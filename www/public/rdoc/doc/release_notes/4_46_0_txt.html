<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>4.46.0 - Sequel: The Database Toolkit for Ruby</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
  var index_rel_prefix = "../../";
</script>

<script src="../../js/navigation.js" defer></script>
<script src="../../js/search.js" defer></script>
<script src="../../js/search_index.js" defer></script>
<script src="../../js/searcher.js" defer></script>
<script src="../../js/darkfish.js" defer></script>

<link href="../../css/fonts.css" rel="stylesheet">
<link href="../../css/rdoc.css" rel="stylesheet">




<body id="top" role="document" class="file">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../table_of_contents.html#pages">Pages</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  
<div class="nav-section">
  <h3>Table of Contents</h3>

  <ul class="link-list" role="directory">
    <li><a href="#label-Deprecated+Features">Deprecated Features</a>
    <li><a href="#label-New+Features">New Features</a>
    <li><a href="#label-Other+Improvements">Other Improvements</a>
    <li><a href="#label-Backwards+Compatibility">Backwards Compatibility</a>
  </ul>
</div>


  <div id="project-metadata">
    <div id="fileindex-section" class="nav-section">
  <h3>Pages</h3>

  <ul class="link-list">
  
    <li><a href="../../CHANGELOG.html">CHANGELOG</a>
  
    <li><a href="../../MIT-LICENSE.html">MIT-LICENSE</a>
  
    <li><a href="../../README_rdoc.html">README</a>
  
    <li><a href="../../doc/CHANGELOG_old.html">CHANGELOG.old</a>
  
    <li><a href="../../doc/advanced_associations_rdoc.html">advanced_associations</a>
  
    <li><a href="../../doc/association_basics_rdoc.html">association_basics</a>
  
    <li><a href="../../doc/bin_sequel_rdoc.html">bin_sequel</a>
  
    <li><a href="../../doc/cheat_sheet_rdoc.html">cheat_sheet</a>
  
    <li><a href="../../doc/code_order_rdoc.html">code_order</a>
  
    <li><a href="../../doc/core_extensions_rdoc.html">core_extensions</a>
  
    <li><a href="../../doc/dataset_basics_rdoc.html">dataset_basics</a>
  
    <li><a href="../../doc/dataset_filtering_rdoc.html">dataset_filtering</a>
  
    <li><a href="../../doc/extensions_rdoc.html">extensions</a>
  
    <li><a href="../../doc/fork_safety_rdoc.html">fork_safety</a>
  
    <li><a href="../../doc/mass_assignment_rdoc.html">mass_assignment</a>
  
    <li><a href="../../doc/migration_rdoc.html">migration</a>
  
    <li><a href="../../doc/model_dataset_method_design_rdoc.html">model_dataset_method_design</a>
  
    <li><a href="../../doc/model_hooks_rdoc.html">model_hooks</a>
  
    <li><a href="../../doc/model_plugins_rdoc.html">model_plugins</a>
  
    <li><a href="../../doc/mssql_stored_procedures_rdoc.html">mssql_stored_procedures</a>
  
    <li><a href="../../doc/object_model_rdoc.html">object_model</a>
  
    <li><a href="../../doc/opening_databases_rdoc.html">opening_databases</a>
  
    <li><a href="../../doc/postgresql_rdoc.html">postgresql</a>
  
    <li><a href="../../doc/prepared_statements_rdoc.html">prepared_statements</a>
  
    <li><a href="../../doc/querying_rdoc.html">querying</a>
  
    <li><a href="../../doc/reflection_rdoc.html">reflection</a>
  
    <li><a href="../../doc/release_notes/1_0_txt.html">1.0</a>
  
    <li><a href="../../doc/release_notes/1_1_txt.html">1.1</a>
  
    <li><a href="../../doc/release_notes/1_3_txt.html">1.3</a>
  
    <li><a href="../../doc/release_notes/1_4_0_txt.html">1.4.0</a>
  
    <li><a href="../../doc/release_notes/1_5_0_txt.html">1.5.0</a>
  
    <li><a href="../../doc/release_notes/2_0_0_txt.html">2.0.0</a>
  
    <li><a href="../../doc/release_notes/2_1_0_txt.html">2.1.0</a>
  
    <li><a href="../../doc/release_notes/2_10_0_txt.html">2.10.0</a>
  
    <li><a href="../../doc/release_notes/2_11_0_txt.html">2.11.0</a>
  
    <li><a href="../../doc/release_notes/2_12_0_txt.html">2.12.0</a>
  
    <li><a href="../../doc/release_notes/2_2_0_txt.html">2.2.0</a>
  
    <li><a href="../../doc/release_notes/2_3_0_txt.html">2.3.0</a>
  
    <li><a href="../../doc/release_notes/2_4_0_txt.html">2.4.0</a>
  
    <li><a href="../../doc/release_notes/2_5_0_txt.html">2.5.0</a>
  
    <li><a href="../../doc/release_notes/2_6_0_txt.html">2.6.0</a>
  
    <li><a href="../../doc/release_notes/2_7_0_txt.html">2.7.0</a>
  
    <li><a href="../../doc/release_notes/2_8_0_txt.html">2.8.0</a>
  
    <li><a href="../../doc/release_notes/2_9_0_txt.html">2.9.0</a>
  
    <li><a href="../../doc/release_notes/3_0_0_txt.html">3.0.0</a>
  
    <li><a href="../../doc/release_notes/3_1_0_txt.html">3.1.0</a>
  
    <li><a href="../../doc/release_notes/3_10_0_txt.html">3.10.0</a>
  
    <li><a href="../../doc/release_notes/3_11_0_txt.html">3.11.0</a>
  
    <li><a href="../../doc/release_notes/3_12_0_txt.html">3.12.0</a>
  
    <li><a href="../../doc/release_notes/3_13_0_txt.html">3.13.0</a>
  
    <li><a href="../../doc/release_notes/3_14_0_txt.html">3.14.0</a>
  
    <li><a href="../../doc/release_notes/3_15_0_txt.html">3.15.0</a>
  
    <li><a href="../../doc/release_notes/3_16_0_txt.html">3.16.0</a>
  
    <li><a href="../../doc/release_notes/3_17_0_txt.html">3.17.0</a>
  
    <li><a href="../../doc/release_notes/3_18_0_txt.html">3.18.0</a>
  
    <li><a href="../../doc/release_notes/3_19_0_txt.html">3.19.0</a>
  
    <li><a href="../../doc/release_notes/3_2_0_txt.html">3.2.0</a>
  
    <li><a href="../../doc/release_notes/3_20_0_txt.html">3.20.0</a>
  
    <li><a href="../../doc/release_notes/3_21_0_txt.html">3.21.0</a>
  
    <li><a href="../../doc/release_notes/3_22_0_txt.html">3.22.0</a>
  
    <li><a href="../../doc/release_notes/3_23_0_txt.html">3.23.0</a>
  
    <li><a href="../../doc/release_notes/3_24_0_txt.html">3.24.0</a>
  
    <li><a href="../../doc/release_notes/3_25_0_txt.html">3.25.0</a>
  
    <li><a href="../../doc/release_notes/3_26_0_txt.html">3.26.0</a>
  
    <li><a href="../../doc/release_notes/3_27_0_txt.html">3.27.0</a>
  
    <li><a href="../../doc/release_notes/3_28_0_txt.html">3.28.0</a>
  
    <li><a href="../../doc/release_notes/3_29_0_txt.html">3.29.0</a>
  
    <li><a href="../../doc/release_notes/3_3_0_txt.html">3.3.0</a>
  
    <li><a href="../../doc/release_notes/3_30_0_txt.html">3.30.0</a>
  
    <li><a href="../../doc/release_notes/3_31_0_txt.html">3.31.0</a>
  
    <li><a href="../../doc/release_notes/3_32_0_txt.html">3.32.0</a>
  
    <li><a href="../../doc/release_notes/3_33_0_txt.html">3.33.0</a>
  
    <li><a href="../../doc/release_notes/3_34_0_txt.html">3.34.0</a>
  
    <li><a href="../../doc/release_notes/3_35_0_txt.html">3.35.0</a>
  
    <li><a href="../../doc/release_notes/3_36_0_txt.html">3.36.0</a>
  
    <li><a href="../../doc/release_notes/3_37_0_txt.html">3.37.0</a>
  
    <li><a href="../../doc/release_notes/3_38_0_txt.html">3.38.0</a>
  
    <li><a href="../../doc/release_notes/3_39_0_txt.html">3.39.0</a>
  
    <li><a href="../../doc/release_notes/3_4_0_txt.html">3.4.0</a>
  
    <li><a href="../../doc/release_notes/3_40_0_txt.html">3.40.0</a>
  
    <li><a href="../../doc/release_notes/3_41_0_txt.html">3.41.0</a>
  
    <li><a href="../../doc/release_notes/3_42_0_txt.html">3.42.0</a>
  
    <li><a href="../../doc/release_notes/3_43_0_txt.html">3.43.0</a>
  
    <li><a href="../../doc/release_notes/3_44_0_txt.html">3.44.0</a>
  
    <li><a href="../../doc/release_notes/3_45_0_txt.html">3.45.0</a>
  
    <li><a href="../../doc/release_notes/3_46_0_txt.html">3.46.0</a>
  
    <li><a href="../../doc/release_notes/3_47_0_txt.html">3.47.0</a>
  
    <li><a href="../../doc/release_notes/3_48_0_txt.html">3.48.0</a>
  
    <li><a href="../../doc/release_notes/3_5_0_txt.html">3.5.0</a>
  
    <li><a href="../../doc/release_notes/3_6_0_txt.html">3.6.0</a>
  
    <li><a href="../../doc/release_notes/3_7_0_txt.html">3.7.0</a>
  
    <li><a href="../../doc/release_notes/3_8_0_txt.html">3.8.0</a>
  
    <li><a href="../../doc/release_notes/3_9_0_txt.html">3.9.0</a>
  
    <li><a href="../../doc/release_notes/4_0_0_txt.html">4.0.0</a>
  
    <li><a href="../../doc/release_notes/4_1_0_txt.html">4.1.0</a>
  
    <li><a href="../../doc/release_notes/4_10_0_txt.html">4.10.0</a>
  
    <li><a href="../../doc/release_notes/4_11_0_txt.html">4.11.0</a>
  
    <li><a href="../../doc/release_notes/4_12_0_txt.html">4.12.0</a>
  
    <li><a href="../../doc/release_notes/4_13_0_txt.html">4.13.0</a>
  
    <li><a href="../../doc/release_notes/4_14_0_txt.html">4.14.0</a>
  
    <li><a href="../../doc/release_notes/4_15_0_txt.html">4.15.0</a>
  
    <li><a href="../../doc/release_notes/4_16_0_txt.html">4.16.0</a>
  
    <li><a href="../../doc/release_notes/4_17_0_txt.html">4.17.0</a>
  
    <li><a href="../../doc/release_notes/4_18_0_txt.html">4.18.0</a>
  
    <li><a href="../../doc/release_notes/4_19_0_txt.html">4.19.0</a>
  
    <li><a href="../../doc/release_notes/4_2_0_txt.html">4.2.0</a>
  
    <li><a href="../../doc/release_notes/4_20_0_txt.html">4.20.0</a>
  
    <li><a href="../../doc/release_notes/4_21_0_txt.html">4.21.0</a>
  
    <li><a href="../../doc/release_notes/4_22_0_txt.html">4.22.0</a>
  
    <li><a href="../../doc/release_notes/4_23_0_txt.html">4.23.0</a>
  
    <li><a href="../../doc/release_notes/4_24_0_txt.html">4.24.0</a>
  
    <li><a href="../../doc/release_notes/4_25_0_txt.html">4.25.0</a>
  
    <li><a href="../../doc/release_notes/4_26_0_txt.html">4.26.0</a>
  
    <li><a href="../../doc/release_notes/4_27_0_txt.html">4.27.0</a>
  
    <li><a href="../../doc/release_notes/4_28_0_txt.html">4.28.0</a>
  
    <li><a href="../../doc/release_notes/4_29_0_txt.html">4.29.0</a>
  
    <li><a href="../../doc/release_notes/4_3_0_txt.html">4.3.0</a>
  
    <li><a href="../../doc/release_notes/4_30_0_txt.html">4.30.0</a>
  
    <li><a href="../../doc/release_notes/4_31_0_txt.html">4.31.0</a>
  
    <li><a href="../../doc/release_notes/4_32_0_txt.html">4.32.0</a>
  
    <li><a href="../../doc/release_notes/4_33_0_txt.html">4.33.0</a>
  
    <li><a href="../../doc/release_notes/4_34_0_txt.html">4.34.0</a>
  
    <li><a href="../../doc/release_notes/4_35_0_txt.html">4.35.0</a>
  
    <li><a href="../../doc/release_notes/4_36_0_txt.html">4.36.0</a>
  
    <li><a href="../../doc/release_notes/4_37_0_txt.html">4.37.0</a>
  
    <li><a href="../../doc/release_notes/4_38_0_txt.html">4.38.0</a>
  
    <li><a href="../../doc/release_notes/4_39_0_txt.html">4.39.0</a>
  
    <li><a href="../../doc/release_notes/4_4_0_txt.html">4.4.0</a>
  
    <li><a href="../../doc/release_notes/4_40_0_txt.html">4.40.0</a>
  
    <li><a href="../../doc/release_notes/4_41_0_txt.html">4.41.0</a>
  
    <li><a href="../../doc/release_notes/4_42_0_txt.html">4.42.0</a>
  
    <li><a href="../../doc/release_notes/4_43_0_txt.html">4.43.0</a>
  
    <li><a href="../../doc/release_notes/4_44_0_txt.html">4.44.0</a>
  
    <li><a href="../../doc/release_notes/4_45_0_txt.html">4.45.0</a>
  
    <li><a href="../../doc/release_notes/4_46_0_txt.html">4.46.0</a>
  
    <li><a href="../../doc/release_notes/4_47_0_txt.html">4.47.0</a>
  
    <li><a href="../../doc/release_notes/4_48_0_txt.html">4.48.0</a>
  
    <li><a href="../../doc/release_notes/4_49_0_txt.html">4.49.0</a>
  
    <li><a href="../../doc/release_notes/4_5_0_txt.html">4.5.0</a>
  
    <li><a href="../../doc/release_notes/4_6_0_txt.html">4.6.0</a>
  
    <li><a href="../../doc/release_notes/4_7_0_txt.html">4.7.0</a>
  
    <li><a href="../../doc/release_notes/4_8_0_txt.html">4.8.0</a>
  
    <li><a href="../../doc/release_notes/4_9_0_txt.html">4.9.0</a>
  
    <li><a href="../../doc/release_notes/5_0_0_txt.html">5.0.0</a>
  
    <li><a href="../../doc/release_notes/5_1_0_txt.html">5.1.0</a>
  
    <li><a href="../../doc/release_notes/5_10_0_txt.html">5.10.0</a>
  
    <li><a href="../../doc/release_notes/5_11_0_txt.html">5.11.0</a>
  
    <li><a href="../../doc/release_notes/5_12_0_txt.html">5.12.0</a>
  
    <li><a href="../../doc/release_notes/5_13_0_txt.html">5.13.0</a>
  
    <li><a href="../../doc/release_notes/5_14_0_txt.html">5.14.0</a>
  
    <li><a href="../../doc/release_notes/5_15_0_txt.html">5.15.0</a>
  
    <li><a href="../../doc/release_notes/5_16_0_txt.html">5.16.0</a>
  
    <li><a href="../../doc/release_notes/5_17_0_txt.html">5.17.0</a>
  
    <li><a href="../../doc/release_notes/5_18_0_txt.html">5.18.0</a>
  
    <li><a href="../../doc/release_notes/5_19_0_txt.html">5.19.0</a>
  
    <li><a href="../../doc/release_notes/5_2_0_txt.html">5.2.0</a>
  
    <li><a href="../../doc/release_notes/5_20_0_txt.html">5.20.0</a>
  
    <li><a href="../../doc/release_notes/5_21_0_txt.html">5.21.0</a>
  
    <li><a href="../../doc/release_notes/5_22_0_txt.html">5.22.0</a>
  
    <li><a href="../../doc/release_notes/5_23_0_txt.html">5.23.0</a>
  
    <li><a href="../../doc/release_notes/5_24_0_txt.html">5.24.0</a>
  
    <li><a href="../../doc/release_notes/5_25_0_txt.html">5.25.0</a>
  
    <li><a href="../../doc/release_notes/5_26_0_txt.html">5.26.0</a>
  
    <li><a href="../../doc/release_notes/5_27_0_txt.html">5.27.0</a>
  
    <li><a href="../../doc/release_notes/5_28_0_txt.html">5.28.0</a>
  
    <li><a href="../../doc/release_notes/5_29_0_txt.html">5.29.0</a>
  
    <li><a href="../../doc/release_notes/5_3_0_txt.html">5.3.0</a>
  
    <li><a href="../../doc/release_notes/5_30_0_txt.html">5.30.0</a>
  
    <li><a href="../../doc/release_notes/5_31_0_txt.html">5.31.0</a>
  
    <li><a href="../../doc/release_notes/5_32_0_txt.html">5.32.0</a>
  
    <li><a href="../../doc/release_notes/5_33_0_txt.html">5.33.0</a>
  
    <li><a href="../../doc/release_notes/5_34_0_txt.html">5.34.0</a>
  
    <li><a href="../../doc/release_notes/5_35_0_txt.html">5.35.0</a>
  
    <li><a href="../../doc/release_notes/5_36_0_txt.html">5.36.0</a>
  
    <li><a href="../../doc/release_notes/5_37_0_txt.html">5.37.0</a>
  
    <li><a href="../../doc/release_notes/5_38_0_txt.html">5.38.0</a>
  
    <li><a href="../../doc/release_notes/5_39_0_txt.html">5.39.0</a>
  
    <li><a href="../../doc/release_notes/5_4_0_txt.html">5.4.0</a>
  
    <li><a href="../../doc/release_notes/5_40_0_txt.html">5.40.0</a>
  
    <li><a href="../../doc/release_notes/5_41_0_txt.html">5.41.0</a>
  
    <li><a href="../../doc/release_notes/5_42_0_txt.html">5.42.0</a>
  
    <li><a href="../../doc/release_notes/5_43_0_txt.html">5.43.0</a>
  
    <li><a href="../../doc/release_notes/5_44_0_txt.html">5.44.0</a>
  
    <li><a href="../../doc/release_notes/5_45_0_txt.html">5.45.0</a>
  
    <li><a href="../../doc/release_notes/5_46_0_txt.html">5.46.0</a>
  
    <li><a href="../../doc/release_notes/5_47_0_txt.html">5.47.0</a>
  
    <li><a href="../../doc/release_notes/5_48_0_txt.html">5.48.0</a>
  
    <li><a href="../../doc/release_notes/5_49_0_txt.html">5.49.0</a>
  
    <li><a href="../../doc/release_notes/5_5_0_txt.html">5.5.0</a>
  
    <li><a href="../../doc/release_notes/5_50_0_txt.html">5.50.0</a>
  
    <li><a href="../../doc/release_notes/5_51_0_txt.html">5.51.0</a>
  
    <li><a href="../../doc/release_notes/5_52_0_txt.html">5.52.0</a>
  
    <li><a href="../../doc/release_notes/5_53_0_txt.html">5.53.0</a>
  
    <li><a href="../../doc/release_notes/5_54_0_txt.html">5.54.0</a>
  
    <li><a href="../../doc/release_notes/5_55_0_txt.html">5.55.0</a>
  
    <li><a href="../../doc/release_notes/5_6_0_txt.html">5.6.0</a>
  
    <li><a href="../../doc/release_notes/5_7_0_txt.html">5.7.0</a>
  
    <li><a href="../../doc/release_notes/5_8_0_txt.html">5.8.0</a>
  
    <li><a href="../../doc/release_notes/5_9_0_txt.html">5.9.0</a>
  
    <li><a href="../../doc/schema_modification_rdoc.html">schema_modification</a>
  
    <li><a href="../../doc/security_rdoc.html">security</a>
  
    <li><a href="../../doc/sharding_rdoc.html">sharding</a>
  
    <li><a href="../../doc/sql_rdoc.html">sql</a>
  
    <li><a href="../../doc/testing_rdoc.html">testing</a>
  
    <li><a href="../../doc/thread_safety_rdoc.html">thread_safety</a>
  
    <li><a href="../../doc/transactions_rdoc.html">transactions</a>
  
    <li><a href="../../doc/validations_rdoc.html">validations</a>
  
    <li><a href="../../doc/virtual_rows_rdoc.html">virtual_rows</a>
  
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-label="Page doc/release_notes/4.46.0.txt">

<h1 id="label-Deprecated+Features">Deprecated Features<span><a href="#label-Deprecated+Features">&para;</a> <a href="#top">&uarr;</a></span></h1>
<ul><li>
<p>Symbol splitting is now deprecated by default.  <a href="../../Sequel.html"><code>Sequel</code></a> has split symbols since the very first version, but it has caused many problems over the years and while terse, it isn&#39;t intuitive to new <a href="../../Sequel.html"><code>Sequel</code></a> users and causes significant problems when using databases that use double/triple underscores in identifiers.</p>

<p>If you are using symbols with embedded double/triple underscores, such as:</p>

<pre class="ruby"><span class="ruby-value">:table__column</span>
<span class="ruby-value">:column___alias</span>
<span class="ruby-value">:table__column___alias</span>
</pre>

<p>you either need to turn symbol splitting on by doing:</p>

<pre class="ruby"><span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">split_symbols</span> = <span class="ruby-keyword">true</span>
</pre>

<p>or you need to convert the symbols to <a href="../../Sequel.html"><code>Sequel</code></a> objects:</p>

<pre class="ruby"><span class="ruby-constant">Sequel</span>[<span class="ruby-value">:table</span>][<span class="ruby-value">:column</span>]
<span class="ruby-constant">Sequel</span>[<span class="ruby-value">:column</span>].<span class="ruby-identifier">as</span>(<span class="ruby-value">:alias</span>)
<span class="ruby-constant">Sequel</span>[<span class="ruby-value">:table</span>][<span class="ruby-value">:column</span>].<span class="ruby-identifier">as</span>(<span class="ruby-value">:alias</span>)
</pre>

<p><a href="../../Sequel.html"><code>Sequel</code></a> ships with multiple extensions that make creation of those <a href="../../Sequel.html"><code>Sequel</code></a> objects less verbose, so consider using the symbol_aref, symbol_aref_refinement, symbol_as,  symbol_as_refinement, and/or s extensions.</p>

<p>To automatically convert symbols with double/triple underscores to their <a href="../../Sequel.html"><code>Sequel</code></a> object equivalents, you can use the sequel-unsplit tool available at <a href="https://github.com/jeremyevans/sequel-unsplit">github.com/jeremyevans/sequel-unsplit</a>.</p>

<p>This deprecation also affects virtual row block methods that use double underscores.  For example:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">where</span>{<span class="ruby-identifier">table__column</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">3</span>}
</pre>

<p>should be changed to:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">where</span>{<span class="ruby-identifier">table</span>[<span class="ruby-value">:column</span>] <span class="ruby-operator">&gt;</span> <span class="ruby-value">3</span>}
</pre>
</li><li>
<p>Automatically treating plain strings passed to filtering/update methods as literal strings has been deprecated, with support moved to the auto_literal_strings extension.  The automatic conversion of plain strings to literal SQL is the most common cause of SQL injections in applications using <a href="../../Sequel.html"><code>Sequel</code></a>, since many methods pass their arguments down to the filtering methods, without considering whether the argument might be a string derived from user input.  By requiring explicit marking of literal SQL strings, SQL injections are less likely and easier to audit for.</p>

<p>This change means that unless you want to use the auto_literal_strings extension, code such as:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;a = 1&quot;</span>)
<span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;a &gt; ?&quot;</span>, <span class="ruby-value">1</span>)
</pre>

<p>should to be converted to:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">where</span>(<span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">lit</span>(<span class="ruby-string">&quot;a = 1&quot;</span>))
<span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">where</span>(<span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">lit</span>(<span class="ruby-string">&quot;a &gt; ?&quot;</span>, <span class="ruby-value">1</span>))
</pre>

<p>or even better, avoid literal SQL completely by converting it to use equivalent <a href="../../Sequel.html"><code>Sequel</code></a> expressions:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">where</span>(<span class="ruby-value">:a</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-value">1</span>)
<span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">where</span>{<span class="ruby-identifier">a</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>}
</pre>

<p>This change also affects passing Dataset#update a string:</p>

<pre class="ruby"><span class="ruby-comment"># Before</span>
<span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">update</span>(<span class="ruby-string">&quot;a = a + 1&quot;</span>)

<span class="ruby-comment"># Change to</span>
<span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">update</span>(<span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">lit</span>(<span class="ruby-string">&quot;a = a + 1&quot;</span>))
<span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">update</span>(<span class="ruby-value">:a</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-constant">Sequel</span>[<span class="ruby-value">:a</span>] <span class="ruby-operator">+</span> <span class="ruby-value">1</span>)
</pre>

<p>Note that this deprecation does not affect cases where literal SQL is used for the entire query, such as when using any of the following:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-string">&quot;SELECT * FROM foo&quot;</span>]
<span class="ruby-constant">DB</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&quot;SELECT * FROM foo WHERE a = ?&quot;</span>, <span class="ruby-value">1</span>)
<span class="ruby-constant">DB</span>.<span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">with_sql</span>(<span class="ruby-string">&quot;SELECT * FROM foo WHERE a = ?&quot;</span>, <span class="ruby-value">1</span>)
</pre>
</li><li>
<p>Passing blocks to virtual row methods has been deprecated, with support moved to the virtual_row_method_block extension.  Historically, passing blocks to virtual row methods changed how the methods were handled, but in recent years alternative methods have been added to get the same results. If you don&#39;t want to use the virtual_row_method_block extension, conversion is fairly simple:</p>

<pre class="ruby"><span class="ruby-comment"># WHERE a()</span>
<span class="ruby-comment"># Before</span>
<span class="ruby-identifier">where</span>{<span class="ruby-identifier">a</span>{}}
<span class="ruby-comment"># Change to</span>
<span class="ruby-identifier">where</span>{<span class="ruby-identifier">a</span>.<span class="ruby-identifier">function</span>}

<span class="ruby-comment"># SELECT count(*)</span>
<span class="ruby-comment"># Before</span>
<span class="ruby-identifier">select</span>{<span class="ruby-identifier">count</span>(<span class="ruby-value">:*</span>){}}
<span class="ruby-comment"># Change to</span>
<span class="ruby-identifier">select</span>{<span class="ruby-identifier">count</span>.<span class="ruby-identifier">function</span>.<span class="ruby-identifier">*</span>}

<span class="ruby-comment"># SELECT count(DISTINCT c)</span>
<span class="ruby-comment"># Before</span>
<span class="ruby-identifier">select</span>{<span class="ruby-identifier">count</span>(<span class="ruby-value">:distinct</span>, <span class="ruby-value">:c</span>){}}
<span class="ruby-comment"># Change to</span>
<span class="ruby-identifier">select</span>{<span class="ruby-identifier">count</span>(<span class="ruby-value">:c</span>).<span class="ruby-identifier">distinct</span>}

<span class="ruby-comment"># SELECT sum(c) OVER (PARTITION BY a)</span>
<span class="ruby-comment"># Before</span>
<span class="ruby-identifier">select</span>{<span class="ruby-identifier">count</span>(<span class="ruby-value">:over</span>, <span class="ruby-value">:args</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">c</span>, <span class="ruby-value">:partition</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">:a</span>){}}
<span class="ruby-comment"># Change to</span>
<span class="ruby-identifier">select</span>{<span class="ruby-identifier">count</span>(<span class="ruby-value">:c</span>).<span class="ruby-identifier">over</span>(<span class="ruby-value">:partition</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">:a</span>)}
</pre>
</li><li>
<p>Model.set_allowed_columns and Model#{set,update}_{all,only} have been deprecated, with support moved to the whitelist_security plugin.  These were the historical mass assignment methods supported by <a href="../../Sequel.html"><code>Sequel</code></a>, but set_fields and update_fields have been recommended instead for many years.</p>
</li><li>
<p>Model.finder and .prepared_finder have been deprecated by default, with support moved to the finder plugin.  Model.finder was originally added to make it easy to create optimized finder methods, but few <a href="../../Sequel.html"><code>Sequel</code></a> users actually use it, so it makes more sense to move it to a plugin.</p>
</li><li>
<p>Model.def_dataset_method and Model.subset have been deprecated by default, with support moved to the def_dataset_method plugin. It&#39;s been recommended for many years to use Model.dataset_module to define dataset methods, instead of calling def_dataset_method and subset on the model class.</p>
</li><li>
<p>Using ` in virtual rows to create literal SQL is now deprecated, switch to using Sequel.lit instead:</p>

<pre class="ruby"><span class="ruby-comment"># Before</span>
<span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">where</span>{<span class="ruby-string">`a = 1`</span>}
<span class="ruby-comment"># Change to</span>
<span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">where</span>(<span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">lit</span>(<span class="ruby-string">&#39;a = 1&#39;</span>))
</pre>
</li><li>
<p>Corner cases in argument handling in the filtering methods are now deprecated, including:</p>
<ul><li>
<p>Ignoring a filtering method called without an argument or block. In <a href="../../Sequel.html"><code>Sequel</code></a> 5, this will raise an exception.</p>
</li><li>
<p>Ignoring empty string arguments or other objects that respond to empty? and return true.  In <a href="../../Sequel.html"><code>Sequel</code></a> 5, only an empty array or hash will be ignored.</p>
</li><li>
<p>Ignoring an explicit nil argument when a block is passed.  In <a href="../../Sequel.html"><code>Sequel</code></a> 5, this will use a NULL filter.</p>
</li><li>
<p>Ignoring an explicit nil argument when there is no existing filter on the dataset. In <a href="../../Sequel.html"><code>Sequel</code></a> 5, this will use a NULL filter.</p>
</li></ul>
</li><li>
<p>Using a joined dataset as a <a href="../../Sequel/Model.html"><code>Sequel::Model</code></a> dataset is now deprecated.  Such datasets should now be wrapped in a subquery. In <a href="../../Sequel.html"><code>Sequel</code></a> 5, such datasets will automatically be wrapped in a subquery aliased to the first table.</p>

<pre class="ruby"><span class="ruby-comment"># Before</span>
<span class="ruby-constant">Model</span>.<span class="ruby-identifier">dataset</span> = <span class="ruby-constant">DB</span>[<span class="ruby-value">:a</span>].<span class="ruby-identifier">join</span>(<span class="ruby-value">:b</span>, <span class="ruby-value">:id</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">:b_id</span>)
<span class="ruby-comment"># Change to</span>
<span class="ruby-constant">Model</span>.<span class="ruby-identifier">dataset</span> = <span class="ruby-constant">DB</span>[<span class="ruby-value">:a</span>].<span class="ruby-identifier">join</span>(<span class="ruby-value">:b</span>, <span class="ruby-value">:id</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">:b_id</span>).<span class="ruby-identifier">from_self</span>(<span class="ruby-value">:alias</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">:a</span>)
</pre>
</li><li>
<p>Model.first_where has been deprecated, Model.first should be used instead.</p>
</li><li>
<p>Database#log_yield is now deprecated.  This does not affect any of the adapters that ship with <a href="../../Sequel.html"><code>Sequel</code></a>, but external adapters that have not yet been updated to support log_connection_yield will need to be updated.</p>
</li><li>
<p>The set_overrides extension is now deprecated.  Anyone using it should consider supporting it as an external extension.</p>
</li><li>
<p>Many internal Database and Dataset regexp and string constants that were previously used internally have been deprecated. Additionally, some historical aliases for existing constants have also been deprecated, such as Sequel::Schema::Generator. Ruby 2.3+ is required to receive deprecation warnings related to these constants.</p>
</li><li>
<p>Passing model classes as the first argument to Dataset#join_table and Dataset#graph is now deprecated.  Pass the model&#39;s table name or the model&#39;s datasets instead.</p>
</li><li>
<p>Passing model instances to Dataset#insert and insert_sql is now deprecated. Call values on the model instance to get the values hash, and pass that as the argument instead.</p>
</li><li>
<p>Calling Dataset#set_graph_aliases before Dataset#graph is now deprecated.  Dataset#set_graph_aliases should now be called after Dataset#graph, not before.</p>
</li><li>
<p>The sequel/no_core_ext file is deprecated.  <a href="../../Sequel.html"><code>Sequel</code></a> hasn&#39;t loaded the core extensions by default since <a href="../../Sequel.html"><code>Sequel</code></a> 3.  You can use the following if you want to support both <a href="../../Sequel.html"><code>Sequel</code></a> 3 and <a href="../../Sequel.html"><code>Sequel</code></a> 5:</p>

<pre class="ruby"><span class="ruby-keyword">begin</span>
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;sequel/no_core_ext&#39;</span>
<span class="ruby-keyword">rescue</span> <span class="ruby-constant">LoadError</span>
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;sequel&#39;</span>
<span class="ruby-keyword">end</span>
</pre>
</li><li>
<p>Database#pragma_get and pragma_set on SQLite are now deprecated, along with any method that calls them, such as auto_vacuum, temp_store, foreign_keys, case_sensitive_like, synchronous, and their setter methods.  To set these pragrams for all SQLite database connections, the appropriate options should be passed when creating the Database instance.</p>
</li><li>
<p>Automatically looking up the dataset class for a Database instance by looking for a DatasetClass constant in the Database&#39;s class is now deprecated.  All adapters that ship with <a href="../../Sequel.html"><code>Sequel</code></a> have been converted, but external adapters should now define the Database#dataset_class_default private method appropriately to return the correct dataset class.</p>
</li><li>
<p>Calling Model.db= on a model with a dataset is now deprecated. If a model already has a dataset, you must now use set_dataset or dataset= to change the dataset, not db=.</p>
</li><li>
<p>Sequel::SQL::Expression#sql_literal and lit are now deprecated. These aren&#39;t used internally and aren&#39;t expected to be used externally.</p>
</li><li>
<p>{Integer,Timestamp}Migrator::DEFAULT_SCHEMA_{COLUMN,TABLE} are now deprecated.  They have been replaced by default_schema_column and default_schema_table instance methods.</p>
</li><li>
<p>Passing a Schema::CreateTableGenerator instance as the second argument to Database#create_table is now deprecated.  Database#create_table still supports passing the generator via the :generator option.</p>
</li><li>
<p>Passing a second argument to Database#alter_table is now deprecated.</p>
</li><li>
<p>Sequel::BasicObject.remove_methods! is now deprecated. It has always been a no-op on ruby 1.9+.</p>
</li><li>
<p>Referencing the PG_NAMED_TYPES constant in your code is now deprecated.  Previously, adding entries to the PG_NAMED_TYPES was deprecated, but no deprecation message would be issued by referencing the constant.</p>
</li><li>
<p>The conversion of - to _ in adapter schemes is now deprecated. This does not affect any internal adapters, but it may affect external ones.</p>
</li><li>
<p>The Database#jdbc_* methods in the jdbc/db2 adapter (e.g. jdbc_tables) are now deprecated.  Call the regular versions instead (e.g. tables).</p>
</li><li>
<p>Dataset#_filter and #_filter_or_exclude private methods have been deprecated.  If you have an extension that was calling these methods, switch to the new add_filter private method.</p>
</li></ul>

<h1 id="label-New+Features">New Features<span><a href="#label-New+Features">&para;</a> <a href="#top">&uarr;</a></span></h1>
<ul><li>
<p>The class_table_inheritance plugin now supports an :alias option. If provided, this wraps subclass datasets in subqueries, avoiding problems with ambiguous columns and cases where the wrong table name is used.  Due to the deprecation of joined datasets for models, use of the class_table_inheritance plugin without this :alias option will result in deprecation warnings.  In <a href="../../Sequel.html"><code>Sequel</code></a> 5, class_table_inheritance will default to using an :alias option with the same as the name of the parent table.</p>
</li><li>
<p>The Dataset#sqltime_precision private method has been added. Adapters can use override this if the precision for time values is different from the precision for timestamp values. <a href="../../Sequel.html"><code>Sequel</code></a> uses this support on Microsoft SQL Server, so that time values now support microsecond precision, instead of millisecond precision.</p>
</li></ul>

<h1 id="label-Other+Improvements">Other Improvements<span><a href="#label-Other+Improvements">&para;</a> <a href="#top">&uarr;</a></span></h1>
<ul><li>
<p><a href="../../Sequel/Model.html"><code>Sequel::Model</code></a> classes that use a SQL::Identifier or SQL::QualifiedIdentifier FROM table value will now use optimized lookups and deletes, just as is done for those that use a Symbol or String.</p>
</li><li>
<p>Dataset#simple_select_all? now handles aliased subqueries correctly, returning false instead of true.</p>
</li><li>
<p>If Sequel.application_timezone is set to :utc, <a href="../../Sequel/SQLTime.html#method-c-create"><code>Sequel::SQLTime.create</code></a> will create instances using utc time instead of local time.</p>
</li><li>
<p>If there is an exception while rolling back a transaction when using the :rollback=&gt;:always option, the exception is now raised instead of being ignored.</p>
</li><li>
<p>If a migration file does not contain a migration or contains multiple migrations, the exception raised will now include the file name in the exception message.</p>
</li><li>
<p>In the jdbc/sqlserver adapter, time values with fractional seconds and datetimeoffset values are now handled better when using some versions of the underlying JDBC driver.</p>
</li><li>
<p>An additional disconnect error is recognized when using the mysql and mysql2 adapters.</p>
</li><li>
<p>Dataset#full_text_search on Microsoft SQL Server now works correctly if the no_auto_literal_strings extension is used.</p>
</li><li>
<p>Calling Database#disconnect when using the single connection pool without an active connection works correctly again. It was broken starting in 4.43.0 during changes to implement Database#freeze.</p>
</li><li>
<p>Model class methods are no longer added for private methods defined in a dataset_module block.  Previously, a public model class method was defined, but it would raise an error when called.</p>
</li><li>
<p>Fixnum is no longer referenced in the sqlanywhere shared adapter, fixing deprecation warnings on ruby 2.4.</p>
</li><li>
<p><a href="../../Sequel.html"><code>Sequel</code></a> no longer uses constants for building SQL queries, relying on frozen string literal support for better performance on ruby 2.3+.  However, this decreases SQL query building performance on ruby &lt;2.3.  For the fastest SQL query building, update to a recent version of ruby.</p>
</li><li>
<p><a href="../../Sequel.html"><code>Sequel</code></a> no longer ignores an empty object argument to a filtering method if a block is provided.  Previously, this could raise an exception or produce invalid SQL.</p>
</li><li>
<p>Many small modifications were made to reduce array allocations, providing minor speedups.</p>
</li><li>
<p>Internal use of Array#at has been replaced with Array#[], providing minor speedups on recent ruby versions.</p>
</li><li>
<p>The jdbc/db2 adapter no longer adds jdbc_* methods to JDBC::Database.</p>
</li><li>
<p><a href="../../Sequel.html"><code>Sequel</code></a> no longer issues deprecation warnings on ruby 1.8.7. <a href="../../Sequel.html"><code>Sequel</code></a> 5 will drop support for ruby 1.8.7, and it doesn&#39;t make sense to issue a deprecation warning if you couldn&#39;t upgrade anyway.</p>
</li></ul>

<h1 id="label-Backwards+Compatibility">Backwards Compatibility<span><a href="#label-Backwards+Compatibility">&para;</a> <a href="#top">&uarr;</a></span></h1>
<ul><li>
<p>When specifying the :fields option to a nested_attributes setter, set_fields is now used internally instead of set_only. set_fields has been recommended over set_fields since it&#39;s introduction in <a href="../../Sequel.html"><code>Sequel</code></a> 3.12, but nested_attributes was added in <a href="../../Sequel.html"><code>Sequel</code></a> 3.4, before set_fields was available.  The result of this change is that if additional fields are provided that do not match the fields in the :fields option, they will be ignored instead of an exception being raised.</p>
</li><li>
<p>When specifying a function name using a <a href="../../Sequel/SQL/Identifier.html"><code>Sequel::SQL::Identifier</code></a> instance, the function name is no longer quoted unless <a href="../../Sequel/SQL/Function.html#method-i-quoted"><code>Sequel::SQL::Function#quoted</code></a> is used to create a quoted function.  The reason for this is to make converting virtual row method block code easier.</p>

<pre class="ruby"><span class="ruby-comment"># Before</span>
<span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">function</span>(<span class="ruby-constant">Sequel</span>[<span class="ruby-value">:a</span>]) <span class="ruby-comment"># &quot;a&quot;()</span>

<span class="ruby-comment"># Now</span>
<span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">function</span>(<span class="ruby-constant">Sequel</span>[<span class="ruby-value">:a</span>]) <span class="ruby-comment"># a()</span>
<span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">function</span>(<span class="ruby-constant">Sequel</span>[<span class="ruby-value">:a</span>]).<span class="ruby-identifier">quoted</span> <span class="ruby-comment"># &quot;a&quot;()</span>
</pre>
</li><li>
<p>When passing an SQL::PlaceholderLiteralString instance to a dataset filtering method, the placeholder string is now always wrapped in parentheses:</p>

<pre class="ruby"><span class="ruby-identifier">ds</span>.<span class="ruby-identifier">where</span>(<span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">lit</span>(<span class="ruby-string">&#39;? OR ?&#39;</span>, <span class="ruby-value">:a</span>, <span class="ruby-value">:b</span>)).<span class="ruby-identifier">where</span>(<span class="ruby-value">:c</span>)
<span class="ruby-comment"># Before: WHERE a OR b AND c</span>
<span class="ruby-comment"># Now: WHERE (a OR b) AND c</span>
</pre>

<p>This is more of a bugfix than a backwards compatibility issue, but is listed in the backwards compatibility section as there may be applications that could break due to this change.</p>
</li><li>
<p>Model.subset now calls Model.dataset_module.subset, instead of the other way around.  If your code depends on this, you will need to make modifications.</p>
</li><li>
<p>The private Database#column_definition_order method no longer uses const_get(:COLUMN_DEFINITION_ORDER).  External adapters that defined COLUMN_DEFINITION_ORDER but did not override this method must now override this method.</p>
</li><li>
<p>The private Database#native_function_name method no longer uses const_get(:EMULATED_FUNCTION_MAP). External adapters that defined EMULATED_FUNCTION_MAP but did not override this method must now override this method.</p>
</li></ul>

</main>



<footer id="validator-badges" role="contentinfo">
  <p><a href="https://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://ruby.github.io/rdoc/">RDoc</a> 6.1.2.1.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

