<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>4.0.0 - Sequel: The Database Toolkit for Ruby</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
  var index_rel_prefix = "../../";
</script>

<script src="../../js/navigation.js" defer></script>
<script src="../../js/search.js" defer></script>
<script src="../../js/search_index.js" defer></script>
<script src="../../js/searcher.js" defer></script>
<script src="../../js/darkfish.js" defer></script>

<link href="../../css/fonts.css" rel="stylesheet">
<link href="../../css/rdoc.css" rel="stylesheet">




<body id="top" role="document" class="file">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../table_of_contents.html#pages">Pages</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  
<div class="nav-section">
  <h3>Table of Contents</h3>

  <ul class="link-list" role="directory">
    <li><a href="#label-Backwards+Compatibility">Backwards Compatibility</a>
    <li><a href="#label-New+Features">New Features</a>
    <li><a href="#label-Support+for+New+Features+in+PostgreSQL+9.3">Support for New Features in PostgreSQL 9.3</a>
    <li><a href="#label-Other+Improvements">Other Improvements</a>
  </ul>
</div>


  <div id="project-metadata">
    <div id="fileindex-section" class="nav-section">
  <h3>Pages</h3>

  <ul class="link-list">
  
    <li><a href="../../CHANGELOG.html">CHANGELOG</a>
  
    <li><a href="../../MIT-LICENSE.html">MIT-LICENSE</a>
  
    <li><a href="../../README_rdoc.html">README</a>
  
    <li><a href="../../doc/CHANGELOG_old.html">CHANGELOG.old</a>
  
    <li><a href="../../doc/advanced_associations_rdoc.html">advanced_associations</a>
  
    <li><a href="../../doc/association_basics_rdoc.html">association_basics</a>
  
    <li><a href="../../doc/bin_sequel_rdoc.html">bin_sequel</a>
  
    <li><a href="../../doc/cheat_sheet_rdoc.html">cheat_sheet</a>
  
    <li><a href="../../doc/code_order_rdoc.html">code_order</a>
  
    <li><a href="../../doc/core_extensions_rdoc.html">core_extensions</a>
  
    <li><a href="../../doc/dataset_basics_rdoc.html">dataset_basics</a>
  
    <li><a href="../../doc/dataset_filtering_rdoc.html">dataset_filtering</a>
  
    <li><a href="../../doc/extensions_rdoc.html">extensions</a>
  
    <li><a href="../../doc/fork_safety_rdoc.html">fork_safety</a>
  
    <li><a href="../../doc/mass_assignment_rdoc.html">mass_assignment</a>
  
    <li><a href="../../doc/migration_rdoc.html">migration</a>
  
    <li><a href="../../doc/model_dataset_method_design_rdoc.html">model_dataset_method_design</a>
  
    <li><a href="../../doc/model_hooks_rdoc.html">model_hooks</a>
  
    <li><a href="../../doc/model_plugins_rdoc.html">model_plugins</a>
  
    <li><a href="../../doc/mssql_stored_procedures_rdoc.html">mssql_stored_procedures</a>
  
    <li><a href="../../doc/object_model_rdoc.html">object_model</a>
  
    <li><a href="../../doc/opening_databases_rdoc.html">opening_databases</a>
  
    <li><a href="../../doc/postgresql_rdoc.html">postgresql</a>
  
    <li><a href="../../doc/prepared_statements_rdoc.html">prepared_statements</a>
  
    <li><a href="../../doc/querying_rdoc.html">querying</a>
  
    <li><a href="../../doc/reflection_rdoc.html">reflection</a>
  
    <li><a href="../../doc/release_notes/1_0_txt.html">1.0</a>
  
    <li><a href="../../doc/release_notes/1_1_txt.html">1.1</a>
  
    <li><a href="../../doc/release_notes/1_3_txt.html">1.3</a>
  
    <li><a href="../../doc/release_notes/1_4_0_txt.html">1.4.0</a>
  
    <li><a href="../../doc/release_notes/1_5_0_txt.html">1.5.0</a>
  
    <li><a href="../../doc/release_notes/2_0_0_txt.html">2.0.0</a>
  
    <li><a href="../../doc/release_notes/2_1_0_txt.html">2.1.0</a>
  
    <li><a href="../../doc/release_notes/2_10_0_txt.html">2.10.0</a>
  
    <li><a href="../../doc/release_notes/2_11_0_txt.html">2.11.0</a>
  
    <li><a href="../../doc/release_notes/2_12_0_txt.html">2.12.0</a>
  
    <li><a href="../../doc/release_notes/2_2_0_txt.html">2.2.0</a>
  
    <li><a href="../../doc/release_notes/2_3_0_txt.html">2.3.0</a>
  
    <li><a href="../../doc/release_notes/2_4_0_txt.html">2.4.0</a>
  
    <li><a href="../../doc/release_notes/2_5_0_txt.html">2.5.0</a>
  
    <li><a href="../../doc/release_notes/2_6_0_txt.html">2.6.0</a>
  
    <li><a href="../../doc/release_notes/2_7_0_txt.html">2.7.0</a>
  
    <li><a href="../../doc/release_notes/2_8_0_txt.html">2.8.0</a>
  
    <li><a href="../../doc/release_notes/2_9_0_txt.html">2.9.0</a>
  
    <li><a href="../../doc/release_notes/3_0_0_txt.html">3.0.0</a>
  
    <li><a href="../../doc/release_notes/3_1_0_txt.html">3.1.0</a>
  
    <li><a href="../../doc/release_notes/3_10_0_txt.html">3.10.0</a>
  
    <li><a href="../../doc/release_notes/3_11_0_txt.html">3.11.0</a>
  
    <li><a href="../../doc/release_notes/3_12_0_txt.html">3.12.0</a>
  
    <li><a href="../../doc/release_notes/3_13_0_txt.html">3.13.0</a>
  
    <li><a href="../../doc/release_notes/3_14_0_txt.html">3.14.0</a>
  
    <li><a href="../../doc/release_notes/3_15_0_txt.html">3.15.0</a>
  
    <li><a href="../../doc/release_notes/3_16_0_txt.html">3.16.0</a>
  
    <li><a href="../../doc/release_notes/3_17_0_txt.html">3.17.0</a>
  
    <li><a href="../../doc/release_notes/3_18_0_txt.html">3.18.0</a>
  
    <li><a href="../../doc/release_notes/3_19_0_txt.html">3.19.0</a>
  
    <li><a href="../../doc/release_notes/3_2_0_txt.html">3.2.0</a>
  
    <li><a href="../../doc/release_notes/3_20_0_txt.html">3.20.0</a>
  
    <li><a href="../../doc/release_notes/3_21_0_txt.html">3.21.0</a>
  
    <li><a href="../../doc/release_notes/3_22_0_txt.html">3.22.0</a>
  
    <li><a href="../../doc/release_notes/3_23_0_txt.html">3.23.0</a>
  
    <li><a href="../../doc/release_notes/3_24_0_txt.html">3.24.0</a>
  
    <li><a href="../../doc/release_notes/3_25_0_txt.html">3.25.0</a>
  
    <li><a href="../../doc/release_notes/3_26_0_txt.html">3.26.0</a>
  
    <li><a href="../../doc/release_notes/3_27_0_txt.html">3.27.0</a>
  
    <li><a href="../../doc/release_notes/3_28_0_txt.html">3.28.0</a>
  
    <li><a href="../../doc/release_notes/3_29_0_txt.html">3.29.0</a>
  
    <li><a href="../../doc/release_notes/3_3_0_txt.html">3.3.0</a>
  
    <li><a href="../../doc/release_notes/3_30_0_txt.html">3.30.0</a>
  
    <li><a href="../../doc/release_notes/3_31_0_txt.html">3.31.0</a>
  
    <li><a href="../../doc/release_notes/3_32_0_txt.html">3.32.0</a>
  
    <li><a href="../../doc/release_notes/3_33_0_txt.html">3.33.0</a>
  
    <li><a href="../../doc/release_notes/3_34_0_txt.html">3.34.0</a>
  
    <li><a href="../../doc/release_notes/3_35_0_txt.html">3.35.0</a>
  
    <li><a href="../../doc/release_notes/3_36_0_txt.html">3.36.0</a>
  
    <li><a href="../../doc/release_notes/3_37_0_txt.html">3.37.0</a>
  
    <li><a href="../../doc/release_notes/3_38_0_txt.html">3.38.0</a>
  
    <li><a href="../../doc/release_notes/3_39_0_txt.html">3.39.0</a>
  
    <li><a href="../../doc/release_notes/3_4_0_txt.html">3.4.0</a>
  
    <li><a href="../../doc/release_notes/3_40_0_txt.html">3.40.0</a>
  
    <li><a href="../../doc/release_notes/3_41_0_txt.html">3.41.0</a>
  
    <li><a href="../../doc/release_notes/3_42_0_txt.html">3.42.0</a>
  
    <li><a href="../../doc/release_notes/3_43_0_txt.html">3.43.0</a>
  
    <li><a href="../../doc/release_notes/3_44_0_txt.html">3.44.0</a>
  
    <li><a href="../../doc/release_notes/3_45_0_txt.html">3.45.0</a>
  
    <li><a href="../../doc/release_notes/3_46_0_txt.html">3.46.0</a>
  
    <li><a href="../../doc/release_notes/3_47_0_txt.html">3.47.0</a>
  
    <li><a href="../../doc/release_notes/3_48_0_txt.html">3.48.0</a>
  
    <li><a href="../../doc/release_notes/3_5_0_txt.html">3.5.0</a>
  
    <li><a href="../../doc/release_notes/3_6_0_txt.html">3.6.0</a>
  
    <li><a href="../../doc/release_notes/3_7_0_txt.html">3.7.0</a>
  
    <li><a href="../../doc/release_notes/3_8_0_txt.html">3.8.0</a>
  
    <li><a href="../../doc/release_notes/3_9_0_txt.html">3.9.0</a>
  
    <li><a href="../../doc/release_notes/4_0_0_txt.html">4.0.0</a>
  
    <li><a href="../../doc/release_notes/4_1_0_txt.html">4.1.0</a>
  
    <li><a href="../../doc/release_notes/4_10_0_txt.html">4.10.0</a>
  
    <li><a href="../../doc/release_notes/4_11_0_txt.html">4.11.0</a>
  
    <li><a href="../../doc/release_notes/4_12_0_txt.html">4.12.0</a>
  
    <li><a href="../../doc/release_notes/4_13_0_txt.html">4.13.0</a>
  
    <li><a href="../../doc/release_notes/4_14_0_txt.html">4.14.0</a>
  
    <li><a href="../../doc/release_notes/4_15_0_txt.html">4.15.0</a>
  
    <li><a href="../../doc/release_notes/4_16_0_txt.html">4.16.0</a>
  
    <li><a href="../../doc/release_notes/4_17_0_txt.html">4.17.0</a>
  
    <li><a href="../../doc/release_notes/4_18_0_txt.html">4.18.0</a>
  
    <li><a href="../../doc/release_notes/4_19_0_txt.html">4.19.0</a>
  
    <li><a href="../../doc/release_notes/4_2_0_txt.html">4.2.0</a>
  
    <li><a href="../../doc/release_notes/4_20_0_txt.html">4.20.0</a>
  
    <li><a href="../../doc/release_notes/4_21_0_txt.html">4.21.0</a>
  
    <li><a href="../../doc/release_notes/4_22_0_txt.html">4.22.0</a>
  
    <li><a href="../../doc/release_notes/4_23_0_txt.html">4.23.0</a>
  
    <li><a href="../../doc/release_notes/4_24_0_txt.html">4.24.0</a>
  
    <li><a href="../../doc/release_notes/4_25_0_txt.html">4.25.0</a>
  
    <li><a href="../../doc/release_notes/4_26_0_txt.html">4.26.0</a>
  
    <li><a href="../../doc/release_notes/4_27_0_txt.html">4.27.0</a>
  
    <li><a href="../../doc/release_notes/4_28_0_txt.html">4.28.0</a>
  
    <li><a href="../../doc/release_notes/4_29_0_txt.html">4.29.0</a>
  
    <li><a href="../../doc/release_notes/4_3_0_txt.html">4.3.0</a>
  
    <li><a href="../../doc/release_notes/4_30_0_txt.html">4.30.0</a>
  
    <li><a href="../../doc/release_notes/4_31_0_txt.html">4.31.0</a>
  
    <li><a href="../../doc/release_notes/4_32_0_txt.html">4.32.0</a>
  
    <li><a href="../../doc/release_notes/4_33_0_txt.html">4.33.0</a>
  
    <li><a href="../../doc/release_notes/4_34_0_txt.html">4.34.0</a>
  
    <li><a href="../../doc/release_notes/4_35_0_txt.html">4.35.0</a>
  
    <li><a href="../../doc/release_notes/4_36_0_txt.html">4.36.0</a>
  
    <li><a href="../../doc/release_notes/4_37_0_txt.html">4.37.0</a>
  
    <li><a href="../../doc/release_notes/4_38_0_txt.html">4.38.0</a>
  
    <li><a href="../../doc/release_notes/4_39_0_txt.html">4.39.0</a>
  
    <li><a href="../../doc/release_notes/4_4_0_txt.html">4.4.0</a>
  
    <li><a href="../../doc/release_notes/4_40_0_txt.html">4.40.0</a>
  
    <li><a href="../../doc/release_notes/4_41_0_txt.html">4.41.0</a>
  
    <li><a href="../../doc/release_notes/4_42_0_txt.html">4.42.0</a>
  
    <li><a href="../../doc/release_notes/4_43_0_txt.html">4.43.0</a>
  
    <li><a href="../../doc/release_notes/4_44_0_txt.html">4.44.0</a>
  
    <li><a href="../../doc/release_notes/4_45_0_txt.html">4.45.0</a>
  
    <li><a href="../../doc/release_notes/4_46_0_txt.html">4.46.0</a>
  
    <li><a href="../../doc/release_notes/4_47_0_txt.html">4.47.0</a>
  
    <li><a href="../../doc/release_notes/4_48_0_txt.html">4.48.0</a>
  
    <li><a href="../../doc/release_notes/4_49_0_txt.html">4.49.0</a>
  
    <li><a href="../../doc/release_notes/4_5_0_txt.html">4.5.0</a>
  
    <li><a href="../../doc/release_notes/4_6_0_txt.html">4.6.0</a>
  
    <li><a href="../../doc/release_notes/4_7_0_txt.html">4.7.0</a>
  
    <li><a href="../../doc/release_notes/4_8_0_txt.html">4.8.0</a>
  
    <li><a href="../../doc/release_notes/4_9_0_txt.html">4.9.0</a>
  
    <li><a href="../../doc/release_notes/5_0_0_txt.html">5.0.0</a>
  
    <li><a href="../../doc/release_notes/5_1_0_txt.html">5.1.0</a>
  
    <li><a href="../../doc/release_notes/5_10_0_txt.html">5.10.0</a>
  
    <li><a href="../../doc/release_notes/5_11_0_txt.html">5.11.0</a>
  
    <li><a href="../../doc/release_notes/5_12_0_txt.html">5.12.0</a>
  
    <li><a href="../../doc/release_notes/5_13_0_txt.html">5.13.0</a>
  
    <li><a href="../../doc/release_notes/5_14_0_txt.html">5.14.0</a>
  
    <li><a href="../../doc/release_notes/5_15_0_txt.html">5.15.0</a>
  
    <li><a href="../../doc/release_notes/5_16_0_txt.html">5.16.0</a>
  
    <li><a href="../../doc/release_notes/5_17_0_txt.html">5.17.0</a>
  
    <li><a href="../../doc/release_notes/5_18_0_txt.html">5.18.0</a>
  
    <li><a href="../../doc/release_notes/5_19_0_txt.html">5.19.0</a>
  
    <li><a href="../../doc/release_notes/5_2_0_txt.html">5.2.0</a>
  
    <li><a href="../../doc/release_notes/5_20_0_txt.html">5.20.0</a>
  
    <li><a href="../../doc/release_notes/5_21_0_txt.html">5.21.0</a>
  
    <li><a href="../../doc/release_notes/5_22_0_txt.html">5.22.0</a>
  
    <li><a href="../../doc/release_notes/5_23_0_txt.html">5.23.0</a>
  
    <li><a href="../../doc/release_notes/5_24_0_txt.html">5.24.0</a>
  
    <li><a href="../../doc/release_notes/5_25_0_txt.html">5.25.0</a>
  
    <li><a href="../../doc/release_notes/5_26_0_txt.html">5.26.0</a>
  
    <li><a href="../../doc/release_notes/5_27_0_txt.html">5.27.0</a>
  
    <li><a href="../../doc/release_notes/5_28_0_txt.html">5.28.0</a>
  
    <li><a href="../../doc/release_notes/5_29_0_txt.html">5.29.0</a>
  
    <li><a href="../../doc/release_notes/5_3_0_txt.html">5.3.0</a>
  
    <li><a href="../../doc/release_notes/5_30_0_txt.html">5.30.0</a>
  
    <li><a href="../../doc/release_notes/5_31_0_txt.html">5.31.0</a>
  
    <li><a href="../../doc/release_notes/5_32_0_txt.html">5.32.0</a>
  
    <li><a href="../../doc/release_notes/5_33_0_txt.html">5.33.0</a>
  
    <li><a href="../../doc/release_notes/5_34_0_txt.html">5.34.0</a>
  
    <li><a href="../../doc/release_notes/5_35_0_txt.html">5.35.0</a>
  
    <li><a href="../../doc/release_notes/5_36_0_txt.html">5.36.0</a>
  
    <li><a href="../../doc/release_notes/5_37_0_txt.html">5.37.0</a>
  
    <li><a href="../../doc/release_notes/5_38_0_txt.html">5.38.0</a>
  
    <li><a href="../../doc/release_notes/5_39_0_txt.html">5.39.0</a>
  
    <li><a href="../../doc/release_notes/5_4_0_txt.html">5.4.0</a>
  
    <li><a href="../../doc/release_notes/5_40_0_txt.html">5.40.0</a>
  
    <li><a href="../../doc/release_notes/5_41_0_txt.html">5.41.0</a>
  
    <li><a href="../../doc/release_notes/5_42_0_txt.html">5.42.0</a>
  
    <li><a href="../../doc/release_notes/5_43_0_txt.html">5.43.0</a>
  
    <li><a href="../../doc/release_notes/5_44_0_txt.html">5.44.0</a>
  
    <li><a href="../../doc/release_notes/5_45_0_txt.html">5.45.0</a>
  
    <li><a href="../../doc/release_notes/5_46_0_txt.html">5.46.0</a>
  
    <li><a href="../../doc/release_notes/5_47_0_txt.html">5.47.0</a>
  
    <li><a href="../../doc/release_notes/5_48_0_txt.html">5.48.0</a>
  
    <li><a href="../../doc/release_notes/5_49_0_txt.html">5.49.0</a>
  
    <li><a href="../../doc/release_notes/5_5_0_txt.html">5.5.0</a>
  
    <li><a href="../../doc/release_notes/5_50_0_txt.html">5.50.0</a>
  
    <li><a href="../../doc/release_notes/5_51_0_txt.html">5.51.0</a>
  
    <li><a href="../../doc/release_notes/5_52_0_txt.html">5.52.0</a>
  
    <li><a href="../../doc/release_notes/5_53_0_txt.html">5.53.0</a>
  
    <li><a href="../../doc/release_notes/5_54_0_txt.html">5.54.0</a>
  
    <li><a href="../../doc/release_notes/5_55_0_txt.html">5.55.0</a>
  
    <li><a href="../../doc/release_notes/5_6_0_txt.html">5.6.0</a>
  
    <li><a href="../../doc/release_notes/5_7_0_txt.html">5.7.0</a>
  
    <li><a href="../../doc/release_notes/5_8_0_txt.html">5.8.0</a>
  
    <li><a href="../../doc/release_notes/5_9_0_txt.html">5.9.0</a>
  
    <li><a href="../../doc/schema_modification_rdoc.html">schema_modification</a>
  
    <li><a href="../../doc/security_rdoc.html">security</a>
  
    <li><a href="../../doc/sharding_rdoc.html">sharding</a>
  
    <li><a href="../../doc/sql_rdoc.html">sql</a>
  
    <li><a href="../../doc/testing_rdoc.html">testing</a>
  
    <li><a href="../../doc/thread_safety_rdoc.html">thread_safety</a>
  
    <li><a href="../../doc/transactions_rdoc.html">transactions</a>
  
    <li><a href="../../doc/validations_rdoc.html">validations</a>
  
    <li><a href="../../doc/virtual_rows_rdoc.html">virtual_rows</a>
  
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-label="Page doc/release_notes/4.0.0.txt">

<h1 id="label-Backwards+Compatibility">Backwards Compatibility<span><a href="#label-Backwards+Compatibility">&para;</a> <a href="#top">&uarr;</a></span></h1>
<ul><li>
<p>All behavior resulting in deprecation messages in 3.48.0 has been removed or modified.  If you plan on upgrading to <a href="../../Sequel.html"><code>Sequel</code></a> 4.0.0 and have not yet upgraded to 3.48.0, upgrade to 3.48.0 first, fix code that results in deprecation warnings, and then upgrade to 4.0.0.</p>
</li><li>
<p>The threaded connection pools now default to :connection_handling=&gt;:queue.  You can manually set :connection_handling=&gt;:stack to get the previous behavior.</p>
</li><li>
<p>Model.raise_on_typecast_failure now defaults to false.  Set this to true to get the previous behavior of raising typecast errors in the setter methods.</p>
</li><li>
<p>Model#save no longer calls Model#_refresh or Model#set_values internally after an insert.  Manual refreshes are now treated differently than after creation refreshes.</p>
</li><li>
<p>On SQLite, integer_booleans now defaults to true.  Set this to false to get the previous behavior of &#39;t&#39; for true and &#39;f&#39; for false.  <a href="../../Sequel.html"><code>Sequel</code></a> will not automatically upgrade your data, users are responsible for doing that if they want to switch the integer_booleans setting.  Note that regardless of the setting, <a href="../../Sequel.html"><code>Sequel</code></a> will return the correct ruby values when retrieving the rows.</p>

<p>Example Code to Migrate Existing Data:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">where</span>(<span class="ruby-value">:column</span><span class="ruby-operator">=&gt;</span><span class="ruby-string">&#39;t&#39;</span>).<span class="ruby-identifier">update</span>(<span class="ruby-value">:column</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">1</span>)
<span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">where</span>(<span class="ruby-value">:column</span><span class="ruby-operator">=&gt;</span><span class="ruby-string">&#39;f&#39;</span>).<span class="ruby-identifier">update</span>(<span class="ruby-value">:column</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">0</span>)
</pre>
</li><li>
<p>On SQLite, use_timestamp_timezones is now false by default.  Set this to true to get the previous behavior with timezone information in timestamps. <a href="../../Sequel.html"><code>Sequel</code></a> will not automatically upgrade your data, users are responsible for doing that if they want to switch the use_timestamp_timezones setting.  Note that regardless of the setting, <a href="../../Sequel.html"><code>Sequel</code></a> will return the correct ruby values when retrieving the rows.</p>
</li><li>
<p>Using window functions when eagerly loading associations with limits or offsets is now done automatically if the database supports it.  Previously, this had to be enabled manually.  If you would like to disable this optimization and just do the slicing in ruby, set default_eager_limit_strategy = nil.</p>
</li><li>
<p>The default value for most option hash arguments is now an shared empty frozen hash.  If you are overriding methods and modifying option hashes, fix your code.</p>
</li><li>
<p>The defaults_setter plugin now works in a lazy manner instead of an eager manner.  So calling the related method returns the default value if there is no value stored, but <a href="../../Sequel.html"><code>Sequel</code></a> does not add the default values to the internal values hash, and will not attempt to insert what it thinks is the default value when saving the new object.</p>
</li><li>
<p>Model#set_all and update_all now allow setting the primary key columns.</p>
</li><li>
<p>The many_to_one_pk_lookup and association_autoreloading plugins are now integrated into the default associations support.</p>
</li><li>
<p>Plugins now extend the class with ClassMethods before including InstanceMethods in the class.</p>
</li><li>
<p>Dataset#get, select_map, and select_order_map now automatically add aliases for unaliased expressions if given a single expression.</p>
</li><li>
<p>Database#tables and views on PostgreSQL now check against the current schemas in the search path.</p>
</li><li>
<p>Calling ungraphed on an eager_graph dataset will restore the row_proc for that dataset.  This is not backwards compatible if your method chain does:</p>

<pre class="ruby"><span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">eager_graph</span>.<span class="ruby-identifier">naked</span>.<span class="ruby-identifier">ungraphed</span>
</pre>

<p>Switch such code to:</p>

<pre class="ruby"><span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">eager_graph</span>.<span class="ruby-identifier">ungraphed</span>.<span class="ruby-identifier">naked</span>
</pre>
</li><li>
<p>The Model#set_restricted and update_restricted private methods have a slightly different API now.</p>
</li><li>
<p>Sequel::SQL::SQLArray alias for ValueList has been removed.</p>
</li><li>
<p>Sequel::SQL::NoBooleanInputMethods has been removed.</p>
</li><li>
<p>Sequel::NotImplemented has been removed.  Default implementations of methods that used to raise this exception have been removed.</p>
</li><li>
<p>Sequel::Model::EMPTY_INSTANCE_VARIABLES has been removed.</p>
</li><li>
<p>The Sequel::Postgres::DatabaseMethods::EXCLUDE_SCHEMAS and SYSTEM_TABLE_REGEXP constants have been removed.</p>
</li><li>
<p>Dataset#columns_without_introspection has been removed from the columns_introspection extension.</p>
</li><li>
<p><a href="../../Sequel.html"><code>Sequel</code></a> no longer provides a default database for the adapter or integration specs.  Additionally, if you are using spec_config.rb to configure a database to use when adapter/integration testing, you may need to modify it, as <a href="../../Sequel.html"><code>Sequel</code></a> now uses the DB constant for the database being tested.</p>
</li><li>
<p>The SEQUEL_MSSQL_SPEC_REQUIRE and SEQUEL_DB2_SPEC_REQUIRE environment variables are no longer respected when adapter/integration testing those databases.  Use RUBYOPT with the -r flag.</p>
</li><li>
<p>In the 3.48.0 release notes, it was announced that Dataset#join_table would default to :qualify=&gt;:deep in 4.0.0.  This change was made but reverted before the release of 4.0.0 as it was determined too likely to break existing code, there was no deprecation warning (since it just changed a setting), and the benefit was minimal. You can make deep qualification the default by by overriding Dataset#default_join_table_qualification.</p>
</li></ul>

<h1 id="label-New+Features">New Features<span><a href="#label-New+Features">&para;</a> <a href="#top">&uarr;</a></span></h1>
<ul><li>
<p>A pg_array_associations plugin has been added, for creating an association based on a PostgreSQL array column containing foreign keys.  Example:</p>

<pre class="ruby"><span class="ruby-comment"># Database schema:</span>
<span class="ruby-comment">#   tags                albums</span>
<span class="ruby-comment">#   :id (int4) &lt;--\    :id</span>
<span class="ruby-comment">#   :name          \-- :tag_ids (int4[])</span>
<span class="ruby-comment">#                      :name</span>

<span class="ruby-keyword">class</span> <span class="ruby-constant">Album</span>
  <span class="ruby-identifier">plugin</span> <span class="ruby-value">:pg_array_associations</span>
  <span class="ruby-identifier">pg_array_to_many</span> <span class="ruby-value">:tags</span>
<span class="ruby-keyword">end</span>
<span class="ruby-keyword">class</span> <span class="ruby-constant">Tag</span>
  <span class="ruby-identifier">plugin</span> <span class="ruby-value">:pg_array_associations</span>
  <span class="ruby-identifier">many_to_pg_array</span> <span class="ruby-value">:albums</span>
<span class="ruby-keyword">end</span>
</pre>

<p>This operates similarly to a many_to_many association, but does not require a join table.  All of the usual <a href="../../Sequel.html"><code>Sequel</code></a> association features are supported, such as adding, removing, and clearing associations, eager loading via eager and eager_graph, filtering by associations, and dataset associations.</p>

<p>Note that until PostgreSQL gains the ability to enforce foreign key constraints in array columns, this plugin is not recommended for production use unless you plan on emulating referential integrity constraints via triggers.</p>
</li><li>
<p>Dataset#from now accepts virtual_row blocks, making it easy to use with table returning functions:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>.<span class="ruby-identifier">from</span>{<span class="ruby-identifier">table_returning_function</span>(<span class="ruby-identifier">arg</span>)}
</pre>
</li><li>
<p>Sequel.deep_qualify has been added, for easily doing a deep qualification of objects:</p>

<pre class="ruby"><span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">deep_qualify</span>(<span class="ruby-value">:table</span>, <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">+</span>(<span class="ruby-value">:column</span>, <span class="ruby-value">1</span>))
<span class="ruby-comment"># (&quot;table&quot;.&quot;column&quot; + 1)</span>
<span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">deep_qualify</span>(<span class="ruby-value">:table</span>, <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">like</span>(<span class="ruby-value">:a</span>, <span class="ruby-string">&#39;b&#39;</span>))
<span class="ruby-comment"># (&quot;table&quot;.&quot;a&quot; LIKE &#39;b&#39; ESCAPE &#39;\&#39;)</span>
</pre>
</li><li>
<p>The prepared_statements_associations plugin now handles one_to_one associations.</p>
</li><li>
<p>SQL::Subscript objects now handle ruby range arguments, operating as an SQL array slice:</p>

<pre class="ruby"><span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">subscript</span>(<span class="ruby-value">:a</span>, <span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">2</span>) <span class="ruby-comment"># a[1:2]</span>
</pre>
</li><li>
<p>Database#create_view now accepts a :columns option to provide explicit column names for the view.</p>
</li><li>
<p>Postgres::ArrayOp#[] now returns an ArrayOp if given a range, since a PostgreSQL array slice can be treated as an array.</p>
</li><li>
<p>Postgres::ArrayOp#hstore has been added for creating hstores from PostgreSQL arrays.</p>
</li><li>
<p>When creating full text indexes on PostgreSQL, the :index_type=&gt;:gist option can be used to use a gist index instead of the default gin index.  This can be useful if insert/update speed is more important than lookup speed.</p>
</li><li>
<p>You can now provide the :owner option to Database#create_schema on PostgreSQL to specify the owner of the schema.</p>
</li><li>
<p>You can now provide the :if_exists option to Database#drop_view on PostgreSQL to not raise an error if the view doesn&#39;t exist.</p>
</li><li>
<p>The pg_json extension now handles non-JSON plain strings, integers and floats in PostgreSQL JSON columns.</p>
</li></ul>

<h1 id="label-Support+for+New+Features+in+PostgreSQL+9.3">Support for New Features in PostgreSQL 9.3<span><a href="#label-Support+for+New+Features+in+PostgreSQL+9.3">&para;</a> <a href="#top">&uarr;</a></span></h1>
<ul><li>
<p>A pg_json_ops extension has been added to support the new json operators and functions.</p>
</li><li>
<p>Postgres::ArrayOp#replace and remove have been added for using the array_replace and array_remove functions.</p>
</li><li>
<p>You can now provide the :if_not_exists option when using Database#create_schema on PostgreSQL to not raise an error if the schema already exists.</p>
</li><li>
<p>Database#create_view now supports a :recursive option on PostgreSQL for creating recursive views.</p>
</li><li>
<p>Database#create_view and drop_view now support a :materialized option on PostgreSQL for creating/dropping materialized views.</p>
</li><li>
<p>Database#refresh_view has been added on PostgreSQL for refreshing materialized views.</p>
</li></ul>

<h1 id="label-Other+Improvements">Other Improvements<span><a href="#label-Other+Improvements">&para;</a> <a href="#top">&uarr;</a></span></h1>
<ul><li>
<p>Check constraints are now always surrounded by parantheses, since that is required by the SQL standard.  This fixes issues in the cases where parentheses were not used automatically, such as when a function call was used.</p>
</li><li>
<p>Using an offset without a limit when eager loading now works correctly.</p>
</li><li>
<p>The prepared_statements_associations plugin now works correctly when the associated class uses a filtered dataset.</p>
</li><li>
<p>The prepared_statements_associations plugin can now use a prepared statement for cases where the association uses :conditions.</p>
</li><li>
<p>Boolean prepared statement arguments now work correctly in the sqlite adapter when the integer_booleans setting is true.</p>
</li><li>
<p>Dataset#inspect on prepared statements now handles anonymous dataset classes correctly.</p>
</li><li>
<p>When dataset string/blob literalization depends on having a database connection and the dataset has an assigned server, a connection to the assigned server is used.</p>
</li><li>
<p>More disconnect errors are now handled when using the postgres adapter with the postgres-pr driver, and in the jdbc/oracle adapter.</p>
</li><li>
<p>Composite primary keys are now parsed correctly on SQLite 3.7.16+.</p>
</li><li>
<p>Blobs are now hex escaped on MySQL, which can solve some encoding issues when blobs are used as literals in the same SQL query with UTF-8 strings.</p>
</li><li>
<p>BigDecimals instances are now formatted nicer in the pretty_table extension.</p>
</li><li>
<p><a href="../../Sequel.html"><code>Sequel</code></a> now raises an exception when attempting to literalize infinite and NaN floats on MySQL.  In general, this would result in MySQL raising an error, but in extreme cases it could have failed silently.</p>
</li><li>
<p>You can now use a NO_SEQUEL_PG environment variable to not automatically require sequel_pg in the postgres adapter.</p>
</li><li>
<p>Dataset#unbind now always uses symbol keys in the bind variable hash.</p>
</li></ul>

</main>



<footer id="validator-badges" role="contentinfo">
  <p><a href="https://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://ruby.github.io/rdoc/">RDoc</a> 6.1.2.1.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

