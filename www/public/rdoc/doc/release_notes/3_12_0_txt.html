<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>3.12.0 - Sequel: The Database Toolkit for Ruby</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
  var index_rel_prefix = "../../";
</script>

<script src="../../js/navigation.js" defer></script>
<script src="../../js/search.js" defer></script>
<script src="../../js/search_index.js" defer></script>
<script src="../../js/searcher.js" defer></script>
<script src="../../js/darkfish.js" defer></script>

<link href="../../css/fonts.css" rel="stylesheet">
<link href="../../css/rdoc.css" rel="stylesheet">




<body id="top" role="document" class="file">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../table_of_contents.html#pages">Pages</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  
<div class="nav-section">
  <h3>Table of Contents</h3>

  <ul class="link-list" role="directory">
    <li><a href="#label-Migration+Changes">Migration Changes</a>
    <li><a href="#label-New+Plugins">New Plugins</a>
    <li><a href="#label-Other+New+Features">Other New Features</a>
    <li><a href="#label-Other+Improvements">Other Improvements</a>
    <li><a href="#label-Backwards+Compatibility">Backwards Compatibility</a>
  </ul>
</div>


  <div id="project-metadata">
    <div id="fileindex-section" class="nav-section">
  <h3>Pages</h3>

  <ul class="link-list">
  
    <li><a href="../../CHANGELOG.html">CHANGELOG</a>
  
    <li><a href="../../MIT-LICENSE.html">MIT-LICENSE</a>
  
    <li><a href="../../README_rdoc.html">README</a>
  
    <li><a href="../../doc/CHANGELOG_old.html">CHANGELOG.old</a>
  
    <li><a href="../../doc/advanced_associations_rdoc.html">advanced_associations</a>
  
    <li><a href="../../doc/association_basics_rdoc.html">association_basics</a>
  
    <li><a href="../../doc/bin_sequel_rdoc.html">bin_sequel</a>
  
    <li><a href="../../doc/cheat_sheet_rdoc.html">cheat_sheet</a>
  
    <li><a href="../../doc/code_order_rdoc.html">code_order</a>
  
    <li><a href="../../doc/core_extensions_rdoc.html">core_extensions</a>
  
    <li><a href="../../doc/dataset_basics_rdoc.html">dataset_basics</a>
  
    <li><a href="../../doc/dataset_filtering_rdoc.html">dataset_filtering</a>
  
    <li><a href="../../doc/extensions_rdoc.html">extensions</a>
  
    <li><a href="../../doc/fork_safety_rdoc.html">fork_safety</a>
  
    <li><a href="../../doc/mass_assignment_rdoc.html">mass_assignment</a>
  
    <li><a href="../../doc/migration_rdoc.html">migration</a>
  
    <li><a href="../../doc/model_dataset_method_design_rdoc.html">model_dataset_method_design</a>
  
    <li><a href="../../doc/model_hooks_rdoc.html">model_hooks</a>
  
    <li><a href="../../doc/model_plugins_rdoc.html">model_plugins</a>
  
    <li><a href="../../doc/mssql_stored_procedures_rdoc.html">mssql_stored_procedures</a>
  
    <li><a href="../../doc/object_model_rdoc.html">object_model</a>
  
    <li><a href="../../doc/opening_databases_rdoc.html">opening_databases</a>
  
    <li><a href="../../doc/postgresql_rdoc.html">postgresql</a>
  
    <li><a href="../../doc/prepared_statements_rdoc.html">prepared_statements</a>
  
    <li><a href="../../doc/querying_rdoc.html">querying</a>
  
    <li><a href="../../doc/reflection_rdoc.html">reflection</a>
  
    <li><a href="../../doc/release_notes/1_0_txt.html">1.0</a>
  
    <li><a href="../../doc/release_notes/1_1_txt.html">1.1</a>
  
    <li><a href="../../doc/release_notes/1_3_txt.html">1.3</a>
  
    <li><a href="../../doc/release_notes/1_4_0_txt.html">1.4.0</a>
  
    <li><a href="../../doc/release_notes/1_5_0_txt.html">1.5.0</a>
  
    <li><a href="../../doc/release_notes/2_0_0_txt.html">2.0.0</a>
  
    <li><a href="../../doc/release_notes/2_1_0_txt.html">2.1.0</a>
  
    <li><a href="../../doc/release_notes/2_10_0_txt.html">2.10.0</a>
  
    <li><a href="../../doc/release_notes/2_11_0_txt.html">2.11.0</a>
  
    <li><a href="../../doc/release_notes/2_12_0_txt.html">2.12.0</a>
  
    <li><a href="../../doc/release_notes/2_2_0_txt.html">2.2.0</a>
  
    <li><a href="../../doc/release_notes/2_3_0_txt.html">2.3.0</a>
  
    <li><a href="../../doc/release_notes/2_4_0_txt.html">2.4.0</a>
  
    <li><a href="../../doc/release_notes/2_5_0_txt.html">2.5.0</a>
  
    <li><a href="../../doc/release_notes/2_6_0_txt.html">2.6.0</a>
  
    <li><a href="../../doc/release_notes/2_7_0_txt.html">2.7.0</a>
  
    <li><a href="../../doc/release_notes/2_8_0_txt.html">2.8.0</a>
  
    <li><a href="../../doc/release_notes/2_9_0_txt.html">2.9.0</a>
  
    <li><a href="../../doc/release_notes/3_0_0_txt.html">3.0.0</a>
  
    <li><a href="../../doc/release_notes/3_1_0_txt.html">3.1.0</a>
  
    <li><a href="../../doc/release_notes/3_10_0_txt.html">3.10.0</a>
  
    <li><a href="../../doc/release_notes/3_11_0_txt.html">3.11.0</a>
  
    <li><a href="../../doc/release_notes/3_12_0_txt.html">3.12.0</a>
  
    <li><a href="../../doc/release_notes/3_13_0_txt.html">3.13.0</a>
  
    <li><a href="../../doc/release_notes/3_14_0_txt.html">3.14.0</a>
  
    <li><a href="../../doc/release_notes/3_15_0_txt.html">3.15.0</a>
  
    <li><a href="../../doc/release_notes/3_16_0_txt.html">3.16.0</a>
  
    <li><a href="../../doc/release_notes/3_17_0_txt.html">3.17.0</a>
  
    <li><a href="../../doc/release_notes/3_18_0_txt.html">3.18.0</a>
  
    <li><a href="../../doc/release_notes/3_19_0_txt.html">3.19.0</a>
  
    <li><a href="../../doc/release_notes/3_2_0_txt.html">3.2.0</a>
  
    <li><a href="../../doc/release_notes/3_20_0_txt.html">3.20.0</a>
  
    <li><a href="../../doc/release_notes/3_21_0_txt.html">3.21.0</a>
  
    <li><a href="../../doc/release_notes/3_22_0_txt.html">3.22.0</a>
  
    <li><a href="../../doc/release_notes/3_23_0_txt.html">3.23.0</a>
  
    <li><a href="../../doc/release_notes/3_24_0_txt.html">3.24.0</a>
  
    <li><a href="../../doc/release_notes/3_25_0_txt.html">3.25.0</a>
  
    <li><a href="../../doc/release_notes/3_26_0_txt.html">3.26.0</a>
  
    <li><a href="../../doc/release_notes/3_27_0_txt.html">3.27.0</a>
  
    <li><a href="../../doc/release_notes/3_28_0_txt.html">3.28.0</a>
  
    <li><a href="../../doc/release_notes/3_29_0_txt.html">3.29.0</a>
  
    <li><a href="../../doc/release_notes/3_3_0_txt.html">3.3.0</a>
  
    <li><a href="../../doc/release_notes/3_30_0_txt.html">3.30.0</a>
  
    <li><a href="../../doc/release_notes/3_31_0_txt.html">3.31.0</a>
  
    <li><a href="../../doc/release_notes/3_32_0_txt.html">3.32.0</a>
  
    <li><a href="../../doc/release_notes/3_33_0_txt.html">3.33.0</a>
  
    <li><a href="../../doc/release_notes/3_34_0_txt.html">3.34.0</a>
  
    <li><a href="../../doc/release_notes/3_35_0_txt.html">3.35.0</a>
  
    <li><a href="../../doc/release_notes/3_36_0_txt.html">3.36.0</a>
  
    <li><a href="../../doc/release_notes/3_37_0_txt.html">3.37.0</a>
  
    <li><a href="../../doc/release_notes/3_38_0_txt.html">3.38.0</a>
  
    <li><a href="../../doc/release_notes/3_39_0_txt.html">3.39.0</a>
  
    <li><a href="../../doc/release_notes/3_4_0_txt.html">3.4.0</a>
  
    <li><a href="../../doc/release_notes/3_40_0_txt.html">3.40.0</a>
  
    <li><a href="../../doc/release_notes/3_41_0_txt.html">3.41.0</a>
  
    <li><a href="../../doc/release_notes/3_42_0_txt.html">3.42.0</a>
  
    <li><a href="../../doc/release_notes/3_43_0_txt.html">3.43.0</a>
  
    <li><a href="../../doc/release_notes/3_44_0_txt.html">3.44.0</a>
  
    <li><a href="../../doc/release_notes/3_45_0_txt.html">3.45.0</a>
  
    <li><a href="../../doc/release_notes/3_46_0_txt.html">3.46.0</a>
  
    <li><a href="../../doc/release_notes/3_47_0_txt.html">3.47.0</a>
  
    <li><a href="../../doc/release_notes/3_48_0_txt.html">3.48.0</a>
  
    <li><a href="../../doc/release_notes/3_5_0_txt.html">3.5.0</a>
  
    <li><a href="../../doc/release_notes/3_6_0_txt.html">3.6.0</a>
  
    <li><a href="../../doc/release_notes/3_7_0_txt.html">3.7.0</a>
  
    <li><a href="../../doc/release_notes/3_8_0_txt.html">3.8.0</a>
  
    <li><a href="../../doc/release_notes/3_9_0_txt.html">3.9.0</a>
  
    <li><a href="../../doc/release_notes/4_0_0_txt.html">4.0.0</a>
  
    <li><a href="../../doc/release_notes/4_1_0_txt.html">4.1.0</a>
  
    <li><a href="../../doc/release_notes/4_10_0_txt.html">4.10.0</a>
  
    <li><a href="../../doc/release_notes/4_11_0_txt.html">4.11.0</a>
  
    <li><a href="../../doc/release_notes/4_12_0_txt.html">4.12.0</a>
  
    <li><a href="../../doc/release_notes/4_13_0_txt.html">4.13.0</a>
  
    <li><a href="../../doc/release_notes/4_14_0_txt.html">4.14.0</a>
  
    <li><a href="../../doc/release_notes/4_15_0_txt.html">4.15.0</a>
  
    <li><a href="../../doc/release_notes/4_16_0_txt.html">4.16.0</a>
  
    <li><a href="../../doc/release_notes/4_17_0_txt.html">4.17.0</a>
  
    <li><a href="../../doc/release_notes/4_18_0_txt.html">4.18.0</a>
  
    <li><a href="../../doc/release_notes/4_19_0_txt.html">4.19.0</a>
  
    <li><a href="../../doc/release_notes/4_2_0_txt.html">4.2.0</a>
  
    <li><a href="../../doc/release_notes/4_20_0_txt.html">4.20.0</a>
  
    <li><a href="../../doc/release_notes/4_21_0_txt.html">4.21.0</a>
  
    <li><a href="../../doc/release_notes/4_22_0_txt.html">4.22.0</a>
  
    <li><a href="../../doc/release_notes/4_23_0_txt.html">4.23.0</a>
  
    <li><a href="../../doc/release_notes/4_24_0_txt.html">4.24.0</a>
  
    <li><a href="../../doc/release_notes/4_25_0_txt.html">4.25.0</a>
  
    <li><a href="../../doc/release_notes/4_26_0_txt.html">4.26.0</a>
  
    <li><a href="../../doc/release_notes/4_27_0_txt.html">4.27.0</a>
  
    <li><a href="../../doc/release_notes/4_28_0_txt.html">4.28.0</a>
  
    <li><a href="../../doc/release_notes/4_29_0_txt.html">4.29.0</a>
  
    <li><a href="../../doc/release_notes/4_3_0_txt.html">4.3.0</a>
  
    <li><a href="../../doc/release_notes/4_30_0_txt.html">4.30.0</a>
  
    <li><a href="../../doc/release_notes/4_31_0_txt.html">4.31.0</a>
  
    <li><a href="../../doc/release_notes/4_32_0_txt.html">4.32.0</a>
  
    <li><a href="../../doc/release_notes/4_33_0_txt.html">4.33.0</a>
  
    <li><a href="../../doc/release_notes/4_34_0_txt.html">4.34.0</a>
  
    <li><a href="../../doc/release_notes/4_35_0_txt.html">4.35.0</a>
  
    <li><a href="../../doc/release_notes/4_36_0_txt.html">4.36.0</a>
  
    <li><a href="../../doc/release_notes/4_37_0_txt.html">4.37.0</a>
  
    <li><a href="../../doc/release_notes/4_38_0_txt.html">4.38.0</a>
  
    <li><a href="../../doc/release_notes/4_39_0_txt.html">4.39.0</a>
  
    <li><a href="../../doc/release_notes/4_4_0_txt.html">4.4.0</a>
  
    <li><a href="../../doc/release_notes/4_40_0_txt.html">4.40.0</a>
  
    <li><a href="../../doc/release_notes/4_41_0_txt.html">4.41.0</a>
  
    <li><a href="../../doc/release_notes/4_42_0_txt.html">4.42.0</a>
  
    <li><a href="../../doc/release_notes/4_43_0_txt.html">4.43.0</a>
  
    <li><a href="../../doc/release_notes/4_44_0_txt.html">4.44.0</a>
  
    <li><a href="../../doc/release_notes/4_45_0_txt.html">4.45.0</a>
  
    <li><a href="../../doc/release_notes/4_46_0_txt.html">4.46.0</a>
  
    <li><a href="../../doc/release_notes/4_47_0_txt.html">4.47.0</a>
  
    <li><a href="../../doc/release_notes/4_48_0_txt.html">4.48.0</a>
  
    <li><a href="../../doc/release_notes/4_49_0_txt.html">4.49.0</a>
  
    <li><a href="../../doc/release_notes/4_5_0_txt.html">4.5.0</a>
  
    <li><a href="../../doc/release_notes/4_6_0_txt.html">4.6.0</a>
  
    <li><a href="../../doc/release_notes/4_7_0_txt.html">4.7.0</a>
  
    <li><a href="../../doc/release_notes/4_8_0_txt.html">4.8.0</a>
  
    <li><a href="../../doc/release_notes/4_9_0_txt.html">4.9.0</a>
  
    <li><a href="../../doc/release_notes/5_0_0_txt.html">5.0.0</a>
  
    <li><a href="../../doc/release_notes/5_1_0_txt.html">5.1.0</a>
  
    <li><a href="../../doc/release_notes/5_10_0_txt.html">5.10.0</a>
  
    <li><a href="../../doc/release_notes/5_11_0_txt.html">5.11.0</a>
  
    <li><a href="../../doc/release_notes/5_12_0_txt.html">5.12.0</a>
  
    <li><a href="../../doc/release_notes/5_13_0_txt.html">5.13.0</a>
  
    <li><a href="../../doc/release_notes/5_14_0_txt.html">5.14.0</a>
  
    <li><a href="../../doc/release_notes/5_15_0_txt.html">5.15.0</a>
  
    <li><a href="../../doc/release_notes/5_16_0_txt.html">5.16.0</a>
  
    <li><a href="../../doc/release_notes/5_17_0_txt.html">5.17.0</a>
  
    <li><a href="../../doc/release_notes/5_18_0_txt.html">5.18.0</a>
  
    <li><a href="../../doc/release_notes/5_19_0_txt.html">5.19.0</a>
  
    <li><a href="../../doc/release_notes/5_2_0_txt.html">5.2.0</a>
  
    <li><a href="../../doc/release_notes/5_20_0_txt.html">5.20.0</a>
  
    <li><a href="../../doc/release_notes/5_21_0_txt.html">5.21.0</a>
  
    <li><a href="../../doc/release_notes/5_22_0_txt.html">5.22.0</a>
  
    <li><a href="../../doc/release_notes/5_23_0_txt.html">5.23.0</a>
  
    <li><a href="../../doc/release_notes/5_24_0_txt.html">5.24.0</a>
  
    <li><a href="../../doc/release_notes/5_25_0_txt.html">5.25.0</a>
  
    <li><a href="../../doc/release_notes/5_26_0_txt.html">5.26.0</a>
  
    <li><a href="../../doc/release_notes/5_27_0_txt.html">5.27.0</a>
  
    <li><a href="../../doc/release_notes/5_28_0_txt.html">5.28.0</a>
  
    <li><a href="../../doc/release_notes/5_29_0_txt.html">5.29.0</a>
  
    <li><a href="../../doc/release_notes/5_3_0_txt.html">5.3.0</a>
  
    <li><a href="../../doc/release_notes/5_30_0_txt.html">5.30.0</a>
  
    <li><a href="../../doc/release_notes/5_31_0_txt.html">5.31.0</a>
  
    <li><a href="../../doc/release_notes/5_32_0_txt.html">5.32.0</a>
  
    <li><a href="../../doc/release_notes/5_33_0_txt.html">5.33.0</a>
  
    <li><a href="../../doc/release_notes/5_34_0_txt.html">5.34.0</a>
  
    <li><a href="../../doc/release_notes/5_35_0_txt.html">5.35.0</a>
  
    <li><a href="../../doc/release_notes/5_36_0_txt.html">5.36.0</a>
  
    <li><a href="../../doc/release_notes/5_37_0_txt.html">5.37.0</a>
  
    <li><a href="../../doc/release_notes/5_38_0_txt.html">5.38.0</a>
  
    <li><a href="../../doc/release_notes/5_39_0_txt.html">5.39.0</a>
  
    <li><a href="../../doc/release_notes/5_4_0_txt.html">5.4.0</a>
  
    <li><a href="../../doc/release_notes/5_40_0_txt.html">5.40.0</a>
  
    <li><a href="../../doc/release_notes/5_41_0_txt.html">5.41.0</a>
  
    <li><a href="../../doc/release_notes/5_42_0_txt.html">5.42.0</a>
  
    <li><a href="../../doc/release_notes/5_43_0_txt.html">5.43.0</a>
  
    <li><a href="../../doc/release_notes/5_44_0_txt.html">5.44.0</a>
  
    <li><a href="../../doc/release_notes/5_45_0_txt.html">5.45.0</a>
  
    <li><a href="../../doc/release_notes/5_46_0_txt.html">5.46.0</a>
  
    <li><a href="../../doc/release_notes/5_47_0_txt.html">5.47.0</a>
  
    <li><a href="../../doc/release_notes/5_48_0_txt.html">5.48.0</a>
  
    <li><a href="../../doc/release_notes/5_49_0_txt.html">5.49.0</a>
  
    <li><a href="../../doc/release_notes/5_5_0_txt.html">5.5.0</a>
  
    <li><a href="../../doc/release_notes/5_50_0_txt.html">5.50.0</a>
  
    <li><a href="../../doc/release_notes/5_51_0_txt.html">5.51.0</a>
  
    <li><a href="../../doc/release_notes/5_52_0_txt.html">5.52.0</a>
  
    <li><a href="../../doc/release_notes/5_53_0_txt.html">5.53.0</a>
  
    <li><a href="../../doc/release_notes/5_54_0_txt.html">5.54.0</a>
  
    <li><a href="../../doc/release_notes/5_55_0_txt.html">5.55.0</a>
  
    <li><a href="../../doc/release_notes/5_6_0_txt.html">5.6.0</a>
  
    <li><a href="../../doc/release_notes/5_7_0_txt.html">5.7.0</a>
  
    <li><a href="../../doc/release_notes/5_8_0_txt.html">5.8.0</a>
  
    <li><a href="../../doc/release_notes/5_9_0_txt.html">5.9.0</a>
  
    <li><a href="../../doc/schema_modification_rdoc.html">schema_modification</a>
  
    <li><a href="../../doc/security_rdoc.html">security</a>
  
    <li><a href="../../doc/sharding_rdoc.html">sharding</a>
  
    <li><a href="../../doc/sql_rdoc.html">sql</a>
  
    <li><a href="../../doc/testing_rdoc.html">testing</a>
  
    <li><a href="../../doc/thread_safety_rdoc.html">thread_safety</a>
  
    <li><a href="../../doc/transactions_rdoc.html">transactions</a>
  
    <li><a href="../../doc/validations_rdoc.html">validations</a>
  
    <li><a href="../../doc/virtual_rows_rdoc.html">virtual_rows</a>
  
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-label="Page doc/release_notes/3.12.0.txt">

<h1 id="label-Migration+Changes">Migration Changes<span><a href="#label-Migration+Changes">&para;</a> <a href="#top">&uarr;</a></span></h1>
<ul><li>
<p>A TimestampMigrator has been added to <a href="../../Sequel.html"><code>Sequel</code></a>, and is automatically used if any migration has a version greater than</p>
<ol><li>
<p>This migrator operates similarly to the default</p>
</li></ol>

<p>ActiveRecord migrator, in that it allows missing migrations. It differs from the ActiveRecord migrator in that it supports migrations with the same timestamp/version as well as a wide variety of timestamp formats (though the ActiveRecord default of YYYYMMDDHHMMSS is recommended and should be used in portable code).</p>

<p><a href="../../Sequel.html"><code>Sequel</code></a> still defaults to the old migrator, but you can use the new one without making changes to your old migrations.  Just make sure your new migration starts with a version greater than 20000100, and <a href="../../Sequel.html"><code>Sequel</code></a> will automatically convert the previous schema table to the new format.</p>
</li><li>
<p>A new migration DSL was added:</p>

<pre class="ruby"><span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">migration</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">up</span> <span class="ruby-keyword">do</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">down</span> <span class="ruby-keyword">do</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>The old style of using a <a href="../../Sequel/Migration.html"><code>Sequel::Migration</code></a> subclass is still supported, but it is recommended that new code use the new DSL.</p>
</li><li>
<p>The default migrator also had significant issues fixed.  First, it now saves the migration version after each migration, instead of after all migrations, which means <a href="../../Sequel.html"><code>Sequel</code></a> won&#39;t attempt to apply already applied migrations if there was previously an error when applying multiple migrations at once on a database that didn&#39;t support transactional schema modification.</p>

<p>Second, duplicate migration versions in the default migrator now raise an exception, as do missing migration versions.  Neither should happen when using the default migrator, which requires consecutive integer versions, similar to the old ActiveRecord migrator.</p>
</li><li>
<p>Execution times for migrations are now logged to the database&#39;s loggers.</p>
</li></ul>

<h1 id="label-New+Plugins">New Plugins<span><a href="#label-New+Plugins">&para;</a> <a href="#top">&uarr;</a></span></h1>
<ul><li>
<p>A sharding plugin has been added that allows model objects to work well with sharded databases.  When using it, model objects know which shard they were retrieved from, so when you save the object, it is saved back to that shard.  The sharding plugin also works with associations, so associated records are retrieved from the same shard the main object was retreived from.  The sharding plugin also works with both methods of eager loading, and provides methods that you can use to create objects on specific shards.</p>
</li><li>
<p>An update_primary_key plugin has been added that allows <a href="../../Sequel.html"><code>Sequel</code></a> to work correctly if you modify the primary key of a model object. This should not be necessary if you are using surrogate keys, but if your database uses natural primary keys which can change, this should be helpful.</p>
</li><li>
<p>An association_pks plugin has been added that adds association_pks and association_pks= methods to model objects for both one_to_many and many_to_many associations.  The association_pks method returns an array of primary key values for the associated objects, and the association_pks= method modifies the database to ensure that the object is only associated to the objects specified by the array of primary keys provided to it.</p>
</li><li>
<p>A string_stripper plugin has been added that strips all strings that are assigned to attribute values.  This is useful for web applications where you want to easily remove leading and trailing whitespace in form entries before storing them in the database.</p>
</li><li>
<p>A skip_create_refresh plugin has been added that skips the refresh of after you save a new model object.  On most databases, <a href="../../Sequel.html"><code>Sequel</code></a> refreshes the model object after inserting it in order to get values for all of the columns.  For performance reasons, you can use this plugin to skip the refresh if it isn&#39;t necessary for you.</p>
</li></ul>

<h1 id="label-Other+New+Features">Other New Features<span><a href="#label-Other+New+Features">&para;</a> <a href="#top">&uarr;</a></span></h1>
<ul><li>
<p>Sequel::Model#set_fields and update_fields were added.  These methods have a similar API to set_only and update_only, but they operate differently. While set_only and update_only operate over the hash, these methods operate over the array of fields, so they don&#39;t raise errors if the hash contains fields not in the array:</p>

<pre class="ruby"><span class="ruby-identifier">params</span> = {<span class="ruby-value">:a</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">1</span>, <span class="ruby-value">:b</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">2</span>, <span class="ruby-value">:c</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">3</span>}
<span class="ruby-identifier">album</span> = <span class="ruby-constant">Album</span>[<span class="ruby-value">1</span>]

<span class="ruby-comment"># raises Error because :a is not in the fields</span>
<span class="ruby-identifier">album</span>.<span class="ruby-identifier">set_only</span>(<span class="ruby-identifier">params</span>, [<span class="ruby-value">:b</span>, <span class="ruby-value">:c</span>])

<span class="ruby-comment"># Just sets the value of album.b and album.c</span>
<span class="ruby-identifier">album</span>.<span class="ruby-identifier">set_fields</span>(<span class="ruby-identifier">params</span>, [<span class="ruby-value">:b</span>, <span class="ruby-value">:c</span>])
</pre>

<p>Other than handling entries in the hash that aren&#39;t in the array, set_fields and update_fields also handle entries not in the hash differently:</p>

<pre class="ruby"><span class="ruby-comment"># Doesn&#39;t modify the object, since the hash is empty</span>
<span class="ruby-identifier">album</span>.<span class="ruby-identifier">set_only</span>({}, [<span class="ruby-value">:b</span>, <span class="ruby-value">:c</span>])

<span class="ruby-comment"># Sets album.b and album.c to nil, since they aren&#39;t in the hash</span>
<span class="ruby-identifier">album</span>.<span class="ruby-identifier">set_fields</span>({}, [<span class="ruby-value">:b</span>, <span class="ruby-value">:c</span>])
</pre>
</li><li>
<p>The :eager_loader association option has a new API, though the previous API still works.  Instead of accepting three arguments, it can now accept a single hash argument, which will use the :key_hash, :rows, and :association keys for the previous three arguments.  The hash will also contain a :self key whose value is the dataset doing the eager load, which was not possible to determine using the old API.</p>
</li><li>
<p><a href="../../Sequel/SQL/Expression.html#method-i-hash"><code>Sequel::SQL::Expression#hash</code></a> has been added so that the objects are now safe to use as hash keys.</p>
</li><li>
<p>A Dataset#order_prepend method has been added allowing you to prepend to an existing order.  This is useful if want to modify a dataset&#39;s order such that it first orders by the columns you provide, but for any rows where the columns you provide are equal, uses the existing order to further order the dataset:</p>

<pre class="ruby"><span class="ruby-identifier">ds</span>.<span class="ruby-identifier">order</span>(<span class="ruby-value">:albums__name</span>).<span class="ruby-identifier">order_prepend</span>(<span class="ruby-value">:artists__name</span>)
<span class="ruby-comment"># ORDER BY artists.name, albums.name</span>
</pre>
</li><li>
<p>When creating foreign key columns, you can now use a :deferrable option to set up a foreign key constraint that is not checked until the end of the transaction:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>.<span class="ruby-identifier">create_table</span>(<span class="ruby-value">:albums</span>) <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">primary_key</span> <span class="ruby-value">:id</span>
  <span class="ruby-constant">String</span> <span class="ruby-value">:name</span>
  <span class="ruby-identifier">foreign_key</span> <span class="ruby-value">:artist_id</span>, <span class="ruby-value">:artists</span>, <span class="ruby-value">:deferrable</span><span class="ruby-operator">=&gt;</span><span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span>
</pre>
</li><li>
<p>many_to_many associations now support a :join_table_block option that is used by the add/remove/remove_all methods.  It can modify the dataset to ensure that certain columns are included when inserting or to add a filter so that only certain records are deleted.  It&#39;s useful if you have a many_to_many association that is filtered to only a subset of the matching rows in the join table.</p>
</li><li>
<p>The single_table_inheritance plugin now supports :model_map and :key_map options to set up a custom mapping of column values to model classes.  For simple situations such as when you are mapping integer values to certain classes, a :model_map hash is sufficient:</p>

<pre class="ruby"><span class="ruby-constant">Employee</span>.<span class="ruby-identifier">plugin</span> <span class="ruby-value">:single_table_inheritance</span>, <span class="ruby-value">:type_id</span>,
 <span class="ruby-value">:model_map</span><span class="ruby-operator">=&gt;</span>{<span class="ruby-value">1</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">:Staff</span>, <span class="ruby-value">2</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">:Manager</span>}
</pre>

<p>Here the :model_map keys are type_id column values, and the :model_map values are symbols or strings specifying class names.</p>

<p>For more complex conditions, you can use a pair of procs:</p>

<pre class="ruby"><span class="ruby-constant">Employee</span>.<span class="ruby-identifier">plugin</span> <span class="ruby-value">:single_table_inheritance</span>, <span class="ruby-value">:type_name</span>,
 <span class="ruby-value">:model_map</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">proc</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">reverse</span>},
 <span class="ruby-value">:key_map</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">proc</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">klass</span><span class="ruby-operator">|</span> <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">reverse</span>}
</pre>

<p>Here the type_name column is a string column holding the reverse of the class&#39;s name.</p>
</li><li>
<p>The single_table_inheritance plugin now correctly sets up subclass filters for middle tables in a class hierarchy with more than 2 levels.  For example, with this code:</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">Employee</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Sequel</span><span class="ruby-operator">::</span><span class="ruby-constant">Model</span>; <span class="ruby-keyword">end</span>
<span class="ruby-constant">Employee</span>.<span class="ruby-identifier">plugin</span> <span class="ruby-value">:single_table_inheritance</span>, <span class="ruby-value">:kind</span>
<span class="ruby-keyword">class</span> <span class="ruby-constant">Manager</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Employee</span>; <span class="ruby-keyword">end</span>
<span class="ruby-keyword">class</span> <span class="ruby-constant">Executive</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Manager</span>; <span class="ruby-keyword">end</span>
</pre>

<p><a href="../../Sequel.html"><code>Sequel</code></a> previously would not return Executives if you used Manager.all.  It now correctly recognizes subclasses so that it will return both Managers and Executives.</p>
</li><li>
<p>Sequel::Model.qualified_primary_key_hash has been added, giving you a hash that can be used for filtering.  It is similar to primary_key_hash, but it qualifies the keys with the model&#39;s table.  It&#39;s useful if you have joined the table to another table that has columns with the same name, but you want to only look for a single model object in that dataset.</p>
</li><li>
<p>For consistency, you can now use Dataset#order_append as an alias for order_more.</p>
</li></ul>

<h1 id="label-Other+Improvements">Other Improvements<span><a href="#label-Other+Improvements">&para;</a> <a href="#top">&uarr;</a></span></h1>
<ul><li>
<p><a href="../../Sequel.html"><code>Sequel</code></a> now correctly removes schema entries when altering tables. Previously, some adapters that had to query the existing schema when altering tables resulted in the previous schema being cached.</p>
</li><li>
<p><a href="../../Sequel/Model/Errors.html#method-i-on"><code>Sequel::Model::Errors#on</code></a> now always returns nil if there are no errors on the attribute.  Previously, it would return an empty array in certain cases.  Additionally, <a href="../../Sequel/Model/Errors.html#method-i-empty-3F"><code>Sequel::Model::Errors#empty?</code></a> now returns true if there are no errors, where it certain cases it would return false even if there were no errors.</p>
</li><li>
<p>The schema_dumper extension now works with tables specified as Sequel::SQL::Identifiers.</p>
</li><li>
<p><a href="../../Sequel.html"><code>Sequel</code></a> now recognizes the timestamp(N) with(out) time zone column type.</p>
</li><li>
<p>The lazy_attributes plugin no longer requires the core extensions to work correctly.</p>
</li><li>
<p>DatabaseDisconnectError support has been added to the ODBC adapter, allowing <a href="../../Sequel.html"><code>Sequel</code></a> to detect disconnects and remove the connection from the connection pool.</p>
</li><li>
<p>A leak of JDBC statement objects when using transactions was fixed in the jdbc adapter.</p>
</li><li>
<p>The jdbc adapter now gives a nicer error message if you use a connection string that it doesn&#39;t recognize and there is an error when connecting.</p>
</li><li>
<p>Temporary table creation was fixed on Microsoft SQL Server, but it is not recommended as it changes the name of the table.  If you use Microsoft SQL Server, you should prefix your temporary table names with # and use the regular create table method.</p>
</li><li>
<p>A large number of guides were added to <a href="../../Sequel.html"><code>Sequel</code></a> to make it easier for new and existing users to learn more about <a href="../../Sequel.html"><code>Sequel</code></a>.  The following guides were added:</p>
<ul><li>
<p>Querying in <a href="../../Sequel.html"><code>Sequel</code></a></p>
</li><li>
<p>Migration and Schema Modification</p>
</li><li>
<p>Model Hooks</p>
</li><li>
<p>Model Validations</p>
</li><li>
<p><a href="../../Sequel.html"><code>Sequel</code></a> for SQL Users</p>
</li><li>
<p><a href="../../Sequel.html"><code>Sequel</code></a> for ActiveRecord Users</p>
</li></ul>
</li><li>
<p>RDoc section support was added to <a href="../../Sequel/Database.html"><code>Sequel::Database</code></a>, making the method documentation easier to read.</p>
</li></ul>

<h1 id="label-Backwards+Compatibility">Backwards Compatibility<span><a href="#label-Backwards+Compatibility">&para;</a> <a href="#top">&uarr;</a></span></h1>
<ul><li>
<p><a href="../../Sequel/Database.html"><code>Sequel::Database</code></a> now defines the indexes and tables methods, even if the adapter does not implement them, similar to how connect and execute are defined.  Previously, you could use respond_to? to check if the adapter supported them, now they raise Sequel::NotImplemented if the database adapter does not implement them.</p>
</li><li>
<p><a href="../../Sequel.html"><code>Sequel</code></a> used to raise NotImplementedError in certain default definitions of methods inside <a href="../../Sequel/Database.html"><code>Sequel::Database</code></a> and <a href="../../Sequel/Dataset.html"><code>Sequel::Dataset</code></a>, when the methods were supposed to be overridden in subclasses. <a href="../../Sequel.html"><code>Sequel</code></a> now uses a Sequel::NotImplemented exception class for these exceptions, which is a subclass of <a href="../../Sequel/Error.html"><code>Sequel::Error</code></a>.</p>
</li><li>
<p><a href="../../Sequel.html"><code>Sequel</code></a> no longer applies all association options to the dataset used to remove all many_to_many associated objects.  You should use the new :join_table_block option to get similar behavior if you were filtering the many_to_many association based on columns in the join table and you wanted remove_all to only remove the related columns.</p>
</li><li>
<p><a href="../../Sequel.html"><code>Sequel</code></a> now calls certain before and after hook actions in plugins in a different order than before.  This should not have an effect unless you were relying on them being called in the previous order. Now, when overriding before hooks in plugins, <a href="../../Sequel.html"><code>Sequel</code></a> always does actions before calling super, and when overriding after hooks in plugins, <a href="../../Sequel.html"><code>Sequel</code></a> always does actions after calling super.</p>
</li><li>
<p>The hook_class_methods plugin no longer skips later after hooks if a previous after hook returns false.  That behavior now only occurs for before hooks.</p>
</li><li>
<p><a href="../../Sequel.html"><code>Sequel</code></a> now only removes primary key values when updating objects if you are saving the entire object and you have not modified the values of the primary keys.  Previously, <a href="../../Sequel.html"><code>Sequel</code></a> would remove primary key values when updating even if you specified the primary key column specifically or the primary key column was modified and you used save_changes/update.</p>
</li><li>
<p><a href="../../Sequel.html"><code>Sequel</code></a> now uses explicit methods instead of aliases for certain methods.  This should only affect you if for example you overrode Dataset#group to do one thing and wanted Dataset#group_by to do the default action.  Now, Dataset#group_by, and methods like it, are explicit methods that just call the methods they previously aliased.  This also means that if you were overriding Dataset#group and explicitly aliasing group_by to it, you no longer need the alias.</p>
</li><li>
<p>The single_table_inheritance plugin now uses IN instead of = for subclass filters.  This could lead to poor performance if the database has a very bad query planner.</p>
</li><li>
<p>The private transaction_statement_object method was removed from the JDBC adapter, and <a href="../../Sequel.html"><code>Sequel</code></a> will no longer check for the presence of the method in the transaction code.</p>
</li><li>
<p>The <a href="../../Sequel/Migrator.html"><code>Sequel::Migrator</code></a> object is now a class instead of a module, and has been pretty much rewritten.  If you were using any methods of it besides apply and run, they no longer work.</p>
</li></ul>

</main>



<footer id="validator-badges" role="contentinfo">
  <p><a href="https://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://ruby.github.io/rdoc/">RDoc</a> 6.1.2.1.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

