<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>security - Sequel: The Database Toolkit for Ruby</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
  var index_rel_prefix = "../";
</script>

<script src="../js/navigation.js" defer></script>
<script src="../js/search.js" defer></script>
<script src="../js/search_index.js" defer></script>
<script src="../js/searcher.js" defer></script>
<script src="../js/darkfish.js" defer></script>

<link href="../css/fonts.css" rel="stylesheet">
<link href="../css/rdoc.css" rel="stylesheet">




<body id="top" role="document" class="file">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../table_of_contents.html#pages">Pages</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  
<div class="nav-section">
  <h3>Table of Contents</h3>

  <ul class="link-list" role="directory">
    <li><a href="#label-Security+Considerations+with+Sequel">Security Considerations with Sequel</a>
    <li><a href="#label-Code+Execution">Code Execution</a>
    <li><a href="#label-SQL+Injection">SQL Injection</a>
    <li><a href="#label-SQL+Code+Injections">SQL Code Injections</a>
    <li><a href="#label-Full+SQL+Strings">Full SQL Strings</a>
    <li><a href="#label-Full+SQL+Strings-2C+With+Possible+Placeholders">Full SQL Strings, With Possible Placeholders</a>
    <li><a href="#label-Manually+Created+Literal+Strings">Manually Created Literal Strings</a>
    <li><a href="#label-SQL+Filter+Fragments">SQL Filter Fragments</a>
    <li><a href="#label-SQL+Fragment+passed+to+Dataset-23lock_style+and+Model-23lock-21">SQL Fragment passed to Dataset#lock_style and Model#lock!</a>
    <li><a href="#label-SQL+Type+Names">SQL Type Names</a>
    <li><a href="#label-SQL+Function+Names">SQL Function Names</a>
    <li><a href="#label-SQL+Window+Frames">SQL Window Frames</a>
    <li><a href="#label-auto_literal_strings+extension">auto_literal_strings extension</a>
    <li><a href="#label-SQL+Identifier+Injections">SQL Identifier Injections</a>
    <li><a href="#label-Denial+of+Service">Denial of Service</a>
    <li><a href="#label-Column+Names-2FAliases">Column Names/Aliases</a>
    <li><a href="#label-Database+Connection+Options">Database Connection Options</a>
    <li><a href="#label-Mass+Assignment">Mass Assignment</a>
    <li><a href="#label-General+Parameter+Handling">General Parameter Handling</a>
  </ul>
</div>


  <div id="project-metadata">
    <div id="fileindex-section" class="nav-section">
  <h3>Pages</h3>

  <ul class="link-list">
  
    <li><a href="../CHANGELOG.html">CHANGELOG</a>
  
    <li><a href="../MIT-LICENSE.html">MIT-LICENSE</a>
  
    <li><a href="../README_rdoc.html">README</a>
  
    <li><a href="../doc/CHANGELOG_old.html">CHANGELOG.old</a>
  
    <li><a href="../doc/advanced_associations_rdoc.html">advanced_associations</a>
  
    <li><a href="../doc/association_basics_rdoc.html">association_basics</a>
  
    <li><a href="../doc/bin_sequel_rdoc.html">bin_sequel</a>
  
    <li><a href="../doc/cheat_sheet_rdoc.html">cheat_sheet</a>
  
    <li><a href="../doc/code_order_rdoc.html">code_order</a>
  
    <li><a href="../doc/core_extensions_rdoc.html">core_extensions</a>
  
    <li><a href="../doc/dataset_basics_rdoc.html">dataset_basics</a>
  
    <li><a href="../doc/dataset_filtering_rdoc.html">dataset_filtering</a>
  
    <li><a href="../doc/extensions_rdoc.html">extensions</a>
  
    <li><a href="../doc/fork_safety_rdoc.html">fork_safety</a>
  
    <li><a href="../doc/mass_assignment_rdoc.html">mass_assignment</a>
  
    <li><a href="../doc/migration_rdoc.html">migration</a>
  
    <li><a href="../doc/model_dataset_method_design_rdoc.html">model_dataset_method_design</a>
  
    <li><a href="../doc/model_hooks_rdoc.html">model_hooks</a>
  
    <li><a href="../doc/model_plugins_rdoc.html">model_plugins</a>
  
    <li><a href="../doc/mssql_stored_procedures_rdoc.html">mssql_stored_procedures</a>
  
    <li><a href="../doc/object_model_rdoc.html">object_model</a>
  
    <li><a href="../doc/opening_databases_rdoc.html">opening_databases</a>
  
    <li><a href="../doc/postgresql_rdoc.html">postgresql</a>
  
    <li><a href="../doc/prepared_statements_rdoc.html">prepared_statements</a>
  
    <li><a href="../doc/querying_rdoc.html">querying</a>
  
    <li><a href="../doc/reflection_rdoc.html">reflection</a>
  
    <li><a href="../doc/release_notes/1_0_txt.html">1.0</a>
  
    <li><a href="../doc/release_notes/1_1_txt.html">1.1</a>
  
    <li><a href="../doc/release_notes/1_3_txt.html">1.3</a>
  
    <li><a href="../doc/release_notes/1_4_0_txt.html">1.4.0</a>
  
    <li><a href="../doc/release_notes/1_5_0_txt.html">1.5.0</a>
  
    <li><a href="../doc/release_notes/2_0_0_txt.html">2.0.0</a>
  
    <li><a href="../doc/release_notes/2_1_0_txt.html">2.1.0</a>
  
    <li><a href="../doc/release_notes/2_10_0_txt.html">2.10.0</a>
  
    <li><a href="../doc/release_notes/2_11_0_txt.html">2.11.0</a>
  
    <li><a href="../doc/release_notes/2_12_0_txt.html">2.12.0</a>
  
    <li><a href="../doc/release_notes/2_2_0_txt.html">2.2.0</a>
  
    <li><a href="../doc/release_notes/2_3_0_txt.html">2.3.0</a>
  
    <li><a href="../doc/release_notes/2_4_0_txt.html">2.4.0</a>
  
    <li><a href="../doc/release_notes/2_5_0_txt.html">2.5.0</a>
  
    <li><a href="../doc/release_notes/2_6_0_txt.html">2.6.0</a>
  
    <li><a href="../doc/release_notes/2_7_0_txt.html">2.7.0</a>
  
    <li><a href="../doc/release_notes/2_8_0_txt.html">2.8.0</a>
  
    <li><a href="../doc/release_notes/2_9_0_txt.html">2.9.0</a>
  
    <li><a href="../doc/release_notes/3_0_0_txt.html">3.0.0</a>
  
    <li><a href="../doc/release_notes/3_1_0_txt.html">3.1.0</a>
  
    <li><a href="../doc/release_notes/3_10_0_txt.html">3.10.0</a>
  
    <li><a href="../doc/release_notes/3_11_0_txt.html">3.11.0</a>
  
    <li><a href="../doc/release_notes/3_12_0_txt.html">3.12.0</a>
  
    <li><a href="../doc/release_notes/3_13_0_txt.html">3.13.0</a>
  
    <li><a href="../doc/release_notes/3_14_0_txt.html">3.14.0</a>
  
    <li><a href="../doc/release_notes/3_15_0_txt.html">3.15.0</a>
  
    <li><a href="../doc/release_notes/3_16_0_txt.html">3.16.0</a>
  
    <li><a href="../doc/release_notes/3_17_0_txt.html">3.17.0</a>
  
    <li><a href="../doc/release_notes/3_18_0_txt.html">3.18.0</a>
  
    <li><a href="../doc/release_notes/3_19_0_txt.html">3.19.0</a>
  
    <li><a href="../doc/release_notes/3_2_0_txt.html">3.2.0</a>
  
    <li><a href="../doc/release_notes/3_20_0_txt.html">3.20.0</a>
  
    <li><a href="../doc/release_notes/3_21_0_txt.html">3.21.0</a>
  
    <li><a href="../doc/release_notes/3_22_0_txt.html">3.22.0</a>
  
    <li><a href="../doc/release_notes/3_23_0_txt.html">3.23.0</a>
  
    <li><a href="../doc/release_notes/3_24_0_txt.html">3.24.0</a>
  
    <li><a href="../doc/release_notes/3_25_0_txt.html">3.25.0</a>
  
    <li><a href="../doc/release_notes/3_26_0_txt.html">3.26.0</a>
  
    <li><a href="../doc/release_notes/3_27_0_txt.html">3.27.0</a>
  
    <li><a href="../doc/release_notes/3_28_0_txt.html">3.28.0</a>
  
    <li><a href="../doc/release_notes/3_29_0_txt.html">3.29.0</a>
  
    <li><a href="../doc/release_notes/3_3_0_txt.html">3.3.0</a>
  
    <li><a href="../doc/release_notes/3_30_0_txt.html">3.30.0</a>
  
    <li><a href="../doc/release_notes/3_31_0_txt.html">3.31.0</a>
  
    <li><a href="../doc/release_notes/3_32_0_txt.html">3.32.0</a>
  
    <li><a href="../doc/release_notes/3_33_0_txt.html">3.33.0</a>
  
    <li><a href="../doc/release_notes/3_34_0_txt.html">3.34.0</a>
  
    <li><a href="../doc/release_notes/3_35_0_txt.html">3.35.0</a>
  
    <li><a href="../doc/release_notes/3_36_0_txt.html">3.36.0</a>
  
    <li><a href="../doc/release_notes/3_37_0_txt.html">3.37.0</a>
  
    <li><a href="../doc/release_notes/3_38_0_txt.html">3.38.0</a>
  
    <li><a href="../doc/release_notes/3_39_0_txt.html">3.39.0</a>
  
    <li><a href="../doc/release_notes/3_4_0_txt.html">3.4.0</a>
  
    <li><a href="../doc/release_notes/3_40_0_txt.html">3.40.0</a>
  
    <li><a href="../doc/release_notes/3_41_0_txt.html">3.41.0</a>
  
    <li><a href="../doc/release_notes/3_42_0_txt.html">3.42.0</a>
  
    <li><a href="../doc/release_notes/3_43_0_txt.html">3.43.0</a>
  
    <li><a href="../doc/release_notes/3_44_0_txt.html">3.44.0</a>
  
    <li><a href="../doc/release_notes/3_45_0_txt.html">3.45.0</a>
  
    <li><a href="../doc/release_notes/3_46_0_txt.html">3.46.0</a>
  
    <li><a href="../doc/release_notes/3_47_0_txt.html">3.47.0</a>
  
    <li><a href="../doc/release_notes/3_48_0_txt.html">3.48.0</a>
  
    <li><a href="../doc/release_notes/3_5_0_txt.html">3.5.0</a>
  
    <li><a href="../doc/release_notes/3_6_0_txt.html">3.6.0</a>
  
    <li><a href="../doc/release_notes/3_7_0_txt.html">3.7.0</a>
  
    <li><a href="../doc/release_notes/3_8_0_txt.html">3.8.0</a>
  
    <li><a href="../doc/release_notes/3_9_0_txt.html">3.9.0</a>
  
    <li><a href="../doc/release_notes/4_0_0_txt.html">4.0.0</a>
  
    <li><a href="../doc/release_notes/4_1_0_txt.html">4.1.0</a>
  
    <li><a href="../doc/release_notes/4_10_0_txt.html">4.10.0</a>
  
    <li><a href="../doc/release_notes/4_11_0_txt.html">4.11.0</a>
  
    <li><a href="../doc/release_notes/4_12_0_txt.html">4.12.0</a>
  
    <li><a href="../doc/release_notes/4_13_0_txt.html">4.13.0</a>
  
    <li><a href="../doc/release_notes/4_14_0_txt.html">4.14.0</a>
  
    <li><a href="../doc/release_notes/4_15_0_txt.html">4.15.0</a>
  
    <li><a href="../doc/release_notes/4_16_0_txt.html">4.16.0</a>
  
    <li><a href="../doc/release_notes/4_17_0_txt.html">4.17.0</a>
  
    <li><a href="../doc/release_notes/4_18_0_txt.html">4.18.0</a>
  
    <li><a href="../doc/release_notes/4_19_0_txt.html">4.19.0</a>
  
    <li><a href="../doc/release_notes/4_2_0_txt.html">4.2.0</a>
  
    <li><a href="../doc/release_notes/4_20_0_txt.html">4.20.0</a>
  
    <li><a href="../doc/release_notes/4_21_0_txt.html">4.21.0</a>
  
    <li><a href="../doc/release_notes/4_22_0_txt.html">4.22.0</a>
  
    <li><a href="../doc/release_notes/4_23_0_txt.html">4.23.0</a>
  
    <li><a href="../doc/release_notes/4_24_0_txt.html">4.24.0</a>
  
    <li><a href="../doc/release_notes/4_25_0_txt.html">4.25.0</a>
  
    <li><a href="../doc/release_notes/4_26_0_txt.html">4.26.0</a>
  
    <li><a href="../doc/release_notes/4_27_0_txt.html">4.27.0</a>
  
    <li><a href="../doc/release_notes/4_28_0_txt.html">4.28.0</a>
  
    <li><a href="../doc/release_notes/4_29_0_txt.html">4.29.0</a>
  
    <li><a href="../doc/release_notes/4_3_0_txt.html">4.3.0</a>
  
    <li><a href="../doc/release_notes/4_30_0_txt.html">4.30.0</a>
  
    <li><a href="../doc/release_notes/4_31_0_txt.html">4.31.0</a>
  
    <li><a href="../doc/release_notes/4_32_0_txt.html">4.32.0</a>
  
    <li><a href="../doc/release_notes/4_33_0_txt.html">4.33.0</a>
  
    <li><a href="../doc/release_notes/4_34_0_txt.html">4.34.0</a>
  
    <li><a href="../doc/release_notes/4_35_0_txt.html">4.35.0</a>
  
    <li><a href="../doc/release_notes/4_36_0_txt.html">4.36.0</a>
  
    <li><a href="../doc/release_notes/4_37_0_txt.html">4.37.0</a>
  
    <li><a href="../doc/release_notes/4_38_0_txt.html">4.38.0</a>
  
    <li><a href="../doc/release_notes/4_39_0_txt.html">4.39.0</a>
  
    <li><a href="../doc/release_notes/4_4_0_txt.html">4.4.0</a>
  
    <li><a href="../doc/release_notes/4_40_0_txt.html">4.40.0</a>
  
    <li><a href="../doc/release_notes/4_41_0_txt.html">4.41.0</a>
  
    <li><a href="../doc/release_notes/4_42_0_txt.html">4.42.0</a>
  
    <li><a href="../doc/release_notes/4_43_0_txt.html">4.43.0</a>
  
    <li><a href="../doc/release_notes/4_44_0_txt.html">4.44.0</a>
  
    <li><a href="../doc/release_notes/4_45_0_txt.html">4.45.0</a>
  
    <li><a href="../doc/release_notes/4_46_0_txt.html">4.46.0</a>
  
    <li><a href="../doc/release_notes/4_47_0_txt.html">4.47.0</a>
  
    <li><a href="../doc/release_notes/4_48_0_txt.html">4.48.0</a>
  
    <li><a href="../doc/release_notes/4_49_0_txt.html">4.49.0</a>
  
    <li><a href="../doc/release_notes/4_5_0_txt.html">4.5.0</a>
  
    <li><a href="../doc/release_notes/4_6_0_txt.html">4.6.0</a>
  
    <li><a href="../doc/release_notes/4_7_0_txt.html">4.7.0</a>
  
    <li><a href="../doc/release_notes/4_8_0_txt.html">4.8.0</a>
  
    <li><a href="../doc/release_notes/4_9_0_txt.html">4.9.0</a>
  
    <li><a href="../doc/release_notes/5_0_0_txt.html">5.0.0</a>
  
    <li><a href="../doc/release_notes/5_1_0_txt.html">5.1.0</a>
  
    <li><a href="../doc/release_notes/5_10_0_txt.html">5.10.0</a>
  
    <li><a href="../doc/release_notes/5_11_0_txt.html">5.11.0</a>
  
    <li><a href="../doc/release_notes/5_12_0_txt.html">5.12.0</a>
  
    <li><a href="../doc/release_notes/5_13_0_txt.html">5.13.0</a>
  
    <li><a href="../doc/release_notes/5_14_0_txt.html">5.14.0</a>
  
    <li><a href="../doc/release_notes/5_15_0_txt.html">5.15.0</a>
  
    <li><a href="../doc/release_notes/5_16_0_txt.html">5.16.0</a>
  
    <li><a href="../doc/release_notes/5_17_0_txt.html">5.17.0</a>
  
    <li><a href="../doc/release_notes/5_18_0_txt.html">5.18.0</a>
  
    <li><a href="../doc/release_notes/5_19_0_txt.html">5.19.0</a>
  
    <li><a href="../doc/release_notes/5_2_0_txt.html">5.2.0</a>
  
    <li><a href="../doc/release_notes/5_20_0_txt.html">5.20.0</a>
  
    <li><a href="../doc/release_notes/5_21_0_txt.html">5.21.0</a>
  
    <li><a href="../doc/release_notes/5_22_0_txt.html">5.22.0</a>
  
    <li><a href="../doc/release_notes/5_23_0_txt.html">5.23.0</a>
  
    <li><a href="../doc/release_notes/5_24_0_txt.html">5.24.0</a>
  
    <li><a href="../doc/release_notes/5_25_0_txt.html">5.25.0</a>
  
    <li><a href="../doc/release_notes/5_26_0_txt.html">5.26.0</a>
  
    <li><a href="../doc/release_notes/5_27_0_txt.html">5.27.0</a>
  
    <li><a href="../doc/release_notes/5_28_0_txt.html">5.28.0</a>
  
    <li><a href="../doc/release_notes/5_29_0_txt.html">5.29.0</a>
  
    <li><a href="../doc/release_notes/5_3_0_txt.html">5.3.0</a>
  
    <li><a href="../doc/release_notes/5_30_0_txt.html">5.30.0</a>
  
    <li><a href="../doc/release_notes/5_31_0_txt.html">5.31.0</a>
  
    <li><a href="../doc/release_notes/5_32_0_txt.html">5.32.0</a>
  
    <li><a href="../doc/release_notes/5_33_0_txt.html">5.33.0</a>
  
    <li><a href="../doc/release_notes/5_34_0_txt.html">5.34.0</a>
  
    <li><a href="../doc/release_notes/5_35_0_txt.html">5.35.0</a>
  
    <li><a href="../doc/release_notes/5_36_0_txt.html">5.36.0</a>
  
    <li><a href="../doc/release_notes/5_37_0_txt.html">5.37.0</a>
  
    <li><a href="../doc/release_notes/5_38_0_txt.html">5.38.0</a>
  
    <li><a href="../doc/release_notes/5_39_0_txt.html">5.39.0</a>
  
    <li><a href="../doc/release_notes/5_4_0_txt.html">5.4.0</a>
  
    <li><a href="../doc/release_notes/5_40_0_txt.html">5.40.0</a>
  
    <li><a href="../doc/release_notes/5_41_0_txt.html">5.41.0</a>
  
    <li><a href="../doc/release_notes/5_42_0_txt.html">5.42.0</a>
  
    <li><a href="../doc/release_notes/5_43_0_txt.html">5.43.0</a>
  
    <li><a href="../doc/release_notes/5_44_0_txt.html">5.44.0</a>
  
    <li><a href="../doc/release_notes/5_45_0_txt.html">5.45.0</a>
  
    <li><a href="../doc/release_notes/5_46_0_txt.html">5.46.0</a>
  
    <li><a href="../doc/release_notes/5_47_0_txt.html">5.47.0</a>
  
    <li><a href="../doc/release_notes/5_48_0_txt.html">5.48.0</a>
  
    <li><a href="../doc/release_notes/5_49_0_txt.html">5.49.0</a>
  
    <li><a href="../doc/release_notes/5_5_0_txt.html">5.5.0</a>
  
    <li><a href="../doc/release_notes/5_50_0_txt.html">5.50.0</a>
  
    <li><a href="../doc/release_notes/5_51_0_txt.html">5.51.0</a>
  
    <li><a href="../doc/release_notes/5_52_0_txt.html">5.52.0</a>
  
    <li><a href="../doc/release_notes/5_53_0_txt.html">5.53.0</a>
  
    <li><a href="../doc/release_notes/5_54_0_txt.html">5.54.0</a>
  
    <li><a href="../doc/release_notes/5_55_0_txt.html">5.55.0</a>
  
    <li><a href="../doc/release_notes/5_6_0_txt.html">5.6.0</a>
  
    <li><a href="../doc/release_notes/5_7_0_txt.html">5.7.0</a>
  
    <li><a href="../doc/release_notes/5_8_0_txt.html">5.8.0</a>
  
    <li><a href="../doc/release_notes/5_9_0_txt.html">5.9.0</a>
  
    <li><a href="../doc/schema_modification_rdoc.html">schema_modification</a>
  
    <li><a href="../doc/security_rdoc.html">security</a>
  
    <li><a href="../doc/sharding_rdoc.html">sharding</a>
  
    <li><a href="../doc/sql_rdoc.html">sql</a>
  
    <li><a href="../doc/testing_rdoc.html">testing</a>
  
    <li><a href="../doc/thread_safety_rdoc.html">thread_safety</a>
  
    <li><a href="../doc/transactions_rdoc.html">transactions</a>
  
    <li><a href="../doc/validations_rdoc.html">validations</a>
  
    <li><a href="../doc/virtual_rows_rdoc.html">virtual_rows</a>
  
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-label="Page doc/security.rdoc">

<h1 id="label-Security+Considerations+with+Sequel">Security Considerations with <a href="../Sequel.html"><code>Sequel</code></a><span><a href="#label-Security+Considerations+with+Sequel">&para;</a> <a href="#top">&uarr;</a></span></h1>

<p>When using <a href="../Sequel.html"><code>Sequel</code></a>, there are some security areas you should be aware of:</p>
<ul><li>
<p>Code Execution</p>
</li><li>
<p>SQL Injection</p>
</li><li>
<p>Denial of Service</p>
</li><li>
<p>Mass Assignment</p>
</li><li>
<p>General Parameter Handling</p>
</li></ul>

<h2 id="label-Code+Execution">Code Execution<span><a href="#label-Code+Execution">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>The most serious security vulnerability you can have in any library is a code execution vulnerability.  <a href="../Sequel.html"><code>Sequel</code></a> should not be vulnerable to this, as it never calls eval on a string that is derived from user input. However, some <a href="../Sequel.html"><code>Sequel</code></a> methods used for creating methods via metaprogramming could conceivably be abused to do so:</p>
<ul><li>
<p><a href="../Sequel/Dataset.html#method-c-def_sql_method"><code>Sequel::Dataset.def_sql_method</code></a></p>
</li><li>
<p>Sequel::JDBC.load_driver</p>
</li><li>
<p><a href="../Sequel/Plugins.html#method-c-def_dataset_methods"><code>Sequel::Plugins.def_dataset_methods</code></a></p>
</li><li>
<p>Sequel::Dataset.prepared_statements_module (private)</p>
</li><li>
<p>Sequel::SQL::Expression.to_s_method (private)</p>
</li></ul>

<p>As long as you don&#39;t call those with user input, you should not be vulnerable to code execution.</p>

<h2 id="label-SQL+Injection">SQL Injection<span><a href="#label-SQL+Injection">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>The primary security concern in SQL database libraries is SQL injection. Because <a href="../Sequel.html"><code>Sequel</code></a> promotes using ruby objects for SQL concepts instead of raw SQL, it is less likely to be vulnerable to SQL injection. However, because <a href="../Sequel.html"><code>Sequel</code></a> still makes it easy to use raw SQL, misuse of the library can result in SQL injection in your application.</p>

<p>There are basically two kinds of possible SQL injections in Sequel:</p>
<ul><li>
<p>SQL code injections</p>
</li><li>
<p>SQL identifier injections</p>
</li></ul>

<h3 id="label-SQL+Code+Injections">SQL Code Injections<span><a href="#label-SQL+Code+Injections">&para;</a> <a href="#top">&uarr;</a></span></h3>

<h4 id="label-Full+SQL+Strings">Full SQL Strings<span><a href="#label-Full+SQL+Strings">&para;</a> <a href="#top">&uarr;</a></span></h4>

<p>Some <a href="../Sequel.html"><code>Sequel</code></a> methods are designed to execute raw SQL strings, including:</p>
<ul><li>
<p>Sequel::Database#execute</p>
</li><li>
<p><a href="../Sequel/Database.html#method-i-execute_ddl"><code>Sequel::Database#execute_ddl</code></a></p>
</li><li>
<p><a href="../Sequel/Database.html#method-i-execute_dui"><code>Sequel::Database#execute_dui</code></a></p>
</li><li>
<p><a href="../Sequel/Database.html#method-i-execute_insert"><code>Sequel::Database#execute_insert</code></a></p>
</li><li>
<p><a href="../Sequel/Database.html#method-i-run"><code>Sequel::Database#run</code></a></p>
</li><li>
<p><a href="../Sequel/Database.html#method-i-3C-3C"><code>Sequel::Database#<<</code></a></p>
</li><li>
<p>Sequel::Dataset#fetch_rows</p>
</li><li>
<p><a href="../Sequel/Dataset.html#method-i-with_sql_all"><code>Sequel::Dataset#with_sql_all</code></a></p>
</li><li>
<p><a href="../Sequel/Dataset.html#method-i-with_sql_delete"><code>Sequel::Dataset#with_sql_delete</code></a></p>
</li><li>
<p><a href="../Sequel/Dataset.html#method-i-with_sql_each"><code>Sequel::Dataset#with_sql_each</code></a></p>
</li><li>
<p><a href="../Sequel/Dataset.html#method-i-with_sql_first"><code>Sequel::Dataset#with_sql_first</code></a></p>
</li><li>
<p><a href="../Sequel/Dataset.html#method-i-with_sql_insert"><code>Sequel::Dataset#with_sql_insert</code></a></p>
</li><li>
<p><a href="../Sequel/Dataset.html#method-i-with_sql_single_value"><code>Sequel::Dataset#with_sql_single_value</code></a></p>
</li><li>
<p><a href="../Sequel/Dataset.html#method-i-with_sql_update"><code>Sequel::Dataset#with_sql_update</code></a></p>
</li></ul>

<p>Here are some examples of use:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>.<span class="ruby-identifier">execute</span> <span class="ruby-string">&#39;SQL&#39;</span>
<span class="ruby-constant">DB</span>.<span class="ruby-identifier">execute_ddl</span> <span class="ruby-string">&#39;SQL&#39;</span>
<span class="ruby-constant">DB</span>.<span class="ruby-identifier">execute_dui</span> <span class="ruby-string">&#39;SQL&#39;</span>
<span class="ruby-constant">DB</span>.<span class="ruby-identifier">execute_insert</span> <span class="ruby-string">&#39;SQL&#39;</span>
<span class="ruby-constant">DB</span>.<span class="ruby-identifier">run</span> <span class="ruby-string">&#39;SQL&#39;</span>
<span class="ruby-constant">DB</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;SQL&#39;</span>
<span class="ruby-constant">DB</span>.<span class="ruby-identifier">fetch_rows</span>(<span class="ruby-string">&#39;SQL&#39;</span>){<span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span> }
<span class="ruby-constant">DB</span>.<span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">with_sql_all</span>(<span class="ruby-string">&#39;SQL&#39;</span>)
<span class="ruby-constant">DB</span>.<span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">with_sql_delete</span>(<span class="ruby-string">&#39;SQL&#39;</span>)
<span class="ruby-constant">DB</span>.<span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">with_sql_each</span>(<span class="ruby-string">&#39;SQL&#39;</span>){<span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span> }
<span class="ruby-constant">DB</span>.<span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">with_sql_first</span>(<span class="ruby-string">&#39;SQL&#39;</span>)
<span class="ruby-constant">DB</span>.<span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">with_sql_insert</span>(<span class="ruby-string">&#39;SQL&#39;</span>)
<span class="ruby-constant">DB</span>.<span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">with_sql_single_value</span>(<span class="ruby-string">&#39;SQL&#39;</span>)
<span class="ruby-constant">DB</span>.<span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">with_sql_update</span>(<span class="ruby-string">&#39;SQL&#39;</span>)
</pre>

<p>If you pass a string to these methods that is derived from user input, you open yourself up to SQL injection.  These methods are not designed to work at all with user input.  If you must call them with user input, you should escape the user input manually via <a href="../Sequel/Database.html#method-i-literal"><code>Sequel::Database#literal</code></a>. Example:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>.<span class="ruby-identifier">run</span> <span class="ruby-node">&quot;SOME SQL #{DB.literal(params[:user].to_s)}&quot;</span>
</pre>

<h4 id="label-Full+SQL+Strings-2C+With+Possible+Placeholders">Full SQL Strings, With Possible Placeholders<span><a href="#label-Full+SQL+Strings-2C+With+Possible+Placeholders">&para;</a> <a href="#top">&uarr;</a></span></h4>

<p>Other <a href="../Sequel.html"><code>Sequel</code></a> methods are designed to support execution of raw SQL strings that may contain placeholders:</p>
<ul><li>
<p><a href="../Sequel/Database.html#method-i-5B-5D"><code>Sequel::Database#[]</code></a></p>
</li><li>
<p><a href="../Sequel/Database.html#method-i-fetch"><code>Sequel::Database#fetch</code></a></p>
</li><li>
<p><a href="../Sequel/Dataset.html#method-i-with_sql"><code>Sequel::Dataset#with_sql</code></a></p>
</li></ul>

<p>Here are some examples of use:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-string">&#39;SQL&#39;</span>].<span class="ruby-identifier">all</span>
<span class="ruby-constant">DB</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&#39;SQL&#39;</span>).<span class="ruby-identifier">all</span>
<span class="ruby-constant">DB</span>.<span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">with_sql</span>(<span class="ruby-string">&#39;SQL&#39;</span>).<span class="ruby-identifier">all</span>
</pre>

<p>With these methods you should use placeholders, in which case <a href="../Sequel.html"><code>Sequel</code></a> automatically escapes the input:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-string">&#39;SELECT * FROM foo WHERE bar = ?&#39;</span>, <span class="ruby-identifier">params</span>[<span class="ruby-value">:user</span>].<span class="ruby-identifier">to_s</span>]
</pre>

<h4 id="label-Manually+Created+Literal+Strings">Manually Created Literal Strings<span><a href="#label-Manually+Created+Literal+Strings">&para;</a> <a href="#top">&uarr;</a></span></h4>

<p><a href="../Sequel.html"><code>Sequel</code></a> generally treats ruby strings as SQL strings (escaping them correctly), and not as raw SQL.  However, you can convert a ruby string to a literal string, and <a href="../Sequel.html"><code>Sequel</code></a> will then treat it as raw SQL.  This is typically done through <a href="../Sequel/SQL/Builders.html#method-i-lit">Sequel.lit</a>.</p>

<pre class="ruby"><span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">lit</span>(<span class="ruby-string">&#39;a&#39;</span>)
</pre>

<p>Using <a href="../Sequel/SQL/Builders.html#method-i-lit">Sequel.lit</a> to turn a ruby string into a literal string results in SQL injection if the string is derived from user input.  With both of these methods, the strings can contain placeholders, which you can use to safely include user input inside a literal string:</p>

<pre class="ruby"><span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">lit</span>(<span class="ruby-string">&#39;a = ?&#39;</span>, <span class="ruby-identifier">params</span>[<span class="ruby-value">:user_id</span>].<span class="ruby-identifier">to_s</span>)
</pre>

<p>Even though they have similar names, note that <a href="../Sequel/Database.html#method-i-literal"><code>Sequel::Database#literal</code></a> operates very differently from String#lit or <a href="../Sequel/SQL/Builders.html#method-i-lit">Sequel.lit</a>. <a href="../Sequel/Database.html#method-i-literal"><code>Sequel::Database#literal</code></a> is for taking any supported object, and getting an SQL representation of that object, while String#lit or <a href="../Sequel/SQL/Builders.html#method-i-lit">Sequel.lit</a> are for treating a ruby string as raw SQL.  For example:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>.<span class="ruby-identifier">literal</span>(<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>) <span class="ruby-comment"># &quot;&#39;2013-03-22&#39;&quot;</span>
<span class="ruby-constant">DB</span>.<span class="ruby-identifier">literal</span>(<span class="ruby-string">&#39;a&#39;</span>) <span class="ruby-comment"># &quot;&#39;a&#39;&quot;</span>
<span class="ruby-constant">DB</span>.<span class="ruby-identifier">literal</span>(<span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">lit</span>(<span class="ruby-string">&#39;a&#39;</span>)) <span class="ruby-comment"># &quot;a&quot;</span>
<span class="ruby-constant">DB</span>.<span class="ruby-identifier">literal</span>(<span class="ruby-value">:a</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;a&#39;</span>) <span class="ruby-comment"># &quot;(\&quot;a\&quot; = &#39;a&#39;)&quot;</span>
<span class="ruby-constant">DB</span>.<span class="ruby-identifier">literal</span>(<span class="ruby-value">:a</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">lit</span>(<span class="ruby-string">&#39;a&#39;</span>)) <span class="ruby-comment"># &quot;(\&quot;a\&quot; = a)&quot;</span>
</pre>

<h4 id="label-SQL+Filter+Fragments">SQL Filter Fragments<span><a href="#label-SQL+Filter+Fragments">&para;</a> <a href="#top">&uarr;</a></span></h4>

<p>Starting in <a href="../Sequel.html"><code>Sequel</code></a> 5, <a href="../Sequel.html"><code>Sequel</code></a> does not automatically convert plain strings to literal strings in typical code.  Instead, you can use Sequel.lit to create literal strings:</p>

<pre class="ruby"><span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">lit</span>(<span class="ruby-string">&quot;name &gt; &#39;A&#39;&quot;</span>)
</pre>

<p>To safely include user input as part of an SQL filter fragment, use Sequel.lit with placeholders:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">where</span>(<span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">lit</span>(<span class="ruby-string">&quot;name &gt; ?&quot;</span>, <span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>].<span class="ruby-identifier">to_s</span>)) <span class="ruby-comment"># Safe</span>
</pre>

<p>Be careful to never call Sequel.lit where the first argument is derived from user input.</p>

<p>There are a few uncommon cases where <a href="../Sequel.html"><code>Sequel</code></a> will still convert plain strings to literal strings.</p>

<h4 id="label-SQL+Fragment+passed+to+Dataset-23lock_style+and+Model-23lock-21">SQL Fragment passed to Dataset#lock_style and Model#lock!<span><a href="#label-SQL+Fragment+passed+to+Dataset-23lock_style+and+Model-23lock-21">&para;</a> <a href="#top">&uarr;</a></span></h4>

<p>The <a href="../Sequel/Dataset.html#method-i-lock_style"><code>Sequel::Dataset#lock_style</code></a> and Sequel::Model#lock! methods also treat an input string as SQL code. These methods should not be called with user input.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">lock_style</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>]) <span class="ruby-comment"># SQL injection!</span>
<span class="ruby-constant">Album</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">lock!</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>]) <span class="ruby-comment"># SQL injection!</span>
</pre>

<h4 id="label-SQL+Type+Names">SQL Type Names<span><a href="#label-SQL+Type+Names">&para;</a> <a href="#top">&uarr;</a></span></h4>

<p>In general, most places where <a href="../Sequel.html"><code>Sequel</code></a> needs to use an SQL type that should be specified by the user, it allows you to use a ruby string, and that string is used verbatim as the SQL type.  You should not use user input for type strings.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">select</span>(<span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">cast</span>(<span class="ruby-value">:a</span>, <span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>])) <span class="ruby-comment"># SQL injection!</span>
</pre>

<h4 id="label-SQL+Function+Names">SQL Function Names<span><a href="#label-SQL+Function+Names">&para;</a> <a href="#top">&uarr;</a></span></h4>

<p>In most cases, <a href="../Sequel.html"><code>Sequel</code></a> does not quote SQL function names.  You should not use user input for function names.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">select</span>(<span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">function</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>])) <span class="ruby-comment"># SQL injection!</span>
</pre>

<h4 id="label-SQL+Window+Frames">SQL Window Frames<span><a href="#label-SQL+Window+Frames">&para;</a> <a href="#top">&uarr;</a></span></h4>

<p>For backwards compatibility, <a href="../Sequel.html"><code>Sequel</code></a> supports regular strings in the window function :frame option, which will be treated as a literal string:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">select</span>{<span class="ruby-identifier">fun</span>(<span class="ruby-identifier">arg</span>).<span class="ruby-identifier">over</span>(<span class="ruby-value">:frame</span><span class="ruby-operator">=&gt;</span><span class="ruby-string">&#39;SQL Here&#39;</span>)}
</pre>

<p>You should make sure the frame argument is not derived from user input, or switch to using a hash as the :frame option value.</p>

<h4 id="label-auto_literal_strings+extension">auto_literal_strings extension<span><a href="#label-auto_literal_strings+extension">&para;</a> <a href="#top">&uarr;</a></span></h4>

<p>If the auto_literal_strings extension is used for backwards compatibility, then <a href="../Sequel.html"><code>Sequel</code></a> will treat plain strings as literal strings if they are used as the first argument to a filtering method.  This can lead to SQL injection:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">where</span>(<span class="ruby-node">&quot;name &gt; #{params[:id].to_s}&quot;</span>)
<span class="ruby-comment"># SQL injection when using auto_literal_strings extension</span>
</pre>

<p>If you are using the auto_literal_strings extension, you need to be very careful, as the following methods will treat a plain string given as the first argument as a literal string:</p>
<ul><li>
<p><a href="../Sequel/Dataset.html#method-i-where"><code>Sequel::Dataset#where</code></a></p>
</li><li>
<p><a href="../Sequel/Dataset.html#method-i-having"><code>Sequel::Dataset#having</code></a></p>
</li><li>
<p><a href="../Sequel/Dataset.html#method-i-filter"><code>Sequel::Dataset#filter</code></a></p>
</li><li>
<p><a href="../Sequel/Dataset.html#method-i-exclude"><code>Sequel::Dataset#exclude</code></a></p>
</li><li>
<p><a href="../Sequel/Dataset.html#method-i-exclude_having"><code>Sequel::Dataset#exclude_having</code></a></p>
</li><li>
<p><a href="../Sequel/Dataset.html#method-i-or"><code>Sequel::Dataset#or</code></a></p>
</li><li>
<p><a href="../Sequel/Dataset.html#method-i-first"><code>Sequel::Dataset#first</code></a></p>
</li><li>
<p><a href="../Sequel/Dataset.html#method-i-last"><code>Sequel::Dataset#last</code></a></p>
</li><li>
<p><a href="../Sequel/Dataset.html#method-i-5B-5D"><code>Sequel::Dataset#[]</code></a></p>
</li></ul>

<p>Even stuff that looks like it may be safe isn&#39;t:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">first</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:num_rows</span>])
<span class="ruby-comment"># SQL injection when using auto_literal_strings extension</span>
</pre>

<p>The <a href="../Sequel/Model/ClassMethods.html#method-i-find">Model.find</a> and <a href="../Sequel/Model/ClassMethods.html#method-i-find_or_create">Model.find_or_create</a> class methods will also treat string arguments as literal strings if the auto_literal_strings extension is used:</p>

<pre class="ruby"><span class="ruby-constant">Album</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>])
<span class="ruby-comment"># SQL injection when using auto_literal_strings extension</span>
</pre>

<p>Similar to the filter methods, the auto_literal_strings extension also makes <a href="../Sequel/Dataset.html#method-i-update"><code>Sequel::Dataset#update</code></a> treats a string argument as raw SQL:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">update</span>(<span class="ruby-string">&quot;column = 1&quot;</span>)
</pre>

<p>So you should not do:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">update</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:changes</span>])
<span class="ruby-comment"># SQL injection when using auto_literal_strings extension</span>
</pre>

<p>or:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">update</span>(<span class="ruby-node">&quot;column = #{params[:value].to_s}&quot;</span>)
<span class="ruby-comment"># SQL injection when using auto_literal_strings extension</span>
</pre>

<p>Instead, you should do:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">update</span>(<span class="ruby-value">:column</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-value">:value</span>].<span class="ruby-identifier">to_s</span>) <span class="ruby-comment"># Safe</span>
</pre>

<p>Because using the auto_literal_strings extension makes SQL injection so much eaiser, it is recommended to not use it, and instead use Sequel.lit with placeholders.</p>

<h3 id="label-SQL+Identifier+Injections">SQL Identifier Injections<span><a href="#label-SQL+Identifier+Injections">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Usually, <a href="../Sequel.html"><code>Sequel</code></a> treats ruby symbols as SQL identifiers, and ruby strings as SQL strings.  However, there are some parts of <a href="../Sequel.html"><code>Sequel</code></a> that treat ruby strings as SQL identifiers if an SQL string would not make sense in the same context.</p>

<p>For example, <a href="../Sequel/Database.html#method-i-from"><code>Sequel::Database#from</code></a> and <a href="../Sequel/Dataset.html#method-i-from"><code>Sequel::Dataset#from</code></a> will treat a string as a table name:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>.<span class="ruby-identifier">from</span>(<span class="ruby-string">&#39;t&#39;</span>) <span class="ruby-comment"># SELECT * FROM &quot;t&quot;</span>
</pre>

<p>Another place where <a href="../Sequel.html"><code>Sequel</code></a> treats ruby strings as identifiers are the <a href="../Sequel/Dataset.html#method-i-insert"><code>Sequel::Dataset#insert</code></a> and <a href="../Sequel/Dataset.html#method-i-update"><code>Sequel::Dataset#update</code></a> methods:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:t</span>].<span class="ruby-identifier">update</span>(<span class="ruby-string">&#39;b&#39;</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">1</span>) <span class="ruby-comment"># UPDATE &quot;t&quot; SET &quot;b&quot; = 1</span>
<span class="ruby-constant">DB</span>[<span class="ruby-value">:t</span>].<span class="ruby-identifier">insert</span>(<span class="ruby-string">&#39;b&#39;</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">1</span>) <span class="ruby-comment"># INSERT INTO &quot;t&quot; (&quot;b&quot;) VALUES (1)</span>
</pre>

<p>Note how the identifier is still quoted in these cases.  <a href="../Sequel.html"><code>Sequel</code></a> quotes identifiers by default on most databases.  However, it does not quote identifiers by default on DB2. On those databases using an identifier derived from user input can lead to SQL injection. Similarly, if you turn off identifier quoting manually on other databases, you open yourself up to SQL injection if you use identifiers derived from user input.</p>

<p>When <a href="../Sequel.html"><code>Sequel</code></a> quotes identifiers, using an identifier derived from user input does not lead to SQL injection, since the identifiers are also escaped when quoting. Exceptions to this are Oracle (can&#39;t escape <code>&quot;</code>) and Microsoft Access (can&#39;t escape <code>]</code>).</p>

<p>In general, even if doesn&#39;t lead to SQL Injection, you should avoid using identifiers derived from user input unless absolutely necessary.</p>

<p><a href="../Sequel.html"><code>Sequel</code></a> also allows you to create identifiers using <a href="../Sequel/SQL/Builders.html#method-i-identifier">Sequel.identifier</a> for plain identifiers, <a href="../Sequel/SQL/Builders.html#method-i-qualify">Sequel.qualify</a> and <a href="">Sequel::SQL::Indentifier#[][rdoc-ref:Sequel::SQL::QualifyingMethods#</a>] for qualified identifiers, and <a href="../Sequel/SQL/Builders.html#method-i-as">Sequel.as</a> for aliased expressions.  So if you pass any of those values derived from user input, you are dealing with the same scenario.</p>

<p>Note that the issues with SQL identifiers do not just apply to places where strings are used as identifiers, they also apply to all places where <a href="../Sequel.html"><code>Sequel</code></a> uses symbols as identifiers.  However, if you are creating symbols from user input, you at least have a denial of service vulnerability in ruby &lt;2.2, and possibly a more serious vulnerability.</p>

<p>Note that many Database schema modification methods (e.g. create_table, add_column) also allow for SQL identifier injections, and possibly also SQL code injections. These methods should never be called with user input.</p>

<h2 id="label-Denial+of+Service">Denial of Service<span><a href="#label-Denial+of+Service">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p><a href="../Sequel.html"><code>Sequel</code></a> converts some strings to symbols.  Because symbols in ruby &lt;2.2 are not garbage collected, if the strings that are converted to symbols are derived from user input, you have a denial of service vulnerability due to memory exhaustion.</p>

<p>The strings that <a href="../Sequel.html"><code>Sequel</code></a> converts to symbols are generally not derived from user input, so <a href="../Sequel.html"><code>Sequel</code></a> in general is not vulnerable to this.  However, users should be aware of the cases in which <a href="../Sequel.html"><code>Sequel</code></a> creates symbols, so they do not introduce a vulnerability into their application.</p>

<h3 id="label-Column+Names-2FAliases">Column Names/Aliases<span><a href="#label-Column+Names-2FAliases">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p><a href="../Sequel.html"><code>Sequel</code></a> returns SQL result sets as an array of hashes with symbol keys.  The keys are derived from the name that the database server gives the column. These names are generally static.  For example:</p>

<pre class="ruby"><span class="ruby-constant">SELECT</span> <span class="ruby-identifier">column</span> <span class="ruby-constant">FROM</span> <span class="ruby-identifier">table</span>
</pre>

<p>The database will generally use “column” as the name in the result set.</p>

<p>If you use an alias:</p>

<pre>SELECT column AS alias FROM table</pre>

<p>The database will generally use “alias” as the name in the result set. So if you allow the user to control the alias name:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">select</span>(<span class="ruby-value">:column</span>.<span class="ruby-identifier">as</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:alias</span>]))
</pre>

<p>Then you can have a denial of service vulnerability.  In general, such a vulnerability is unlikely, because you are probably indexing into the returned hash(es) by name, and if an alias was used and you didn&#39;t expect it, your application wouldn&#39;t work.</p>

<h3 id="label-Database+Connection+Options">Database Connection Options<span><a href="#label-Database+Connection+Options">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>All database connection options are converted to symbols.  For a connection URL, the keys are generally fixed, but the scheme is turned into a symbol and the query option keys are used as connection option keys, so they are converted to symbols as well.  For example:</p>

<pre>postgres://host/database?option1=foo&amp;option2=bar</pre>

<p>Will result in :postgres, :option1, and :option2 symbols being created.</p>

<p>Certain option values are also converted to symbols.  In the general case, the sql_log_level option value is, but some adapters treat additional options similarly.</p>

<p>This is not generally a risk unless you are allowing the user to control the connection URLs or are connecting to arbitrary databases at runtime.</p>

<h2 id="label-Mass+Assignment">Mass Assignment<span><a href="#label-Mass+Assignment">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Mass assignment is the practice of passing a hash of columns and values to a single method, and having multiple column values for a given object set based on the content of the hash. The security issue here is that mass assignment may allow the user to set columns that you didn&#39;t intend to allow.</p>

<p>The <a href="../Sequel/Model/InstanceMethods.html#method-i-set">Model#set</a> and <a href="../Sequel/Model/InstanceMethods.html#method-i-update">Model#update</a> methods do mass assignment.  The default configuration of <a href="../Sequel/Model.html"><code>Sequel::Model</code></a> allows all model columns except for the primary key column(s) to be set via mass assignment.</p>

<p>Example:</p>

<pre class="ruby"><span class="ruby-identifier">album</span> = <span class="ruby-constant">Album</span>.<span class="ruby-identifier">new</span>
<span class="ruby-identifier">album</span>.<span class="ruby-identifier">set</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:album</span>]) <span class="ruby-comment"># Mass Assignment</span>
</pre>

<p>Both <a href="../Sequel/Model/InstanceMethods.html#method-c-new">Model.new</a> and <a href="../Sequel/Model/ClassMethods.html#method-i-create">Model.create</a> call <a href="../Sequel/Model/InstanceMethods.html#method-i-set">Model#set</a> internally, so they also allow mass assignment:</p>

<pre class="ruby"><span class="ruby-constant">Album</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:album</span>]) <span class="ruby-comment"># Mass Assignment</span>
<span class="ruby-constant">Album</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:album</span>]) <span class="ruby-comment"># Mass Assignment</span>
</pre>

<p>When the argument is derived from user input, instead of these methods, it is encouraged to either use  <a href="../Sequel/Model/InstanceMethods.html#method-i-set_fields">Model#set_fields</a> or <a href="../Sequel/Model/InstanceMethods.html#method-i-update_fields">Model#update_fields</a>, which allow you to specify which fields to allow on a per-call basis.  This pretty much eliminates the chance that the user will be able to set a column you did not intend to allow:</p>

<pre class="ruby"><span class="ruby-identifier">album</span>.<span class="ruby-identifier">set_fields</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:album</span>], [<span class="ruby-value">:name</span>, <span class="ruby-value">:copies_sold</span>])
<span class="ruby-identifier">album</span>.<span class="ruby-identifier">update_fields</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:album</span>], [<span class="ruby-value">:name</span>, <span class="ruby-value">:copies_sold</span>])
</pre>

<p>These two methods iterate over the second argument (<code>:name</code> and <code>:copies_sold</code> in this example) instead of iterating over the entries in the first argument (<code>params[:album]</code> in this example).</p>

<p>If you want to override the columns that <a href="../Sequel/Model/InstanceMethods.html#method-i-set">Model#set</a> allows by default during mass assignment, you can use the whitelist_security plugin, then call the set_allowed_columns class method.</p>

<pre class="ruby"><span class="ruby-constant">Album</span>.<span class="ruby-identifier">plugin</span> <span class="ruby-value">:whitelist_security</span>
<span class="ruby-constant">Album</span>.<span class="ruby-identifier">set_allowed_columns</span>(<span class="ruby-value">:name</span>, <span class="ruby-value">:copies_sold</span>)
<span class="ruby-constant">Album</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">params</span>[<span class="ruby-value">:album</span>]) <span class="ruby-comment"># Only name and copies_sold set</span>
</pre>

<p>Being explicit on a per-call basis using the set_fields and update_fields methods is recommended instead of using the whitelist_security plugin and setting a global whitelist.</p>

<p>For more details on the mass assignment methods, see the <a href="mass_assignment_rdoc.html">Mass Assignment Guide</a>.</p>

<h2 id="label-General+Parameter+Handling">General Parameter Handling<span><a href="#label-General+Parameter+Handling">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>This issue isn&#39;t necessarily specific to <a href="../Sequel.html"><code>Sequel</code></a>, but it is a good general practice. If you are using values derived from user input, it is best to be explicit about their type.  For example:</p>

<pre class="ruby"><span class="ruby-constant">Album</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:id</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>])
</pre>

<p>is probably a bad idea.  Assuming you are using a web framework, <code>params[:id]</code> could be a string, an array, a hash, nil, or potentially something else.</p>

<p>Assuming that <code>id</code> is an integer field, you probably want to do:</p>

<pre class="ruby"><span class="ruby-constant">Album</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:id</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>].<span class="ruby-identifier">to_i</span>)
</pre>

<p>If you are looking something up by name, you should try to enforce the value to be a string:</p>

<pre class="ruby"><span class="ruby-constant">Album</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:name</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:name</span>].<span class="ruby-identifier">to_s</span>)
</pre>

<p>If you are trying to use an IN clause with a list of id values based on input provided on a web form:</p>

<pre class="ruby"><span class="ruby-constant">Album</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:id</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:ids</span>].<span class="ruby-identifier">to_a</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:to_i</span>))
</pre>

<p>Basically, be as explicit as possible. While there aren&#39;t any known security issues in <a href="../Sequel.html"><code>Sequel</code></a> when you do:</p>

<pre class="ruby"><span class="ruby-constant">Album</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">:id</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-value">:id</span>])
</pre>

<p>It allows the attacker to choose to do any of the following queries:</p>

<pre>id IS NULL # nil
id = &#39;1&#39; # &#39;1&#39;
id IN (&#39;1&#39;, &#39;2&#39;, &#39;3&#39;) # [&#39;1&#39;, &#39;2&#39;, &#39;3&#39;]
id = (&#39;a&#39; = &#39;b&#39;) # {&#39;a&#39;=&gt;&#39;b&#39;}
id = (&#39;a&#39; IN (&#39;a&#39;, &#39;b&#39;) AND &#39;c&#39; = &#39;&#39;) # {&#39;a&#39;=&gt;[&#39;a&#39;, &#39;b&#39;], &#39;c&#39;=&gt;&#39;&#39;}</pre>

<p>While none of those allow for SQL injection, it&#39;s possible that they might have an issue in your application.  For example, a long array or deeply nested hash might cause the database to have to do a lot of work that could be avoided.</p>

<p>In general, it&#39;s best to let the attacker control as little as possible, and explicitly specifying types helps a great deal there.</p>

</main>



<footer id="validator-badges" role="contentinfo">
  <p><a href="https://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://ruby.github.io/rdoc/">RDoc</a> 6.1.2.1.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

