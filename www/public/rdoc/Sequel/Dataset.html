<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class Sequel::Dataset - Sequel: The Database Toolkit for Ruby</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
  var index_rel_prefix = "../";
</script>

<script src="../js/navigation.js" defer></script>
<script src="../js/search.js" defer></script>
<script src="../js/search_index.js" defer></script>
<script src="../js/searcher.js" defer></script>
<script src="../js/darkfish.js" defer></script>

<link href="../css/fonts.css" rel="stylesheet">
<link href="../css/rdoc.css" rel="stylesheet">




<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../table_of_contents.html#pages">Pages</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    <div id="sections-section" class="nav-section">
  <h3>Sections</h3>

  <ul class="link-list" role="directory">
    
      <li><a href="#5Buntitled-5D"></a></li>
    
      <li><a href="#1+-+Methods+that+return+modified+datasets">1 - Methods that return modified datasets</a></li>
    
      <li><a href="#2+-+Methods+that+execute+code+on+the+database">2 - Methods that execute code on the database</a></li>
    
      <li><a href="#3+-+User+Methods+relating+to+SQL+Creation">3 - User Methods relating to SQL Creation</a></li>
    
      <li><a href="#4+-+Methods+that+describe+what+the+dataset+supports">4 - Methods that describe what the dataset supports</a></li>
    
      <li><a href="#5+-+Methods+related+to+dataset+graphing">5 - Methods related to dataset graphing</a></li>
    
      <li><a href="#6+-+Miscellaneous+methods">6 - Miscellaneous methods</a></li>
    
      <li><a href="#8+-+Methods+related+to+prepared+statements+or+bound+variables">8 - Methods related to prepared statements or bound variables</a></li>
    
      <li><a href="#9+-+Internal+Methods+relating+to+SQL+Creation">9 - Internal Methods relating to SQL Creation</a></li>
    
  </ul>
</div>

    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link">Object
  
</div>

    <div id="includes-section" class="nav-section">
  <h3>Included Modules</h3>

  <ul class="link-list">
  
  
    <li><span class="include">Enumerable</span>
  
  
  
    <li><a class="include" href="SQL/AliasMethods.html">Sequel::SQL::AliasMethods</a>
  
  
  
    <li><a class="include" href="SQL/BooleanMethods.html">Sequel::SQL::BooleanMethods</a>
  
  
  
    <li><a class="include" href="SQL/CastMethods.html">Sequel::SQL::CastMethods</a>
  
  
  
    <li><a class="include" href="SQL/ComplexExpressionMethods.html">Sequel::SQL::ComplexExpressionMethods</a>
  
  
  
    <li><a class="include" href="SQL/InequalityMethods.html">Sequel::SQL::InequalityMethods</a>
  
  
  
    <li><a class="include" href="SQL/NumericMethods.html">Sequel::SQL::NumericMethods</a>
  
  
  
    <li><a class="include" href="SQL/OrderMethods.html">Sequel::SQL::OrderMethods</a>
  
  
  
    <li><a class="include" href="SQL/StringMethods.html">Sequel::SQL::StringMethods</a>
  
  
  </ul>
</div>

    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-c-clause_methods">::clause_methods</a>
    
    <li ><a href="#method-c-def_sql_method">::def_sql_method</a>
    
    <li ><a href="#method-c-new">::new</a>
    
    <li ><a href="#method-c-register_extension">::register_extension</a>
    
    <li ><a href="#method-i-3C-3C">#&lt;&lt;</a>
    
    <li ><a href="#method-i-3D-3D">#==</a>
    
    <li ><a href="#method-i-5B-5D">#[]</a>
    
    <li ><a href="#method-i-_clone">#_clone</a>
    
    <li ><a href="#method-i-_columns">#_columns</a>
    
    <li ><a href="#method-i-_import">#_import</a>
    
    <li ><a href="#method-i-_select_map_multiple">#_select_map_multiple</a>
    
    <li ><a href="#method-i-_select_map_single">#_select_map_single</a>
    
    <li ><a href="#method-i-add_graph_aliases">#add_graph_aliases</a>
    
    <li ><a href="#method-i-aliased_expression_sql_append">#aliased_expression_sql_append</a>
    
    <li ><a href="#method-i-all">#all</a>
    
    <li ><a href="#method-i-array_sql_append">#array_sql_append</a>
    
    <li ><a href="#method-i-as_hash">#as_hash</a>
    
    <li ><a href="#method-i-avg">#avg</a>
    
    <li ><a href="#method-i-bind">#bind</a>
    
    <li ><a href="#method-i-boolean_constant_sql_append">#boolean_constant_sql_append</a>
    
    <li ><a href="#method-i-cache_get">#cache_get</a>
    
    <li ><a href="#method-i-cache_set">#cache_set</a>
    
    <li ><a href="#method-i-call">#call</a>
    
    <li ><a href="#method-i-case_expression_sql_append">#case_expression_sql_append</a>
    
    <li ><a href="#method-i-cast_sql_append">#cast_sql_append</a>
    
    <li ><a href="#method-i-clear_columns_cache">#clear_columns_cache</a>
    
    <li class="calls-super" ><a href="#method-i-clone">#clone</a>
    
    <li ><a href="#method-i-column_all_sql_append">#column_all_sql_append</a>
    
    <li ><a href="#method-i-columns">#columns</a>
    
    <li ><a href="#method-i-columns-21">#columns!</a>
    
    <li ><a href="#method-i-complex_expression_sql_append">#complex_expression_sql_append</a>
    
    <li ><a href="#method-i-compound_clone">#compound_clone</a>
    
    <li ><a href="#method-i-compound_from_self">#compound_from_self</a>
    
    <li ><a href="#method-i-constant_sql_append">#constant_sql_append</a>
    
    <li ><a href="#method-i-count">#count</a>
    
    <li ><a href="#method-i-current_datetime">#current_datetime</a>
    
    <li ><a href="#method-i-delayed_evaluation_sql_append">#delayed_evaluation_sql_append</a>
    
    <li ><a href="#method-i-delete">#delete</a>
    
    <li ><a href="#method-i-distinct">#distinct</a>
    
    <li ><a href="#method-i-dup">#dup</a>
    
    <li ><a href="#method-i-each">#each</a>
    
    <li ><a href="#method-i-each_server">#each_server</a>
    
    <li ><a href="#method-i-empty-3F">#empty?</a>
    
    <li ><a href="#method-i-eql-3F">#eql?</a>
    
    <li ><a href="#method-i-escape_like">#escape_like</a>
    
    <li ><a href="#method-i-except">#except</a>
    
    <li ><a href="#method-i-exclude">#exclude</a>
    
    <li ><a href="#method-i-exclude_having">#exclude_having</a>
    
    <li ><a href="#method-i-exists">#exists</a>
    
    <li ><a href="#method-i-extension">#extension</a>
    
    <li ><a href="#method-i-filter">#filter</a>
    
    <li ><a href="#method-i-first">#first</a>
    
    <li ><a href="#method-i-first-21">#first!</a>
    
    <li ><a href="#method-i-first_source">#first_source</a>
    
    <li ><a href="#method-i-first_source_alias">#first_source_alias</a>
    
    <li ><a href="#method-i-first_source_table">#first_source_table</a>
    
    <li ><a href="#method-i-for_update">#for_update</a>
    
    <li class="calls-super" ><a href="#method-i-freeze">#freeze</a>
    
    <li ><a href="#method-i-from">#from</a>
    
    <li ><a href="#method-i-from_self">#from_self</a>
    
    <li ><a href="#method-i-function_sql_append">#function_sql_append</a>
    
    <li ><a href="#method-i-get">#get</a>
    
    <li ><a href="#method-i-graph">#graph</a>
    
    <li ><a href="#method-i-grep">#grep</a>
    
    <li ><a href="#method-i-group">#group</a>
    
    <li ><a href="#method-i-group_and_count">#group_and_count</a>
    
    <li ><a href="#method-i-group_append">#group_append</a>
    
    <li ><a href="#method-i-group_by">#group_by</a>
    
    <li ><a href="#method-i-group_cube">#group_cube</a>
    
    <li ><a href="#method-i-group_rollup">#group_rollup</a>
    
    <li ><a href="#method-i-grouping_sets">#grouping_sets</a>
    
    <li ><a href="#method-i-hash">#hash</a>
    
    <li ><a href="#method-i-having">#having</a>
    
    <li ><a href="#method-i-import">#import</a>
    
    <li ><a href="#method-i-insert">#insert</a>
    
    <li ><a href="#method-i-insert_sql">#insert_sql</a>
    
    <li ><a href="#method-i-inspect">#inspect</a>
    
    <li ><a href="#method-i-intersect">#intersect</a>
    
    <li ><a href="#method-i-invert">#invert</a>
    
    <li ><a href="#method-i-join">#join</a>
    
    <li ><a href="#method-i-join_clause_sql_append">#join_clause_sql_append</a>
    
    <li ><a href="#method-i-join_on_clause_sql_append">#join_on_clause_sql_append</a>
    
    <li ><a href="#method-i-join_table">#join_table</a>
    
    <li ><a href="#method-i-join_using_clause_sql_append">#join_using_clause_sql_append</a>
    
    <li ><a href="#method-i-joined_dataset-3F">#joined_dataset?</a>
    
    <li ><a href="#method-i-last">#last</a>
    
    <li ><a href="#method-i-lateral">#lateral</a>
    
    <li ><a href="#method-i-limit">#limit</a>
    
    <li ><a href="#method-i-literal_append">#literal_append</a>
    
    <li ><a href="#method-i-lock_style">#lock_style</a>
    
    <li class="calls-super" ><a href="#method-i-map">#map</a>
    
    <li ><a href="#method-i-max">#max</a>
    
    <li ><a href="#method-i-min">#min</a>
    
    <li ><a href="#method-i-multi_insert">#multi_insert</a>
    
    <li ><a href="#method-i-multi_insert_sql">#multi_insert_sql</a>
    
    <li ><a href="#method-i-naked">#naked</a>
    
    <li ><a href="#method-i-negative_boolean_constant_sql_append">#negative_boolean_constant_sql_append</a>
    
    <li ><a href="#method-i-nowait">#nowait</a>
    
    <li ><a href="#method-i-offset">#offset</a>
    
    <li ><a href="#method-i-options_overlap">#options_overlap</a>
    
    <li ><a href="#method-i-or">#or</a>
    
    <li ><a href="#method-i-order">#order</a>
    
    <li ><a href="#method-i-order_append">#order_append</a>
    
    <li ><a href="#method-i-order_by">#order_by</a>
    
    <li ><a href="#method-i-order_more">#order_more</a>
    
    <li ><a href="#method-i-order_prepend">#order_prepend</a>
    
    <li ><a href="#method-i-ordered_expression_sql_append">#ordered_expression_sql_append</a>
    
    <li ><a href="#method-i-paged_each">#paged_each</a>
    
    <li ><a href="#method-i-placeholder_literal_string_sql_append">#placeholder_literal_string_sql_append</a>
    
    <li ><a href="#method-i-prepare">#prepare</a>
    
    <li ><a href="#method-i-provides_accurate_rows_matched-3F">#provides_accurate_rows_matched?</a>
    
    <li ><a href="#method-i-qualified_identifier_sql_append">#qualified_identifier_sql_append</a>
    
    <li ><a href="#method-i-qualify">#qualify</a>
    
    <li ><a href="#method-i-quote_identifier_append">#quote_identifier_append</a>
    
    <li ><a href="#method-i-quote_identifiers-3F">#quote_identifiers?</a>
    
    <li ><a href="#method-i-quote_schema_table_append">#quote_schema_table_append</a>
    
    <li ><a href="#method-i-quoted_identifier_append">#quoted_identifier_append</a>
    
    <li ><a href="#method-i-recursive_cte_requires_column_aliases-3F">#recursive_cte_requires_column_aliases?</a>
    
    <li ><a href="#method-i-requires_placeholder_type_specifiers-3F">#requires_placeholder_type_specifiers?</a>
    
    <li ><a href="#method-i-requires_sql_standard_datetimes-3F">#requires_sql_standard_datetimes?</a>
    
    <li ><a href="#method-i-returning">#returning</a>
    
    <li ><a href="#method-i-reverse">#reverse</a>
    
    <li ><a href="#method-i-reverse_order">#reverse_order</a>
    
    <li ><a href="#method-i-row_number_column">#row_number_column</a>
    
    <li ><a href="#method-i-row_proc">#row_proc</a>
    
    <li ><a href="#method-i-schema_and_table">#schema_and_table</a>
    
    <li ><a href="#method-i-select">#select</a>
    
    <li ><a href="#method-i-select_all">#select_all</a>
    
    <li ><a href="#method-i-select_append">#select_append</a>
    
    <li ><a href="#method-i-select_group">#select_group</a>
    
    <li ><a href="#method-i-select_hash">#select_hash</a>
    
    <li ><a href="#method-i-select_hash_groups">#select_hash_groups</a>
    
    <li ><a href="#method-i-select_map">#select_map</a>
    
    <li ><a href="#method-i-select_more">#select_more</a>
    
    <li ><a href="#method-i-select_order_map">#select_order_map</a>
    
    <li ><a href="#method-i-server">#server</a>
    
    <li ><a href="#method-i-server-3F">#server?</a>
    
    <li ><a href="#method-i-set_graph_aliases">#set_graph_aliases</a>
    
    <li ><a href="#method-i-simple_select_all-3F">#simple_select_all?</a>
    
    <li ><a href="#method-i-single_record">#single_record</a>
    
    <li ><a href="#method-i-single_record-21">#single_record!</a>
    
    <li ><a href="#method-i-single_value">#single_value</a>
    
    <li ><a href="#method-i-single_value-21">#single_value!</a>
    
    <li ><a href="#method-i-single_value_ds">#single_value_ds</a>
    
    <li ><a href="#method-i-skip_limit_check">#skip_limit_check</a>
    
    <li ><a href="#method-i-skip_locked">#skip_locked</a>
    
    <li ><a href="#method-i-split_alias">#split_alias</a>
    
    <li ><a href="#method-i-split_qualifiers">#split_qualifiers</a>
    
    <li ><a href="#method-i-sql">#sql</a>
    
    <li ><a href="#method-i-subscript_sql_append">#subscript_sql_append</a>
    
    <li ><a href="#method-i-sum">#sum</a>
    
    <li ><a href="#method-i-supports_cte-3F">#supports_cte?</a>
    
    <li ><a href="#method-i-supports_cte_in_subqueries-3F">#supports_cte_in_subqueries?</a>
    
    <li ><a href="#method-i-supports_deleting_joins-3F">#supports_deleting_joins?</a>
    
    <li ><a href="#method-i-supports_derived_column_lists-3F">#supports_derived_column_lists?</a>
    
    <li ><a href="#method-i-supports_distinct_on-3F">#supports_distinct_on?</a>
    
    <li ><a href="#method-i-supports_group_cube-3F">#supports_group_cube?</a>
    
    <li ><a href="#method-i-supports_group_rollup-3F">#supports_group_rollup?</a>
    
    <li ><a href="#method-i-supports_grouping_sets-3F">#supports_grouping_sets?</a>
    
    <li ><a href="#method-i-supports_insert_select-3F">#supports_insert_select?</a>
    
    <li ><a href="#method-i-supports_intersect_except-3F">#supports_intersect_except?</a>
    
    <li ><a href="#method-i-supports_intersect_except_all-3F">#supports_intersect_except_all?</a>
    
    <li ><a href="#method-i-supports_is_true-3F">#supports_is_true?</a>
    
    <li ><a href="#method-i-supports_join_using-3F">#supports_join_using?</a>
    
    <li ><a href="#method-i-supports_lateral_subqueries-3F">#supports_lateral_subqueries?</a>
    
    <li ><a href="#method-i-supports_limits_in_correlated_subqueries-3F">#supports_limits_in_correlated_subqueries?</a>
    
    <li ><a href="#method-i-supports_modifying_joins-3F">#supports_modifying_joins?</a>
    
    <li ><a href="#method-i-supports_multiple_column_in-3F">#supports_multiple_column_in?</a>
    
    <li ><a href="#method-i-supports_nowait-3F">#supports_nowait?</a>
    
    <li ><a href="#method-i-supports_offsets_in_correlated_subqueries-3F">#supports_offsets_in_correlated_subqueries?</a>
    
    <li ><a href="#method-i-supports_ordered_distinct_on-3F">#supports_ordered_distinct_on?</a>
    
    <li ><a href="#method-i-supports_regexp-3F">#supports_regexp?</a>
    
    <li ><a href="#method-i-supports_replace-3F">#supports_replace?</a>
    
    <li ><a href="#method-i-supports_returning-3F">#supports_returning?</a>
    
    <li ><a href="#method-i-supports_select_all_and_column-3F">#supports_select_all_and_column?</a>
    
    <li ><a href="#method-i-supports_skip_locked-3F">#supports_skip_locked?</a>
    
    <li ><a href="#method-i-supports_timestamp_timezones-3F">#supports_timestamp_timezones?</a>
    
    <li ><a href="#method-i-supports_timestamp_usecs-3F">#supports_timestamp_usecs?</a>
    
    <li ><a href="#method-i-supports_updating_joins-3F">#supports_updating_joins?</a>
    
    <li ><a href="#method-i-supports_where_true-3F">#supports_where_true?</a>
    
    <li ><a href="#method-i-supports_window_clause-3F">#supports_window_clause?</a>
    
    <li ><a href="#method-i-supports_window_function_frame_option-3F">#supports_window_function_frame_option?</a>
    
    <li ><a href="#method-i-supports_window_functions-3F">#supports_window_functions?</a>
    
    <li ><a href="#method-i-to_hash">#to_hash</a>
    
    <li ><a href="#method-i-to_hash_groups">#to_hash_groups</a>
    
    <li ><a href="#method-i-to_prepared_statement">#to_prepared_statement</a>
    
    <li ><a href="#method-i-truncate">#truncate</a>
    
    <li ><a href="#method-i-truncate_sql">#truncate_sql</a>
    
    <li ><a href="#method-i-unfiltered">#unfiltered</a>
    
    <li ><a href="#method-i-ungraphed">#ungraphed</a>
    
    <li ><a href="#method-i-ungrouped">#ungrouped</a>
    
    <li ><a href="#method-i-union">#union</a>
    
    <li ><a href="#method-i-unlimited">#unlimited</a>
    
    <li ><a href="#method-i-unordered">#unordered</a>
    
    <li ><a href="#method-i-unqualified_column_for">#unqualified_column_for</a>
    
    <li ><a href="#method-i-unused_table_alias">#unused_table_alias</a>
    
    <li ><a href="#method-i-update">#update</a>
    
    <li ><a href="#method-i-update_sql">#update_sql</a>
    
    <li ><a href="#method-i-where">#where</a>
    
    <li ><a href="#method-i-where_all">#where_all</a>
    
    <li ><a href="#method-i-where_each">#where_each</a>
    
    <li ><a href="#method-i-where_single_value">#where_single_value</a>
    
    <li ><a href="#method-i-window">#window</a>
    
    <li ><a href="#method-i-window_sql_append">#window_sql_append</a>
    
    <li ><a href="#method-i-with">#with</a>
    
    <li ><a href="#method-i-with_extend">#with_extend</a>
    
    <li ><a href="#method-i-with_quote_identifiers">#with_quote_identifiers</a>
    
    <li ><a href="#method-i-with_recursive">#with_recursive</a>
    
    <li ><a href="#method-i-with_row_proc">#with_row_proc</a>
    
    <li ><a href="#method-i-with_sql">#with_sql</a>
    
    <li ><a href="#method-i-with_sql_all">#with_sql_all</a>
    
    <li ><a href="#method-i-with_sql_delete">#with_sql_delete</a>
    
    <li ><a href="#method-i-with_sql_each">#with_sql_each</a>
    
    <li ><a href="#method-i-with_sql_first">#with_sql_first</a>
    
    <li ><a href="#method-i-with_sql_insert">#with_sql_insert</a>
    
    <li ><a href="#method-i-with_sql_single_value">#with_sql_single_value</a>
    
    <li ><a href="#method-i-with_sql_update">#with_sql_update</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-Sequel::Dataset">
  <h1 id="class-Sequel::Dataset" class="class">
    class Sequel::Dataset
  </h1>

  <section class="description">
    
<p>A dataset represents an <a href="SQL.html"><code>SQL</code></a> query. Datasets can be used to select, insert, update and delete records.</p>

<p>Query results are always retrieved on demand, so a dataset can be kept around and reused indefinitely (datasets never cache results):</p>

<pre class="ruby"><span class="ruby-identifier">my_posts</span> = <span class="ruby-constant">DB</span>[<span class="ruby-value">:posts</span>].<span class="ruby-identifier">where</span>(<span class="ruby-value">author:</span> <span class="ruby-string">&#39;david&#39;</span>) <span class="ruby-comment"># no records are retrieved</span>
<span class="ruby-identifier">my_posts</span>.<span class="ruby-identifier">all</span> <span class="ruby-comment"># records are retrieved</span>
<span class="ruby-identifier">my_posts</span>.<span class="ruby-identifier">all</span> <span class="ruby-comment"># records are retrieved again</span>
</pre>

<p>Datasets are frozen and use a functional style where modification methods return modified copies of the the dataset.  This allows you to reuse datasets:</p>

<pre class="ruby"><span class="ruby-identifier">posts</span> = <span class="ruby-constant">DB</span>[<span class="ruby-value">:posts</span>]
<span class="ruby-identifier">davids_posts</span> = <span class="ruby-identifier">posts</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">author:</span> <span class="ruby-string">&#39;david&#39;</span>)
<span class="ruby-identifier">old_posts</span> = <span class="ruby-identifier">posts</span>.<span class="ruby-identifier">where</span>{<span class="ruby-identifier">stamp</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span> <span class="ruby-operator">-</span> <span class="ruby-value">7</span>}
<span class="ruby-identifier">davids_old_posts</span> = <span class="ruby-identifier">davids_posts</span>.<span class="ruby-identifier">where</span>{<span class="ruby-identifier">stamp</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span> <span class="ruby-operator">-</span> <span class="ruby-value">7</span>}
</pre>

<p>Datasets are Enumerable objects, so they can be manipulated using many of the Enumerable methods, such as <code>map</code> and <code>inject</code>.  Note that there are some methods that <a href="Dataset.html"><code>Dataset</code></a> defines that override methods defined in Enumerable and result in different behavior, such as <code>select</code> and <code>group_by</code>.</p>

<p>For more information, see the <a href="../doc/dataset_basics_rdoc.html">“Dataset Basics” guide</a>.</p>

  </section>

  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    
    <section class="constants-list">
      <header>
        <h3>Constants</h3>
      </header>
      <dl>
      
        <dt id="OPTS">OPTS
        
        <dd>
        
      
        <dt id="TRUE_FREEZE">TRUE_FREEZE
        
        <dd><p>Whether <a href="Dataset.html#method-i-freeze"><code>Dataset#freeze</code></a> can actually freeze datasets.  True only on ruby 2.4+, as it requires clone(freeze: false)</p>
        
      
      </dl>
    </section>
    

    

    
  </section>

  <section id="1+-+Methods+that+return+modified+datasets" class="documentation-section">
    
    <header class="documentation-section-title">
      <h2>
        1 - Methods that return modified datasets
      </h2>
      <span class="section-click-top">
        <a href="#top">&uarr; top</a>
      </span>
    </header>
    

    

    
    <section class="constants-list">
      <header>
        <h3>Constants</h3>
      </header>
      <dl>
      
        <dt id="COLUMN_CHANGE_OPTS">COLUMN_CHANGE_OPTS
        
        <dd><p>The dataset options that require the removal of cached columns if changed.</p>
        
      
        <dt id="CONDITIONED_JOIN_TYPES">CONDITIONED_JOIN_TYPES
        
        <dd><p>These symbols have _join methods created (e.g. inner_join) that call <a href="Dataset.html#method-i-join_table"><code>join_table</code></a> with the symbol, passing along the arguments and block from the method call.</p>
        
      
        <dt id="EMPTY_ARRAY">EMPTY_ARRAY
        
        <dd>
        
      
        <dt id="EXTENSIONS">EXTENSIONS
        
        <dd><p>Hash of extension name symbols to callable objects to load the extension into the <a href="Dataset.html"><code>Dataset</code></a> object (usually by extending it with a module defined in the extension).</p>
        
      
        <dt id="JOIN_METHODS">JOIN_METHODS
        
        <dd><p>All methods that return modified datasets with a joined table added.</p>
        
      
        <dt id="NON_SQL_OPTIONS">NON_SQL_OPTIONS
        
        <dd><p>Which options don&#39;t affect the <a href="SQL.html"><code>SQL</code></a> generation.  Used by simple_select_all? to determine if this is a simple SELECT * FROM table.</p>
        
      
        <dt id="QUERY_METHODS">QUERY_METHODS
        
        <dd><p>Methods that return modified datasets</p>
        
      
        <dt id="SIMPLE_SELECT_ALL_ALLOWED_FROM">SIMPLE_SELECT_ALL_ALLOWED_FROM
        
        <dd><p>From types allowed to be considered a simple_select_all</p>
        
      
        <dt id="UNCONDITIONED_JOIN_TYPES">UNCONDITIONED_JOIN_TYPES
        
        <dd><p>These symbols have _join methods created (e.g. natural_join). They accept a table argument and options hash which is passed to <a href="Dataset.html#method-i-join_table"><code>join_table</code></a>, and they raise an error if called with a block.</p>
        
      
      </dl>
    </section>
    

    

    
     <section id="public-class-1+-+Methods+that+return+modified+datasets-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-register_extension" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">register_extension</span><span
            class="method-args">(ext, mod=nil, &amp;block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Register an extension callback for <a href="Dataset.html"><code>Dataset</code></a> objects.  ext should be the extension name symbol, and mod should either be a Module that the dataset is extended with, or a callable object called with the database object.  If mod is not provided, a block can be provided and is treated as the mod object.</p>

<p>If mod is a module, this also registers a <a href="Database.html"><code>Database</code></a> extension that will extend all of the database&#39;s datasets.</p>
          
          

          
          <div class="method-source-code" id="register_extension-source">
            <pre>   <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">55</span> <span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">register_extension</span>(<span class="ruby-identifier">ext</span>, <span class="ruby-identifier">mod</span>=<span class="ruby-keyword">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">56</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">mod</span>
<span class="line-num">57</span>     <span class="ruby-identifier">raise</span>(<span class="ruby-constant">Error</span>, <span class="ruby-string">&quot;cannot provide both mod and block to Dataset.register_extension&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">block</span>
<span class="line-num">58</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">mod</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Module</span>)
<span class="line-num">59</span>       <span class="ruby-identifier">block</span> = <span class="ruby-identifier">proc</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">ds</span><span class="ruby-operator">|</span> <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">extend</span>(<span class="ruby-identifier">mod</span>)}
<span class="line-num">60</span>       <span class="ruby-constant">Sequel</span><span class="ruby-operator">::</span><span class="ruby-constant">Database</span>.<span class="ruby-identifier">register_extension</span>(<span class="ruby-identifier">ext</span>){<span class="ruby-operator">|</span><span class="ruby-identifier">db</span><span class="ruby-operator">|</span> <span class="ruby-identifier">db</span>.<span class="ruby-identifier">extend_datasets</span>(<span class="ruby-identifier">mod</span>)}
<span class="line-num">61</span>     <span class="ruby-keyword">else</span>
<span class="line-num">62</span>       <span class="ruby-identifier">block</span> = <span class="ruby-identifier">mod</span>
<span class="line-num">63</span>     <span class="ruby-keyword">end</span>
<span class="line-num">64</span>   <span class="ruby-keyword">end</span>
<span class="line-num">65</span>   <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">synchronize</span>{<span class="ruby-constant">EXTENSIONS</span>[<span class="ruby-identifier">ext</span>] = <span class="ruby-identifier">block</span>}
<span class="line-num">66</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="public-instance-1+-+Methods+that+return+modified+datasets-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-_clone" class="method-detail method-alias">
        
        <div class="method-heading">
          <span class="method-name">_clone</span><span
            class="method-args">(opts = nil || (return self))</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Save original clone implementation, as some other methods need to call it internally.</p>
          
          

          
        </div>

        

        
        <div class="aliases">
          Alias for: <a href="Dataset.html#method-i-clone">clone</a>
        </div>
        
      </div>

    
      <div id="method-i-clone" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">clone</span><span
            class="method-args">(opts = nil || (return self))</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns a new clone of the dataset with the given options merged. If the options changed include options in <a href="Dataset.html#COLUMN_CHANGE_OPTS"><code>COLUMN_CHANGE_OPTS</code></a>, the cached columns are deleted.  This method should generally not be called directly by user code.</p>
          
          
            <div class="method-calls-super">
              Calls superclass method
              
            </div>
          

          
          <div class="method-source-code" id="clone-source">
            <pre>   <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">84</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">clone</span>(<span class="ruby-identifier">opts</span> = <span class="ruby-keyword">nil</span> <span class="ruby-operator">||</span> (<span class="ruby-keyword">return</span> <span class="ruby-keyword">self</span>))
<span class="line-num">85</span>   <span class="ruby-comment"># return self used above because clone is called by almost all</span>
<span class="line-num">86</span>   <span class="ruby-comment"># other query methods, and it is the fastest approach</span>
<span class="line-num">87</span>   <span class="ruby-identifier">c</span> = <span class="ruby-keyword">super</span>(<span class="ruby-value">:freeze</span><span class="ruby-operator">=&gt;</span><span class="ruby-keyword">false</span>)
<span class="line-num">88</span>   <span class="ruby-identifier">c</span>.<span class="ruby-identifier">opts</span>.<span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">opts</span>)
<span class="line-num">89</span>   <span class="ruby-keyword">unless</span> <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">each_key</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">o</span><span class="ruby-operator">|</span> <span class="ruby-keyword">break</span> <span class="ruby-keyword">if</span> <span class="ruby-constant">COLUMN_CHANGE_OPTS</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">o</span>)}
<span class="line-num">90</span>     <span class="ruby-identifier">c</span>.<span class="ruby-identifier">clear_columns_cache</span>
<span class="line-num">91</span>   <span class="ruby-keyword">end</span>
<span class="line-num">92</span>   <span class="ruby-identifier">c</span>.<span class="ruby-identifier">freeze</span>
<span class="line-num">93</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        
        <div class="aliases">
          Also aliased as: <a href="Dataset.html#method-i-_clone">_clone</a>
        </div>
        

        
      </div>

    
      <div id="method-i-distinct" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">distinct</span><span
            class="method-args">(*args, &amp;block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns a copy of the dataset with the <a href="SQL.html"><code>SQL</code></a> DISTINCT clause. The DISTINCT clause is used to remove duplicate rows from the output.  If arguments are provided, uses a DISTINCT ON clause, in which case it will only be distinct on those columns, instead of all returned columns. If a block is given, it is treated as a virtual row block, similar to <code>where</code>. Raises an error if arguments are given and DISTINCT ON is not supported.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">distinct</span> <span class="ruby-comment"># SQL: SELECT DISTINCT * FROM items</span>
<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">order</span>(<span class="ruby-value">:id</span>).<span class="ruby-identifier">distinct</span>(<span class="ruby-value">:id</span>) <span class="ruby-comment"># SQL: SELECT DISTINCT ON (id) * FROM items ORDER BY id</span>
<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">order</span>(<span class="ruby-value">:id</span>).<span class="ruby-identifier">distinct</span>{<span class="ruby-identifier">func</span>(<span class="ruby-value">:id</span>)} <span class="ruby-comment"># SQL: SELECT DISTINCT ON (func(id)) * FROM items ORDER BY id</span>
</pre>

<p>There is support for emualting the DISTINCT ON support in MySQL, but it does not support the ORDER of the dataset, and also doesn&#39;t work in many cases if the ONLY_FULL_GROUP_BY sql_mode is used, which is the default on MySQL 5.7.5+.</p>
          
          

          
          <div class="method-source-code" id="distinct-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">123</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">distinct</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">124</span>   <span class="ruby-identifier">virtual_row_columns</span>(<span class="ruby-identifier">args</span>, <span class="ruby-identifier">block</span>)
<span class="line-num">125</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">empty?</span>
<span class="line-num">126</span>     <span class="ruby-identifier">cached_dataset</span>(<span class="ruby-value">:_distinct_ds</span>){<span class="ruby-identifier">clone</span>(<span class="ruby-value">:distinct</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-constant">EMPTY_ARRAY</span>)}
<span class="line-num">127</span>   <span class="ruby-keyword">else</span>
<span class="line-num">128</span>     <span class="ruby-identifier">raise</span>(<span class="ruby-constant">InvalidOperation</span>, <span class="ruby-string">&quot;DISTINCT ON not supported&quot;</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">supports_distinct_on?</span>
<span class="line-num">129</span>     <span class="ruby-identifier">clone</span>(<span class="ruby-value">:distinct</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">freeze</span>)
<span class="line-num">130</span>   <span class="ruby-keyword">end</span>
<span class="line-num">131</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-except" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">except</span><span
            class="method-args">(dataset, opts=OPTS)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Adds an EXCEPT clause using a second dataset object. An EXCEPT compound dataset returns all rows in the current dataset that are not in the given dataset. Raises an <code>InvalidOperation</code> if the operation is not supported. Options:</p>
<dl class="rdoc-list note-list"><dt>:alias 
<dd>
<p>Use the given value as the <a href="Dataset.html#method-i-from_self"><code>from_self</code></a> alias</p>
</dd><dt>:all 
<dd>
<p>Set to true to use EXCEPT ALL instead of EXCEPT, so duplicate rows can occur</p>
</dd><dt>:from_self 
<dd>
<p>Set to false to not wrap the returned dataset in a <a href="Dataset.html#method-i-from_self"><code>from_self</code></a>, use with care.</p>
</dd></dl>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">except</span>(<span class="ruby-constant">DB</span>[<span class="ruby-value">:other_items</span>])
<span class="ruby-comment"># SELECT * FROM (SELECT * FROM items EXCEPT SELECT * FROM other_items) AS t1</span>

<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">except</span>(<span class="ruby-constant">DB</span>[<span class="ruby-value">:other_items</span>], <span class="ruby-value">all:</span> <span class="ruby-keyword">true</span>, <span class="ruby-value">from_self:</span> <span class="ruby-keyword">false</span>)
<span class="ruby-comment"># SELECT * FROM items EXCEPT ALL SELECT * FROM other_items</span>

<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">except</span>(<span class="ruby-constant">DB</span>[<span class="ruby-value">:other_items</span>], <span class="ruby-value">alias:</span> <span class="ruby-value">:i</span>)
<span class="ruby-comment"># SELECT * FROM (SELECT * FROM items EXCEPT SELECT * FROM other_items) AS i</span>
</pre>
          
          

          
          <div class="method-source-code" id="except-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">150</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">except</span>(<span class="ruby-identifier">dataset</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)
<span class="line-num">151</span>   <span class="ruby-identifier">raise</span>(<span class="ruby-constant">InvalidOperation</span>, <span class="ruby-string">&quot;EXCEPT not supported&quot;</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">supports_intersect_except?</span>
<span class="line-num">152</span>   <span class="ruby-identifier">raise</span>(<span class="ruby-constant">InvalidOperation</span>, <span class="ruby-string">&quot;EXCEPT ALL not supported&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:all</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">supports_intersect_except_all?</span>
<span class="line-num">153</span>   <span class="ruby-identifier">compound_clone</span>(<span class="ruby-value">:except</span>, <span class="ruby-identifier">dataset</span>, <span class="ruby-identifier">opts</span>)
<span class="line-num">154</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-exclude" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">exclude</span><span
            class="method-args">(*cond, &amp;block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Performs the inverse of <a href="Dataset.html#method-i-where"><code>Dataset#where</code></a>.  Note that if you have multiple filter conditions, this is not the same as a negation of all conditions.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">exclude</span>(<span class="ruby-value">category:</span> <span class="ruby-string">&#39;software&#39;</span>)
<span class="ruby-comment"># SELECT * FROM items WHERE (category != &#39;software&#39;)</span>

<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">exclude</span>(<span class="ruby-value">category:</span> <span class="ruby-string">&#39;software&#39;</span>, <span class="ruby-value">id:</span> <span class="ruby-value">3</span>)
<span class="ruby-comment"># SELECT * FROM items WHERE ((category != &#39;software&#39;) OR (id != 3))</span>
</pre>

<p>Also note that <a href="SQL.html"><code>SQL</code></a> uses 3-valued boolean logic (<code>true</code>, <code>false</code>, <code>NULL</code>), so the inverse of a true condition is a false condition, and will still not match rows that were NULL originally.  If you take the earlier example:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">exclude</span>(<span class="ruby-value">category:</span> <span class="ruby-string">&#39;software&#39;</span>)
<span class="ruby-comment"># SELECT * FROM items WHERE (category != &#39;software&#39;)</span>
</pre>

<p>Note that this does not match rows where <code>category</code> is <code>NULL</code>.  This is because <code>NULL</code> is an unknown value, and you do not know whether or not the <code>NULL</code> category is <code>software</code>.  You can explicitly specify how to handle <code>NULL</code> values if you want:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">exclude</span>(<span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">~</span>(<span class="ruby-value">category:</span> <span class="ruby-keyword">nil</span>) <span class="ruby-operator">&amp;</span> {<span class="ruby-value">category:</span> <span class="ruby-string">&#39;software&#39;</span>})
<span class="ruby-comment"># SELECT * FROM items WHERE ((category IS NULL) OR (category != &#39;software&#39;))</span>
</pre>
          
          

          
          <div class="method-source-code" id="exclude-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">180</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">exclude</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">cond</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">181</span>   <span class="ruby-identifier">add_filter</span>(<span class="ruby-value">:where</span>, <span class="ruby-identifier">cond</span>, <span class="ruby-keyword">true</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">182</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-exclude_having" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">exclude_having</span><span
            class="method-args">(*cond, &amp;block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Inverts the given conditions and adds them to the HAVING clause.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">select_group</span>(<span class="ruby-value">:name</span>).<span class="ruby-identifier">exclude_having</span>{<span class="ruby-identifier">count</span>(<span class="ruby-identifier">name</span>) <span class="ruby-operator">&lt;</span> <span class="ruby-value">2</span>}
<span class="ruby-comment"># SELECT name FROM items GROUP BY name HAVING (count(name) &gt;= 2)</span>
</pre>

<p>See documentation for exclude for how inversion is handled in regards to <a href="SQL.html"><code>SQL</code></a> 3-valued boolean logic.</p>
          
          

          
          <div class="method-source-code" id="exclude_having-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">191</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">exclude_having</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">cond</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">192</span>   <span class="ruby-identifier">add_filter</span>(<span class="ruby-value">:having</span>, <span class="ruby-identifier">cond</span>, <span class="ruby-keyword">true</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">193</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-extension" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">extension</span><span
            class="method-args">(*a)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Return a clone of the dataset loaded with the given dataset extensions. If no related extension file exists or the extension does not have specific support for <a href="Dataset.html"><code>Dataset</code></a> objects, an <a href="Error.html"><code>Error</code></a> will be raised.</p>
          
          

          
          <div class="method-source-code" id="extension-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">199</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">extension</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">a</span>)
<span class="line-num">200</span>   <span class="ruby-identifier">c</span> = <span class="ruby-identifier">_clone</span>(<span class="ruby-value">:freeze</span><span class="ruby-operator">=&gt;</span><span class="ruby-keyword">false</span>)
<span class="line-num">201</span>   <span class="ruby-identifier">c</span>.<span class="ruby-identifier">send</span>(<span class="ruby-value">:_extension!</span>, <span class="ruby-identifier">a</span>)
<span class="line-num">202</span>   <span class="ruby-identifier">c</span>.<span class="ruby-identifier">freeze</span>
<span class="line-num">203</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-filter" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">filter</span><span
            class="method-args">(*cond, &amp;block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Alias for where.</p>
          
          

          
          <div class="method-source-code" id="filter-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">215</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">filter</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">cond</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">216</span>   <span class="ruby-identifier">where</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">cond</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">217</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-for_update" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">for_update</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns a cloned dataset with a :update lock style.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">for_update</span> <span class="ruby-comment"># SELECT * FROM table FOR UPDATE</span>
</pre>
          
          

          
          <div class="method-source-code" id="for_update-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">222</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">for_update</span>
<span class="line-num">223</span>   <span class="ruby-identifier">cached_dataset</span>(<span class="ruby-value">:_for_update_ds</span>){<span class="ruby-identifier">lock_style</span>(<span class="ruby-value">:update</span>)}
<span class="line-num">224</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-from" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">from</span><span
            class="method-args">(*source, &amp;block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns a copy of the dataset with the source changed. If no source is given, removes all tables.  If multiple sources are given, it is the same as using a CROSS JOIN (cartesian product) between all tables. If a block is given, it is treated as a virtual row block, similar to <code>where</code>.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">from</span> <span class="ruby-comment"># SQL: SELECT *</span>
<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">from</span>(<span class="ruby-value">:blah</span>) <span class="ruby-comment"># SQL: SELECT * FROM blah</span>
<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">from</span>(<span class="ruby-value">:blah</span>, <span class="ruby-value">:foo</span>) <span class="ruby-comment"># SQL: SELECT * FROM blah, foo</span>
<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">from</span>{<span class="ruby-identifier">fun</span>(<span class="ruby-identifier">arg</span>)} <span class="ruby-comment"># SQL: SELECT * FROM fun(arg)</span>
</pre>
          
          

          
          <div class="method-source-code" id="from-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">235</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">from</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">source</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">236</span>   <span class="ruby-identifier">virtual_row_columns</span>(<span class="ruby-identifier">source</span>, <span class="ruby-identifier">block</span>)
<span class="line-num">237</span>   <span class="ruby-identifier">table_alias_num</span> = <span class="ruby-value">0</span>
<span class="line-num">238</span>   <span class="ruby-identifier">ctes</span> = <span class="ruby-keyword">nil</span>
<span class="line-num">239</span>   <span class="ruby-identifier">source</span>.<span class="ruby-identifier">map!</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
<span class="line-num">240</span>     <span class="ruby-keyword">case</span> <span class="ruby-identifier">s</span>
<span class="line-num">241</span>     <span class="ruby-keyword">when</span> <span class="ruby-constant">Dataset</span>
<span class="line-num">242</span>       <span class="ruby-keyword">if</span> <span class="ruby-identifier">hoist_cte?</span>(<span class="ruby-identifier">s</span>)
<span class="line-num">243</span>         <span class="ruby-identifier">ctes</span> <span class="ruby-operator">||=</span> []
<span class="line-num">244</span>         <span class="ruby-identifier">ctes</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">opts</span>[<span class="ruby-value">:with</span>]
<span class="line-num">245</span>         <span class="ruby-identifier">s</span> = <span class="ruby-identifier">s</span>.<span class="ruby-identifier">clone</span>(<span class="ruby-value">:with</span><span class="ruby-operator">=&gt;</span><span class="ruby-keyword">nil</span>)
<span class="line-num">246</span>       <span class="ruby-keyword">end</span>
<span class="line-num">247</span>       <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">AliasedExpression</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">s</span>, <span class="ruby-identifier">dataset_alias</span>(<span class="ruby-identifier">table_alias_num</span><span class="ruby-operator">+=</span><span class="ruby-value">1</span>))
<span class="line-num">248</span>     <span class="ruby-keyword">when</span> <span class="ruby-constant">Symbol</span>
<span class="line-num">249</span>       <span class="ruby-identifier">sch</span>, <span class="ruby-identifier">table</span>, <span class="ruby-identifier">aliaz</span> = <span class="ruby-identifier">split_symbol</span>(<span class="ruby-identifier">s</span>)
<span class="line-num">250</span>       <span class="ruby-keyword">if</span> <span class="ruby-identifier">aliaz</span>
<span class="line-num">251</span>         <span class="ruby-identifier">s</span> = <span class="ruby-identifier">sch</span> <span class="ruby-operator">?</span> <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">QualifiedIdentifier</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">sch</span>, <span class="ruby-identifier">table</span>) <span class="ruby-operator">:</span> <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">Identifier</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">table</span>)
<span class="line-num">252</span>         <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">AliasedExpression</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">s</span>, <span class="ruby-identifier">aliaz</span>.<span class="ruby-identifier">to_sym</span>)
<span class="line-num">253</span>       <span class="ruby-keyword">else</span>
<span class="line-num">254</span>         <span class="ruby-identifier">s</span>
<span class="line-num">255</span>       <span class="ruby-keyword">end</span>
<span class="line-num">256</span>     <span class="ruby-keyword">else</span>
<span class="line-num">257</span>       <span class="ruby-identifier">s</span>
<span class="line-num">258</span>     <span class="ruby-keyword">end</span>
<span class="line-num">259</span>   <span class="ruby-keyword">end</span>
<span class="line-num">260</span>   <span class="ruby-identifier">o</span> = {<span class="ruby-value">:from</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">source</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">?</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">source</span>.<span class="ruby-identifier">freeze</span>}
<span class="line-num">261</span>   <span class="ruby-identifier">o</span>[<span class="ruby-value">:with</span>] = ((<span class="ruby-identifier">opts</span>[<span class="ruby-value">:with</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">EMPTY_ARRAY</span>) <span class="ruby-operator">+</span> <span class="ruby-identifier">ctes</span>).<span class="ruby-identifier">freeze</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">ctes</span>
<span class="line-num">262</span>   <span class="ruby-identifier">o</span>[<span class="ruby-value">:num_dataset_sources</span>] = <span class="ruby-identifier">table_alias_num</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">table_alias_num</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
<span class="line-num">263</span>   <span class="ruby-identifier">clone</span>(<span class="ruby-identifier">o</span>)
<span class="line-num">264</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-from_self" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">from_self</span><span
            class="method-args">(opts=OPTS)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns a dataset selecting from the current dataset. Options:</p>
<dl class="rdoc-list note-list"><dt>:alias 
<dd>
<p>Controls the alias of the table</p>
</dd><dt>:column_aliases 
<dd>
<p>Also aliases columns, using derived column lists. Only used in conjunction with :alias.</p>
</dd></dl>

<pre class="ruby"><span class="ruby-identifier">ds</span> = <span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">order</span>(<span class="ruby-value">:name</span>).<span class="ruby-identifier">select</span>(<span class="ruby-value">:id</span>, <span class="ruby-value">:name</span>)
<span class="ruby-comment"># SELECT id,name FROM items ORDER BY name</span>

<span class="ruby-identifier">ds</span>.<span class="ruby-identifier">from_self</span>
<span class="ruby-comment"># SELECT * FROM (SELECT id, name FROM items ORDER BY name) AS t1</span>

<span class="ruby-identifier">ds</span>.<span class="ruby-identifier">from_self</span>(<span class="ruby-value">alias:</span> <span class="ruby-value">:foo</span>)
<span class="ruby-comment"># SELECT * FROM (SELECT id, name FROM items ORDER BY name) AS foo</span>

<span class="ruby-identifier">ds</span>.<span class="ruby-identifier">from_self</span>(<span class="ruby-value">alias:</span> <span class="ruby-value">:foo</span>, <span class="ruby-value">column_aliases:</span> [<span class="ruby-value">:c1</span>, <span class="ruby-value">:c2</span>])
<span class="ruby-comment"># SELECT * FROM (SELECT id, name FROM items ORDER BY name) AS foo(c1, c2)</span>
</pre>
          
          

          
          <div class="method-source-code" id="from_self-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">283</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">from_self</span>(<span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)
<span class="line-num">284</span>   <span class="ruby-identifier">fs</span> = {}
<span class="line-num">285</span>   <span class="ruby-ivar">@opts</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">k</span><span class="ruby-operator">|</span> <span class="ruby-identifier">fs</span>[<span class="ruby-identifier">k</span>] = <span class="ruby-keyword">nil</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">non_sql_option?</span>(<span class="ruby-identifier">k</span>)}
<span class="line-num">286</span>   <span class="ruby-identifier">pr</span> = <span class="ruby-identifier">proc</span> <span class="ruby-keyword">do</span>
<span class="line-num">287</span>     <span class="ruby-identifier">c</span> = <span class="ruby-identifier">clone</span>(<span class="ruby-identifier">fs</span>).<span class="ruby-identifier">from</span>(<span class="ruby-identifier">opts</span>[<span class="ruby-value">:alias</span>] <span class="ruby-operator">?</span> <span class="ruby-identifier">as</span>(<span class="ruby-identifier">opts</span>[<span class="ruby-value">:alias</span>], <span class="ruby-identifier">opts</span>[<span class="ruby-value">:column_aliases</span>]) <span class="ruby-operator">:</span> <span class="ruby-keyword">self</span>)
<span class="line-num">288</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">cols</span> = <span class="ruby-identifier">_columns</span>
<span class="line-num">289</span>       <span class="ruby-identifier">c</span>.<span class="ruby-identifier">send</span>(<span class="ruby-value">:columns=</span>, <span class="ruby-identifier">cols</span>)
<span class="line-num">290</span>     <span class="ruby-keyword">end</span>
<span class="line-num">291</span>     <span class="ruby-identifier">c</span>
<span class="line-num">292</span>   <span class="ruby-keyword">end</span>
<span class="line-num">293</span> 
<span class="line-num">294</span>   <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">cached_dataset</span>(<span class="ruby-value">:_from_self_ds</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">pr</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">pr</span>.<span class="ruby-identifier">call</span>
<span class="line-num">295</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-grep" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">grep</span><span
            class="method-args">(columns, patterns, opts=OPTS)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Match any of the columns to any of the patterns. The terms can be strings (which use LIKE) or regular expressions if the database supports that. Note that the total number of pattern matches will be Array(columns).length * Array(terms).length, which could cause performance issues.</p>

<p>Options (all are boolean):</p>
<dl class="rdoc-list note-list"><dt>:all_columns 
<dd>
<p>All columns must be matched to any of the given patterns.</p>
</dd><dt>:all_patterns 
<dd>
<p>All patterns must match at least one of the columns.</p>
</dd><dt>:case_insensitive 
<dd>
<p>Use a case insensitive pattern match (the default is case sensitive if the database supports it).</p>
</dd></dl>

<p>If both :all_columns and :all_patterns are true, all columns must match all patterns.</p>

<p>Examples:</p>

<pre class="ruby"><span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">grep</span>(<span class="ruby-value">:a</span>, <span class="ruby-string">&#39;%test%&#39;</span>)
<span class="ruby-comment"># SELECT * FROM items WHERE (a LIKE &#39;%test%&#39; ESCAPE &#39;\&#39;)</span>

<span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">grep</span>([<span class="ruby-value">:a</span>, <span class="ruby-value">:b</span>], <span class="ruby-node">%w&#39;%test% foo&#39;</span>)
<span class="ruby-comment"># SELECT * FROM items WHERE ((a LIKE &#39;%test%&#39; ESCAPE &#39;\&#39;) OR (a LIKE &#39;foo&#39; ESCAPE &#39;\&#39;)</span>
<span class="ruby-comment">#   OR (b LIKE &#39;%test%&#39; ESCAPE &#39;\&#39;) OR (b LIKE &#39;foo&#39; ESCAPE &#39;\&#39;))</span>

<span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">grep</span>([<span class="ruby-value">:a</span>, <span class="ruby-value">:b</span>], <span class="ruby-node">%w&#39;%foo% %bar%&#39;</span>, <span class="ruby-value">all_patterns:</span> <span class="ruby-keyword">true</span>)
<span class="ruby-comment"># SELECT * FROM a WHERE (((a LIKE &#39;%foo%&#39; ESCAPE &#39;\&#39;) OR (b LIKE &#39;%foo%&#39; ESCAPE &#39;\&#39;))</span>
<span class="ruby-comment">#   AND ((a LIKE &#39;%bar%&#39; ESCAPE &#39;\&#39;) OR (b LIKE &#39;%bar%&#39; ESCAPE &#39;\&#39;)))</span>

<span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">grep</span>([<span class="ruby-value">:a</span>, <span class="ruby-value">:b</span>], <span class="ruby-node">%w&#39;%foo% %bar%&#39;</span>, <span class="ruby-value">all_columns:</span> <span class="ruby-keyword">true</span>)
<span class="ruby-comment"># SELECT * FROM a WHERE (((a LIKE &#39;%foo%&#39; ESCAPE &#39;\&#39;) OR (a LIKE &#39;%bar%&#39; ESCAPE &#39;\&#39;))</span>
<span class="ruby-comment">#   AND ((b LIKE &#39;%foo%&#39; ESCAPE &#39;\&#39;) OR (b LIKE &#39;%bar%&#39; ESCAPE &#39;\&#39;)))</span>

<span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">grep</span>([<span class="ruby-value">:a</span>, <span class="ruby-value">:b</span>], <span class="ruby-node">%w&#39;%foo% %bar%&#39;</span>, <span class="ruby-value">all_patterns:</span> <span class="ruby-keyword">true</span>, <span class="ruby-value">all_columns:</span> <span class="ruby-keyword">true</span>)
<span class="ruby-comment"># SELECT * FROM a WHERE ((a LIKE &#39;%foo%&#39; ESCAPE &#39;\&#39;) AND (b LIKE &#39;%foo%&#39; ESCAPE &#39;\&#39;)</span>
<span class="ruby-comment">#   AND (a LIKE &#39;%bar%&#39; ESCAPE &#39;\&#39;) AND (b LIKE &#39;%bar%&#39; ESCAPE &#39;\&#39;))</span>
</pre>
          
          

          
          <div class="method-source-code" id="grep-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">332</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">grep</span>(<span class="ruby-identifier">columns</span>, <span class="ruby-identifier">patterns</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)
<span class="line-num">333</span>   <span class="ruby-identifier">column_op</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:all_columns</span>] <span class="ruby-operator">?</span> <span class="ruby-value">:AND</span> <span class="ruby-operator">:</span> <span class="ruby-value">:OR</span>
<span class="line-num">334</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:all_patterns</span>]
<span class="line-num">335</span>     <span class="ruby-identifier">conds</span> = <span class="ruby-constant">Array</span>(<span class="ruby-identifier">patterns</span>).<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">pat</span><span class="ruby-operator">|</span>
<span class="line-num">336</span>       <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">BooleanExpression</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">column_op</span>, <span class="ruby-operator">*</span><span class="ruby-constant">Array</span>(<span class="ruby-identifier">columns</span>).<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">StringExpression</span>.<span class="ruby-identifier">like</span>(<span class="ruby-identifier">c</span>, <span class="ruby-identifier">pat</span>, <span class="ruby-identifier">opts</span>)})
<span class="line-num">337</span>     <span class="ruby-keyword">end</span>
<span class="line-num">338</span>     <span class="ruby-identifier">where</span>(<span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">BooleanExpression</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:AND</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">conds</span>))
<span class="line-num">339</span>   <span class="ruby-keyword">else</span>
<span class="line-num">340</span>     <span class="ruby-identifier">conds</span> = <span class="ruby-constant">Array</span>(<span class="ruby-identifier">columns</span>).<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
<span class="line-num">341</span>       <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">BooleanExpression</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:OR</span>, <span class="ruby-operator">*</span><span class="ruby-constant">Array</span>(<span class="ruby-identifier">patterns</span>).<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">pat</span><span class="ruby-operator">|</span> <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">StringExpression</span>.<span class="ruby-identifier">like</span>(<span class="ruby-identifier">c</span>, <span class="ruby-identifier">pat</span>, <span class="ruby-identifier">opts</span>)})
<span class="line-num">342</span>     <span class="ruby-keyword">end</span>
<span class="line-num">343</span>     <span class="ruby-identifier">where</span>(<span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">BooleanExpression</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">column_op</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">conds</span>))
<span class="line-num">344</span>   <span class="ruby-keyword">end</span>
<span class="line-num">345</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-group" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">group</span><span
            class="method-args">(*columns, &amp;block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns a copy of the dataset with the results grouped by the value of  the given columns.  If a block is given, it is treated as a virtual row block, similar to <code>where</code>.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">group</span>(<span class="ruby-value">:id</span>) <span class="ruby-comment"># SELECT * FROM items GROUP BY id</span>
<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">group</span>(<span class="ruby-value">:id</span>, <span class="ruby-value">:name</span>) <span class="ruby-comment"># SELECT * FROM items GROUP BY id, name</span>
<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">group</span>{[<span class="ruby-identifier">a</span>, <span class="ruby-identifier">sum</span>(<span class="ruby-identifier">b</span>)]} <span class="ruby-comment"># SELECT * FROM items GROUP BY a, sum(b)</span>
</pre>
          
          

          
          <div class="method-source-code" id="group-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">354</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">group</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">columns</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">355</span>   <span class="ruby-identifier">virtual_row_columns</span>(<span class="ruby-identifier">columns</span>, <span class="ruby-identifier">block</span>)
<span class="line-num">356</span>   <span class="ruby-identifier">clone</span>(<span class="ruby-value">:group</span> <span class="ruby-operator">=&gt;</span> (<span class="ruby-identifier">columns</span>.<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">?</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">columns</span>.<span class="ruby-identifier">freeze</span>))
<span class="line-num">357</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-group_and_count" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">group_and_count</span><span
            class="method-args">(*columns, &amp;block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns a dataset grouped by the given column with count by group. Column aliases may be supplied, and will be included in the select clause. If a block is given, it is treated as a virtual row block, similar to <code>where</code>.</p>

<p>Examples:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">group_and_count</span>(<span class="ruby-value">:name</span>).<span class="ruby-identifier">all</span>
<span class="ruby-comment"># SELECT name, count(*) AS count FROM items GROUP BY name</span>
<span class="ruby-comment"># =&gt; [{:name=&gt;&#39;a&#39;, :count=&gt;1}, ...]</span>

<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">group_and_count</span>(<span class="ruby-value">:first_name</span>, <span class="ruby-value">:last_name</span>).<span class="ruby-identifier">all</span>
<span class="ruby-comment"># SELECT first_name, last_name, count(*) AS count FROM items GROUP BY first_name, last_name</span>
<span class="ruby-comment"># =&gt; [{:first_name=&gt;&#39;a&#39;, :last_name=&gt;&#39;b&#39;, :count=&gt;1}, ...]</span>

<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">group_and_count</span>(<span class="ruby-constant">Sequel</span>[<span class="ruby-value">:first_name</span>].<span class="ruby-identifier">as</span>(<span class="ruby-value">:name</span>)).<span class="ruby-identifier">all</span>
<span class="ruby-comment"># SELECT first_name AS name, count(*) AS count FROM items GROUP BY first_name</span>
<span class="ruby-comment"># =&gt; [{:name=&gt;&#39;a&#39;, :count=&gt;1}, ...]</span>

<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">group_and_count</span>{<span class="ruby-identifier">substr</span>(<span class="ruby-value">:first_name</span>, <span class="ruby-value">1</span>, <span class="ruby-value">1</span>).<span class="ruby-identifier">as</span>(<span class="ruby-value">:initial</span>)}.<span class="ruby-identifier">all</span>
<span class="ruby-comment"># SELECT substr(first_name, 1, 1) AS initial, count(*) AS count FROM items GROUP BY substr(first_name, 1, 1)</span>
<span class="ruby-comment"># =&gt; [{:initial=&gt;&#39;a&#39;, :count=&gt;1}, ...]</span>
</pre>
          
          

          
          <div class="method-source-code" id="group_and_count-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">385</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">group_and_count</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">columns</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">386</span>   <span class="ruby-identifier">select_group</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">columns</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>).<span class="ruby-identifier">select_append</span>(<span class="ruby-constant">COUNT_OF_ALL_AS_COUNT</span>)
<span class="line-num">387</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-group_append" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">group_append</span><span
            class="method-args">(*columns, &amp;block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns a copy of the dataset with the given columns added to the list of existing columns to group on. If no existing columns are present this method simply sets the columns as the initial ones to group on.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">group_append</span>(<span class="ruby-value">:b</span>) <span class="ruby-comment"># SELECT * FROM items GROUP BY b</span>
<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">group</span>(<span class="ruby-value">:a</span>).<span class="ruby-identifier">group_append</span>(<span class="ruby-value">:b</span>) <span class="ruby-comment"># SELECT * FROM items GROUP BY a, b</span>
</pre>
          
          

          
          <div class="method-source-code" id="group_append-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">395</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">group_append</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">columns</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">396</span>   <span class="ruby-identifier">columns</span> = <span class="ruby-ivar">@opts</span>[<span class="ruby-value">:group</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">columns</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@opts</span>[<span class="ruby-value">:group</span>]
<span class="line-num">397</span>   <span class="ruby-identifier">group</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">columns</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">398</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-group_by" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">group_by</span><span
            class="method-args">(*columns, &amp;block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Alias of group</p>
          
          

          
          <div class="method-source-code" id="group_by-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">360</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">group_by</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">columns</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">361</span>   <span class="ruby-identifier">group</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">columns</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">362</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-group_cube" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">group_cube</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Adds the appropriate CUBE syntax to GROUP BY.</p>
          
          

          
          <div class="method-source-code" id="group_cube-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">401</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">group_cube</span>
<span class="line-num">402</span>   <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-node">&quot;GROUP BY CUBE not supported on #{db.database_type}&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">supports_group_cube?</span>
<span class="line-num">403</span>   <span class="ruby-identifier">clone</span>(<span class="ruby-value">:group_options</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">:cube</span>)
<span class="line-num">404</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-group_rollup" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">group_rollup</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Adds the appropriate ROLLUP syntax to GROUP BY.</p>
          
          

          
          <div class="method-source-code" id="group_rollup-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">407</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">group_rollup</span>
<span class="line-num">408</span>   <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-node">&quot;GROUP BY ROLLUP not supported on #{db.database_type}&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">supports_group_rollup?</span>
<span class="line-num">409</span>   <span class="ruby-identifier">clone</span>(<span class="ruby-value">:group_options</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">:rollup</span>)
<span class="line-num">410</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-grouping_sets" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">grouping_sets</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Adds the appropriate GROUPING SETS syntax to GROUP BY.</p>
          
          

          
          <div class="method-source-code" id="grouping_sets-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">413</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">grouping_sets</span>
<span class="line-num">414</span>   <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-node">&quot;GROUP BY GROUPING SETS not supported on #{db.database_type}&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">supports_grouping_sets?</span>
<span class="line-num">415</span>   <span class="ruby-identifier">clone</span>(<span class="ruby-value">:group_options</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">:&quot;grouping sets&quot;</span>)
<span class="line-num">416</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-having" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">having</span><span
            class="method-args">(*cond, &amp;block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns a copy of the dataset with the HAVING conditions changed. See <a href="Dataset.html#method-i-where"><code>where</code></a> for argument types.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">group</span>(<span class="ruby-value">:sum</span>).<span class="ruby-identifier">having</span>(<span class="ruby-value">sum:</span> <span class="ruby-value">10</span>)
<span class="ruby-comment"># SELECT * FROM items GROUP BY sum HAVING (sum = 10)</span>
</pre>
          
          

          
          <div class="method-source-code" id="having-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">422</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">having</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">cond</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">423</span>   <span class="ruby-identifier">add_filter</span>(<span class="ruby-value">:having</span>, <span class="ruby-identifier">cond</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">424</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-intersect" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">intersect</span><span
            class="method-args">(dataset, opts=OPTS)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Adds an INTERSECT clause using a second dataset object. An INTERSECT compound dataset returns all rows in both the current dataset and the given dataset. Raises an <code>InvalidOperation</code> if the operation is not supported. Options:</p>
<dl class="rdoc-list note-list"><dt>:alias 
<dd>
<p>Use the given value as the <a href="Dataset.html#method-i-from_self"><code>from_self</code></a> alias</p>
</dd><dt>:all 
<dd>
<p>Set to true to use INTERSECT ALL instead of INTERSECT, so duplicate rows can occur</p>
</dd><dt>:from_self 
<dd>
<p>Set to false to not wrap the returned dataset in a <a href="Dataset.html#method-i-from_self"><code>from_self</code></a>, use with care.</p>
</dd></dl>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">intersect</span>(<span class="ruby-constant">DB</span>[<span class="ruby-value">:other_items</span>])
<span class="ruby-comment"># SELECT * FROM (SELECT * FROM items INTERSECT SELECT * FROM other_items) AS t1</span>

<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">intersect</span>(<span class="ruby-constant">DB</span>[<span class="ruby-value">:other_items</span>], <span class="ruby-value">all:</span> <span class="ruby-keyword">true</span>, <span class="ruby-value">from_self:</span> <span class="ruby-keyword">false</span>)
<span class="ruby-comment"># SELECT * FROM items INTERSECT ALL SELECT * FROM other_items</span>

<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">intersect</span>(<span class="ruby-constant">DB</span>[<span class="ruby-value">:other_items</span>], <span class="ruby-value">alias:</span> <span class="ruby-value">:i</span>)
<span class="ruby-comment"># SELECT * FROM (SELECT * FROM items INTERSECT SELECT * FROM other_items) AS i</span>
</pre>
          
          

          
          <div class="method-source-code" id="intersect-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">443</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">intersect</span>(<span class="ruby-identifier">dataset</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)
<span class="line-num">444</span>   <span class="ruby-identifier">raise</span>(<span class="ruby-constant">InvalidOperation</span>, <span class="ruby-string">&quot;INTERSECT not supported&quot;</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">supports_intersect_except?</span>
<span class="line-num">445</span>   <span class="ruby-identifier">raise</span>(<span class="ruby-constant">InvalidOperation</span>, <span class="ruby-string">&quot;INTERSECT ALL not supported&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:all</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">supports_intersect_except_all?</span>
<span class="line-num">446</span>   <span class="ruby-identifier">compound_clone</span>(<span class="ruby-value">:intersect</span>, <span class="ruby-identifier">dataset</span>, <span class="ruby-identifier">opts</span>)
<span class="line-num">447</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-invert" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">invert</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Inverts the current WHERE and HAVING clauses.  If there is neither a WHERE or HAVING clause, adds a WHERE clause that is always false.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">where</span>(<span class="ruby-value">category:</span> <span class="ruby-string">&#39;software&#39;</span>).<span class="ruby-identifier">invert</span>
<span class="ruby-comment"># SELECT * FROM items WHERE (category != &#39;software&#39;)</span>

<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">where</span>(<span class="ruby-value">category:</span> <span class="ruby-string">&#39;software&#39;</span>, <span class="ruby-value">id:</span> <span class="ruby-value">3</span>).<span class="ruby-identifier">invert</span>
<span class="ruby-comment"># SELECT * FROM items WHERE ((category != &#39;software&#39;) OR (id != 3))</span>
</pre>

<p>See documentation for exclude for how inversion is handled in regards to <a href="SQL.html"><code>SQL</code></a> 3-valued boolean logic.</p>
          
          

          
          <div class="method-source-code" id="invert-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">460</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">invert</span>
<span class="line-num">461</span>   <span class="ruby-identifier">cached_dataset</span>(<span class="ruby-value">:_invert_ds</span>) <span class="ruby-keyword">do</span>
<span class="line-num">462</span>     <span class="ruby-identifier">having</span>, <span class="ruby-identifier">where</span> = <span class="ruby-ivar">@opts</span>.<span class="ruby-identifier">values_at</span>(<span class="ruby-value">:having</span>, <span class="ruby-value">:where</span>)
<span class="line-num">463</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">having</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">where</span>.<span class="ruby-identifier">nil?</span>
<span class="line-num">464</span>       <span class="ruby-identifier">where</span>(<span class="ruby-keyword">false</span>)
<span class="line-num">465</span>     <span class="ruby-keyword">else</span>
<span class="line-num">466</span>       <span class="ruby-identifier">o</span> = {}
<span class="line-num">467</span>       <span class="ruby-identifier">o</span>[<span class="ruby-value">:having</span>] = <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">BooleanExpression</span>.<span class="ruby-identifier">invert</span>(<span class="ruby-identifier">having</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">having</span>
<span class="line-num">468</span>       <span class="ruby-identifier">o</span>[<span class="ruby-value">:where</span>] = <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">BooleanExpression</span>.<span class="ruby-identifier">invert</span>(<span class="ruby-identifier">where</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">where</span>
<span class="line-num">469</span>       <span class="ruby-identifier">clone</span>(<span class="ruby-identifier">o</span>)
<span class="line-num">470</span>     <span class="ruby-keyword">end</span>
<span class="line-num">471</span>   <span class="ruby-keyword">end</span>
<span class="line-num">472</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-join" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">join</span><span
            class="method-args">(*args, &amp;block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Alias of <code>inner_join</code></p>
          
          

          
          <div class="method-source-code" id="join-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">475</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">join</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">476</span>   <span class="ruby-identifier">inner_join</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">477</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-join_table" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">join_table</span><span
            class="method-args">(type, table, expr=nil, options=OPTS) { |table_name, last_alias, opts || EMPTY_ARRAY| ... }</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns a joined dataset.  Not usually called directly, users should use the appropriate join method (e.g. join, left_join, natural_join, cross_join) which fills in the <code>type</code> argument.</p>

<p>Takes the following arguments:</p>
<dl class="rdoc-list note-list"><dt>type 
<dd>
<p>The type of join to do (e.g. :inner)</p>
</dd><dt>table 
<dd>
<p>table to join into the current dataset.  Generally one of the following types:</p>
<dl class="rdoc-list note-list"><dt>String, Symbol 
<dd>
<p>identifier used as table or view name</p>
</dd><dt><a href="Dataset.html"><code>Dataset</code></a> 
<dd>
<p>a subselect is performed with an alias of tN for some value of N</p>
</dd><dt><a href="SQL/Function.html"><code>SQL::Function</code></a> 
<dd>
<p>set returning function</p>
</dd><dt><a href="SQL/AliasedExpression.html"><code>SQL::AliasedExpression</code></a> 
<dd>
<p>already aliased expression.  Uses given alias unless overridden by the :table_alias option.</p>
</dd></dl>
</dd><dt>expr 
<dd>
<p>conditions used when joining, depends on type:</p>
<dl class="rdoc-list note-list"><dt>Hash, Array of pairs 
<dd>
<p>Assumes key (1st arg) is column of joined table (unless already qualified), and value (2nd arg) is column of the last joined or primary table (or the :implicit_qualifier option). To specify multiple conditions on a single joined table column, you must use an array.  Uses a JOIN with an ON clause.</p>
</dd><dt>Array 
<dd>
<p>If all members of the array are symbols, considers them as columns and  uses a JOIN with a USING clause.  Most databases will remove duplicate columns from the result set if this is used.</p>
</dd><dt>nil 
<dd>
<p>If a block is not given, doesn&#39;t use ON or USING, so the JOIN should be a NATURAL or CROSS join. If a block is given, uses an ON clause based on the block, see below.</p>
</dd><dt>otherwise 
<dd>
<p>Treats the argument as a filter expression, so strings are considered literal, symbols specify boolean columns, and <a href="../Sequel.html"><code>Sequel</code></a> expressions can be used. Uses a JOIN with an ON clause.</p>
</dd></dl>
</dd><dt>options 
<dd>
<p>a hash of options, with the following keys supported:</p>
<dl class="rdoc-list note-list"><dt>:table_alias 
<dd>
<p>Override the table alias used when joining.  In general you shouldn&#39;t use this option, you should provide the appropriate <a href="SQL/AliasedExpression.html"><code>SQL::AliasedExpression</code></a> as the table argument.</p>
</dd><dt>:implicit_qualifier 
<dd>
<p>The name to use for qualifying implicit conditions.  By default, the last joined or primary table is used.</p>
</dd><dt>:join_using 
<dd>
<p>Force the using of JOIN USING, even if <code>expr</code> is not an array of symbols.</p>
</dd><dt>:reset_implicit_qualifier 
<dd>
<p>Can set to false to ignore this join when future joins determine qualifier for implicit conditions.</p>
</dd><dt>:qualify 
<dd>
<p>Can be set to false to not do any implicit qualification.  Can be set to :deep to use the <a href="Qualifier.html"><code>Qualifier</code></a> AST Transformer, which will attempt to qualify subexpressions of the expression tree.  Can be set to :symbol to only qualify symbols. Defaults to the value of default_join_table_qualification.</p>
</dd></dl>
</dd><dt>block 
<dd>
<p>The block argument should only be given if a JOIN with an ON clause is used, in which case it yields the table alias/name for the table currently being joined, the table alias/name for the last joined (or first table), and an array of previous <a href="SQL/JoinClause.html"><code>SQL::JoinClause</code></a>. Unlike <code>where</code>, this block is not treated as a virtual row block.</p>
</dd></dl>

<p>Examples:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:a</span>].<span class="ruby-identifier">join_table</span>(<span class="ruby-value">:cross</span>, <span class="ruby-value">:b</span>)
<span class="ruby-comment"># SELECT * FROM a CROSS JOIN b</span>

<span class="ruby-constant">DB</span>[<span class="ruby-value">:a</span>].<span class="ruby-identifier">join_table</span>(<span class="ruby-value">:inner</span>, <span class="ruby-constant">DB</span>[<span class="ruby-value">:b</span>], <span class="ruby-value">c:</span> <span class="ruby-identifier">d</span>)
<span class="ruby-comment"># SELECT * FROM a INNER JOIN (SELECT * FROM b) AS t1 ON (t1.c = a.d)</span>

<span class="ruby-constant">DB</span>[<span class="ruby-value">:a</span>].<span class="ruby-identifier">join_table</span>(<span class="ruby-value">:left</span>, <span class="ruby-constant">Sequel</span>[<span class="ruby-value">:b</span>].<span class="ruby-identifier">as</span>(<span class="ruby-value">:c</span>), [<span class="ruby-value">:d</span>])
<span class="ruby-comment"># SELECT * FROM a LEFT JOIN b AS c USING (d)</span>

<span class="ruby-constant">DB</span>[<span class="ruby-value">:a</span>].<span class="ruby-identifier">natural_join</span>(<span class="ruby-value">:b</span>).<span class="ruby-identifier">join_table</span>(<span class="ruby-value">:inner</span>, <span class="ruby-value">:c</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">ta</span>, <span class="ruby-identifier">jta</span>, <span class="ruby-identifier">js</span><span class="ruby-operator">|</span>
  (<span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">qualify</span>(<span class="ruby-identifier">ta</span>, <span class="ruby-value">:d</span>) <span class="ruby-operator">&gt;</span> <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">qualify</span>(<span class="ruby-identifier">jta</span>, <span class="ruby-value">:e</span>)) <span class="ruby-operator">&amp;</span> {<span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">qualify</span>(<span class="ruby-identifier">ta</span>, <span class="ruby-value">:f</span>)<span class="ruby-operator">=&gt;</span><span class="ruby-constant">DB</span>.<span class="ruby-identifier">from</span>(<span class="ruby-identifier">js</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">table</span>).<span class="ruby-identifier">select</span>(<span class="ruby-value">:g</span>)}
<span class="ruby-keyword">end</span>
<span class="ruby-comment"># SELECT * FROM a NATURAL JOIN b INNER JOIN c</span>
<span class="ruby-comment">#   ON ((c.d &gt; b.e) AND (c.f IN (SELECT g FROM b)))</span>
</pre>
          
          

          
          <div class="method-source-code" id="join_table-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">539</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">join_table</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">table</span>, <span class="ruby-identifier">expr</span>=<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">options</span>=<span class="ruby-constant">OPTS</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">540</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">hoist_cte?</span>(<span class="ruby-identifier">table</span>)
<span class="line-num">541</span>     <span class="ruby-identifier">s</span>, <span class="ruby-identifier">ds</span> = <span class="ruby-identifier">hoist_cte</span>(<span class="ruby-identifier">table</span>)
<span class="line-num">542</span>     <span class="ruby-keyword">return</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">join_table</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">ds</span>, <span class="ruby-identifier">expr</span>, <span class="ruby-identifier">options</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">543</span>   <span class="ruby-keyword">end</span>
<span class="line-num">544</span> 
<span class="line-num">545</span>   <span class="ruby-identifier">using_join</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:join_using</span>] <span class="ruby-operator">||</span> (<span class="ruby-identifier">expr</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">expr</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">expr</span>.<span class="ruby-identifier">all?</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Symbol</span>)})
<span class="line-num">546</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">using_join</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">supports_join_using?</span>
<span class="line-num">547</span>     <span class="ruby-identifier">h</span> = {}
<span class="line-num">548</span>     <span class="ruby-identifier">expr</span>.<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">e</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">e</span>] = <span class="ruby-identifier">e</span>}
<span class="line-num">549</span>     <span class="ruby-keyword">return</span> <span class="ruby-identifier">join_table</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">table</span>, <span class="ruby-identifier">h</span>, <span class="ruby-identifier">options</span>)
<span class="line-num">550</span>   <span class="ruby-keyword">end</span>
<span class="line-num">551</span> 
<span class="line-num">552</span>   <span class="ruby-identifier">table_alias</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:table_alias</span>]
<span class="line-num">553</span> 
<span class="line-num">554</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">table</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">AliasedExpression</span>)
<span class="line-num">555</span>     <span class="ruby-identifier">table_expr</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">table_alias</span>
<span class="line-num">556</span>       <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">AliasedExpression</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">table</span>.<span class="ruby-identifier">expression</span>, <span class="ruby-identifier">table_alias</span>, <span class="ruby-identifier">table</span>.<span class="ruby-identifier">columns</span>)
<span class="line-num">557</span>     <span class="ruby-keyword">else</span>
<span class="line-num">558</span>       <span class="ruby-identifier">table</span>
<span class="line-num">559</span>     <span class="ruby-keyword">end</span>
<span class="line-num">560</span>     <span class="ruby-identifier">table</span> = <span class="ruby-identifier">table_expr</span>.<span class="ruby-identifier">expression</span>
<span class="line-num">561</span>     <span class="ruby-identifier">table_name</span> = <span class="ruby-identifier">table_alias</span> = <span class="ruby-identifier">table_expr</span>.<span class="ruby-identifier">alias</span>
<span class="line-num">562</span>   <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">table</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Dataset</span>)
<span class="line-num">563</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">table_alias</span>.<span class="ruby-identifier">nil?</span>
<span class="line-num">564</span>       <span class="ruby-identifier">table_alias_num</span> = (<span class="ruby-ivar">@opts</span>[<span class="ruby-value">:num_dataset_sources</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>) <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
<span class="line-num">565</span>       <span class="ruby-identifier">table_alias</span> = <span class="ruby-identifier">dataset_alias</span>(<span class="ruby-identifier">table_alias_num</span>)
<span class="line-num">566</span>     <span class="ruby-keyword">end</span>
<span class="line-num">567</span>     <span class="ruby-identifier">table_name</span> = <span class="ruby-identifier">table_alias</span>
<span class="line-num">568</span>     <span class="ruby-identifier">table_expr</span> = <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">AliasedExpression</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">table</span>, <span class="ruby-identifier">table_alias</span>)
<span class="line-num">569</span>   <span class="ruby-keyword">else</span>
<span class="line-num">570</span>     <span class="ruby-identifier">table</span>, <span class="ruby-identifier">implicit_table_alias</span> = <span class="ruby-identifier">split_alias</span>(<span class="ruby-identifier">table</span>)
<span class="line-num">571</span>     <span class="ruby-identifier">table_alias</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">implicit_table_alias</span>
<span class="line-num">572</span>     <span class="ruby-identifier">table_name</span> = <span class="ruby-identifier">table_alias</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">table</span>
<span class="line-num">573</span>     <span class="ruby-identifier">table_expr</span> = <span class="ruby-identifier">table_alias</span> <span class="ruby-operator">?</span> <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">AliasedExpression</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">table</span>, <span class="ruby-identifier">table_alias</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">table</span>
<span class="line-num">574</span>   <span class="ruby-keyword">end</span>
<span class="line-num">575</span> 
<span class="line-num">576</span>   <span class="ruby-identifier">join</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">expr</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword">and</span> <span class="ruby-operator">!</span><span class="ruby-identifier">block</span>
<span class="line-num">577</span>     <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">JoinClause</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">table_expr</span>)
<span class="line-num">578</span>   <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">using_join</span>
<span class="line-num">579</span>     <span class="ruby-identifier">raise</span>(<span class="ruby-constant">Sequel</span><span class="ruby-operator">::</span><span class="ruby-constant">Error</span>, <span class="ruby-string">&quot;can&#39;t use a block if providing an array of symbols as expr&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">block</span>
<span class="line-num">580</span>     <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">JoinUsingClause</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">expr</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">table_expr</span>)
<span class="line-num">581</span>   <span class="ruby-keyword">else</span>
<span class="line-num">582</span>     <span class="ruby-identifier">last_alias</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:implicit_qualifier</span>] <span class="ruby-operator">||</span> <span class="ruby-ivar">@opts</span>[<span class="ruby-value">:last_joined_table</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">first_source_alias</span>
<span class="line-num">583</span>     <span class="ruby-identifier">qualify_type</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:qualify</span>]
<span class="line-num">584</span>     <span class="ruby-keyword">if</span> <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">condition_specifier?</span>(<span class="ruby-identifier">expr</span>)
<span class="line-num">585</span>       <span class="ruby-identifier">expr</span> = <span class="ruby-identifier">expr</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
<span class="line-num">586</span>         <span class="ruby-identifier">qualify_type</span> = <span class="ruby-identifier">default_join_table_qualification</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">qualify_type</span>.<span class="ruby-identifier">nil?</span>
<span class="line-num">587</span>         <span class="ruby-keyword">case</span> <span class="ruby-identifier">qualify_type</span>
<span class="line-num">588</span>         <span class="ruby-keyword">when</span> <span class="ruby-keyword">false</span>
<span class="line-num">589</span>           <span class="ruby-keyword">nil</span> <span class="ruby-comment"># Do no qualification</span>
<span class="line-num">590</span>         <span class="ruby-keyword">when</span> <span class="ruby-value">:deep</span>
<span class="line-num">591</span>           <span class="ruby-identifier">k</span> = <span class="ruby-constant">Sequel</span><span class="ruby-operator">::</span><span class="ruby-constant">Qualifier</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">table_name</span>).<span class="ruby-identifier">transform</span>(<span class="ruby-identifier">k</span>)
<span class="line-num">592</span>           <span class="ruby-identifier">v</span> = <span class="ruby-constant">Sequel</span><span class="ruby-operator">::</span><span class="ruby-constant">Qualifier</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">last_alias</span>).<span class="ruby-identifier">transform</span>(<span class="ruby-identifier">v</span>)
<span class="line-num">593</span>         <span class="ruby-keyword">else</span>
<span class="line-num">594</span>           <span class="ruby-identifier">k</span> = <span class="ruby-identifier">qualified_column_name</span>(<span class="ruby-identifier">k</span>, <span class="ruby-identifier">table_name</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">k</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Symbol</span>)
<span class="line-num">595</span>           <span class="ruby-identifier">v</span> = <span class="ruby-identifier">qualified_column_name</span>(<span class="ruby-identifier">v</span>, <span class="ruby-identifier">last_alias</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Symbol</span>)
<span class="line-num">596</span>         <span class="ruby-keyword">end</span>
<span class="line-num">597</span>         [<span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span>]
<span class="line-num">598</span>       <span class="ruby-keyword">end</span>
<span class="line-num">599</span>       <span class="ruby-identifier">expr</span> = <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">BooleanExpression</span>.<span class="ruby-identifier">from_value_pairs</span>(<span class="ruby-identifier">expr</span>)
<span class="line-num">600</span>     <span class="ruby-keyword">end</span>
<span class="line-num">601</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">block</span>
<span class="line-num">602</span>       <span class="ruby-identifier">expr2</span> = <span class="ruby-keyword">yield</span>(<span class="ruby-identifier">table_name</span>, <span class="ruby-identifier">last_alias</span>, <span class="ruby-ivar">@opts</span>[<span class="ruby-value">:join</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">EMPTY_ARRAY</span>)
<span class="line-num">603</span>       <span class="ruby-identifier">expr</span> = <span class="ruby-identifier">expr</span> <span class="ruby-operator">?</span> <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">BooleanExpression</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:AND</span>, <span class="ruby-identifier">expr</span>, <span class="ruby-identifier">expr2</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">expr2</span>
<span class="line-num">604</span>     <span class="ruby-keyword">end</span>
<span class="line-num">605</span>     <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">JoinOnClause</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">expr</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">table_expr</span>)
<span class="line-num">606</span>   <span class="ruby-keyword">end</span>
<span class="line-num">607</span> 
<span class="line-num">608</span>   <span class="ruby-identifier">opts</span> = {<span class="ruby-value">:join</span> <span class="ruby-operator">=&gt;</span> ((<span class="ruby-ivar">@opts</span>[<span class="ruby-value">:join</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">EMPTY_ARRAY</span>) <span class="ruby-operator">+</span> [<span class="ruby-identifier">join</span>]).<span class="ruby-identifier">freeze</span>}
<span class="line-num">609</span>   <span class="ruby-identifier">opts</span>[<span class="ruby-value">:last_joined_table</span>] = <span class="ruby-identifier">table_name</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:reset_implicit_qualifier</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword">false</span>
<span class="line-num">610</span>   <span class="ruby-identifier">opts</span>[<span class="ruby-value">:num_dataset_sources</span>] = <span class="ruby-identifier">table_alias_num</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">table_alias_num</span>
<span class="line-num">611</span>   <span class="ruby-identifier">clone</span>(<span class="ruby-identifier">opts</span>)
<span class="line-num">612</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-lateral" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">lateral</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Marks this dataset as a lateral dataset.  If used in another dataset&#39;s FROM or JOIN clauses, it will surround the subquery with LATERAL to enable it to deal with previous tables in the query:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>.<span class="ruby-identifier">from</span>(<span class="ruby-value">:a</span>, <span class="ruby-constant">DB</span>[<span class="ruby-value">:b</span>].<span class="ruby-identifier">where</span>(<span class="ruby-constant">Sequel</span>[<span class="ruby-value">:a</span>][<span class="ruby-value">:c</span>]<span class="ruby-operator">=&gt;</span><span class="ruby-constant">Sequel</span>[<span class="ruby-value">:b</span>][<span class="ruby-value">:d</span>]).<span class="ruby-identifier">lateral</span>)
<span class="ruby-comment"># SELECT * FROM a, LATERAL (SELECT * FROM b WHERE (a.c = b.d))</span>
</pre>
          
          

          
          <div class="method-source-code" id="lateral-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">633</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">lateral</span>
<span class="line-num">634</span>   <span class="ruby-identifier">cached_dataset</span>(<span class="ruby-value">:_lateral_ds</span>){<span class="ruby-identifier">clone</span>(<span class="ruby-value">:lateral</span><span class="ruby-operator">=&gt;</span><span class="ruby-keyword">true</span>)}
<span class="line-num">635</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-limit" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">limit</span><span
            class="method-args">(l, o = (no_offset = true; nil))</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>If given an integer, the dataset will contain only the first l results. If given a range, it will contain only those at offsets within that range. If a second argument is given, it is used as an offset. To use an offset without a limit, pass nil as the first argument.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">limit</span>(<span class="ruby-value">10</span>) <span class="ruby-comment"># SELECT * FROM items LIMIT 10</span>
<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">limit</span>(<span class="ruby-value">10</span>, <span class="ruby-value">20</span>) <span class="ruby-comment"># SELECT * FROM items LIMIT 10 OFFSET 20</span>
<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">limit</span>(<span class="ruby-value">10</span><span class="ruby-operator">...</span><span class="ruby-value">20</span>) <span class="ruby-comment"># SELECT * FROM items LIMIT 10 OFFSET 10</span>
<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">limit</span>(<span class="ruby-value">10</span><span class="ruby-operator">..</span><span class="ruby-value">20</span>) <span class="ruby-comment"># SELECT * FROM items LIMIT 11 OFFSET 10</span>
<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">limit</span>(<span class="ruby-keyword">nil</span>, <span class="ruby-value">20</span>) <span class="ruby-comment"># SELECT * FROM items OFFSET 20</span>
</pre>
          
          

          
          <div class="method-source-code" id="limit-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">647</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">limit</span>(<span class="ruby-identifier">l</span>, <span class="ruby-identifier">o</span> = (<span class="ruby-identifier">no_offset</span> = <span class="ruby-keyword">true</span>; <span class="ruby-keyword">nil</span>))
<span class="line-num">648</span>   <span class="ruby-keyword">return</span> <span class="ruby-identifier">from_self</span>.<span class="ruby-identifier">limit</span>(<span class="ruby-identifier">l</span>, <span class="ruby-identifier">o</span>) <span class="ruby-keyword">if</span> <span class="ruby-ivar">@opts</span>[<span class="ruby-value">:sql</span>]
<span class="line-num">649</span> 
<span class="line-num">650</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">l</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Range</span>)
<span class="line-num">651</span>     <span class="ruby-identifier">no_offset</span> = <span class="ruby-keyword">false</span>
<span class="line-num">652</span>     <span class="ruby-identifier">o</span> = <span class="ruby-identifier">l</span>.<span class="ruby-identifier">first</span>
<span class="line-num">653</span>     <span class="ruby-identifier">l</span> = <span class="ruby-identifier">l</span>.<span class="ruby-identifier">last</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">l</span>.<span class="ruby-identifier">first</span> <span class="ruby-operator">+</span> (<span class="ruby-identifier">l</span>.<span class="ruby-identifier">exclude_end?</span> <span class="ruby-operator">?</span> <span class="ruby-value">0</span> <span class="ruby-operator">:</span> <span class="ruby-value">1</span>)
<span class="line-num">654</span>   <span class="ruby-keyword">end</span>
<span class="line-num">655</span>   <span class="ruby-identifier">l</span> = <span class="ruby-identifier">l</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">l</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">l</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">LiteralString</span>)
<span class="line-num">656</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">l</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Integer</span>)
<span class="line-num">657</span>     <span class="ruby-identifier">raise</span>(<span class="ruby-constant">Error</span>, <span class="ruby-string">&#39;Limits must be greater than or equal to 1&#39;</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">l</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">1</span>
<span class="line-num">658</span>   <span class="ruby-keyword">end</span>
<span class="line-num">659</span> 
<span class="line-num">660</span>   <span class="ruby-identifier">ds</span> = <span class="ruby-identifier">clone</span>(<span class="ruby-value">:limit</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">l</span>)
<span class="line-num">661</span>   <span class="ruby-identifier">ds</span> = <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">offset</span>(<span class="ruby-identifier">o</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">no_offset</span>
<span class="line-num">662</span>   <span class="ruby-identifier">ds</span>
<span class="line-num">663</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-lock_style" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">lock_style</span><span
            class="method-args">(style)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns a cloned dataset with the given lock style.  If style is a string, it will be used directly. You should never pass a string to this method that is derived from user input, as that can lead to <a href="SQL.html"><code>SQL</code></a> injection.</p>

<p>A symbol may be used for database independent locking behavior, but all supported symbols have separate methods (e.g. <a href="Dataset.html#method-i-for_update"><code>for_update</code></a>).</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">lock_style</span>(<span class="ruby-string">&#39;FOR SHARE NOWAIT&#39;</span>)
<span class="ruby-comment"># SELECT * FROM items FOR SHARE NOWAIT</span>
<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">lock_style</span>(<span class="ruby-string">&#39;FOR UPDATE OF table1 SKIP LOCKED&#39;</span>)
<span class="ruby-comment"># SELECT * FROM items FOR UPDATE OF table1 SKIP LOCKED</span>
</pre>
          
          

          
          <div class="method-source-code" id="lock_style-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">677</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">lock_style</span>(<span class="ruby-identifier">style</span>)
<span class="line-num">678</span>   <span class="ruby-identifier">clone</span>(<span class="ruby-value">:lock</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">style</span>)
<span class="line-num">679</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-naked" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">naked</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns a cloned dataset without a row_proc.</p>

<pre class="ruby"><span class="ruby-identifier">ds</span> = <span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">with_row_proc</span>(<span class="ruby-value">:invert</span>.<span class="ruby-identifier">to_proc</span>)
<span class="ruby-identifier">ds</span>.<span class="ruby-identifier">all</span> <span class="ruby-comment"># =&gt; [{2=&gt;:id}]</span>
<span class="ruby-identifier">ds</span>.<span class="ruby-identifier">naked</span>.<span class="ruby-identifier">all</span> <span class="ruby-comment"># =&gt; [{:id=&gt;2}]</span>
</pre>
          
          

          
          <div class="method-source-code" id="naked-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">686</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">naked</span>
<span class="line-num">687</span>   <span class="ruby-identifier">cached_dataset</span>(<span class="ruby-value">:_naked_ds</span>){<span class="ruby-identifier">with_row_proc</span>(<span class="ruby-keyword">nil</span>)}
<span class="line-num">688</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-nowait" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">nowait</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns a copy of the dataset that will raise a DatabaseLockTimeout instead of waiting for rows that are locked by another transaction</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">for_update</span>.<span class="ruby-identifier">nowait</span>
<span class="ruby-comment"># SELECT * FROM items FOR UPDATE NOWAIT</span>
</pre>
          
          

          
          <div class="method-source-code" id="nowait-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">695</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">nowait</span>
<span class="line-num">696</span>   <span class="ruby-identifier">cached_dataset</span>(<span class="ruby-value">:_nowait_ds</span>) <span class="ruby-keyword">do</span>
<span class="line-num">697</span>     <span class="ruby-identifier">raise</span>(<span class="ruby-constant">Error</span>, <span class="ruby-string">&#39;This dataset does not support raises errors instead of waiting for locked rows&#39;</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">supports_nowait?</span>
<span class="line-num">698</span>     <span class="ruby-identifier">clone</span>(<span class="ruby-value">:nowait</span><span class="ruby-operator">=&gt;</span><span class="ruby-keyword">true</span>)
<span class="line-num">699</span>   <span class="ruby-keyword">end</span>
<span class="line-num">700</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-offset" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">offset</span><span
            class="method-args">(o)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns a copy of the dataset with a specified order. Can be safely combined with limit. If you call limit with an offset, it will override the offset if you&#39;ve called offset first.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">offset</span>(<span class="ruby-value">10</span>) <span class="ruby-comment"># SELECT * FROM items OFFSET 10</span>
</pre>
          
          

          
          <div class="method-source-code" id="offset-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">707</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">offset</span>(<span class="ruby-identifier">o</span>)
<span class="line-num">708</span>   <span class="ruby-identifier">o</span> = <span class="ruby-identifier">o</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">o</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">o</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">LiteralString</span>)
<span class="line-num">709</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">o</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Integer</span>)
<span class="line-num">710</span>     <span class="ruby-identifier">raise</span>(<span class="ruby-constant">Error</span>, <span class="ruby-string">&#39;Offsets must be greater than or equal to 0&#39;</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">o</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">0</span>
<span class="line-num">711</span>   <span class="ruby-keyword">end</span>
<span class="line-num">712</span>   <span class="ruby-identifier">clone</span>(<span class="ruby-value">:offset</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">o</span>)
<span class="line-num">713</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-or" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">or</span><span
            class="method-args">(*cond, &amp;block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Adds an alternate filter to an existing WHERE clause using OR.  If there  is no WHERE clause, then the default is WHERE true, and OR would be redundant, so return the dataset in that case.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">where</span>(<span class="ruby-value">:a</span>).<span class="ruby-identifier">or</span>(<span class="ruby-value">:b</span>) <span class="ruby-comment"># SELECT * FROM items WHERE a OR b</span>
<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">or</span>(<span class="ruby-value">:b</span>) <span class="ruby-comment"># SELECT * FROM items</span>
</pre>
          
          

          
          <div class="method-source-code" id="or-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">721</span> <span class="ruby-keyword">def</span> <span class="ruby-keyword">or</span>(<span class="ruby-operator">*</span><span class="ruby-identifier ruby-title">cond</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">722</span>   <span class="ruby-keyword">if</span> <span class="ruby-ivar">@opts</span>[<span class="ruby-value">:where</span>].<span class="ruby-identifier">nil?</span>
<span class="line-num">723</span>     <span class="ruby-keyword">self</span>
<span class="line-num">724</span>   <span class="ruby-keyword">else</span>
<span class="line-num">725</span>     <span class="ruby-identifier">add_filter</span>(<span class="ruby-value">:where</span>, <span class="ruby-identifier">cond</span>, <span class="ruby-keyword">false</span>, <span class="ruby-value">:OR</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">726</span>   <span class="ruby-keyword">end</span>
<span class="line-num">727</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-order" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">order</span><span
            class="method-args">(*columns, &amp;block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns a copy of the dataset with the order changed. If the dataset has an existing order, it is ignored and overwritten with this order. If a nil is given the returned dataset has no order. This can accept multiple arguments of varying kinds, such as <a href="SQL.html"><code>SQL</code></a> functions.  If a block is given, it is treated as a virtual row block, similar to <code>where</code>.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">order</span>(<span class="ruby-value">:name</span>) <span class="ruby-comment"># SELECT * FROM items ORDER BY name</span>
<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">order</span>(<span class="ruby-value">:a</span>, <span class="ruby-value">:b</span>) <span class="ruby-comment"># SELECT * FROM items ORDER BY a, b</span>
<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">order</span>(<span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">lit</span>(<span class="ruby-string">&#39;a + b&#39;</span>)) <span class="ruby-comment"># SELECT * FROM items ORDER BY a + b</span>
<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">order</span>(<span class="ruby-constant">Sequel</span>[<span class="ruby-value">:a</span>] <span class="ruby-operator">+</span> <span class="ruby-value">:b</span>) <span class="ruby-comment"># SELECT * FROM items ORDER BY (a + b)</span>
<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">order</span>(<span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">desc</span>(<span class="ruby-value">:name</span>)) <span class="ruby-comment"># SELECT * FROM items ORDER BY name DESC</span>
<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">order</span>(<span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">asc</span>(<span class="ruby-value">:name</span>, <span class="ruby-value">:nulls</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">:last</span>)) <span class="ruby-comment"># SELECT * FROM items ORDER BY name ASC NULLS LAST</span>
<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">order</span>{<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">name</span>).<span class="ruby-identifier">desc</span>} <span class="ruby-comment"># SELECT * FROM items ORDER BY sum(name) DESC</span>
<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">order</span>(<span class="ruby-keyword">nil</span>) <span class="ruby-comment"># SELECT * FROM items</span>
</pre>
          
          

          
          <div class="method-source-code" id="order-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">743</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">order</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">columns</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">744</span>   <span class="ruby-identifier">virtual_row_columns</span>(<span class="ruby-identifier">columns</span>, <span class="ruby-identifier">block</span>)
<span class="line-num">745</span>   <span class="ruby-identifier">clone</span>(<span class="ruby-value">:order</span> <span class="ruby-operator">=&gt;</span> (<span class="ruby-identifier">columns</span>.<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">empty?</span>) <span class="ruby-operator">?</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">columns</span>.<span class="ruby-identifier">freeze</span>)
<span class="line-num">746</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-order_append" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">order_append</span><span
            class="method-args">(*columns, &amp;block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns a copy of the dataset with the order columns added to the end of the existing order.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">order</span>(<span class="ruby-value">:a</span>).<span class="ruby-identifier">order</span>(<span class="ruby-value">:b</span>) <span class="ruby-comment"># SELECT * FROM items ORDER BY b</span>
<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">order</span>(<span class="ruby-value">:a</span>).<span class="ruby-identifier">order_append</span>(<span class="ruby-value">:b</span>) <span class="ruby-comment"># SELECT * FROM items ORDER BY a, b</span>
</pre>
          
          

          
          <div class="method-source-code" id="order_append-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">753</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">order_append</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">columns</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">754</span>   <span class="ruby-identifier">columns</span> = <span class="ruby-ivar">@opts</span>[<span class="ruby-value">:order</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">columns</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@opts</span>[<span class="ruby-value">:order</span>]
<span class="line-num">755</span>   <span class="ruby-identifier">order</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">columns</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">756</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-order_by" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">order_by</span><span
            class="method-args">(*columns, &amp;block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Alias of order</p>
          
          

          
          <div class="method-source-code" id="order_by-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">759</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">order_by</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">columns</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">760</span>   <span class="ruby-identifier">order</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">columns</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">761</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-order_more" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">order_more</span><span
            class="method-args">(*columns, &amp;block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Alias of order_append.</p>
          
          

          
          <div class="method-source-code" id="order_more-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">764</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">order_more</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">columns</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">765</span>   <span class="ruby-identifier">order_append</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">columns</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">766</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-order_prepend" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">order_prepend</span><span
            class="method-args">(*columns, &amp;block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns a copy of the dataset with the order columns added to the beginning of the existing order.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">order</span>(<span class="ruby-value">:a</span>).<span class="ruby-identifier">order</span>(<span class="ruby-value">:b</span>) <span class="ruby-comment"># SELECT * FROM items ORDER BY b</span>
<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">order</span>(<span class="ruby-value">:a</span>).<span class="ruby-identifier">order_prepend</span>(<span class="ruby-value">:b</span>) <span class="ruby-comment"># SELECT * FROM items ORDER BY b, a</span>
</pre>
          
          

          
          <div class="method-source-code" id="order_prepend-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">773</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">order_prepend</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">columns</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">774</span>   <span class="ruby-identifier">ds</span> = <span class="ruby-identifier">order</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">columns</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">775</span>   <span class="ruby-ivar">@opts</span>[<span class="ruby-value">:order</span>] <span class="ruby-operator">?</span> <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">order_append</span>(<span class="ruby-operator">*</span><span class="ruby-ivar">@opts</span>[<span class="ruby-value">:order</span>]) <span class="ruby-operator">:</span> <span class="ruby-identifier">ds</span>
<span class="line-num">776</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-qualify" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">qualify</span><span
            class="method-args">(table=(cache=true; first_source))</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Qualify to the given table, or first source if no table is given.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">where</span>(<span class="ruby-value">id:</span> <span class="ruby-value">1</span>).<span class="ruby-identifier">qualify</span>
<span class="ruby-comment"># SELECT items.* FROM items WHERE (items.id = 1)</span>

<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">where</span>(<span class="ruby-value">id:</span> <span class="ruby-value">1</span>).<span class="ruby-identifier">qualify</span>(<span class="ruby-value">:i</span>)
<span class="ruby-comment"># SELECT i.* FROM items WHERE (i.id = 1)</span>
</pre>
          
          

          
          <div class="method-source-code" id="qualify-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">785</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">qualify</span>(<span class="ruby-identifier">table</span>=(<span class="ruby-identifier">cache</span>=<span class="ruby-keyword">true</span>; <span class="ruby-identifier">first_source</span>))
<span class="line-num">786</span>   <span class="ruby-identifier">o</span> = <span class="ruby-ivar">@opts</span>
<span class="line-num">787</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">self</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">o</span>[<span class="ruby-value">:sql</span>]
<span class="line-num">788</span> 
<span class="line-num">789</span>   <span class="ruby-identifier">pr</span> = <span class="ruby-identifier">proc</span> <span class="ruby-keyword">do</span>
<span class="line-num">790</span>     <span class="ruby-identifier">h</span> = {}
<span class="line-num">791</span>     (<span class="ruby-identifier">o</span>.<span class="ruby-identifier">keys</span> <span class="ruby-operator">&amp;</span> <span class="ruby-constant">QUALIFY_KEYS</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span><span class="ruby-operator">|</span>
<span class="line-num">792</span>       <span class="ruby-identifier">h</span>[<span class="ruby-identifier">k</span>] = <span class="ruby-identifier">qualified_expression</span>(<span class="ruby-identifier">o</span>[<span class="ruby-identifier">k</span>], <span class="ruby-identifier">table</span>)
<span class="line-num">793</span>     <span class="ruby-keyword">end</span>
<span class="line-num">794</span>     <span class="ruby-identifier">h</span>[<span class="ruby-value">:select</span>] = [<span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">ColumnAll</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">table</span>)].<span class="ruby-identifier">freeze</span> <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">o</span>[<span class="ruby-value">:select</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">o</span>[<span class="ruby-value">:select</span>].<span class="ruby-identifier">empty?</span>
<span class="line-num">795</span>     <span class="ruby-identifier">clone</span>(<span class="ruby-identifier">h</span>)
<span class="line-num">796</span>   <span class="ruby-keyword">end</span>
<span class="line-num">797</span> 
<span class="line-num">798</span>   <span class="ruby-identifier">cache</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">cached_dataset</span>(<span class="ruby-value">:_qualify_ds</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">pr</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">pr</span>.<span class="ruby-identifier">call</span>
<span class="line-num">799</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-returning" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">returning</span><span
            class="method-args">(*values)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Modify the RETURNING clause, only supported on a few databases.  If returning is used, instead of insert returning the autogenerated primary key or update/delete returning the number of modified rows, results are returned using <code>fetch_rows</code>.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">returning</span> <span class="ruby-comment"># RETURNING *</span>
<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">returning</span>(<span class="ruby-keyword">nil</span>) <span class="ruby-comment"># RETURNING NULL</span>
<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">returning</span>(<span class="ruby-value">:id</span>, <span class="ruby-value">:name</span>) <span class="ruby-comment"># RETURNING id, name</span>

<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">returning</span>.<span class="ruby-identifier">insert</span>(<span class="ruby-value">:a</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">1</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">hash</span><span class="ruby-operator">|</span>
  <span class="ruby-comment"># hash for each row inserted, with values for all columns</span>
<span class="ruby-keyword">end</span>
<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">returning</span>.<span class="ruby-identifier">update</span>(<span class="ruby-value">:a</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">1</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">hash</span><span class="ruby-operator">|</span>
  <span class="ruby-comment"># hash for each row updated, with values for all columns</span>
<span class="ruby-keyword">end</span>
<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">returning</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:a</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">1</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">hash</span><span class="ruby-operator">|</span>
  <span class="ruby-comment"># hash for each row deleted, with values for all columns</span>
<span class="ruby-keyword">end</span>
</pre>
          
          

          
          <div class="method-source-code" id="returning-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">819</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">returning</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">values</span>)
<span class="line-num">820</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">values</span>.<span class="ruby-identifier">empty?</span>
<span class="line-num">821</span>     <span class="ruby-identifier">cached_dataset</span>(<span class="ruby-value">:_returning_ds</span>) <span class="ruby-keyword">do</span>
<span class="line-num">822</span>       <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-node">&quot;RETURNING is not supported on #{db.database_type}&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">supports_returning?</span>(<span class="ruby-value">:insert</span>)
<span class="line-num">823</span>       <span class="ruby-identifier">clone</span>(<span class="ruby-value">:returning</span><span class="ruby-operator">=&gt;</span><span class="ruby-constant">EMPTY_ARRAY</span>)
<span class="line-num">824</span>     <span class="ruby-keyword">end</span>
<span class="line-num">825</span>   <span class="ruby-keyword">else</span>
<span class="line-num">826</span>     <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-node">&quot;RETURNING is not supported on #{db.database_type}&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">supports_returning?</span>(<span class="ruby-value">:insert</span>)
<span class="line-num">827</span>     <span class="ruby-identifier">clone</span>(<span class="ruby-value">:returning</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">values</span>.<span class="ruby-identifier">freeze</span>)
<span class="line-num">828</span>   <span class="ruby-keyword">end</span>
<span class="line-num">829</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-reverse" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">reverse</span><span
            class="method-args">(*order, &amp;block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns a copy of the dataset with the order reversed. If no order is given, the existing order is inverted.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">reverse</span>(<span class="ruby-value">:id</span>) <span class="ruby-comment"># SELECT * FROM items ORDER BY id DESC</span>
<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">reverse</span>{<span class="ruby-identifier">foo</span>(<span class="ruby-identifier">bar</span>)} <span class="ruby-comment"># SELECT * FROM items ORDER BY foo(bar) DESC</span>
<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">order</span>(<span class="ruby-value">:id</span>).<span class="ruby-identifier">reverse</span> <span class="ruby-comment"># SELECT * FROM items ORDER BY id DESC</span>
<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">order</span>(<span class="ruby-value">:id</span>).<span class="ruby-identifier">reverse</span>(<span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">desc</span>(<span class="ruby-value">:name</span>)) <span class="ruby-comment"># SELECT * FROM items ORDER BY name ASC</span>
</pre>
          
          

          
          <div class="method-source-code" id="reverse-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">838</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">reverse</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">order</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">839</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">order</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">block</span>
<span class="line-num">840</span>     <span class="ruby-identifier">cached_dataset</span>(<span class="ruby-value">:_reverse_ds</span>){<span class="ruby-identifier">order</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">invert_order</span>(<span class="ruby-ivar">@opts</span>[<span class="ruby-value">:order</span>]))}
<span class="line-num">841</span>   <span class="ruby-keyword">else</span>
<span class="line-num">842</span>     <span class="ruby-identifier">virtual_row_columns</span>(<span class="ruby-identifier">order</span>, <span class="ruby-identifier">block</span>)
<span class="line-num">843</span>     <span class="ruby-identifier">order</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">invert_order</span>(<span class="ruby-identifier">order</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">?</span> <span class="ruby-ivar">@opts</span>[<span class="ruby-value">:order</span>] <span class="ruby-operator">:</span> <span class="ruby-identifier">order</span>.<span class="ruby-identifier">freeze</span>))
<span class="line-num">844</span>   <span class="ruby-keyword">end</span>
<span class="line-num">845</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-reverse_order" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">reverse_order</span><span
            class="method-args">(*order, &amp;block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Alias of <code>reverse</code></p>
          
          

          
          <div class="method-source-code" id="reverse_order-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">848</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">reverse_order</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">order</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">849</span>   <span class="ruby-identifier">reverse</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">order</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">850</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-select" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">select</span><span
            class="method-args">(*columns, &amp;block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns a copy of the dataset with the columns selected changed to the given columns. This also takes a virtual row block, similar to <code>where</code>.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">select</span>(<span class="ruby-value">:a</span>) <span class="ruby-comment"># SELECT a FROM items</span>
<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">select</span>(<span class="ruby-value">:a</span>, <span class="ruby-value">:b</span>) <span class="ruby-comment"># SELECT a, b FROM items</span>
<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">select</span>{[<span class="ruby-identifier">a</span>, <span class="ruby-identifier">sum</span>(<span class="ruby-identifier">b</span>)]} <span class="ruby-comment"># SELECT a, sum(b) FROM items</span>
</pre>
          
          

          
          <div class="method-source-code" id="select-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">859</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">select</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">columns</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">860</span>   <span class="ruby-identifier">virtual_row_columns</span>(<span class="ruby-identifier">columns</span>, <span class="ruby-identifier">block</span>)
<span class="line-num">861</span>   <span class="ruby-identifier">clone</span>(<span class="ruby-value">:select</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">columns</span>.<span class="ruby-identifier">freeze</span>)
<span class="line-num">862</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-select_all" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">select_all</span><span
            class="method-args">(*tables)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns a copy of the dataset selecting the wildcard if no arguments are given.  If arguments are given, treat them as tables and select all columns (using the wildcard) from each table.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">select</span>(<span class="ruby-value">:a</span>).<span class="ruby-identifier">select_all</span> <span class="ruby-comment"># SELECT * FROM items</span>
<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">select_all</span>(<span class="ruby-value">:items</span>) <span class="ruby-comment"># SELECT items.* FROM items</span>
<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">select_all</span>(<span class="ruby-value">:items</span>, <span class="ruby-value">:foo</span>) <span class="ruby-comment"># SELECT items.*, foo.* FROM items</span>
</pre>
          
          

          
          <div class="method-source-code" id="select_all-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">871</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">select_all</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">tables</span>)
<span class="line-num">872</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">tables</span>.<span class="ruby-identifier">empty?</span>
<span class="line-num">873</span>     <span class="ruby-identifier">cached_dataset</span>(<span class="ruby-value">:_select_all_ds</span>){<span class="ruby-identifier">clone</span>(<span class="ruby-value">:select</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">nil</span>)}
<span class="line-num">874</span>   <span class="ruby-keyword">else</span>
<span class="line-num">875</span>     <span class="ruby-identifier">select</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">tables</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span> <span class="ruby-identifier">i</span>, <span class="ruby-identifier">a</span> = <span class="ruby-identifier">split_alias</span>(<span class="ruby-identifier">t</span>); <span class="ruby-identifier">a</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">i</span>}.<span class="ruby-identifier">map!</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span> <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">ColumnAll</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">t</span>)}.<span class="ruby-identifier">freeze</span>)
<span class="line-num">876</span>   <span class="ruby-keyword">end</span>
<span class="line-num">877</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-select_append" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">select_append</span><span
            class="method-args">(*columns, &amp;block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns a copy of the dataset with the given columns added to the existing selected columns.  If no columns are currently selected, it will select the columns given in addition to *.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">select</span>(<span class="ruby-value">:a</span>).<span class="ruby-identifier">select</span>(<span class="ruby-value">:b</span>) <span class="ruby-comment"># SELECT b FROM items</span>
<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">select</span>(<span class="ruby-value">:a</span>).<span class="ruby-identifier">select_append</span>(<span class="ruby-value">:b</span>) <span class="ruby-comment"># SELECT a, b FROM items</span>
<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">select_append</span>(<span class="ruby-value">:b</span>) <span class="ruby-comment"># SELECT *, b FROM items</span>
</pre>
          
          

          
          <div class="method-source-code" id="select_append-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">886</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">select_append</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">columns</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">887</span>   <span class="ruby-identifier">cur_sel</span> = <span class="ruby-ivar">@opts</span>[<span class="ruby-value">:select</span>]
<span class="line-num">888</span>   <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">cur_sel</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">cur_sel</span>.<span class="ruby-identifier">empty?</span>
<span class="line-num">889</span>     <span class="ruby-keyword">unless</span> <span class="ruby-identifier">supports_select_all_and_column?</span>
<span class="line-num">890</span>       <span class="ruby-keyword">return</span> <span class="ruby-identifier">select_all</span>(<span class="ruby-operator">*</span>(<span class="ruby-constant">Array</span>(<span class="ruby-ivar">@opts</span>[<span class="ruby-value">:from</span>]) <span class="ruby-operator">+</span> <span class="ruby-constant">Array</span>(<span class="ruby-ivar">@opts</span>[<span class="ruby-value">:join</span>]))).<span class="ruby-identifier">select_append</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">columns</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">891</span>     <span class="ruby-keyword">end</span>
<span class="line-num">892</span>     <span class="ruby-identifier">cur_sel</span> = [<span class="ruby-constant">WILDCARD</span>]
<span class="line-num">893</span>   <span class="ruby-keyword">end</span>
<span class="line-num">894</span>   <span class="ruby-identifier">select</span>(<span class="ruby-operator">*</span>(<span class="ruby-identifier">cur_sel</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">columns</span>), <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">895</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-select_group" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">select_group</span><span
            class="method-args">(*columns, &amp;block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Set both the select and group clauses with the given <code>columns</code>. Column aliases may be supplied, and will be included in the select clause. This also takes a virtual row block similar to <code>where</code>.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">select_group</span>(<span class="ruby-value">:a</span>, <span class="ruby-value">:b</span>)
<span class="ruby-comment"># SELECT a, b FROM items GROUP BY a, b</span>

<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">select_group</span>(<span class="ruby-constant">Sequel</span>[<span class="ruby-value">:c</span>].<span class="ruby-identifier">as</span>(<span class="ruby-value">:a</span>)){<span class="ruby-identifier">f</span>(<span class="ruby-identifier">c2</span>)}
<span class="ruby-comment"># SELECT c AS a, f(c2) FROM items GROUP BY c, f(c2)</span>
</pre>
          
          

          
          <div class="method-source-code" id="select_group-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">906</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">select_group</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">columns</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">907</span>   <span class="ruby-identifier">virtual_row_columns</span>(<span class="ruby-identifier">columns</span>, <span class="ruby-identifier">block</span>)
<span class="line-num">908</span>   <span class="ruby-identifier">select</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">columns</span>).<span class="ruby-identifier">group</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">columns</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">unaliased_identifier</span>(<span class="ruby-identifier">c</span>)})
<span class="line-num">909</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-select_more" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">select_more</span><span
            class="method-args">(*columns, &amp;block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Alias for select_append.</p>
          
          

          
          <div class="method-source-code" id="select_more-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">912</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">select_more</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">columns</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">913</span>   <span class="ruby-identifier">select_append</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">columns</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">914</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-server" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">server</span><span
            class="method-args">(servr)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Set the server for this dataset to use.  Used to pick a specific database shard to run a query against, or to override the default (where SELECT uses :read_only database and all other queries use the :default database).  This method is always available but is only useful when database sharding is being used.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">all</span> <span class="ruby-comment"># Uses the :read_only or :default server</span>
<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">delete</span> <span class="ruby-comment"># Uses the :default server</span>
<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">server</span>(<span class="ruby-value">:blah</span>).<span class="ruby-identifier">delete</span> <span class="ruby-comment"># Uses the :blah server</span>
</pre>
          
          

          
          <div class="method-source-code" id="server-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">925</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">server</span>(<span class="ruby-identifier">servr</span>)
<span class="line-num">926</span>   <span class="ruby-identifier">clone</span>(<span class="ruby-value">:server</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">servr</span>)
<span class="line-num">927</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-server-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">server?</span><span
            class="method-args">(server)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>If the database uses sharding and the current dataset has not had a server set, return a cloned dataset that uses the given server. Otherwise, return the receiver directly instead of returning a clone.</p>
          
          

          
          <div class="method-source-code" id="server-3F-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">932</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">server?</span>(<span class="ruby-identifier">server</span>)
<span class="line-num">933</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">db</span>.<span class="ruby-identifier">sharded?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">opts</span>[<span class="ruby-value">:server</span>]
<span class="line-num">934</span>     <span class="ruby-identifier">server</span>(<span class="ruby-identifier">server</span>)
<span class="line-num">935</span>   <span class="ruby-keyword">else</span>
<span class="line-num">936</span>     <span class="ruby-keyword">self</span>
<span class="line-num">937</span>   <span class="ruby-keyword">end</span>
<span class="line-num">938</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-skip_limit_check" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">skip_limit_check</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Specify that the check for limits/offsets when updating/deleting be skipped for the dataset.</p>
          
          

          
          <div class="method-source-code" id="skip_limit_check-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">941</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">skip_limit_check</span>
<span class="line-num">942</span>   <span class="ruby-identifier">cached_dataset</span>(<span class="ruby-value">:_skip_limit_check_ds</span>) <span class="ruby-keyword">do</span>
<span class="line-num">943</span>     <span class="ruby-identifier">clone</span>(<span class="ruby-value">:skip_limit_check</span><span class="ruby-operator">=&gt;</span><span class="ruby-keyword">true</span>)
<span class="line-num">944</span>   <span class="ruby-keyword">end</span>
<span class="line-num">945</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-skip_locked" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">skip_locked</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Skip locked rows when returning results from this dataset.</p>
          
          

          
          <div class="method-source-code" id="skip_locked-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">948</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">skip_locked</span>
<span class="line-num">949</span>   <span class="ruby-identifier">cached_dataset</span>(<span class="ruby-value">:_skip_locked_ds</span>) <span class="ruby-keyword">do</span>
<span class="line-num">950</span>     <span class="ruby-identifier">raise</span>(<span class="ruby-constant">Error</span>, <span class="ruby-string">&#39;This dataset does not support skipping locked rows&#39;</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">supports_skip_locked?</span>
<span class="line-num">951</span>     <span class="ruby-identifier">clone</span>(<span class="ruby-value">:skip_locked</span><span class="ruby-operator">=&gt;</span><span class="ruby-keyword">true</span>)
<span class="line-num">952</span>   <span class="ruby-keyword">end</span>
<span class="line-num">953</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-unfiltered" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">unfiltered</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns a copy of the dataset with no filters (HAVING or WHERE clause) applied.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">group</span>(<span class="ruby-value">:a</span>).<span class="ruby-identifier">having</span>(<span class="ruby-value">a:</span> <span class="ruby-value">1</span>).<span class="ruby-identifier">where</span>(<span class="ruby-value">:b</span>).<span class="ruby-identifier">unfiltered</span>
<span class="ruby-comment"># SELECT * FROM items GROUP BY a</span>
</pre>
          
          

          
          <div class="method-source-code" id="unfiltered-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">959</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">unfiltered</span>
<span class="line-num">960</span>   <span class="ruby-identifier">cached_dataset</span>(<span class="ruby-value">:_unfiltered_ds</span>){<span class="ruby-identifier">clone</span>(<span class="ruby-value">:where</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">:having</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">nil</span>)}
<span class="line-num">961</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-ungrouped" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">ungrouped</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns a copy of the dataset with no grouping (GROUP or HAVING clause) applied.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">group</span>(<span class="ruby-value">:a</span>).<span class="ruby-identifier">having</span>(<span class="ruby-value">a:</span> <span class="ruby-value">1</span>).<span class="ruby-identifier">where</span>(<span class="ruby-value">:b</span>).<span class="ruby-identifier">ungrouped</span>
<span class="ruby-comment"># SELECT * FROM items WHERE b</span>
</pre>
          
          

          
          <div class="method-source-code" id="ungrouped-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">967</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">ungrouped</span>
<span class="line-num">968</span>   <span class="ruby-identifier">cached_dataset</span>(<span class="ruby-value">:_ungrouped_ds</span>){<span class="ruby-identifier">clone</span>(<span class="ruby-value">:group</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">:having</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">nil</span>)}
<span class="line-num">969</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-union" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">union</span><span
            class="method-args">(dataset, opts=OPTS)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Adds a UNION clause using a second dataset object. A UNION compound dataset returns all rows in either the current dataset or the given dataset. Options:</p>
<dl class="rdoc-list note-list"><dt>:alias 
<dd>
<p>Use the given value as the <a href="Dataset.html#method-i-from_self"><code>from_self</code></a> alias</p>
</dd><dt>:all 
<dd>
<p>Set to true to use UNION ALL instead of UNION, so duplicate rows can occur</p>
</dd><dt>:from_self 
<dd>
<p>Set to false to not wrap the returned dataset in a <a href="Dataset.html#method-i-from_self"><code>from_self</code></a>, use with care.</p>
</dd></dl>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">union</span>(<span class="ruby-constant">DB</span>[<span class="ruby-value">:other_items</span>])
<span class="ruby-comment"># SELECT * FROM (SELECT * FROM items UNION SELECT * FROM other_items) AS t1</span>

<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">union</span>(<span class="ruby-constant">DB</span>[<span class="ruby-value">:other_items</span>], <span class="ruby-value">all:</span> <span class="ruby-keyword">true</span>, <span class="ruby-value">from_self:</span> <span class="ruby-keyword">false</span>)
<span class="ruby-comment"># SELECT * FROM items UNION ALL SELECT * FROM other_items</span>

<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">union</span>(<span class="ruby-constant">DB</span>[<span class="ruby-value">:other_items</span>], <span class="ruby-value">alias:</span> <span class="ruby-value">:i</span>)
<span class="ruby-comment"># SELECT * FROM (SELECT * FROM items UNION SELECT * FROM other_items) AS i</span>
</pre>
          
          

          
          <div class="method-source-code" id="union-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">987</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">union</span>(<span class="ruby-identifier">dataset</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)
<span class="line-num">988</span>   <span class="ruby-identifier">compound_clone</span>(<span class="ruby-value">:union</span>, <span class="ruby-identifier">dataset</span>, <span class="ruby-identifier">opts</span>)
<span class="line-num">989</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-unlimited" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">unlimited</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns a copy of the dataset with no limit or offset.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">limit</span>(<span class="ruby-value">10</span>, <span class="ruby-value">20</span>).<span class="ruby-identifier">unlimited</span> <span class="ruby-comment"># SELECT * FROM items</span>
</pre>
          
          

          
          <div class="method-source-code" id="unlimited-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">994</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">unlimited</span>
<span class="line-num">995</span>   <span class="ruby-identifier">cached_dataset</span>(<span class="ruby-value">:_unlimited_ds</span>){<span class="ruby-identifier">clone</span>(<span class="ruby-value">:limit</span><span class="ruby-operator">=&gt;</span><span class="ruby-keyword">nil</span>, <span class="ruby-value">:offset</span><span class="ruby-operator">=&gt;</span><span class="ruby-keyword">nil</span>)}
<span class="line-num">996</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-unordered" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">unordered</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns a copy of the dataset with no order.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">order</span>(<span class="ruby-value">:a</span>).<span class="ruby-identifier">unordered</span> <span class="ruby-comment"># SELECT * FROM items</span>
</pre>
          
          

          
          <div class="method-source-code" id="unordered-source">
            <pre>     <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">1001</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">unordered</span>
<span class="line-num">1002</span>   <span class="ruby-identifier">cached_dataset</span>(<span class="ruby-value">:_unordered_ds</span>){<span class="ruby-identifier">clone</span>(<span class="ruby-value">:order</span><span class="ruby-operator">=&gt;</span><span class="ruby-keyword">nil</span>)}
<span class="line-num">1003</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-where" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">where</span><span
            class="method-args">(*cond, &amp;block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns a copy of the dataset with the given WHERE conditions imposed upon it.</p>

<p>Accepts the following argument types:</p>
<dl class="rdoc-list note-list"><dt>Hash, Array of pairs 
<dd>
<p>list of equality/inclusion expressions</p>
</dd><dt>Symbol 
<dd>
<p>taken as a boolean column argument (e.g. WHERE active)</p>
</dd><dt><a href="SQL/BooleanExpression.html"><code>Sequel::SQL::BooleanExpression</code></a>, <a href="LiteralString.html"><code>Sequel::LiteralString</code></a> 
<dd>
<p>an existing condition expression, probably created using the <a href="../Sequel.html"><code>Sequel</code></a> expression filter DSL.</p>
</dd></dl>

<p>where also accepts a block, which should return one of the above argument types, and is treated the same way.  This block yields a virtual row object, which is easy to use to create identifiers and functions.  For more details on the virtual row support, see the <a href="../doc/virtual_rows_rdoc.html">“Virtual Rows” guide</a></p>

<p>If both a block and regular argument are provided, they get ANDed together.</p>

<p>Examples:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">where</span>(<span class="ruby-value">id:</span> <span class="ruby-value">3</span>)
<span class="ruby-comment"># SELECT * FROM items WHERE (id = 3)</span>

<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">where</span>(<span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">lit</span>(<span class="ruby-string">&#39;price &lt; ?&#39;</span>, <span class="ruby-value">100</span>))
<span class="ruby-comment"># SELECT * FROM items WHERE price &lt; 100</span>

<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">where</span>([[<span class="ruby-value">:id</span>, [<span class="ruby-value">1</span>,<span class="ruby-value">2</span>,<span class="ruby-value">3</span>]], [<span class="ruby-value">:id</span>, <span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">10</span>]])
<span class="ruby-comment"># SELECT * FROM items WHERE ((id IN (1, 2, 3)) AND ((id &gt;= 0) AND (id &lt;= 10)))</span>

<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">where</span>(<span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">lit</span>(<span class="ruby-string">&#39;price &lt; 100&#39;</span>))
<span class="ruby-comment"># SELECT * FROM items WHERE price &lt; 100</span>

<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">where</span>(<span class="ruby-value">:active</span>)
<span class="ruby-comment"># SELECT * FROM items WHERE :active</span>

<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">where</span>{<span class="ruby-identifier">price</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">100</span>}
<span class="ruby-comment"># SELECT * FROM items WHERE (price &lt; 100)</span>
</pre>

<p>Multiple where calls can be chained for scoping:</p>

<pre class="ruby"><span class="ruby-identifier">software</span> = <span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">where</span>(<span class="ruby-value">category:</span> <span class="ruby-string">&#39;software&#39;</span>).<span class="ruby-identifier">where</span>{<span class="ruby-identifier">price</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">100</span>}
<span class="ruby-comment"># SELECT * FROM items WHERE ((category = &#39;software&#39;) AND (price &lt; 100))</span>
</pre>

<p>See the <a href="../doc/dataset_filtering_rdoc.html">“Dataset Filtering” guide</a> for more examples and details.</p>
          
          

          
          <div class="method-source-code" id="where-source">
            <pre>     <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">1047</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">where</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">cond</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">1048</span>   <span class="ruby-identifier">add_filter</span>(<span class="ruby-value">:where</span>, <span class="ruby-identifier">cond</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">1049</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-window" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">window</span><span
            class="method-args">(name, opts)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Return a clone of the dataset with an addition named window that can be referenced in window functions. See <a href="SQL/Window.html"><code>Sequel::SQL::Window</code></a> for a list of options that can be passed in. Example:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">window</span>(<span class="ruby-value">:w</span>, <span class="ruby-value">:partition</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">:c1</span>, <span class="ruby-value">:order</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">:c2</span>)
<span class="ruby-comment"># SELECT * FROM items WINDOW w AS (PARTITION BY c1 ORDER BY c2)</span>
</pre>
          
          

          
          <div class="method-source-code" id="window-source">
            <pre>     <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">1057</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">window</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">opts</span>)
<span class="line-num">1058</span>   <span class="ruby-identifier">clone</span>(<span class="ruby-value">:window</span><span class="ruby-operator">=&gt;</span>((<span class="ruby-ivar">@opts</span>[<span class="ruby-value">:window</span>]<span class="ruby-operator">||</span><span class="ruby-constant">EMPTY_ARRAY</span>) <span class="ruby-operator">+</span> [[<span class="ruby-identifier">name</span>, <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">Window</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">opts</span>)].<span class="ruby-identifier">freeze</span>]).<span class="ruby-identifier">freeze</span>)
<span class="line-num">1059</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-with" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">with</span><span
            class="method-args">(name, dataset, opts=OPTS)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Add a common table expression (CTE) with the given name and a dataset that defines the CTE. A common table expression acts as an inline view for the query.</p>

<p>Options:</p>
<dl class="rdoc-list note-list"><dt>:args 
<dd>
<p>Specify the arguments/columns for the CTE, should be an array of symbols.</p>
</dd><dt>:recursive 
<dd>
<p>Specify that this is a recursive CTE</p>
</dd><dt>:materialized 
<dd>
<p>Set to false to force inlining of the CTE, or true to force not inlining the CTE (PostgreSQL 12+/SQLite 3.35+).</p>
</dd></dl>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">with</span>(<span class="ruby-value">:items</span>, <span class="ruby-constant">DB</span>[<span class="ruby-value">:syx</span>].<span class="ruby-identifier">where</span>(<span class="ruby-constant">Sequel</span>[<span class="ruby-value">:name</span>].<span class="ruby-identifier">like</span>(<span class="ruby-string">&#39;A%&#39;</span>)))
<span class="ruby-comment"># WITH items AS (SELECT * FROM syx WHERE (name LIKE &#39;A%&#39; ESCAPE &#39;\&#39;)) SELECT * FROM items</span>
</pre>
          
          

          
          <div class="method-source-code" id="with-source">
            <pre>     <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">1072</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">with</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">dataset</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)
<span class="line-num">1073</span>   <span class="ruby-identifier">raise</span>(<span class="ruby-constant">Error</span>, <span class="ruby-string">&#39;This dataset does not support common table expressions&#39;</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">supports_cte?</span>
<span class="line-num">1074</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">hoist_cte?</span>(<span class="ruby-identifier">dataset</span>)
<span class="line-num">1075</span>     <span class="ruby-identifier">s</span>, <span class="ruby-identifier">ds</span> = <span class="ruby-identifier">hoist_cte</span>(<span class="ruby-identifier">dataset</span>)
<span class="line-num">1076</span>     <span class="ruby-identifier">s</span>.<span class="ruby-identifier">with</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">ds</span>, <span class="ruby-identifier">opts</span>)
<span class="line-num">1077</span>   <span class="ruby-keyword">else</span>
<span class="line-num">1078</span>     <span class="ruby-identifier">clone</span>(<span class="ruby-value">:with</span><span class="ruby-operator">=&gt;</span>((<span class="ruby-ivar">@opts</span>[<span class="ruby-value">:with</span>]<span class="ruby-operator">||</span><span class="ruby-constant">EMPTY_ARRAY</span>) <span class="ruby-operator">+</span> [<span class="ruby-constant">Hash</span>[<span class="ruby-identifier">opts</span>].<span class="ruby-identifier">merge!</span>(<span class="ruby-value">:name</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">name</span>, <span class="ruby-value">:dataset</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">dataset</span>)]).<span class="ruby-identifier">freeze</span>)
<span class="line-num">1079</span>   <span class="ruby-keyword">end</span>
<span class="line-num">1080</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-with_extend" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">with_extend</span><span
            class="method-args">(*mods, &amp;block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Return a clone of the dataset extended with the given modules. Note that like Object#extend, when multiple modules are provided as arguments the cloned dataset is extended with the modules in reverse order.  If a block is provided, a <a href="Dataset/DatasetModule.html"><code>DatasetModule</code></a> is created using the block and the clone is extended with that module after any modules given as arguments.</p>
          
          

          
          <div class="method-source-code" id="with_extend-source">
            <pre>     <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">1157</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">with_extend</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">mods</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">1158</span>   <span class="ruby-identifier">c</span> = <span class="ruby-identifier">_clone</span>(<span class="ruby-value">:freeze</span><span class="ruby-operator">=&gt;</span><span class="ruby-keyword">false</span>)
<span class="line-num">1159</span>   <span class="ruby-identifier">c</span>.<span class="ruby-identifier">extend</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">mods</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">mods</span>.<span class="ruby-identifier">empty?</span>
<span class="line-num">1160</span>   <span class="ruby-identifier">c</span>.<span class="ruby-identifier">extend</span>(<span class="ruby-constant">DatasetModule</span>.<span class="ruby-identifier">new</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)) <span class="ruby-keyword">if</span> <span class="ruby-identifier">block</span>
<span class="line-num">1161</span>   <span class="ruby-identifier">c</span>.<span class="ruby-identifier">freeze</span>
<span class="line-num">1162</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-with_recursive" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">with_recursive</span><span
            class="method-args">(name, nonrecursive, recursive, opts=OPTS)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Add a recursive common table expression (CTE) with the given name, a dataset that defines the nonrecursive part of the CTE, and a dataset that defines the recursive part of the CTE.</p>

<p>Options:</p>
<dl class="rdoc-list note-list"><dt>:args 
<dd>
<p>Specify the arguments/columns for the CTE, should be an array of symbols.</p>
</dd><dt>:union_all 
<dd>
<p>Set to false to use UNION instead of UNION ALL combining the nonrecursive and recursive parts.</p>
</dd></dl>

<p>PostgreSQL 14+ Options:</p>
<dl class="rdoc-list note-list"><dt>:cycle 
<dd>
<p>Stop recursive searching when a cycle is detected. Includes two columns in the result of the CTE, a cycle column indicating whether a cycle was detected for the current row, and a path column for the path traversed to get to the current row.  If given, must be a hash with the following keys:</p>
<dl class="rdoc-list note-list"><dt>:columns 
<dd>
<p>(required) The column or array of columns to use to detect a cycle. If the value of these columns match columns already traversed, then a cycle is detected, and recursive searching will not traverse beyond the cycle (the CTE will include the row where the cycle was detected).</p>
</dd><dt>:cycle_column 
<dd>
<p>The name of the cycle column in the output, defaults to :is_cycle.</p>
</dd><dt>:cycle_value 
<dd>
<p>The value of the cycle column in the output if the current row was detected as a cycle, defaults to true.</p>
</dd><dt>:noncycle_value 
<dd>
<p>The value of the cycle column in the output if the current row was not detected as a cycle, defaults to false. Only respected if :cycle_value is given.</p>
</dd><dt>:path_column 
<dd>
<p>The name of the path column in the output, defaults to :path.</p>
</dd></dl>
</dd><dt>:search 
<dd>
<p>Include an order column in the result of the CTE that allows for breadth or depth first searching. If given, must be a hash with the following keys:</p>
<dl class="rdoc-list note-list"><dt>:by 
<dd>
<p>(required) The column or array of columns to search by.</p>
</dd><dt>:order_column 
<dd>
<p>The name of the order column in the output, defaults to :ordercol.</p>
</dd><dt>:type 
<dd>
<p>Set to :breadth to use breadth-first searching (depth-first searching is the default).</p>
</dd></dl>
</dd></dl>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:t</span>].<span class="ruby-identifier">with_recursive</span>(<span class="ruby-value">:t</span>,
  <span class="ruby-constant">DB</span>[<span class="ruby-value">:i1</span>].<span class="ruby-identifier">select</span>(<span class="ruby-value">:id</span>, <span class="ruby-value">:parent_id</span>).<span class="ruby-identifier">where</span>(<span class="ruby-value">parent_id:</span> <span class="ruby-keyword">nil</span>),
  <span class="ruby-constant">DB</span>[<span class="ruby-value">:i1</span>].<span class="ruby-identifier">join</span>(<span class="ruby-value">:t</span>, <span class="ruby-value">id:</span> <span class="ruby-value">:parent_id</span>).<span class="ruby-identifier">select</span>(<span class="ruby-constant">Sequel</span>[<span class="ruby-value">:i1</span>][<span class="ruby-value">:id</span>], <span class="ruby-constant">Sequel</span>[<span class="ruby-value">:i1</span>][<span class="ruby-value">:parent_id</span>]),
  <span class="ruby-value">:args</span><span class="ruby-operator">=&gt;</span>[<span class="ruby-value">:id</span>, <span class="ruby-value">:parent_id</span>])

<span class="ruby-comment"># WITH RECURSIVE t(id, parent_id) AS (</span>
<span class="ruby-comment">#   SELECT id, parent_id FROM i1 WHERE (parent_id IS NULL)</span>
<span class="ruby-comment">#   UNION ALL</span>
<span class="ruby-comment">#   SELECT i1.id, i1.parent_id FROM i1 INNER JOIN t ON (t.id = i1.parent_id)</span>
<span class="ruby-comment"># ) SELECT * FROM t</span>

<span class="ruby-constant">DB</span>[<span class="ruby-value">:t</span>].<span class="ruby-identifier">with_recursive</span>(<span class="ruby-value">:t</span>,
  <span class="ruby-constant">DB</span>[<span class="ruby-value">:i1</span>].<span class="ruby-identifier">where</span>(<span class="ruby-value">parent_id:</span> <span class="ruby-keyword">nil</span>),
  <span class="ruby-constant">DB</span>[<span class="ruby-value">:i1</span>].<span class="ruby-identifier">join</span>(<span class="ruby-value">:t</span>, <span class="ruby-value">id:</span> <span class="ruby-value">:parent_id</span>).<span class="ruby-identifier">select_all</span>(<span class="ruby-value">:i1</span>),
  <span class="ruby-value">search:</span> {<span class="ruby-value">by:</span> <span class="ruby-value">:id</span>, <span class="ruby-value">type:</span> <span class="ruby-value">:breadth</span>},
  <span class="ruby-value">cycle:</span> {<span class="ruby-value">columns:</span> <span class="ruby-value">:id</span>, <span class="ruby-value">cycle_value:</span> <span class="ruby-value">1</span>, <span class="ruby-value">noncycle_value:</span> <span class="ruby-value">2</span>})

<span class="ruby-comment"># WITH RECURSIVE t AS (</span>
<span class="ruby-comment">#     SELECT * FROM i1 WHERE (parent_id IS NULL)</span>
<span class="ruby-comment">#     UNION ALL</span>
<span class="ruby-comment">#     (SELECT i1.* FROM i1 INNER JOIN t ON (t.id = i1.parent_id))</span>
<span class="ruby-comment">#   )</span>
<span class="ruby-comment">#   SEARCH BREADTH FIRST BY id SET ordercol</span>
<span class="ruby-comment">#   CYCLE id SET is_cycle TO 1 DEFAULT 2 USING path</span>
<span class="ruby-comment"># SELECT * FROM t</span>
</pre>
          
          

          
          <div class="method-source-code" id="with_recursive-source">
            <pre>     <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">1138</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">with_recursive</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">nonrecursive</span>, <span class="ruby-identifier">recursive</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)
<span class="line-num">1139</span>   <span class="ruby-identifier">raise</span>(<span class="ruby-constant">Error</span>, <span class="ruby-string">&#39;This dataset does not support common table expressions&#39;</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">supports_cte?</span>
<span class="line-num">1140</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">hoist_cte?</span>(<span class="ruby-identifier">nonrecursive</span>)
<span class="line-num">1141</span>     <span class="ruby-identifier">s</span>, <span class="ruby-identifier">ds</span> = <span class="ruby-identifier">hoist_cte</span>(<span class="ruby-identifier">nonrecursive</span>)
<span class="line-num">1142</span>     <span class="ruby-identifier">s</span>.<span class="ruby-identifier">with_recursive</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">ds</span>, <span class="ruby-identifier">recursive</span>, <span class="ruby-identifier">opts</span>)
<span class="line-num">1143</span>   <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">hoist_cte?</span>(<span class="ruby-identifier">recursive</span>)
<span class="line-num">1144</span>     <span class="ruby-identifier">s</span>, <span class="ruby-identifier">ds</span> = <span class="ruby-identifier">hoist_cte</span>(<span class="ruby-identifier">recursive</span>)
<span class="line-num">1145</span>     <span class="ruby-identifier">s</span>.<span class="ruby-identifier">with_recursive</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">nonrecursive</span>, <span class="ruby-identifier">ds</span>, <span class="ruby-identifier">opts</span>)
<span class="line-num">1146</span>   <span class="ruby-keyword">else</span>
<span class="line-num">1147</span>     <span class="ruby-identifier">clone</span>(<span class="ruby-value">:with</span><span class="ruby-operator">=&gt;</span>((<span class="ruby-ivar">@opts</span>[<span class="ruby-value">:with</span>]<span class="ruby-operator">||</span><span class="ruby-constant">EMPTY_ARRAY</span>) <span class="ruby-operator">+</span> [<span class="ruby-constant">Hash</span>[<span class="ruby-identifier">opts</span>].<span class="ruby-identifier">merge!</span>(<span class="ruby-value">:recursive</span><span class="ruby-operator">=&gt;</span><span class="ruby-keyword">true</span>, <span class="ruby-value">:name</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">name</span>, <span class="ruby-value">:dataset</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">nonrecursive</span>.<span class="ruby-identifier">union</span>(<span class="ruby-identifier">recursive</span>, {<span class="ruby-value">:all</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">opts</span>[<span class="ruby-value">:union_all</span>] <span class="ruby-operator">!=</span> <span class="ruby-keyword">false</span>, <span class="ruby-value">:from_self</span><span class="ruby-operator">=&gt;</span><span class="ruby-keyword">false</span>}))]).<span class="ruby-identifier">freeze</span>)
<span class="line-num">1148</span>   <span class="ruby-keyword">end</span>
<span class="line-num">1149</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-with_row_proc" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">with_row_proc</span><span
            class="method-args">(callable)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns a cloned dataset with the given row_proc.</p>

<pre class="ruby"><span class="ruby-identifier">ds</span> = <span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>]
<span class="ruby-identifier">ds</span>.<span class="ruby-identifier">all</span> <span class="ruby-comment"># =&gt; [{:id=&gt;2}]</span>
<span class="ruby-identifier">ds</span>.<span class="ruby-identifier">with_row_proc</span>(<span class="ruby-value">:invert</span>.<span class="ruby-identifier">to_proc</span>).<span class="ruby-identifier">all</span> <span class="ruby-comment"># =&gt; [{2=&gt;:id}]</span>
</pre>
          
          

          
          <div class="method-source-code" id="with_row_proc-source">
            <pre>     <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">1179</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">with_row_proc</span>(<span class="ruby-identifier">callable</span>)
<span class="line-num">1180</span>   <span class="ruby-identifier">clone</span>(<span class="ruby-value">:row_proc</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">callable</span>)
<span class="line-num">1181</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-with_sql" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">with_sql</span><span
            class="method-args">(sql, *args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns a copy of the dataset with the static <a href="SQL.html"><code>SQL</code></a> used.  This is useful if you want to keep the same row_proc/graph, but change the <a href="SQL.html"><code>SQL</code></a> used to custom <a href="SQL.html"><code>SQL</code></a>.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">with_sql</span>(<span class="ruby-string">&#39;SELECT * FROM foo&#39;</span>) <span class="ruby-comment"># SELECT * FROM foo</span>
</pre>

<p>You can use placeholders in your <a href="SQL.html"><code>SQL</code></a> and provide arguments for those placeholders:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">with_sql</span>(<span class="ruby-string">&#39;SELECT ? FROM foo&#39;</span>, <span class="ruby-value">1</span>) <span class="ruby-comment"># SELECT 1 FROM foo</span>
</pre>

<p>You can also provide a method name and arguments to call to get the SQL:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">with_sql</span>(<span class="ruby-value">:insert_sql</span>, <span class="ruby-value">:b</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">1</span>) <span class="ruby-comment"># INSERT INTO items (b) VALUES (1)</span>
</pre>

<p>Note that datasets that specify custom <a href="SQL.html"><code>SQL</code></a> using this method will generally ignore future dataset methods that modify the <a href="SQL.html"><code>SQL</code></a> used, as specifying custom <a href="SQL.html"><code>SQL</code></a> overrides Sequel&#39;s <a href="SQL.html"><code>SQL</code></a> generator.  You should probably limit yourself to the following dataset methods when using this method, or use the implicit_subquery extension:</p>
<ul><li>
<p>each</p>
</li><li>
<p>all</p>
</li><li>
<p><a href="Dataset.html#method-i-single_record"><code>single_record</code></a> (if only one record could be returned)</p>
</li><li>
<p><a href="Dataset.html#method-i-single_value"><code>single_value</code></a> (if only one record could be returned, and a single column is selected)</p>
</li><li>
<p>map</p>
</li><li>
<p><a href="Dataset.html#method-i-as_hash"><code>as_hash</code></a></p>
</li><li>
<p><a href="Dataset.html#method-i-to_hash"><code>to_hash</code></a></p>
</li><li>
<p><a href="Dataset.html#method-i-to_hash_groups"><code>to_hash_groups</code></a></p>
</li><li>
<p>delete (if a DELETE statement)</p>
</li><li>
<p>update (if an UPDATE statement, with no arguments)</p>
</li><li>
<p>insert (if an INSERT statement, with no arguments)</p>
</li><li>
<p>truncate (if a TRUNCATE statement, with no arguments)</p>
</li></ul>
          
          

          
          <div class="method-source-code" id="with_sql-source">
            <pre>     <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">1213</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">with_sql</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
<span class="line-num">1214</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">sql</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Symbol</span>)
<span class="line-num">1215</span>     <span class="ruby-identifier">sql</span> = <span class="ruby-identifier">public_send</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
<span class="line-num">1216</span>   <span class="ruby-keyword">else</span>
<span class="line-num">1217</span>     <span class="ruby-identifier">sql</span> = <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">PlaceholderLiteralString</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">args</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">empty?</span>
<span class="line-num">1218</span>   <span class="ruby-keyword">end</span>
<span class="line-num">1219</span>   <span class="ruby-identifier">clone</span>(<span class="ruby-value">:sql</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">sql</span>)
<span class="line-num">1220</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="protected-instance-1+-+Methods+that+return+modified+datasets-method-details" class="method-section">
       <header>
         <h3>Protected Instance Methods</h3>
       </header>

    
      <div id="method-i-compound_clone" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">compound_clone</span><span
            class="method-args">(type, dataset, opts)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Add the dataset to the list of compounds</p>
          
          

          
          <div class="method-source-code" id="compound_clone-source">
            <pre>     <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">1225</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">compound_clone</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">dataset</span>, <span class="ruby-identifier">opts</span>)
<span class="line-num">1226</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Dataset</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">opts</span>[<span class="ruby-value">:with</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">supports_cte_in_compounds?</span>
<span class="line-num">1227</span>     <span class="ruby-identifier">s</span>, <span class="ruby-identifier">ds</span> = <span class="ruby-identifier">hoist_cte</span>(<span class="ruby-identifier">dataset</span>)
<span class="line-num">1228</span>     <span class="ruby-keyword">return</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">compound_clone</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">ds</span>, <span class="ruby-identifier">opts</span>)
<span class="line-num">1229</span>   <span class="ruby-keyword">end</span>
<span class="line-num">1230</span>   <span class="ruby-identifier">ds</span> = <span class="ruby-identifier">compound_from_self</span>.<span class="ruby-identifier">clone</span>(<span class="ruby-value">:compounds</span><span class="ruby-operator">=&gt;</span>(<span class="ruby-constant">Array</span>(<span class="ruby-ivar">@opts</span>[<span class="ruby-value">:compounds</span>]).<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:dup</span>) <span class="ruby-operator">+</span> [[<span class="ruby-identifier">type</span>, <span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">compound_from_self</span>, <span class="ruby-identifier">opts</span>[<span class="ruby-value">:all</span>]].<span class="ruby-identifier">freeze</span>]).<span class="ruby-identifier">freeze</span>)
<span class="line-num">1231</span>   <span class="ruby-identifier">opts</span>[<span class="ruby-value">:from_self</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword">false</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">ds</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">from_self</span>(<span class="ruby-identifier">opts</span>)
<span class="line-num">1232</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-options_overlap" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">options_overlap</span><span
            class="method-args">(opts)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Return true if the dataset has a non-nil value for any key in opts.</p>
          
          

          
          <div class="method-source-code" id="options_overlap-source">
            <pre>     <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">1235</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">options_overlap</span>(<span class="ruby-identifier">opts</span>)
<span class="line-num">1236</span>   <span class="ruby-operator">!</span>(<span class="ruby-ivar">@opts</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">k</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">nil?</span>}.<span class="ruby-identifier">compact</span> <span class="ruby-operator">&amp;</span> <span class="ruby-identifier">opts</span>).<span class="ruby-identifier">empty?</span>
<span class="line-num">1237</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-simple_select_all-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">simple_select_all?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Whether this dataset is a simple select from an underlying table, such as:</p>

<pre>SELECT * FROM table
SELECT table.* FROM table</pre>
          
          

          
          <div class="method-source-code" id="simple_select_all-3F-source">
            <pre>     <span class="ruby-comment"># File lib/sequel/dataset/query.rb</span>
<span class="line-num">1246</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">simple_select_all?</span>
<span class="line-num">1247</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">unless</span> (<span class="ruby-identifier">f</span> = <span class="ruby-ivar">@opts</span>[<span class="ruby-value">:from</span>]) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">f</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
<span class="line-num">1248</span>   <span class="ruby-identifier">o</span> = <span class="ruby-ivar">@opts</span>.<span class="ruby-identifier">reject</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">non_sql_option?</span>(<span class="ruby-identifier">k</span>)}
<span class="line-num">1249</span>   <span class="ruby-identifier">from</span> = <span class="ruby-identifier">f</span>.<span class="ruby-identifier">first</span>
<span class="line-num">1250</span>   <span class="ruby-identifier">from</span> = <span class="ruby-identifier">from</span>.<span class="ruby-identifier">expression</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">from</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">AliasedExpression</span>)
<span class="line-num">1251</span> 
<span class="line-num">1252</span>   <span class="ruby-keyword">if</span> <span class="ruby-constant">SIMPLE_SELECT_ALL_ALLOWED_FROM</span>.<span class="ruby-identifier">any?</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">from</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-identifier">x</span>)}
<span class="line-num">1253</span>     <span class="ruby-keyword">case</span> <span class="ruby-identifier">o</span>.<span class="ruby-identifier">length</span>
<span class="line-num">1254</span>     <span class="ruby-keyword">when</span> <span class="ruby-value">1</span>
<span class="line-num">1255</span>       <span class="ruby-keyword">true</span>
<span class="line-num">1256</span>     <span class="ruby-keyword">when</span> <span class="ruby-value">2</span>
<span class="line-num">1257</span>       (<span class="ruby-identifier">s</span> = <span class="ruby-identifier">o</span>[<span class="ruby-value">:select</span>]) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">ColumnAll</span>)
<span class="line-num">1258</span>     <span class="ruby-keyword">else</span>
<span class="line-num">1259</span>       <span class="ruby-keyword">false</span>
<span class="line-num">1260</span>     <span class="ruby-keyword">end</span>
<span class="line-num">1261</span>   <span class="ruby-keyword">else</span>
<span class="line-num">1262</span>     <span class="ruby-keyword">false</span>
<span class="line-num">1263</span>   <span class="ruby-keyword">end</span>
<span class="line-num">1264</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>

  <section id="2+-+Methods+that+execute+code+on+the+database" class="documentation-section">
    
    <header class="documentation-section-title">
      <h2>
        2 - Methods that execute code on the database
      </h2>
      <span class="section-click-top">
        <a href="#top">&uarr; top</a>
      </span>
    </header>
    

    

    
    <section class="constants-list">
      <header>
        <h3>Constants</h3>
      </header>
      <dl>
      
        <dt id="ACTION_METHODS">ACTION_METHODS
        
        <dd><p>Action methods defined by <a href="../Sequel.html"><code>Sequel</code></a> that execute code on the database.</p>
        
      
        <dt id="COLUMNS_CLONE_OPTIONS">COLUMNS_CLONE_OPTIONS
        
        <dd><p>The clone options to use when retrieving columns for a dataset.</p>
        
      
        <dt id="COUNT_SELECT">COUNT_SELECT
        
        <dd>
        
      
        <dt id="EMPTY_SELECT">EMPTY_SELECT
        
        <dd>
        
      
      </dl>
    </section>
    

    

    
     <section id="public-instance-2+-+Methods+that+execute+code+on+the+database-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-3C-3C" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">&lt;&lt;</span><span
            class="method-args">(arg)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Inserts the given argument into the database.  Returns self so it can be used safely when chaining:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>] <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">id:</span> <span class="ruby-value">0</span>, <span class="ruby-value">name:</span> <span class="ruby-string">&#39;Zero&#39;</span>} <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">DB</span>[<span class="ruby-value">:old_items</span>].<span class="ruby-identifier">select</span>(<span class="ruby-value">:id</span>, <span class="ruby-identifier">name</span>)
</pre>
          
          

          
          <div class="method-source-code" id="3C-3C-source">
            <pre>   <span class="ruby-comment"># File lib/sequel/dataset/actions.rb</span>
<span class="line-num">28</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">&lt;&lt;</span>(<span class="ruby-identifier">arg</span>)
<span class="line-num">29</span>   <span class="ruby-identifier">insert</span>(<span class="ruby-identifier">arg</span>)
<span class="line-num">30</span>   <span class="ruby-keyword">self</span>
<span class="line-num">31</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-5B-5D" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">[]</span><span
            class="method-args">(*conditions)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns the first record matching the conditions. Examples:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>][<span class="ruby-value">id:</span> <span class="ruby-value">1</span>] <span class="ruby-comment"># SELECT * FROM table WHERE (id = 1) LIMIT 1</span>
<span class="ruby-comment"># =&gt; {:id=&gt;1}</span>
</pre>
          
          

          
          <div class="method-source-code" id="5B-5D-source">
            <pre>   <span class="ruby-comment"># File lib/sequel/dataset/actions.rb</span>
<span class="line-num">37</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">[]</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">conditions</span>)
<span class="line-num">38</span>   <span class="ruby-identifier">raise</span>(<span class="ruby-constant">Error</span>, <span class="ruby-string">&#39;You cannot call Dataset#[] with an integer or with no arguments&#39;</span>) <span class="ruby-keyword">if</span> (<span class="ruby-identifier">conditions</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">conditions</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Integer</span>)) <span class="ruby-keyword">or</span> <span class="ruby-identifier">conditions</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
<span class="line-num">39</span>   <span class="ruby-identifier">first</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">conditions</span>)
<span class="line-num">40</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-all" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">all</span><span
            class="method-args">(&amp;block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns an array with all records in the dataset. If a block is given, the array is iterated over after all items have been loaded.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">all</span> <span class="ruby-comment"># SELECT * FROM table</span>
<span class="ruby-comment"># =&gt; [{:id=&gt;1, ...}, {:id=&gt;2, ...}, ...]</span>

<span class="ruby-comment"># Iterate over all rows in the table</span>
<span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">all</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span> <span class="ruby-identifier">p</span> <span class="ruby-identifier">row</span>}
</pre>
          
          

          
          <div class="method-source-code" id="all-source">
            <pre>   <span class="ruby-comment"># File lib/sequel/dataset/actions.rb</span>
<span class="line-num">50</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">all</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">51</span>   <span class="ruby-identifier">_all</span>(<span class="ruby-identifier">block</span>){<span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span> <span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-identifier">a</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">r</span>}}
<span class="line-num">52</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-as_hash" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">as_hash</span><span
            class="method-args">(key_column, value_column = nil, opts = OPTS)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns a hash with one column used as key and another used as value. If rows have duplicate values for the key column, the latter row(s) will overwrite the value of the previous row(s). If the value_column is not given or nil, uses the entire hash as the value.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">as_hash</span>(<span class="ruby-value">:id</span>, <span class="ruby-value">:name</span>) <span class="ruby-comment"># SELECT * FROM table</span>
<span class="ruby-comment"># {1=&gt;&#39;Jim&#39;, 2=&gt;&#39;Bob&#39;, ...}</span>

<span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">as_hash</span>(<span class="ruby-value">:id</span>) <span class="ruby-comment"># SELECT * FROM table</span>
<span class="ruby-comment"># {1=&gt;{:id=&gt;1, :name=&gt;&#39;Jim&#39;}, 2=&gt;{:id=&gt;2, :name=&gt;&#39;Bob&#39;}, ...}</span>
</pre>

<p>You can also provide an array of column names for either the key_column, the value column, or both:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">as_hash</span>([<span class="ruby-value">:id</span>, <span class="ruby-value">:foo</span>], [<span class="ruby-value">:name</span>, <span class="ruby-value">:bar</span>]) <span class="ruby-comment"># SELECT * FROM table</span>
<span class="ruby-comment"># {[1, 3]=&gt;[&#39;Jim&#39;, &#39;bo&#39;], [2, 4]=&gt;[&#39;Bob&#39;, &#39;be&#39;], ...}</span>

<span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">as_hash</span>([<span class="ruby-value">:id</span>, <span class="ruby-value">:name</span>]) <span class="ruby-comment"># SELECT * FROM table</span>
<span class="ruby-comment"># {[1, &#39;Jim&#39;]=&gt;{:id=&gt;1, :name=&gt;&#39;Jim&#39;}, [2, &#39;Bob&#39;]=&gt;{:id=&gt;2, :name=&gt;&#39;Bob&#39;}, ...}</span>
</pre>

<p>Options:</p>
<dl class="rdoc-list note-list"><dt>:all 
<dd>
<p>Use all instead of each to retrieve the objects</p>
</dd><dt>:hash 
<dd>
<p>The object into which the values will be placed.  If this is not given, an empty hash is used.  This can be used to use a hash with a default value or default proc.</p>
</dd></dl>
          
          

          
          <div class="method-source-code" id="as_hash-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/actions.rb</span>
<span class="line-num">774</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">as_hash</span>(<span class="ruby-identifier">key_column</span>, <span class="ruby-identifier">value_column</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">opts</span> = <span class="ruby-constant">OPTS</span>)
<span class="line-num">775</span>   <span class="ruby-identifier">h</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:hash</span>] <span class="ruby-operator">||</span> {}
<span class="line-num">776</span>   <span class="ruby-identifier">meth</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:all</span>] <span class="ruby-operator">?</span> <span class="ruby-value">:all</span> <span class="ruby-operator">:</span> <span class="ruby-value">:each</span>
<span class="line-num">777</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">value_column</span>
<span class="line-num">778</span>     <span class="ruby-keyword">return</span> <span class="ruby-identifier">naked</span>.<span class="ruby-identifier">as_hash</span>(<span class="ruby-identifier">key_column</span>, <span class="ruby-identifier">value_column</span>, <span class="ruby-identifier">opts</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">row_proc</span>
<span class="line-num">779</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">value_column</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)
<span class="line-num">780</span>       <span class="ruby-keyword">if</span> <span class="ruby-identifier">key_column</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)
<span class="line-num">781</span>         <span class="ruby-identifier">public_send</span>(<span class="ruby-identifier">meth</span>){<span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">r</span>.<span class="ruby-identifier">values_at</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">key_column</span>)] = <span class="ruby-identifier">r</span>.<span class="ruby-identifier">values_at</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">value_column</span>)}
<span class="line-num">782</span>       <span class="ruby-keyword">else</span>
<span class="line-num">783</span>         <span class="ruby-identifier">public_send</span>(<span class="ruby-identifier">meth</span>){<span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">r</span>[<span class="ruby-identifier">key_column</span>]] = <span class="ruby-identifier">r</span>.<span class="ruby-identifier">values_at</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">value_column</span>)}
<span class="line-num">784</span>       <span class="ruby-keyword">end</span>
<span class="line-num">785</span>     <span class="ruby-keyword">else</span>
<span class="line-num">786</span>       <span class="ruby-keyword">if</span> <span class="ruby-identifier">key_column</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)
<span class="line-num">787</span>         <span class="ruby-identifier">public_send</span>(<span class="ruby-identifier">meth</span>){<span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">r</span>.<span class="ruby-identifier">values_at</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">key_column</span>)] = <span class="ruby-identifier">r</span>[<span class="ruby-identifier">value_column</span>]}
<span class="line-num">788</span>       <span class="ruby-keyword">else</span>
<span class="line-num">789</span>         <span class="ruby-identifier">public_send</span>(<span class="ruby-identifier">meth</span>){<span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">r</span>[<span class="ruby-identifier">key_column</span>]] = <span class="ruby-identifier">r</span>[<span class="ruby-identifier">value_column</span>]}
<span class="line-num">790</span>       <span class="ruby-keyword">end</span>
<span class="line-num">791</span>     <span class="ruby-keyword">end</span>
<span class="line-num">792</span>   <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">key_column</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)
<span class="line-num">793</span>     <span class="ruby-identifier">public_send</span>(<span class="ruby-identifier">meth</span>){<span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">key_column</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">k</span><span class="ruby-operator">|</span> <span class="ruby-identifier">r</span>[<span class="ruby-identifier">k</span>]}] = <span class="ruby-identifier">r</span>}
<span class="line-num">794</span>   <span class="ruby-keyword">else</span>
<span class="line-num">795</span>     <span class="ruby-identifier">public_send</span>(<span class="ruby-identifier">meth</span>){<span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">r</span>[<span class="ruby-identifier">key_column</span>]] = <span class="ruby-identifier">r</span>}
<span class="line-num">796</span>   <span class="ruby-keyword">end</span>
<span class="line-num">797</span>   <span class="ruby-identifier">h</span>
<span class="line-num">798</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-avg" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">avg</span><span
            class="method-args">(arg=(no_arg = true), &amp;block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns the average value for the given column/expression. Uses a virtual row block if no argument is given.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">avg</span>(<span class="ruby-value">:number</span>) <span class="ruby-comment"># SELECT avg(number) FROM table LIMIT 1</span>
<span class="ruby-comment"># =&gt; 3</span>
<span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">avg</span>{<span class="ruby-identifier">function</span>(<span class="ruby-identifier">column</span>)} <span class="ruby-comment"># SELECT avg(function(column)) FROM table LIMIT 1</span>
<span class="ruby-comment"># =&gt; 1</span>
</pre>
          
          

          
          <div class="method-source-code" id="avg-source">
            <pre>   <span class="ruby-comment"># File lib/sequel/dataset/actions.rb</span>
<span class="line-num">61</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">avg</span>(<span class="ruby-identifier">arg</span>=(<span class="ruby-identifier">no_arg</span> = <span class="ruby-keyword">true</span>), <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">62</span>   <span class="ruby-identifier">arg</span> = <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">virtual_row</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">no_arg</span>
<span class="line-num">63</span>   <span class="ruby-identifier">_aggregate</span>(<span class="ruby-value">:avg</span>, <span class="ruby-identifier">arg</span>)
<span class="line-num">64</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-columns" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">columns</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns the columns in the result set in order as an array of symbols. If the columns are currently cached, returns the cached value. Otherwise, a SELECT query is performed to retrieve a single row in order to get the columns.</p>

<p>If you are looking for all columns for a single table and maybe some information about each column (e.g. database type), see <code>Database#schema</code>.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">columns</span>
<span class="ruby-comment"># =&gt; [:id, :name]</span>
</pre>
          
          

          
          <div class="method-source-code" id="columns-source">
            <pre>   <span class="ruby-comment"># File lib/sequel/dataset/actions.rb</span>
<span class="line-num">75</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">columns</span>
<span class="line-num">76</span>   <span class="ruby-identifier">_columns</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">columns!</span>
<span class="line-num">77</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-columns-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">columns!</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Ignore any cached column information and perform a query to retrieve a row in order to get the columns.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">columns!</span>
<span class="ruby-comment"># =&gt; [:id, :name]</span>
</pre>
          
          

          
          <div class="method-source-code" id="columns-21-source">
            <pre>   <span class="ruby-comment"># File lib/sequel/dataset/actions.rb</span>
<span class="line-num">84</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">columns!</span>
<span class="line-num">85</span>   <span class="ruby-identifier">ds</span> = <span class="ruby-identifier">clone</span>(<span class="ruby-constant">COLUMNS_CLONE_OPTIONS</span>)
<span class="line-num">86</span>   <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">each</span>{<span class="ruby-keyword">break</span>}
<span class="line-num">87</span> 
<span class="line-num">88</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">cols</span> = <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">cache</span>[<span class="ruby-value">:_columns</span>]
<span class="line-num">89</span>     <span class="ruby-keyword">self</span>.<span class="ruby-identifier">columns</span> = <span class="ruby-identifier">cols</span>
<span class="line-num">90</span>   <span class="ruby-keyword">else</span>
<span class="line-num">91</span>     []
<span class="line-num">92</span>   <span class="ruby-keyword">end</span>
<span class="line-num">93</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-count" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">count</span><span
            class="method-args">(arg=(no_arg=true), &amp;block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns the number of records in the dataset. If an argument is provided, it is used as the argument to count.  If a block is provided, it is treated as a virtual row, and the result is used as the argument to count.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">count</span> <span class="ruby-comment"># SELECT count(*) AS count FROM table LIMIT 1</span>
<span class="ruby-comment"># =&gt; 3</span>
<span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">count</span>(<span class="ruby-value">:column</span>) <span class="ruby-comment"># SELECT count(column) AS count FROM table LIMIT 1</span>
<span class="ruby-comment"># =&gt; 2</span>
<span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">count</span>{<span class="ruby-identifier">foo</span>(<span class="ruby-identifier">column</span>)} <span class="ruby-comment"># SELECT count(foo(column)) AS count FROM table LIMIT 1</span>
<span class="ruby-comment"># =&gt; 1</span>
</pre>
          
          

          
          <div class="method-source-code" id="count-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/actions.rb</span>
<span class="line-num">108</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">count</span>(<span class="ruby-identifier">arg</span>=(<span class="ruby-identifier">no_arg</span>=<span class="ruby-keyword">true</span>), <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">109</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">no_arg</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">block</span>
<span class="line-num">110</span>     <span class="ruby-identifier">cached_dataset</span>(<span class="ruby-value">:_count_ds</span>) <span class="ruby-keyword">do</span>
<span class="line-num">111</span>       <span class="ruby-identifier">aggregate_dataset</span>.<span class="ruby-identifier">select</span>(<span class="ruby-constant">COUNT_SELECT</span>).<span class="ruby-identifier">single_value_ds</span>
<span class="line-num">112</span>     <span class="ruby-keyword">end</span>.<span class="ruby-identifier">single_value!</span>.<span class="ruby-identifier">to_i</span>
<span class="line-num">113</span>   <span class="ruby-keyword">else</span>
<span class="line-num">114</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">block</span>
<span class="line-num">115</span>       <span class="ruby-keyword">if</span> <span class="ruby-identifier">no_arg</span>
<span class="line-num">116</span>         <span class="ruby-identifier">arg</span> = <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">virtual_row</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">117</span>       <span class="ruby-keyword">else</span>
<span class="line-num">118</span>         <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-string">&#39;cannot provide both argument and block to Dataset#count&#39;</span>
<span class="line-num">119</span>       <span class="ruby-keyword">end</span>
<span class="line-num">120</span>     <span class="ruby-keyword">end</span>
<span class="line-num">121</span> 
<span class="line-num">122</span>     <span class="ruby-identifier">_aggregate</span>(<span class="ruby-value">:count</span>, <span class="ruby-identifier">arg</span>)
<span class="line-num">123</span>   <span class="ruby-keyword">end</span>
<span class="line-num">124</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-delete" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">delete</span><span
            class="method-args">(&amp;block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Deletes the records in the dataset, returning the number of records deleted.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">delete</span> <span class="ruby-comment"># DELETE * FROM table</span>
<span class="ruby-comment"># =&gt; 3</span>
</pre>
          
          

          
          <div class="method-source-code" id="delete-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/actions.rb</span>
<span class="line-num">130</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">delete</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">131</span>   <span class="ruby-identifier">sql</span> = <span class="ruby-identifier">delete_sql</span>
<span class="line-num">132</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">uses_returning?</span>(<span class="ruby-value">:delete</span>)
<span class="line-num">133</span>     <span class="ruby-identifier">returning_fetch_rows</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">134</span>   <span class="ruby-keyword">else</span>
<span class="line-num">135</span>     <span class="ruby-identifier">execute_dui</span>(<span class="ruby-identifier">sql</span>)
<span class="line-num">136</span>   <span class="ruby-keyword">end</span>
<span class="line-num">137</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-each" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">each</span><span
            class="method-args">() { |call| ... }</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Iterates over the records in the dataset as they are yielded from the database adapter, and returns self.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span> <span class="ruby-identifier">p</span> <span class="ruby-identifier">row</span>} <span class="ruby-comment"># SELECT * FROM table</span>
</pre>

<p>Note that this method is not safe to use on many adapters if you are running additional queries inside the provided block.  If you are running queries inside the block, you should use <code>all</code> instead of <code>each</code> for the outer queries, or use a separate thread or shard inside <code>each</code>.</p>
          
          

          
          <div class="method-source-code" id="each-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/actions.rb</span>
<span class="line-num">148</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">each</span>
<span class="line-num">149</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">rp</span> = <span class="ruby-identifier">row_proc</span>
<span class="line-num">150</span>     <span class="ruby-identifier">fetch_rows</span>(<span class="ruby-identifier">select_sql</span>){<span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-keyword">yield</span> <span class="ruby-identifier">rp</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">r</span>)}
<span class="line-num">151</span>   <span class="ruby-keyword">else</span>
<span class="line-num">152</span>     <span class="ruby-identifier">fetch_rows</span>(<span class="ruby-identifier">select_sql</span>){<span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-keyword">yield</span> <span class="ruby-identifier">r</span>}
<span class="line-num">153</span>   <span class="ruby-keyword">end</span>
<span class="line-num">154</span>   <span class="ruby-keyword">self</span>
<span class="line-num">155</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-empty-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">empty?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns true if no records exist in the dataset, false otherwise</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">empty?</span> <span class="ruby-comment"># SELECT 1 AS one FROM table LIMIT 1</span>
<span class="ruby-comment"># =&gt; false</span>
</pre>
          
          

          
          <div class="method-source-code" id="empty-3F-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/actions.rb</span>
<span class="line-num">163</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">empty?</span>
<span class="line-num">164</span>   <span class="ruby-identifier">cached_dataset</span>(<span class="ruby-value">:_empty_ds</span>) <span class="ruby-keyword">do</span>
<span class="line-num">165</span>     <span class="ruby-identifier">single_value_ds</span>.<span class="ruby-identifier">unordered</span>.<span class="ruby-identifier">select</span>(<span class="ruby-constant">EMPTY_SELECT</span>)
<span class="line-num">166</span>   <span class="ruby-keyword">end</span>.<span class="ruby-identifier">single_value!</span>.<span class="ruby-identifier">nil?</span>
<span class="line-num">167</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-first" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">first</span><span
            class="method-args">(*args, &amp;block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns the first matching record if no arguments are given. If a integer argument is given, it is interpreted as a limit, and then returns all  matching records up to that limit.  If any other type of argument(s) is passed, it is treated as a filter and the first matching record is returned.  If a block is given, it is used to filter the dataset before returning anything.</p>

<p>If there are no records in the dataset, returns nil (or an empty array if an integer argument is given).</p>

<p>Examples:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">first</span> <span class="ruby-comment"># SELECT * FROM table LIMIT 1</span>
<span class="ruby-comment"># =&gt; {:id=&gt;7}</span>

<span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">first</span>(<span class="ruby-value">2</span>) <span class="ruby-comment"># SELECT * FROM table LIMIT 2</span>
<span class="ruby-comment"># =&gt; [{:id=&gt;6}, {:id=&gt;4}]</span>

<span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">first</span>(<span class="ruby-value">id:</span> <span class="ruby-value">2</span>) <span class="ruby-comment"># SELECT * FROM table WHERE (id = 2) LIMIT 1</span>
<span class="ruby-comment"># =&gt; {:id=&gt;2}</span>

<span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">first</span>(<span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">lit</span>(<span class="ruby-string">&quot;id = 3&quot;</span>)) <span class="ruby-comment"># SELECT * FROM table WHERE (id = 3) LIMIT 1</span>
<span class="ruby-comment"># =&gt; {:id=&gt;3}</span>

<span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">first</span>(<span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">lit</span>(<span class="ruby-string">&quot;id = ?&quot;</span>, <span class="ruby-value">4</span>)) <span class="ruby-comment"># SELECT * FROM table WHERE (id = 4) LIMIT 1</span>
<span class="ruby-comment"># =&gt; {:id=&gt;4}</span>

<span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">first</span>{<span class="ruby-identifier">id</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">2</span>} <span class="ruby-comment"># SELECT * FROM table WHERE (id &gt; 2) LIMIT 1</span>
<span class="ruby-comment"># =&gt; {:id=&gt;5}</span>

<span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">first</span>(<span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">lit</span>(<span class="ruby-string">&quot;id &gt; ?&quot;</span>, <span class="ruby-value">4</span>)){<span class="ruby-identifier">id</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">6</span>} <span class="ruby-comment"># SELECT * FROM table WHERE ((id &gt; 4) AND (id &lt; 6)) LIMIT 1</span>
<span class="ruby-comment"># =&gt; {:id=&gt;5}</span>

<span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">first</span>(<span class="ruby-value">2</span>){<span class="ruby-identifier">id</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">2</span>} <span class="ruby-comment"># SELECT * FROM table WHERE (id &lt; 2) LIMIT 2</span>
<span class="ruby-comment"># =&gt; [{:id=&gt;1}]</span>
</pre>
          
          

          
          <div class="method-source-code" id="first-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/actions.rb</span>
<span class="line-num">204</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">first</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">205</span>   <span class="ruby-keyword">case</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">length</span>
<span class="line-num">206</span>   <span class="ruby-keyword">when</span> <span class="ruby-value">0</span>
<span class="line-num">207</span>     <span class="ruby-keyword">unless</span> <span class="ruby-identifier">block</span>
<span class="line-num">208</span>       <span class="ruby-keyword">return</span> <span class="ruby-identifier">single_record</span>
<span class="line-num">209</span>     <span class="ruby-keyword">end</span>
<span class="line-num">210</span>   <span class="ruby-keyword">when</span> <span class="ruby-value">1</span>
<span class="line-num">211</span>     <span class="ruby-identifier">arg</span> = <span class="ruby-identifier">args</span>[<span class="ruby-value">0</span>]
<span class="line-num">212</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Integer</span>)
<span class="line-num">213</span>       <span class="ruby-identifier">res</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">block</span>
<span class="line-num">214</span>         <span class="ruby-keyword">if</span> <span class="ruby-identifier">loader</span> = <span class="ruby-identifier">cached_placeholder_literalizer</span>(<span class="ruby-value">:_first_integer_cond_loader</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">pl</span><span class="ruby-operator">|</span>
<span class="line-num">215</span>             <span class="ruby-identifier">where</span>(<span class="ruby-identifier">pl</span>.<span class="ruby-identifier">arg</span>).<span class="ruby-identifier">limit</span>(<span class="ruby-identifier">pl</span>.<span class="ruby-identifier">arg</span>)
<span class="line-num">216</span>           <span class="ruby-keyword">end</span>
<span class="line-num">217</span> 
<span class="line-num">218</span>           <span class="ruby-identifier">loader</span>.<span class="ruby-identifier">all</span>(<span class="ruby-identifier">filter_expr</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>), <span class="ruby-identifier">arg</span>)
<span class="line-num">219</span>         <span class="ruby-keyword">else</span>
<span class="line-num">220</span>           <span class="ruby-identifier">where</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>).<span class="ruby-identifier">limit</span>(<span class="ruby-identifier">arg</span>).<span class="ruby-identifier">all</span>
<span class="line-num">221</span>         <span class="ruby-keyword">end</span>
<span class="line-num">222</span>       <span class="ruby-keyword">else</span>
<span class="line-num">223</span>         <span class="ruby-keyword">if</span> <span class="ruby-identifier">loader</span> = <span class="ruby-identifier">cached_placeholder_literalizer</span>(<span class="ruby-value">:_first_integer_loader</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">pl</span><span class="ruby-operator">|</span>
<span class="line-num">224</span>            <span class="ruby-identifier">limit</span>(<span class="ruby-identifier">pl</span>.<span class="ruby-identifier">arg</span>)
<span class="line-num">225</span>           <span class="ruby-keyword">end</span>
<span class="line-num">226</span> 
<span class="line-num">227</span>           <span class="ruby-identifier">loader</span>.<span class="ruby-identifier">all</span>(<span class="ruby-identifier">arg</span>)
<span class="line-num">228</span>         <span class="ruby-keyword">else</span>
<span class="line-num">229</span>           <span class="ruby-identifier">limit</span>(<span class="ruby-identifier">arg</span>).<span class="ruby-identifier">all</span>
<span class="line-num">230</span>         <span class="ruby-keyword">end</span>
<span class="line-num">231</span>       <span class="ruby-keyword">end</span>
<span class="line-num">232</span> 
<span class="line-num">233</span>       <span class="ruby-keyword">return</span> <span class="ruby-identifier">res</span>
<span class="line-num">234</span>     <span class="ruby-keyword">end</span>
<span class="line-num">235</span>     <span class="ruby-identifier">where_args</span> = <span class="ruby-identifier">args</span>
<span class="line-num">236</span>     <span class="ruby-identifier">args</span> = <span class="ruby-identifier">arg</span>
<span class="line-num">237</span>   <span class="ruby-keyword">end</span>
<span class="line-num">238</span> 
<span class="line-num">239</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">loader</span> = <span class="ruby-identifier">cached_where_placeholder_literalizer</span>(<span class="ruby-identifier">where_args</span><span class="ruby-operator">||</span><span class="ruby-identifier">args</span>, <span class="ruby-identifier">block</span>, <span class="ruby-value">:_first_cond_loader</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">pl</span><span class="ruby-operator">|</span>
<span class="line-num">240</span>       <span class="ruby-identifier">_single_record_ds</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">pl</span>.<span class="ruby-identifier">arg</span>)
<span class="line-num">241</span>     <span class="ruby-keyword">end</span>
<span class="line-num">242</span> 
<span class="line-num">243</span>     <span class="ruby-identifier">loader</span>.<span class="ruby-identifier">first</span>(<span class="ruby-identifier">filter_expr</span>(<span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>))
<span class="line-num">244</span>   <span class="ruby-keyword">else</span>
<span class="line-num">245</span>     <span class="ruby-identifier">_single_record_ds</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>).<span class="ruby-identifier">single_record!</span>
<span class="line-num">246</span>   <span class="ruby-keyword">end</span>
<span class="line-num">247</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-first-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">first!</span><span
            class="method-args">(*args, &amp;block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Calls first.  If first returns nil (signaling that no row matches), raise a <a href="NoMatchingRow.html"><code>Sequel::NoMatchingRow</code></a> exception.</p>
          
          

          
          <div class="method-source-code" id="first-21-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/actions.rb</span>
<span class="line-num">251</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">first!</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">252</span>   <span class="ruby-identifier">first</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">raise</span>(<span class="ruby-constant">Sequel</span><span class="ruby-operator">::</span><span class="ruby-constant">NoMatchingRow</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword">self</span>))
<span class="line-num">253</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get</span><span
            class="method-args">(column=(no_arg=true; nil), &amp;block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Return the column value for the first matching record in the dataset. Raises an error if both an argument and block is given.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">get</span>(<span class="ruby-value">:id</span>) <span class="ruby-comment"># SELECT id FROM table LIMIT 1</span>
<span class="ruby-comment"># =&gt; 3</span>

<span class="ruby-identifier">ds</span>.<span class="ruby-identifier">get</span>{<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">id</span>)} <span class="ruby-comment"># SELECT sum(id) AS v FROM table LIMIT 1</span>
<span class="ruby-comment"># =&gt; 6</span>
</pre>

<p>You can pass an array of arguments to return multiple arguments, but you must make sure each element in the array has an alias that <a href="../Sequel.html"><code>Sequel</code></a> can determine:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">get</span>([<span class="ruby-value">:id</span>, <span class="ruby-value">:name</span>]) <span class="ruby-comment"># SELECT id, name FROM table LIMIT 1</span>
<span class="ruby-comment"># =&gt; [3, &#39;foo&#39;]</span>

<span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">get</span>{[<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">id</span>).<span class="ruby-identifier">as</span>(<span class="ruby-identifier">sum</span>), <span class="ruby-identifier">name</span>]} <span class="ruby-comment"># SELECT sum(id) AS sum, name FROM table LIMIT 1</span>
<span class="ruby-comment"># =&gt; [6, &#39;foo&#39;]</span>
</pre>
          
          

          
          <div class="method-source-code" id="get-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/actions.rb</span>
<span class="line-num">273</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">get</span>(<span class="ruby-identifier">column</span>=(<span class="ruby-identifier">no_arg</span>=<span class="ruby-keyword">true</span>; <span class="ruby-keyword">nil</span>), <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">274</span>   <span class="ruby-identifier">ds</span> = <span class="ruby-identifier">naked</span>
<span class="line-num">275</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">block</span>
<span class="line-num">276</span>     <span class="ruby-identifier">raise</span>(<span class="ruby-constant">Error</span>, <span class="ruby-string">&#39;Must call Dataset#get with an argument or a block, not both&#39;</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">no_arg</span>
<span class="line-num">277</span>     <span class="ruby-identifier">ds</span> = <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">select</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">278</span>     <span class="ruby-identifier">column</span> = <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">opts</span>[<span class="ruby-value">:select</span>]
<span class="line-num">279</span>     <span class="ruby-identifier">column</span> = <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">column</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">column</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">2</span>
<span class="line-num">280</span>   <span class="ruby-keyword">else</span>
<span class="line-num">281</span>     <span class="ruby-keyword">case</span> <span class="ruby-identifier">column</span>
<span class="line-num">282</span>     <span class="ruby-keyword">when</span> <span class="ruby-constant">Array</span>
<span class="line-num">283</span>       <span class="ruby-identifier">ds</span> = <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">select</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">column</span>)
<span class="line-num">284</span>     <span class="ruby-keyword">when</span> <span class="ruby-constant">LiteralString</span>, <span class="ruby-constant">Symbol</span>, <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">Identifier</span>, <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">QualifiedIdentifier</span>, <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">AliasedExpression</span>
<span class="line-num">285</span>       <span class="ruby-keyword">if</span> <span class="ruby-identifier">loader</span> = <span class="ruby-identifier">cached_placeholder_literalizer</span>(<span class="ruby-value">:_get_loader</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">pl</span><span class="ruby-operator">|</span>
<span class="line-num">286</span>           <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">single_value_ds</span>.<span class="ruby-identifier">select</span>(<span class="ruby-identifier">pl</span>.<span class="ruby-identifier">arg</span>)
<span class="line-num">287</span>         <span class="ruby-keyword">end</span>
<span class="line-num">288</span> 
<span class="line-num">289</span>         <span class="ruby-keyword">return</span> <span class="ruby-identifier">loader</span>.<span class="ruby-identifier">get</span>(<span class="ruby-identifier">column</span>)
<span class="line-num">290</span>       <span class="ruby-keyword">end</span>
<span class="line-num">291</span> 
<span class="line-num">292</span>       <span class="ruby-identifier">ds</span> = <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">select</span>(<span class="ruby-identifier">column</span>)
<span class="line-num">293</span>     <span class="ruby-keyword">else</span>
<span class="line-num">294</span>       <span class="ruby-keyword">if</span> <span class="ruby-identifier">loader</span> = <span class="ruby-identifier">cached_placeholder_literalizer</span>(<span class="ruby-value">:_get_alias_loader</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">pl</span><span class="ruby-operator">|</span>
<span class="line-num">295</span>           <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">single_value_ds</span>.<span class="ruby-identifier">select</span>(<span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">as</span>(<span class="ruby-identifier">pl</span>.<span class="ruby-identifier">arg</span>, <span class="ruby-value">:v</span>))
<span class="line-num">296</span>         <span class="ruby-keyword">end</span>
<span class="line-num">297</span> 
<span class="line-num">298</span>         <span class="ruby-keyword">return</span> <span class="ruby-identifier">loader</span>.<span class="ruby-identifier">get</span>(<span class="ruby-identifier">column</span>)
<span class="line-num">299</span>       <span class="ruby-keyword">end</span>
<span class="line-num">300</span> 
<span class="line-num">301</span>       <span class="ruby-identifier">ds</span> = <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">select</span>(<span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">as</span>(<span class="ruby-identifier">column</span>, <span class="ruby-value">:v</span>))
<span class="line-num">302</span>     <span class="ruby-keyword">end</span>
<span class="line-num">303</span>   <span class="ruby-keyword">end</span>
<span class="line-num">304</span> 
<span class="line-num">305</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">column</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)
<span class="line-num">306</span>    <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span> = <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">single_record</span>
<span class="line-num">307</span>      <span class="ruby-identifier">r</span>.<span class="ruby-identifier">values_at</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">hash_key_symbols</span>(<span class="ruby-identifier">column</span>))
<span class="line-num">308</span>    <span class="ruby-keyword">end</span>
<span class="line-num">309</span>   <span class="ruby-keyword">else</span>
<span class="line-num">310</span>     <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">single_value</span>
<span class="line-num">311</span>   <span class="ruby-keyword">end</span>
<span class="line-num">312</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-import" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">import</span><span
            class="method-args">(columns, values, opts=OPTS)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Inserts multiple records into the associated table. This method can be used to efficiently insert a large number of records into a table in a single query if the database supports it. Inserts are automatically wrapped in a transaction.</p>

<p>This method is called with a columns array and an array of value arrays:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">import</span>([<span class="ruby-value">:x</span>, <span class="ruby-value">:y</span>], [[<span class="ruby-value">1</span>, <span class="ruby-value">2</span>], [<span class="ruby-value">3</span>, <span class="ruby-value">4</span>]])
<span class="ruby-comment"># INSERT INTO table (x, y) VALUES (1, 2)</span>
<span class="ruby-comment"># INSERT INTO table (x, y) VALUES (3, 4)</span>
</pre>

<p>This method also accepts a dataset instead of an array of value arrays:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">import</span>([<span class="ruby-value">:x</span>, <span class="ruby-value">:y</span>], <span class="ruby-constant">DB</span>[<span class="ruby-value">:table2</span>].<span class="ruby-identifier">select</span>(<span class="ruby-value">:a</span>, <span class="ruby-value">:b</span>))
<span class="ruby-comment"># INSERT INTO table (x, y) SELECT a, b FROM table2</span>
</pre>

<p>Options:</p>
<dl class="rdoc-list note-list"><dt>:commit_every 
<dd>
<p>Open a new transaction for every given number of records. For example, if you provide a value of 50, will commit after every 50 records.</p>
</dd><dt>:return 
<dd>
<p>When this is set to :primary_key, returns an array of autoincremented primary key values for the rows inserted. This does not have an effect if <code>values</code> is a <a href="Dataset.html"><code>Dataset</code></a>.</p>
</dd><dt>:server 
<dd>
<p>Set the server/shard to use for the transaction and insert queries.</p>
</dd><dt>:slice 
<dd>
<p>Same as :commit_every, :commit_every takes precedence.</p>
</dd></dl>
          
          

          
          <div class="method-source-code" id="import-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/actions.rb</span>
<span class="line-num">340</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">import</span>(<span class="ruby-identifier">columns</span>, <span class="ruby-identifier">values</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)
<span class="line-num">341</span>   <span class="ruby-keyword">return</span> <span class="ruby-ivar">@db</span>.<span class="ruby-identifier">transaction</span>{<span class="ruby-identifier">insert</span>(<span class="ruby-identifier">columns</span>, <span class="ruby-identifier">values</span>)} <span class="ruby-keyword">if</span> <span class="ruby-identifier">values</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Dataset</span>)
<span class="line-num">342</span> 
<span class="line-num">343</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">values</span>.<span class="ruby-identifier">empty?</span>
<span class="line-num">344</span>   <span class="ruby-identifier">raise</span>(<span class="ruby-constant">Error</span>, <span class="ruby-string">&#39;Using Sequel::Dataset#import with an empty column array is not allowed&#39;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">columns</span>.<span class="ruby-identifier">empty?</span>
<span class="line-num">345</span>   <span class="ruby-identifier">ds</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:server</span>] <span class="ruby-operator">?</span> <span class="ruby-identifier">server</span>(<span class="ruby-identifier">opts</span>[<span class="ruby-value">:server</span>]) <span class="ruby-operator">:</span> <span class="ruby-keyword">self</span>
<span class="line-num">346</span>   
<span class="line-num">347</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">slice_size</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-value">:commit_every</span>, <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-value">:slice</span>, <span class="ruby-identifier">default_import_slice</span>))
<span class="line-num">348</span>     <span class="ruby-identifier">offset</span> = <span class="ruby-value">0</span>
<span class="line-num">349</span>     <span class="ruby-identifier">rows</span> = []
<span class="line-num">350</span>     <span class="ruby-keyword">while</span> <span class="ruby-identifier">offset</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">values</span>.<span class="ruby-identifier">length</span>
<span class="line-num">351</span>       <span class="ruby-identifier">rows</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">_import</span>(<span class="ruby-identifier">columns</span>, <span class="ruby-identifier">values</span>[<span class="ruby-identifier">offset</span>, <span class="ruby-identifier">slice_size</span>], <span class="ruby-identifier">opts</span>)
<span class="line-num">352</span>       <span class="ruby-identifier">offset</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">slice_size</span>
<span class="line-num">353</span>     <span class="ruby-keyword">end</span>
<span class="line-num">354</span>     <span class="ruby-identifier">rows</span>.<span class="ruby-identifier">flatten</span>
<span class="line-num">355</span>   <span class="ruby-keyword">else</span>
<span class="line-num">356</span>     <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">_import</span>(<span class="ruby-identifier">columns</span>, <span class="ruby-identifier">values</span>, <span class="ruby-identifier">opts</span>)
<span class="line-num">357</span>   <span class="ruby-keyword">end</span>
<span class="line-num">358</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-insert" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">insert</span><span
            class="method-args">(*values, &amp;block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Inserts values into the associated table.  The returned value is generally the value of the autoincremented primary key for the inserted row, assuming that a single row is inserted and the table has an autoincrementing primary key.</p>

<p><code>insert</code> handles a number of different argument formats:</p>
<dl class="rdoc-list note-list"><dt>no arguments or single empty hash 
<dd>
<p>Uses <a href="Dataset.html#DEFAULT"><code>DEFAULT</code></a> VALUES</p>
</dd><dt>single hash 
<dd>
<p>Most common format, treats keys as columns and values as values</p>
</dd><dt>single array 
<dd>
<p>Treats entries as values, with no columns</p>
</dd><dt>two arrays 
<dd>
<p>Treats first array as columns, second array as values</p>
</dd><dt>single <a href="Dataset.html"><code>Dataset</code></a> 
<dd>
<p>Treats as an insert based on a selection from the dataset given, with no columns</p>
</dd><dt>array and dataset 
<dd>
<p>Treats as an insert based on a selection from the dataset given, with the columns given by the array.</p>
</dd></dl>

<p>Examples:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">insert</span>
<span class="ruby-comment"># INSERT INTO items DEFAULT VALUES</span>

<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">insert</span>({})
<span class="ruby-comment"># INSERT INTO items DEFAULT VALUES</span>

<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">insert</span>([<span class="ruby-value">1</span>,<span class="ruby-value">2</span>,<span class="ruby-value">3</span>])
<span class="ruby-comment"># INSERT INTO items VALUES (1, 2, 3)</span>

<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">insert</span>([<span class="ruby-value">:a</span>, <span class="ruby-value">:b</span>], [<span class="ruby-value">1</span>,<span class="ruby-value">2</span>])
<span class="ruby-comment"># INSERT INTO items (a, b) VALUES (1, 2)</span>

<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">insert</span>(<span class="ruby-value">a:</span> <span class="ruby-value">1</span>, <span class="ruby-value">b:</span> <span class="ruby-value">2</span>)
<span class="ruby-comment"># INSERT INTO items (a, b) VALUES (1, 2)</span>

<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">insert</span>(<span class="ruby-constant">DB</span>[<span class="ruby-value">:old_items</span>])
<span class="ruby-comment"># INSERT INTO items SELECT * FROM old_items</span>

<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">insert</span>([<span class="ruby-value">:a</span>, <span class="ruby-value">:b</span>], <span class="ruby-constant">DB</span>[<span class="ruby-value">:old_items</span>])
<span class="ruby-comment"># INSERT INTO items (a, b) SELECT * FROM old_items</span>
</pre>
          
          

          
          <div class="method-source-code" id="insert-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/actions.rb</span>
<span class="line-num">396</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">insert</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">values</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">397</span>   <span class="ruby-identifier">sql</span> = <span class="ruby-identifier">insert_sql</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">values</span>)
<span class="line-num">398</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">uses_returning?</span>(<span class="ruby-value">:insert</span>)
<span class="line-num">399</span>     <span class="ruby-identifier">returning_fetch_rows</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">400</span>   <span class="ruby-keyword">else</span>
<span class="line-num">401</span>     <span class="ruby-identifier">execute_insert</span>(<span class="ruby-identifier">sql</span>)
<span class="line-num">402</span>   <span class="ruby-keyword">end</span>
<span class="line-num">403</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-last" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">last</span><span
            class="method-args">(*args, &amp;block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Reverses the order and then runs <a href="Dataset.html#method-i-first"><code>first</code></a> with the given arguments and block.  Note that this will not necessarily give you the last record in the dataset, unless you have an unambiguous order.  If there is not currently an order for this dataset, raises an <code>Error</code>.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">order</span>(<span class="ruby-value">:id</span>).<span class="ruby-identifier">last</span> <span class="ruby-comment"># SELECT * FROM table ORDER BY id DESC LIMIT 1</span>
<span class="ruby-comment"># =&gt; {:id=&gt;10}</span>

<span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">order</span>(<span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">desc</span>(<span class="ruby-value">:id</span>)).<span class="ruby-identifier">last</span>(<span class="ruby-value">2</span>) <span class="ruby-comment"># SELECT * FROM table ORDER BY id ASC LIMIT 2</span>
<span class="ruby-comment"># =&gt; [{:id=&gt;1}, {:id=&gt;2}]</span>
</pre>
          
          

          
          <div class="method-source-code" id="last-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/actions.rb</span>
<span class="line-num">415</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">last</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">416</span>   <span class="ruby-identifier">raise</span>(<span class="ruby-constant">Error</span>, <span class="ruby-string">&#39;No order specified&#39;</span>) <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@opts</span>[<span class="ruby-value">:order</span>]
<span class="line-num">417</span>   <span class="ruby-identifier">reverse</span>.<span class="ruby-identifier">first</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">418</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-map" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">map</span><span
            class="method-args">(column=nil, &amp;block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Maps column values for each record in the dataset (if an argument is given) or performs the stock mapping functionality of <code>Enumerable</code> otherwise.  Raises an <code>Error</code> if both an argument and block are given.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">map</span>(<span class="ruby-value">:id</span>) <span class="ruby-comment"># SELECT * FROM table</span>
<span class="ruby-comment"># =&gt; [1, 2, 3, ...]</span>

<span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-identifier">r</span>[<span class="ruby-value">:id</span>] <span class="ruby-operator">*</span> <span class="ruby-value">2</span>} <span class="ruby-comment"># SELECT * FROM table</span>
<span class="ruby-comment"># =&gt; [2, 4, 6, ...]</span>
</pre>

<p>You can also provide an array of column names:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">map</span>([<span class="ruby-value">:id</span>, <span class="ruby-value">:name</span>]) <span class="ruby-comment"># SELECT * FROM table</span>
<span class="ruby-comment"># =&gt; [[1, &#39;A&#39;], [2, &#39;B&#39;], [3, &#39;C&#39;], ...]</span>
</pre>
          
          
            <div class="method-calls-super">
              Calls superclass method
              
            </div>
          

          
          <div class="method-source-code" id="map-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/actions.rb</span>
<span class="line-num">434</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">map</span>(<span class="ruby-identifier">column</span>=<span class="ruby-keyword">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">435</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">column</span>
<span class="line-num">436</span>     <span class="ruby-identifier">raise</span>(<span class="ruby-constant">Error</span>, <span class="ruby-string">&#39;Must call Dataset#map with either an argument or a block, not both&#39;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">block</span>
<span class="line-num">437</span>     <span class="ruby-keyword">return</span> <span class="ruby-identifier">naked</span>.<span class="ruby-identifier">map</span>(<span class="ruby-identifier">column</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">row_proc</span>
<span class="line-num">438</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">column</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)
<span class="line-num">439</span>       <span class="ruby-keyword">super</span>(){<span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">values_at</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">column</span>)}
<span class="line-num">440</span>     <span class="ruby-keyword">else</span>
<span class="line-num">441</span>       <span class="ruby-keyword">super</span>(){<span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-identifier">r</span>[<span class="ruby-identifier">column</span>]}
<span class="line-num">442</span>     <span class="ruby-keyword">end</span>
<span class="line-num">443</span>   <span class="ruby-keyword">else</span>
<span class="line-num">444</span>     <span class="ruby-keyword">super</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">445</span>   <span class="ruby-keyword">end</span>
<span class="line-num">446</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-max" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">max</span><span
            class="method-args">(arg=(no_arg = true), &amp;block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns the maximum value for the given column/expression. Uses a virtual row block if no argument is given.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">max</span>(<span class="ruby-value">:id</span>) <span class="ruby-comment"># SELECT max(id) FROM table LIMIT 1</span>
<span class="ruby-comment"># =&gt; 10</span>
<span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">max</span>{<span class="ruby-identifier">function</span>(<span class="ruby-identifier">column</span>)} <span class="ruby-comment"># SELECT max(function(column)) FROM table LIMIT 1</span>
<span class="ruby-comment"># =&gt; 7</span>
</pre>
          
          

          
          <div class="method-source-code" id="max-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/actions.rb</span>
<span class="line-num">455</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">max</span>(<span class="ruby-identifier">arg</span>=(<span class="ruby-identifier">no_arg</span> = <span class="ruby-keyword">true</span>), <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">456</span>   <span class="ruby-identifier">arg</span> = <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">virtual_row</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">no_arg</span>
<span class="line-num">457</span>   <span class="ruby-identifier">_aggregate</span>(<span class="ruby-value">:max</span>, <span class="ruby-identifier">arg</span>)
<span class="line-num">458</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-min" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">min</span><span
            class="method-args">(arg=(no_arg = true), &amp;block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns the minimum value for the given column/expression. Uses a virtual row block if no argument is given.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">min</span>(<span class="ruby-value">:id</span>) <span class="ruby-comment"># SELECT min(id) FROM table LIMIT 1</span>
<span class="ruby-comment"># =&gt; 1</span>
<span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">min</span>{<span class="ruby-identifier">function</span>(<span class="ruby-identifier">column</span>)} <span class="ruby-comment"># SELECT min(function(column)) FROM table LIMIT 1</span>
<span class="ruby-comment"># =&gt; 0</span>
</pre>
          
          

          
          <div class="method-source-code" id="min-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/actions.rb</span>
<span class="line-num">467</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">min</span>(<span class="ruby-identifier">arg</span>=(<span class="ruby-identifier">no_arg</span> = <span class="ruby-keyword">true</span>), <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">468</span>   <span class="ruby-identifier">arg</span> = <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">virtual_row</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">no_arg</span>
<span class="line-num">469</span>   <span class="ruby-identifier">_aggregate</span>(<span class="ruby-value">:min</span>, <span class="ruby-identifier">arg</span>)
<span class="line-num">470</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-multi_insert" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">multi_insert</span><span
            class="method-args">(hashes, opts=OPTS)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>This is a front end for import that allows you to submit an array of hashes instead of arrays of columns and values:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">multi_insert</span>([{<span class="ruby-value">x:</span> <span class="ruby-value">1</span>}, {<span class="ruby-value">x:</span> <span class="ruby-value">2</span>}])
<span class="ruby-comment"># INSERT INTO table (x) VALUES (1)</span>
<span class="ruby-comment"># INSERT INTO table (x) VALUES (2)</span>
</pre>

<p>Be aware that all hashes should have the same keys if you use this calling method, otherwise some columns could be missed or set to null instead of to default values.</p>

<p>This respects the same options as <a href="Dataset.html#method-i-import"><code>import</code></a>.</p>
          
          

          
          <div class="method-source-code" id="multi_insert-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/actions.rb</span>
<span class="line-num">484</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">multi_insert</span>(<span class="ruby-identifier">hashes</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)
<span class="line-num">485</span>   <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">hashes</span>.<span class="ruby-identifier">empty?</span>
<span class="line-num">486</span>   <span class="ruby-identifier">columns</span> = <span class="ruby-identifier">hashes</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">keys</span>
<span class="line-num">487</span>   <span class="ruby-identifier">import</span>(<span class="ruby-identifier">columns</span>, <span class="ruby-identifier">hashes</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">h</span><span class="ruby-operator">|</span> <span class="ruby-identifier">columns</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">h</span>[<span class="ruby-identifier">c</span>]}}, <span class="ruby-identifier">opts</span>)
<span class="line-num">488</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-paged_each" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">paged_each</span><span
            class="method-args">(opts=OPTS) { || ... }</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Yields each row in the dataset, but internally uses multiple queries as needed to process the entire result set without keeping all rows in the dataset in memory, even if the underlying driver buffers all query results in memory.</p>

<p>Because this uses multiple queries internally, in order to remain consistent, it also uses a transaction internally.  Additionally, to work correctly, the dataset must have unambiguous order.  Using an ambiguous order can result in an infinite loop, as well as subtler bugs such as yielding duplicate rows or rows being skipped.</p>

<p><a href="../Sequel.html"><code>Sequel</code></a> checks that the datasets using this method have an order, but it cannot ensure that the order is unambiguous.</p>

<p>Note that this method is not safe to use on many adapters if you are running additional queries inside the provided block.  If you are running queries inside the block, use a separate thread or shard inside <code>paged_each</code>.</p>

<p>Options:</p>
<dl class="rdoc-list note-list"><dt>:rows_per_fetch 
<dd>
<p>The number of rows to fetch per query.  Defaults to 1000.</p>
</dd><dt>:strategy 
<dd>
<p>The strategy to use for paging of results.  By default this is :offset, for using an approach with a limit and offset for every page.  This can be set to :filter, which uses a limit and a filter that excludes rows from previous pages.  In order for this strategy to work, you must be selecting the columns you are ordering by, and none of the columns can contain NULLs.  Note that some <a href="../Sequel.html"><code>Sequel</code></a> adapters have optimized implementations that will use cursors or streaming regardless of the :strategy option used.</p>
</dd><dt>:filter_values 
<dd>
<p>If the strategy: :filter option is used, this option should be a proc that accepts the last retrieved row for the previous page and an array of ORDER BY expressions, and returns an array of values relating to those expressions for the last retrieved row.  You will need to use this option if your ORDER BY expressions are not simple columns, if they contain qualified identifiers that would be ambiguous unqualified, if they contain any identifiers that are aliased in SELECT, and potentially other cases.</p>
</dd></dl>

<p>Examples:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">order</span>(<span class="ruby-value">:id</span>).<span class="ruby-identifier">paged_each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span> }
<span class="ruby-comment"># SELECT * FROM table ORDER BY id LIMIT 1000</span>
<span class="ruby-comment"># SELECT * FROM table ORDER BY id LIMIT 1000 OFFSET 1000</span>
<span class="ruby-comment"># ...</span>

<span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">order</span>(<span class="ruby-value">:id</span>).<span class="ruby-identifier">paged_each</span>(<span class="ruby-value">:rows_per_fetch</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">100</span>){<span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span> }
<span class="ruby-comment"># SELECT * FROM table ORDER BY id LIMIT 100</span>
<span class="ruby-comment"># SELECT * FROM table ORDER BY id LIMIT 100 OFFSET 100</span>
<span class="ruby-comment"># ...</span>

<span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">order</span>(<span class="ruby-value">:id</span>).<span class="ruby-identifier">paged_each</span>(<span class="ruby-value">strategy:</span> <span class="ruby-value">:filter</span>){<span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span> }
<span class="ruby-comment"># SELECT * FROM table ORDER BY id LIMIT 1000</span>
<span class="ruby-comment"># SELECT * FROM table WHERE id &gt; 1001 ORDER BY id LIMIT 1000</span>
<span class="ruby-comment"># ...</span>

<span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">order</span>(<span class="ruby-value">:id</span>).<span class="ruby-identifier">paged_each</span>(<span class="ruby-value">strategy:</span> <span class="ruby-value">:filter</span>,
  <span class="ruby-value">filter_values:</span> <span class="ruby-identifier">lambda</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">row</span>, <span class="ruby-identifier">exprs</span><span class="ruby-operator">|</span> [<span class="ruby-identifier">row</span>[<span class="ruby-value">:id</span>]]}){<span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span> }
<span class="ruby-comment"># SELECT * FROM table ORDER BY id LIMIT 1000</span>
<span class="ruby-comment"># SELECT * FROM table WHERE id &gt; 1001 ORDER BY id LIMIT 1000</span>
<span class="ruby-comment"># ...</span>
</pre>
          
          

          
          <div class="method-source-code" id="paged_each-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/actions.rb</span>
<span class="line-num">545</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">paged_each</span>(<span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)
<span class="line-num">546</span>   <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@opts</span>[<span class="ruby-value">:order</span>]
<span class="line-num">547</span>     <span class="ruby-identifier">raise</span> <span class="ruby-constant">Sequel</span><span class="ruby-operator">::</span><span class="ruby-constant">Error</span>, <span class="ruby-string">&quot;Dataset#paged_each requires the dataset be ordered&quot;</span>
<span class="line-num">548</span>   <span class="ruby-keyword">end</span>
<span class="line-num">549</span>   <span class="ruby-keyword">unless</span> <span class="ruby-keyword">defined?</span>(<span class="ruby-keyword">yield</span>)
<span class="line-num">550</span>     <span class="ruby-keyword">return</span> <span class="ruby-identifier">enum_for</span>(<span class="ruby-value">:paged_each</span>, <span class="ruby-identifier">opts</span>)
<span class="line-num">551</span>   <span class="ruby-keyword">end</span>
<span class="line-num">552</span> 
<span class="line-num">553</span>   <span class="ruby-identifier">total_limit</span> = <span class="ruby-ivar">@opts</span>[<span class="ruby-value">:limit</span>]
<span class="line-num">554</span>   <span class="ruby-identifier">offset</span> = <span class="ruby-ivar">@opts</span>[<span class="ruby-value">:offset</span>]
<span class="line-num">555</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">server</span> = <span class="ruby-ivar">@opts</span>[<span class="ruby-value">:server</span>]
<span class="line-num">556</span>     <span class="ruby-identifier">opts</span> = <span class="ruby-constant">Hash</span>[<span class="ruby-identifier">opts</span>]
<span class="line-num">557</span>     <span class="ruby-identifier">opts</span>[<span class="ruby-value">:server</span>] = <span class="ruby-identifier">server</span>
<span class="line-num">558</span>   <span class="ruby-keyword">end</span>
<span class="line-num">559</span> 
<span class="line-num">560</span>   <span class="ruby-identifier">rows_per_fetch</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:rows_per_fetch</span>] <span class="ruby-operator">||</span> <span class="ruby-value">1000</span>
<span class="line-num">561</span>   <span class="ruby-identifier">strategy</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">offset</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">total_limit</span>
<span class="line-num">562</span>     <span class="ruby-value">:offset</span>
<span class="line-num">563</span>   <span class="ruby-keyword">else</span>
<span class="line-num">564</span>     <span class="ruby-identifier">opts</span>[<span class="ruby-value">:strategy</span>] <span class="ruby-operator">||</span> <span class="ruby-value">:offset</span>
<span class="line-num">565</span>   <span class="ruby-keyword">end</span>
<span class="line-num">566</span> 
<span class="line-num">567</span>   <span class="ruby-identifier">db</span>.<span class="ruby-identifier">transaction</span>(<span class="ruby-identifier">opts</span>) <span class="ruby-keyword">do</span>
<span class="line-num">568</span>     <span class="ruby-keyword">case</span> <span class="ruby-identifier">strategy</span>
<span class="line-num">569</span>     <span class="ruby-keyword">when</span> <span class="ruby-value">:filter</span>
<span class="line-num">570</span>       <span class="ruby-identifier">filter_values</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:filter_values</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">proc</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">row</span>, <span class="ruby-identifier">exprs</span><span class="ruby-operator">|</span> <span class="ruby-identifier">exprs</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">e</span><span class="ruby-operator">|</span> <span class="ruby-identifier">row</span>[<span class="ruby-identifier">hash_key_symbol</span>(<span class="ruby-identifier">e</span>)]}}
<span class="line-num">571</span>       <span class="ruby-identifier">base_ds</span> = <span class="ruby-identifier">ds</span> = <span class="ruby-identifier">limit</span>(<span class="ruby-identifier">rows_per_fetch</span>)
<span class="line-num">572</span>       <span class="ruby-keyword">while</span> <span class="ruby-identifier">ds</span>
<span class="line-num">573</span>         <span class="ruby-identifier">last_row</span> = <span class="ruby-keyword">nil</span>
<span class="line-num">574</span>         <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span>
<span class="line-num">575</span>           <span class="ruby-identifier">last_row</span> = <span class="ruby-identifier">row</span>
<span class="line-num">576</span>           <span class="ruby-keyword">yield</span> <span class="ruby-identifier">row</span>
<span class="line-num">577</span>         <span class="ruby-keyword">end</span>
<span class="line-num">578</span>         <span class="ruby-identifier">ds</span> = (<span class="ruby-identifier">base_ds</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">ignore_values_preceding</span>(<span class="ruby-identifier">last_row</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">filter_values</span>)) <span class="ruby-keyword">if</span> <span class="ruby-identifier">last_row</span>)
<span class="line-num">579</span>       <span class="ruby-keyword">end</span>
<span class="line-num">580</span>     <span class="ruby-keyword">else</span>
<span class="line-num">581</span>       <span class="ruby-identifier">offset</span> <span class="ruby-operator">||=</span> <span class="ruby-value">0</span>
<span class="line-num">582</span>       <span class="ruby-identifier">num_rows_yielded</span> = <span class="ruby-identifier">rows_per_fetch</span>
<span class="line-num">583</span>       <span class="ruby-identifier">total_rows</span> = <span class="ruby-value">0</span>
<span class="line-num">584</span> 
<span class="line-num">585</span>       <span class="ruby-keyword">while</span> <span class="ruby-identifier">num_rows_yielded</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">rows_per_fetch</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">total_limit</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">total_rows</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">total_limit</span>)
<span class="line-num">586</span>         <span class="ruby-keyword">if</span> <span class="ruby-identifier">total_limit</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">total_rows</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">rows_per_fetch</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">total_limit</span>
<span class="line-num">587</span>           <span class="ruby-identifier">rows_per_fetch</span> = <span class="ruby-identifier">total_limit</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">total_rows</span>
<span class="line-num">588</span>         <span class="ruby-keyword">end</span>
<span class="line-num">589</span> 
<span class="line-num">590</span>         <span class="ruby-identifier">num_rows_yielded</span> = <span class="ruby-value">0</span>
<span class="line-num">591</span>         <span class="ruby-identifier">limit</span>(<span class="ruby-identifier">rows_per_fetch</span>, <span class="ruby-identifier">offset</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span>
<span class="line-num">592</span>           <span class="ruby-identifier">num_rows_yielded</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
<span class="line-num">593</span>           <span class="ruby-identifier">total_rows</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">total_limit</span>
<span class="line-num">594</span>           <span class="ruby-keyword">yield</span> <span class="ruby-identifier">row</span>
<span class="line-num">595</span>         <span class="ruby-keyword">end</span>
<span class="line-num">596</span> 
<span class="line-num">597</span>         <span class="ruby-identifier">offset</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">rows_per_fetch</span>
<span class="line-num">598</span>       <span class="ruby-keyword">end</span>
<span class="line-num">599</span>     <span class="ruby-keyword">end</span>
<span class="line-num">600</span>   <span class="ruby-keyword">end</span>
<span class="line-num">601</span> 
<span class="line-num">602</span>   <span class="ruby-keyword">self</span>
<span class="line-num">603</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-select_hash" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">select_hash</span><span
            class="method-args">(key_column, value_column, opts = OPTS)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns a hash with key_column values as keys and value_column values as values.  Similar to <a href="Dataset.html#method-i-as_hash"><code>as_hash</code></a>, but only selects the columns given.  Like <a href="Dataset.html#method-i-as_hash"><code>as_hash</code></a>, it accepts an optional :hash parameter, into which entries will be merged. </p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">select_hash</span>(<span class="ruby-value">:id</span>, <span class="ruby-value">:name</span>)
<span class="ruby-comment"># SELECT id, name FROM table</span>
<span class="ruby-comment"># =&gt; {1=&gt;&#39;a&#39;, 2=&gt;&#39;b&#39;, ...}</span>
</pre>

<p>You can also provide an array of column names for either the key_column, the value column, or both:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">select_hash</span>([<span class="ruby-value">:id</span>, <span class="ruby-value">:foo</span>], [<span class="ruby-value">:name</span>, <span class="ruby-value">:bar</span>])
<span class="ruby-comment"># SELECT id, foo, name, bar FROM table</span>
<span class="ruby-comment"># =&gt; {[1, 3]=&gt;[&#39;a&#39;, &#39;c&#39;], [2, 4]=&gt;[&#39;b&#39;, &#39;d&#39;], ...}</span>
</pre>

<p>When using this method, you must be sure that each expression has an alias that <a href="../Sequel.html"><code>Sequel</code></a> can determine.</p>
          
          

          
          <div class="method-source-code" id="select_hash-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/actions.rb</span>
<span class="line-num">623</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">select_hash</span>(<span class="ruby-identifier">key_column</span>, <span class="ruby-identifier">value_column</span>, <span class="ruby-identifier">opts</span> = <span class="ruby-constant">OPTS</span>)
<span class="line-num">624</span>   <span class="ruby-identifier">_select_hash</span>(<span class="ruby-value">:as_hash</span>, <span class="ruby-identifier">key_column</span>, <span class="ruby-identifier">value_column</span>, <span class="ruby-identifier">opts</span>)
<span class="line-num">625</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-select_hash_groups" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">select_hash_groups</span><span
            class="method-args">(key_column, value_column, opts = OPTS)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns a hash with key_column values as keys and an array of value_column values. Similar to <a href="Dataset.html#method-i-to_hash_groups"><code>to_hash_groups</code></a>, but only selects the columns given.  Like <a href="Dataset.html#method-i-to_hash_groups"><code>to_hash_groups</code></a>, it accepts an optional :hash parameter, into which entries will be merged. </p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">select_hash_groups</span>(<span class="ruby-value">:name</span>, <span class="ruby-value">:id</span>)
<span class="ruby-comment"># SELECT id, name FROM table</span>
<span class="ruby-comment"># =&gt; {&#39;a&#39;=&gt;[1, 4, ...], &#39;b&#39;=&gt;[2, ...], ...}</span>
</pre>

<p>You can also provide an array of column names for either the key_column, the value column, or both:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">select_hash_groups</span>([<span class="ruby-value">:first</span>, <span class="ruby-value">:middle</span>], [<span class="ruby-value">:last</span>, <span class="ruby-value">:id</span>])
<span class="ruby-comment"># SELECT first, middle, last, id FROM table</span>
<span class="ruby-comment"># =&gt; {[&#39;a&#39;, &#39;b&#39;]=&gt;[[&#39;c&#39;, 1], [&#39;d&#39;, 2], ...], ...}</span>
</pre>

<p>When using this method, you must be sure that each expression has an alias that <a href="../Sequel.html"><code>Sequel</code></a> can determine.</p>
          
          

          
          <div class="method-source-code" id="select_hash_groups-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/actions.rb</span>
<span class="line-num">644</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">select_hash_groups</span>(<span class="ruby-identifier">key_column</span>, <span class="ruby-identifier">value_column</span>, <span class="ruby-identifier">opts</span> = <span class="ruby-constant">OPTS</span>)
<span class="line-num">645</span>   <span class="ruby-identifier">_select_hash</span>(<span class="ruby-value">:to_hash_groups</span>, <span class="ruby-identifier">key_column</span>, <span class="ruby-identifier">value_column</span>, <span class="ruby-identifier">opts</span>)
<span class="line-num">646</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-select_map" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">select_map</span><span
            class="method-args">(column=nil, &amp;block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Selects the column given (either as an argument or as a block), and returns an array of all values of that column in the dataset.  If you give a block argument that returns an array with multiple entries, the contents of the resulting array are undefined.  Raises an <a href="Error.html"><code>Error</code></a> if called with both an argument and a block.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">select_map</span>(<span class="ruby-value">:id</span>) <span class="ruby-comment"># SELECT id FROM table</span>
<span class="ruby-comment"># =&gt; [3, 5, 8, 1, ...]</span>

<span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">select_map</span>{<span class="ruby-identifier">id</span> <span class="ruby-operator">*</span> <span class="ruby-value">2</span>} <span class="ruby-comment"># SELECT (id * 2) FROM table</span>
<span class="ruby-comment"># =&gt; [6, 10, 16, 2, ...]</span>
</pre>

<p>You can also provide an array of column names:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">select_map</span>([<span class="ruby-value">:id</span>, <span class="ruby-value">:name</span>]) <span class="ruby-comment"># SELECT id, name FROM table</span>
<span class="ruby-comment"># =&gt; [[1, &#39;A&#39;], [2, &#39;B&#39;], [3, &#39;C&#39;], ...]</span>
</pre>

<p>If you provide an array of expressions, you must be sure that each entry in the array has an alias that <a href="../Sequel.html"><code>Sequel</code></a> can determine.</p>
          
          

          
          <div class="method-source-code" id="select_map-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/actions.rb</span>
<span class="line-num">667</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">select_map</span>(<span class="ruby-identifier">column</span>=<span class="ruby-keyword">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">668</span>   <span class="ruby-identifier">_select_map</span>(<span class="ruby-identifier">column</span>, <span class="ruby-keyword">false</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">669</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-select_order_map" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">select_order_map</span><span
            class="method-args">(column=nil, &amp;block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>The same as <a href="Dataset.html#method-i-select_map"><code>select_map</code></a>, but in addition orders the array by the column.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">select_order_map</span>(<span class="ruby-value">:id</span>) <span class="ruby-comment"># SELECT id FROM table ORDER BY id</span>
<span class="ruby-comment"># =&gt; [1, 2, 3, 4, ...]</span>

<span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">select_order_map</span>{<span class="ruby-identifier">id</span> <span class="ruby-operator">*</span> <span class="ruby-value">2</span>} <span class="ruby-comment"># SELECT (id * 2) FROM table ORDER BY (id * 2)</span>
<span class="ruby-comment"># =&gt; [2, 4, 6, 8, ...]</span>
</pre>

<p>You can also provide an array of column names:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">select_order_map</span>([<span class="ruby-value">:id</span>, <span class="ruby-value">:name</span>]) <span class="ruby-comment"># SELECT id, name FROM table ORDER BY id, name</span>
<span class="ruby-comment"># =&gt; [[1, &#39;A&#39;], [2, &#39;B&#39;], [3, &#39;C&#39;], ...]</span>
</pre>

<p>If you provide an array of expressions, you must be sure that each entry in the array has an alias that <a href="../Sequel.html"><code>Sequel</code></a> can determine.</p>
          
          

          
          <div class="method-source-code" id="select_order_map-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/actions.rb</span>
<span class="line-num">686</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">select_order_map</span>(<span class="ruby-identifier">column</span>=<span class="ruby-keyword">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">687</span>   <span class="ruby-identifier">_select_map</span>(<span class="ruby-identifier">column</span>, <span class="ruby-keyword">true</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">688</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-single_record" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">single_record</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Limits the dataset to one record, and returns the first record in the dataset, or nil if the dataset has no records. Users should probably use <code>first</code> instead of this method. Example:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:test</span>].<span class="ruby-identifier">single_record</span> <span class="ruby-comment"># SELECT * FROM test LIMIT 1</span>
<span class="ruby-comment"># =&gt; {:column_name=&gt;&#39;value&#39;}</span>
</pre>
          
          

          
          <div class="method-source-code" id="single_record-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/actions.rb</span>
<span class="line-num">696</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">single_record</span>
<span class="line-num">697</span>   <span class="ruby-identifier">_single_record_ds</span>.<span class="ruby-identifier">single_record!</span>
<span class="line-num">698</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-single_record-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">single_record!</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns the first record in dataset, without limiting the dataset. Returns nil if the dataset has no records. Users should probably use <code>first</code> instead of this method. This should only be used if you know the dataset is already limited to a single record. This method may be desirable to use for performance reasons, as it does not clone the receiver. Example:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:test</span>].<span class="ruby-identifier">single_record!</span> <span class="ruby-comment"># SELECT * FROM test</span>
<span class="ruby-comment"># =&gt; {:column_name=&gt;&#39;value&#39;}</span>
</pre>
          
          

          
          <div class="method-source-code" id="single_record-21-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/actions.rb</span>
<span class="line-num">708</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">single_record!</span>
<span class="line-num">709</span>   <span class="ruby-identifier">with_sql_first</span>(<span class="ruby-identifier">select_sql</span>)
<span class="line-num">710</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-single_value" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">single_value</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns the first value of the first record in the dataset. Returns nil if dataset is empty.  Users should generally use <code>get</code> instead of this method. Example:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:test</span>].<span class="ruby-identifier">single_value</span> <span class="ruby-comment"># SELECT * FROM test LIMIT 1</span>
<span class="ruby-comment"># =&gt; &#39;value&#39;</span>
</pre>
          
          

          
          <div class="method-source-code" id="single_value-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/actions.rb</span>
<span class="line-num">718</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">single_value</span>
<span class="line-num">719</span>   <span class="ruby-identifier">single_value_ds</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span>
<span class="line-num">720</span>     <span class="ruby-identifier">r</span>.<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">_</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-keyword">return</span> <span class="ruby-identifier">v</span>}
<span class="line-num">721</span>   <span class="ruby-keyword">end</span>
<span class="line-num">722</span>   <span class="ruby-keyword">nil</span>
<span class="line-num">723</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-single_value-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">single_value!</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns the first value of the first record in the dataset, without limiting the dataset. Returns nil if the dataset is empty. Users should generally use <code>get</code> instead of this method.  Should not be used on graphed datasets or datasets that have row_procs that don&#39;t return hashes.  This method may be desirable to use for performance reasons, as it does not clone the receiver.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:test</span>].<span class="ruby-identifier">single_value!</span> <span class="ruby-comment"># SELECT * FROM test</span>
<span class="ruby-comment"># =&gt; &#39;value&#39;</span>
</pre>
          
          

          
          <div class="method-source-code" id="single_value-21-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/actions.rb</span>
<span class="line-num">733</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">single_value!</span>
<span class="line-num">734</span>   <span class="ruby-identifier">with_sql_single_value</span>(<span class="ruby-identifier">select_sql</span>)
<span class="line-num">735</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-sum" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">sum</span><span
            class="method-args">(arg=(no_arg = true), &amp;block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns the sum for the given column/expression. Uses a virtual row block if no column is given.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">sum</span>(<span class="ruby-value">:id</span>) <span class="ruby-comment"># SELECT sum(id) FROM table LIMIT 1</span>
<span class="ruby-comment"># =&gt; 55</span>
<span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">sum</span>{<span class="ruby-identifier">function</span>(<span class="ruby-identifier">column</span>)} <span class="ruby-comment"># SELECT sum(function(column)) FROM table LIMIT 1</span>
<span class="ruby-comment"># =&gt; 10</span>
</pre>
          
          

          
          <div class="method-source-code" id="sum-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/actions.rb</span>
<span class="line-num">744</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">sum</span>(<span class="ruby-identifier">arg</span>=(<span class="ruby-identifier">no_arg</span> = <span class="ruby-keyword">true</span>), <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">745</span>   <span class="ruby-identifier">arg</span> = <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">virtual_row</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">no_arg</span>
<span class="line-num">746</span>   <span class="ruby-identifier">_aggregate</span>(<span class="ruby-value">:sum</span>, <span class="ruby-identifier">arg</span>)
<span class="line-num">747</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-to_hash" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">to_hash</span><span
            class="method-args">(*a)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Alias of <a href="Dataset.html#method-i-as_hash"><code>as_hash</code></a> for backwards compatibility.</p>
          
          

          
          <div class="method-source-code" id="to_hash-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/actions.rb</span>
<span class="line-num">801</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">to_hash</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">a</span>)
<span class="line-num">802</span>   <span class="ruby-identifier">as_hash</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">a</span>)
<span class="line-num">803</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-to_hash_groups" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">to_hash_groups</span><span
            class="method-args">(key_column, value_column = nil, opts = OPTS)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns a hash with one column used as key and the values being an array of column values. If the value_column is not given or nil, uses the entire hash as the value.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">to_hash_groups</span>(<span class="ruby-value">:name</span>, <span class="ruby-value">:id</span>) <span class="ruby-comment"># SELECT * FROM table</span>
<span class="ruby-comment"># {&#39;Jim&#39;=&gt;[1, 4, 16, ...], &#39;Bob&#39;=&gt;[2], ...}</span>

<span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">to_hash_groups</span>(<span class="ruby-value">:name</span>) <span class="ruby-comment"># SELECT * FROM table</span>
<span class="ruby-comment"># {&#39;Jim&#39;=&gt;[{:id=&gt;1, :name=&gt;&#39;Jim&#39;}, {:id=&gt;4, :name=&gt;&#39;Jim&#39;}, ...], &#39;Bob&#39;=&gt;[{:id=&gt;2, :name=&gt;&#39;Bob&#39;}], ...}</span>
</pre>

<p>You can also provide an array of column names for either the key_column, the value column, or both:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">to_hash_groups</span>([<span class="ruby-value">:first</span>, <span class="ruby-value">:middle</span>], [<span class="ruby-value">:last</span>, <span class="ruby-value">:id</span>]) <span class="ruby-comment"># SELECT * FROM table</span>
<span class="ruby-comment"># {[&#39;Jim&#39;, &#39;Bob&#39;]=&gt;[[&#39;Smith&#39;, 1], [&#39;Jackson&#39;, 4], ...], ...}</span>

<span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">to_hash_groups</span>([<span class="ruby-value">:first</span>, <span class="ruby-value">:middle</span>]) <span class="ruby-comment"># SELECT * FROM table</span>
<span class="ruby-comment"># {[&#39;Jim&#39;, &#39;Bob&#39;]=&gt;[{:id=&gt;1, :first=&gt;&#39;Jim&#39;, :middle=&gt;&#39;Bob&#39;, :last=&gt;&#39;Smith&#39;}, ...], ...}</span>
</pre>

<p>Options:</p>
<dl class="rdoc-list note-list"><dt>:all 
<dd>
<p>Use all instead of each to retrieve the objects</p>
</dd><dt>:hash 
<dd>
<p>The object into which the values will be placed.  If this is not given, an empty hash is used.  This can be used to use a hash with a default value or default proc.</p>
</dd></dl>
          
          

          
          <div class="method-source-code" id="to_hash_groups-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/actions.rb</span>
<span class="line-num">829</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">to_hash_groups</span>(<span class="ruby-identifier">key_column</span>, <span class="ruby-identifier">value_column</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">opts</span> = <span class="ruby-constant">OPTS</span>)
<span class="line-num">830</span>   <span class="ruby-identifier">h</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:hash</span>] <span class="ruby-operator">||</span> {}
<span class="line-num">831</span>   <span class="ruby-identifier">meth</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:all</span>] <span class="ruby-operator">?</span> <span class="ruby-value">:all</span> <span class="ruby-operator">:</span> <span class="ruby-value">:each</span>
<span class="line-num">832</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">value_column</span>
<span class="line-num">833</span>     <span class="ruby-keyword">return</span> <span class="ruby-identifier">naked</span>.<span class="ruby-identifier">to_hash_groups</span>(<span class="ruby-identifier">key_column</span>, <span class="ruby-identifier">value_column</span>, <span class="ruby-identifier">opts</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">row_proc</span>
<span class="line-num">834</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">value_column</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)
<span class="line-num">835</span>       <span class="ruby-keyword">if</span> <span class="ruby-identifier">key_column</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)
<span class="line-num">836</span>         <span class="ruby-identifier">public_send</span>(<span class="ruby-identifier">meth</span>){<span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> (<span class="ruby-identifier">h</span>[<span class="ruby-identifier">r</span>.<span class="ruby-identifier">values_at</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">key_column</span>)] <span class="ruby-operator">||=</span> []) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">values_at</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">value_column</span>)}
<span class="line-num">837</span>       <span class="ruby-keyword">else</span>
<span class="line-num">838</span>         <span class="ruby-identifier">public_send</span>(<span class="ruby-identifier">meth</span>){<span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> (<span class="ruby-identifier">h</span>[<span class="ruby-identifier">r</span>[<span class="ruby-identifier">key_column</span>]] <span class="ruby-operator">||=</span> []) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">values_at</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">value_column</span>)}
<span class="line-num">839</span>       <span class="ruby-keyword">end</span>
<span class="line-num">840</span>     <span class="ruby-keyword">else</span>
<span class="line-num">841</span>       <span class="ruby-keyword">if</span> <span class="ruby-identifier">key_column</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)
<span class="line-num">842</span>         <span class="ruby-identifier">public_send</span>(<span class="ruby-identifier">meth</span>){<span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> (<span class="ruby-identifier">h</span>[<span class="ruby-identifier">r</span>.<span class="ruby-identifier">values_at</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">key_column</span>)] <span class="ruby-operator">||=</span> []) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">r</span>[<span class="ruby-identifier">value_column</span>]}
<span class="line-num">843</span>       <span class="ruby-keyword">else</span>
<span class="line-num">844</span>         <span class="ruby-identifier">public_send</span>(<span class="ruby-identifier">meth</span>){<span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> (<span class="ruby-identifier">h</span>[<span class="ruby-identifier">r</span>[<span class="ruby-identifier">key_column</span>]] <span class="ruby-operator">||=</span> []) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">r</span>[<span class="ruby-identifier">value_column</span>]}
<span class="line-num">845</span>       <span class="ruby-keyword">end</span>
<span class="line-num">846</span>     <span class="ruby-keyword">end</span>
<span class="line-num">847</span>   <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">key_column</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)
<span class="line-num">848</span>     <span class="ruby-identifier">public_send</span>(<span class="ruby-identifier">meth</span>){<span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> (<span class="ruby-identifier">h</span>[<span class="ruby-identifier">key_column</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">k</span><span class="ruby-operator">|</span> <span class="ruby-identifier">r</span>[<span class="ruby-identifier">k</span>]}] <span class="ruby-operator">||=</span> []) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">r</span>}
<span class="line-num">849</span>   <span class="ruby-keyword">else</span>
<span class="line-num">850</span>     <span class="ruby-identifier">public_send</span>(<span class="ruby-identifier">meth</span>){<span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> (<span class="ruby-identifier">h</span>[<span class="ruby-identifier">r</span>[<span class="ruby-identifier">key_column</span>]] <span class="ruby-operator">||=</span> []) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">r</span>}
<span class="line-num">851</span>   <span class="ruby-keyword">end</span>
<span class="line-num">852</span>   <span class="ruby-identifier">h</span>
<span class="line-num">853</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-truncate" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">truncate</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Truncates the dataset.  Returns nil.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">truncate</span> <span class="ruby-comment"># TRUNCATE table</span>
<span class="ruby-comment"># =&gt; nil</span>
</pre>
          
          

          
          <div class="method-source-code" id="truncate-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/actions.rb</span>
<span class="line-num">859</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">truncate</span>
<span class="line-num">860</span>   <span class="ruby-identifier">execute_ddl</span>(<span class="ruby-identifier">truncate_sql</span>)
<span class="line-num">861</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-update" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update</span><span
            class="method-args">(values=OPTS, &amp;block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Updates values for the dataset.  The returned value is the number of rows updated. <code>values</code> should be a hash where the keys are columns to set and values are the values to which to set the columns.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">update</span>(<span class="ruby-value">x:</span> <span class="ruby-keyword">nil</span>) <span class="ruby-comment"># UPDATE table SET x = NULL</span>
<span class="ruby-comment"># =&gt; 10</span>

<span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">update</span>(<span class="ruby-value">x:</span> <span class="ruby-constant">Sequel</span>[<span class="ruby-value">:x</span>]<span class="ruby-value">+1</span>, <span class="ruby-value">y:</span> <span class="ruby-value">0</span>) <span class="ruby-comment"># UPDATE table SET x = (x + 1), y = 0</span>
<span class="ruby-comment"># =&gt; 10</span>
</pre>
          
          

          
          <div class="method-source-code" id="update-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/actions.rb</span>
<span class="line-num">872</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">update</span>(<span class="ruby-identifier">values</span>=<span class="ruby-constant">OPTS</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">873</span>   <span class="ruby-identifier">sql</span> = <span class="ruby-identifier">update_sql</span>(<span class="ruby-identifier">values</span>)
<span class="line-num">874</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">uses_returning?</span>(<span class="ruby-value">:update</span>)
<span class="line-num">875</span>     <span class="ruby-identifier">returning_fetch_rows</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">876</span>   <span class="ruby-keyword">else</span>
<span class="line-num">877</span>     <span class="ruby-identifier">execute_dui</span>(<span class="ruby-identifier">sql</span>)
<span class="line-num">878</span>   <span class="ruby-keyword">end</span>
<span class="line-num">879</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-where_all" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">where_all</span><span
            class="method-args">(cond, &amp;block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Return an array of all rows matching the given filter condition, also yielding each row to the given block.  Basically the same as where(cond).all(&amp;block), except it can be optimized to not create an intermediate dataset.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">where_all</span>(<span class="ruby-value">id:</span> [<span class="ruby-value">1</span>,<span class="ruby-value">2</span>,<span class="ruby-value">3</span>])
<span class="ruby-comment"># SELECT * FROM table WHERE (id IN (1, 2, 3))</span>
</pre>
          
          

          
          <div class="method-source-code" id="where_all-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/actions.rb</span>
<span class="line-num">887</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">where_all</span>(<span class="ruby-identifier">cond</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">888</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">loader</span> = <span class="ruby-identifier">_where_loader</span>([<span class="ruby-identifier">cond</span>], <span class="ruby-keyword">nil</span>)
<span class="line-num">889</span>     <span class="ruby-identifier">loader</span>.<span class="ruby-identifier">all</span>(<span class="ruby-identifier">filter_expr</span>(<span class="ruby-identifier">cond</span>), <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">890</span>   <span class="ruby-keyword">else</span>
<span class="line-num">891</span>     <span class="ruby-identifier">where</span>(<span class="ruby-identifier">cond</span>).<span class="ruby-identifier">all</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">892</span>   <span class="ruby-keyword">end</span>
<span class="line-num">893</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-where_each" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">where_each</span><span
            class="method-args">(cond, &amp;block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Iterate over all rows matching the given filter condition,  yielding each row to the given block.  Basically the same as where(cond).each(&amp;block), except it can be optimized to not create an intermediate dataset.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">where_each</span>(<span class="ruby-value">id:</span> [<span class="ruby-value">1</span>,<span class="ruby-value">2</span>,<span class="ruby-value">3</span>]){<span class="ruby-operator">|</span><span class="ruby-identifier">row</span><span class="ruby-operator">|</span> <span class="ruby-identifier">p</span> <span class="ruby-identifier">row</span>}
<span class="ruby-comment"># SELECT * FROM table WHERE (id IN (1, 2, 3))</span>
</pre>
          
          

          
          <div class="method-source-code" id="where_each-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/actions.rb</span>
<span class="line-num">901</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">where_each</span>(<span class="ruby-identifier">cond</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">902</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">loader</span> = <span class="ruby-identifier">_where_loader</span>([<span class="ruby-identifier">cond</span>], <span class="ruby-keyword">nil</span>)
<span class="line-num">903</span>     <span class="ruby-identifier">loader</span>.<span class="ruby-identifier">each</span>(<span class="ruby-identifier">filter_expr</span>(<span class="ruby-identifier">cond</span>), <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">904</span>   <span class="ruby-keyword">else</span>
<span class="line-num">905</span>     <span class="ruby-identifier">where</span>(<span class="ruby-identifier">cond</span>).<span class="ruby-identifier">each</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">906</span>   <span class="ruby-keyword">end</span>
<span class="line-num">907</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-where_single_value" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">where_single_value</span><span
            class="method-args">(cond)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Filter the datasets using the given filter condition, then return a single value. This assumes that the dataset has already been setup to limit the selection to a single column.  Basically the same as where(cond).single_value, except it can be optimized to not create an intermediate dataset.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">select</span>(<span class="ruby-value">:name</span>).<span class="ruby-identifier">where_single_value</span>(<span class="ruby-value">id:</span> <span class="ruby-value">1</span>)
<span class="ruby-comment"># SELECT name FROM table WHERE (id = 1) LIMIT 1</span>
</pre>
          
          

          
          <div class="method-source-code" id="where_single_value-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/actions.rb</span>
<span class="line-num">916</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">where_single_value</span>(<span class="ruby-identifier">cond</span>)
<span class="line-num">917</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">loader</span> = <span class="ruby-identifier">cached_where_placeholder_literalizer</span>([<span class="ruby-identifier">cond</span>], <span class="ruby-keyword">nil</span>, <span class="ruby-value">:_where_single_value_loader</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">pl</span><span class="ruby-operator">|</span>
<span class="line-num">918</span>       <span class="ruby-identifier">single_value_ds</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">pl</span>.<span class="ruby-identifier">arg</span>)
<span class="line-num">919</span>     <span class="ruby-keyword">end</span>
<span class="line-num">920</span> 
<span class="line-num">921</span>     <span class="ruby-identifier">loader</span>.<span class="ruby-identifier">get</span>(<span class="ruby-identifier">filter_expr</span>(<span class="ruby-identifier">cond</span>))
<span class="line-num">922</span>   <span class="ruby-keyword">else</span>
<span class="line-num">923</span>     <span class="ruby-identifier">where</span>(<span class="ruby-identifier">cond</span>).<span class="ruby-identifier">single_value</span>
<span class="line-num">924</span>   <span class="ruby-keyword">end</span>
<span class="line-num">925</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-with_sql_all" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">with_sql_all</span><span
            class="method-args">(sql, &amp;block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Run the given <a href="SQL.html"><code>SQL</code></a> and return an array of all rows.  If a block is given, each row is yielded to the block after all rows are loaded. See with_sql_each.</p>
          
          

          
          <div class="method-source-code" id="with_sql_all-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/actions.rb</span>
<span class="line-num">929</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">with_sql_all</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">930</span>   <span class="ruby-identifier">_all</span>(<span class="ruby-identifier">block</span>){<span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span> <span class="ruby-identifier">with_sql_each</span>(<span class="ruby-identifier">sql</span>){<span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-identifier">a</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">r</span>}}
<span class="line-num">931</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-with_sql_delete" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">with_sql_delete</span><span
            class="method-args">(sql)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Execute the given <a href="SQL.html"><code>SQL</code></a> and return the number of rows deleted.  This exists solely as an optimization, replacing <a href="Dataset.html#method-i-with_sql"><code>with_sql</code></a>(sql).delete.  It&#39;s significantly faster as it does not require cloning the current dataset.</p>
          
          

          
          <div class="method-source-code" id="with_sql_delete-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/actions.rb</span>
<span class="line-num">936</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">with_sql_delete</span>(<span class="ruby-identifier">sql</span>)
<span class="line-num">937</span>   <span class="ruby-identifier">execute_dui</span>(<span class="ruby-identifier">sql</span>)
<span class="line-num">938</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        
        <div class="aliases">
          Also aliased as: <a href="Dataset.html#method-i-with_sql_update">with_sql_update</a>
        </div>
        

        
      </div>

    
      <div id="method-i-with_sql_each" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">with_sql_each</span><span
            class="method-args">(sql) { |call| ... }</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Run the given <a href="SQL.html"><code>SQL</code></a> and yield each returned row to the block.</p>
          
          

          
          <div class="method-source-code" id="with_sql_each-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/actions.rb</span>
<span class="line-num">942</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">with_sql_each</span>(<span class="ruby-identifier">sql</span>)
<span class="line-num">943</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">rp</span> = <span class="ruby-identifier">row_proc</span>
<span class="line-num">944</span>     <span class="ruby-identifier">_with_sql_dataset</span>.<span class="ruby-identifier">fetch_rows</span>(<span class="ruby-identifier">sql</span>){<span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-keyword">yield</span> <span class="ruby-identifier">rp</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">r</span>)}
<span class="line-num">945</span>   <span class="ruby-keyword">else</span>
<span class="line-num">946</span>     <span class="ruby-identifier">_with_sql_dataset</span>.<span class="ruby-identifier">fetch_rows</span>(<span class="ruby-identifier">sql</span>){<span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-keyword">yield</span> <span class="ruby-identifier">r</span>}
<span class="line-num">947</span>   <span class="ruby-keyword">end</span>
<span class="line-num">948</span>   <span class="ruby-keyword">self</span>
<span class="line-num">949</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-with_sql_first" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">with_sql_first</span><span
            class="method-args">(sql)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Run the given <a href="SQL.html"><code>SQL</code></a> and return the first row, or nil if no rows were returned. See with_sql_each.</p>
          
          

          
          <div class="method-source-code" id="with_sql_first-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/actions.rb</span>
<span class="line-num">953</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">with_sql_first</span>(<span class="ruby-identifier">sql</span>)
<span class="line-num">954</span>   <span class="ruby-identifier">with_sql_each</span>(<span class="ruby-identifier">sql</span>){<span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-keyword">return</span> <span class="ruby-identifier">r</span>}
<span class="line-num">955</span>   <span class="ruby-keyword">nil</span>
<span class="line-num">956</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-with_sql_insert" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">with_sql_insert</span><span
            class="method-args">(sql)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Execute the given <a href="SQL.html"><code>SQL</code></a> and (on most databases) return the primary key of the inserted row.</p>
          
          

          
          <div class="method-source-code" id="with_sql_insert-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/actions.rb</span>
<span class="line-num">969</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">with_sql_insert</span>(<span class="ruby-identifier">sql</span>)
<span class="line-num">970</span>   <span class="ruby-identifier">execute_insert</span>(<span class="ruby-identifier">sql</span>)
<span class="line-num">971</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-with_sql_single_value" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">with_sql_single_value</span><span
            class="method-args">(sql)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Run the given <a href="SQL.html"><code>SQL</code></a> and return the first value in the first row, or nil if no rows were returned.  For this to make sense, the <a href="SQL.html"><code>SQL</code></a> given should select only a single value.  See with_sql_each.</p>
          
          

          
          <div class="method-source-code" id="with_sql_single_value-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/actions.rb</span>
<span class="line-num">961</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">with_sql_single_value</span>(<span class="ruby-identifier">sql</span>)
<span class="line-num">962</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span> = <span class="ruby-identifier">with_sql_first</span>(<span class="ruby-identifier">sql</span>)
<span class="line-num">963</span>     <span class="ruby-identifier">r</span>.<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">_</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-keyword">return</span> <span class="ruby-identifier">v</span>}
<span class="line-num">964</span>   <span class="ruby-keyword">end</span>
<span class="line-num">965</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-with_sql_update" class="method-detail method-alias">
        
        <div class="method-heading">
          <span class="method-name">with_sql_update</span><span
            class="method-args">(sql)</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
        </div>

        

        
        <div class="aliases">
          Alias for: <a href="Dataset.html#method-i-with_sql_delete">with_sql_delete</a>
        </div>
        
      </div>

    
    </section>
  
     <section id="protected-instance-2+-+Methods+that+execute+code+on+the+database-method-details" class="method-section">
       <header>
         <h3>Protected Instance Methods</h3>
       </header>

    
      <div id="method-i-_import" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">_import</span><span
            class="method-args">(columns, values, opts)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Internals of <a href="Dataset.html#method-i-import"><code>import</code></a>.  If primary key values are requested, use separate insert commands for each row.  Otherwise, call <a href="Dataset.html#method-i-multi_insert_sql"><code>multi_insert_sql</code></a> and execute each statement it gives separately.</p>
          
          

          
          <div class="method-source-code" id="_import-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/actions.rb</span>
<span class="line-num">978</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">_import</span>(<span class="ruby-identifier">columns</span>, <span class="ruby-identifier">values</span>, <span class="ruby-identifier">opts</span>)
<span class="line-num">979</span>   <span class="ruby-identifier">trans_opts</span> = <span class="ruby-constant">Hash</span>[<span class="ruby-identifier">opts</span>]
<span class="line-num">980</span>   <span class="ruby-identifier">trans_opts</span>[<span class="ruby-value">:server</span>] = <span class="ruby-ivar">@opts</span>[<span class="ruby-value">:server</span>]
<span class="line-num">981</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:return</span>] <span class="ruby-operator">==</span> <span class="ruby-value">:primary_key</span>
<span class="line-num">982</span>     <span class="ruby-ivar">@db</span>.<span class="ruby-identifier">transaction</span>(<span class="ruby-identifier">trans_opts</span>){<span class="ruby-identifier">values</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">insert</span>(<span class="ruby-identifier">columns</span>, <span class="ruby-identifier">v</span>)}}
<span class="line-num">983</span>   <span class="ruby-keyword">else</span>
<span class="line-num">984</span>     <span class="ruby-identifier">stmts</span> = <span class="ruby-identifier">multi_insert_sql</span>(<span class="ruby-identifier">columns</span>, <span class="ruby-identifier">values</span>)
<span class="line-num">985</span>     <span class="ruby-ivar">@db</span>.<span class="ruby-identifier">transaction</span>(<span class="ruby-identifier">trans_opts</span>){<span class="ruby-identifier">stmts</span>.<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">st</span><span class="ruby-operator">|</span> <span class="ruby-identifier">execute_dui</span>(<span class="ruby-identifier">st</span>)}}
<span class="line-num">986</span>   <span class="ruby-keyword">end</span>
<span class="line-num">987</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-_select_map_multiple" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">_select_map_multiple</span><span
            class="method-args">(ret_cols)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Return an array of arrays of values given by the symbols in ret_cols.</p>
          
          

          
          <div class="method-source-code" id="_select_map_multiple-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/actions.rb</span>
<span class="line-num">990</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">_select_map_multiple</span>(<span class="ruby-identifier">ret_cols</span>)
<span class="line-num">991</span>   <span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">values_at</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">ret_cols</span>)}
<span class="line-num">992</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-_select_map_single" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">_select_map_single</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns an array of the first value in each row.</p>
          
          

          
          <div class="method-source-code" id="_select_map_single-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/actions.rb</span>
<span class="line-num">995</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">_select_map_single</span>
<span class="line-num">996</span>   <span class="ruby-identifier">k</span> = <span class="ruby-keyword">nil</span>
<span class="line-num">997</span>   <span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-identifier">r</span>[<span class="ruby-identifier">k</span><span class="ruby-operator">||=</span><span class="ruby-identifier">r</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">first</span>]}
<span class="line-num">998</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-single_value_ds" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">single_value_ds</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>A dataset for returning single values from the current dataset.</p>
          
          

          
          <div class="method-source-code" id="single_value_ds-source">
            <pre>     <span class="ruby-comment"># File lib/sequel/dataset/actions.rb</span>
<span class="line-num">1001</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">single_value_ds</span>
<span class="line-num">1002</span>   <span class="ruby-identifier">clone</span>(<span class="ruby-value">:limit</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">1</span>).<span class="ruby-identifier">ungraphed</span>.<span class="ruby-identifier">naked</span>
<span class="line-num">1003</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>

  <section id="3+-+User+Methods+relating+to+SQL+Creation" class="documentation-section">
    
    <header class="documentation-section-title">
      <h2>
        3 - User Methods relating to SQL Creation
      </h2>
      <span class="section-click-top">
        <a href="#top">&uarr; top</a>
      </span>
    </header>
    

    

    

    

    
     <section id="public-instance-3+-+User+Methods+relating+to+SQL+Creation-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-exists" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">exists</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns an <a href="Dataset.html#EXISTS"><code>EXISTS</code></a> clause for the dataset as an <a href="SQL/PlaceholderLiteralString.html"><code>SQL::PlaceholderLiteralString</code></a>.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>.<span class="ruby-identifier">select</span>(<span class="ruby-value">1</span>).<span class="ruby-identifier">where</span>(<span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">exists</span>)
<span class="ruby-comment"># SELECT 1 WHERE (EXISTS (SELECT * FROM items))</span>
</pre>
          
          

          
          <div class="method-source-code" id="exists-source">
            <pre>   <span class="ruby-comment"># File lib/sequel/dataset/sql.rb</span>
<span class="line-num">14</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">exists</span>
<span class="line-num">15</span>   <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">PlaceholderLiteralString</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">EXISTS</span>, [<span class="ruby-keyword">self</span>], <span class="ruby-keyword">true</span>)
<span class="line-num">16</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-insert_sql" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">insert_sql</span><span
            class="method-args">(*values)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns an INSERT <a href="SQL.html"><code>SQL</code></a> query string.  See <code>insert</code>.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">insert_sql</span>(<span class="ruby-value">a:</span> <span class="ruby-value">1</span>)
<span class="ruby-comment"># =&gt; &quot;INSERT INTO items (a) VALUES (1)&quot;</span>
</pre>
          
          

          
          <div class="method-source-code" id="insert_sql-source">
            <pre>   <span class="ruby-comment"># File lib/sequel/dataset/sql.rb</span>
<span class="line-num">22</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">insert_sql</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">values</span>)
<span class="line-num">23</span>   <span class="ruby-keyword">return</span> <span class="ruby-identifier">static_sql</span>(<span class="ruby-ivar">@opts</span>[<span class="ruby-value">:sql</span>]) <span class="ruby-keyword">if</span> <span class="ruby-ivar">@opts</span>[<span class="ruby-value">:sql</span>]
<span class="line-num">24</span> 
<span class="line-num">25</span>   <span class="ruby-identifier">check_insert_allowed!</span>
<span class="line-num">26</span> 
<span class="line-num">27</span>   <span class="ruby-identifier">columns</span> = []
<span class="line-num">28</span> 
<span class="line-num">29</span>   <span class="ruby-keyword">case</span> <span class="ruby-identifier">values</span>.<span class="ruby-identifier">size</span>
<span class="line-num">30</span>   <span class="ruby-keyword">when</span> <span class="ruby-value">0</span>
<span class="line-num">31</span>     <span class="ruby-keyword">return</span> <span class="ruby-identifier">insert_sql</span>(<span class="ruby-constant">OPTS</span>)
<span class="line-num">32</span>   <span class="ruby-keyword">when</span> <span class="ruby-value">1</span>
<span class="line-num">33</span>     <span class="ruby-keyword">case</span> <span class="ruby-identifier">vals</span> = <span class="ruby-identifier">values</span>[<span class="ruby-value">0</span>]
<span class="line-num">34</span>     <span class="ruby-keyword">when</span> <span class="ruby-constant">Hash</span>
<span class="line-num">35</span>       <span class="ruby-identifier">values</span> = []
<span class="line-num">36</span>       <span class="ruby-identifier">vals</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span> 
<span class="line-num">37</span>         <span class="ruby-identifier">columns</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">k</span>
<span class="line-num">38</span>         <span class="ruby-identifier">values</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">v</span>
<span class="line-num">39</span>       <span class="ruby-keyword">end</span>
<span class="line-num">40</span>     <span class="ruby-keyword">when</span> <span class="ruby-constant">Dataset</span>, <span class="ruby-constant">Array</span>, <span class="ruby-constant">LiteralString</span>
<span class="line-num">41</span>       <span class="ruby-identifier">values</span> = <span class="ruby-identifier">vals</span>
<span class="line-num">42</span>     <span class="ruby-keyword">end</span>
<span class="line-num">43</span>   <span class="ruby-keyword">when</span> <span class="ruby-value">2</span>
<span class="line-num">44</span>     <span class="ruby-keyword">if</span> (<span class="ruby-identifier">v0</span> = <span class="ruby-identifier">values</span>[<span class="ruby-value">0</span>]).<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>) <span class="ruby-operator">&amp;&amp;</span> ((<span class="ruby-identifier">v1</span> = <span class="ruby-identifier">values</span>[<span class="ruby-value">1</span>]).<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">v1</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Dataset</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">v1</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">LiteralString</span>))
<span class="line-num">45</span>       <span class="ruby-identifier">columns</span>, <span class="ruby-identifier">values</span> = <span class="ruby-identifier">v0</span>, <span class="ruby-identifier">v1</span>
<span class="line-num">46</span>       <span class="ruby-identifier">raise</span>(<span class="ruby-constant">Error</span>, <span class="ruby-string">&quot;Different number of values and columns given to insert_sql&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">values</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>) <span class="ruby-keyword">and</span> <span class="ruby-identifier">columns</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">values</span>.<span class="ruby-identifier">length</span>
<span class="line-num">47</span>     <span class="ruby-keyword">end</span>
<span class="line-num">48</span>   <span class="ruby-keyword">end</span>
<span class="line-num">49</span> 
<span class="line-num">50</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">values</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">values</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">insert_supports_empty_values?</span> 
<span class="line-num">51</span>     <span class="ruby-identifier">columns</span>, <span class="ruby-identifier">values</span> = <span class="ruby-identifier">insert_empty_columns_values</span>
<span class="line-num">52</span>   <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">values</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Dataset</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">hoist_cte?</span>(<span class="ruby-identifier">values</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">supports_cte?</span>(<span class="ruby-value">:insert</span>)
<span class="line-num">53</span>     <span class="ruby-identifier">ds</span>, <span class="ruby-identifier">values</span> = <span class="ruby-identifier">hoist_cte</span>(<span class="ruby-identifier">values</span>)
<span class="line-num">54</span>     <span class="ruby-keyword">return</span> <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">clone</span>(<span class="ruby-value">:columns</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">columns</span>, <span class="ruby-value">:values</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">values</span>).<span class="ruby-identifier">send</span>(<span class="ruby-value">:_insert_sql</span>)
<span class="line-num">55</span>   <span class="ruby-keyword">end</span>
<span class="line-num">56</span>   <span class="ruby-identifier">clone</span>(<span class="ruby-value">:columns</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">columns</span>, <span class="ruby-value">:values</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">values</span>).<span class="ruby-identifier">send</span>(<span class="ruby-value">:_insert_sql</span>)
<span class="line-num">57</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-literal_append" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">literal_append</span><span
            class="method-args">(sql, v)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Append a literal representation of a value to the given <a href="SQL.html"><code>SQL</code></a> string.</p>

<p>If an unsupported object is given, an <code>Error</code> is raised.</p>
          
          

          
          <div class="method-source-code" id="literal_append-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/sql.rb</span>
<span class="line-num"> 62</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">literal_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">v</span>)
<span class="line-num"> 63</span>   <span class="ruby-keyword">case</span> <span class="ruby-identifier">v</span>
<span class="line-num"> 64</span>   <span class="ruby-keyword">when</span> <span class="ruby-constant">Symbol</span>
<span class="line-num"> 65</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">skip_symbol_cache?</span>
<span class="line-num"> 66</span>       <span class="ruby-identifier">literal_symbol_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">v</span>)
<span class="line-num"> 67</span>     <span class="ruby-keyword">else</span> 
<span class="line-num"> 68</span>       <span class="ruby-keyword">unless</span> <span class="ruby-identifier">l</span> = <span class="ruby-identifier">db</span>.<span class="ruby-identifier">literal_symbol</span>(<span class="ruby-identifier">v</span>)
<span class="line-num"> 69</span>         <span class="ruby-identifier">l</span> = <span class="ruby-constant">String</span>.<span class="ruby-identifier">new</span>
<span class="line-num"> 70</span>         <span class="ruby-identifier">literal_symbol_append</span>(<span class="ruby-identifier">l</span>, <span class="ruby-identifier">v</span>)
<span class="line-num"> 71</span>         <span class="ruby-identifier">db</span>.<span class="ruby-identifier">literal_symbol_set</span>(<span class="ruby-identifier">v</span>, <span class="ruby-identifier">l</span>)
<span class="line-num"> 72</span>       <span class="ruby-keyword">end</span>
<span class="line-num"> 73</span>       <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">l</span>
<span class="line-num"> 74</span>     <span class="ruby-keyword">end</span>
<span class="line-num"> 75</span>   <span class="ruby-keyword">when</span> <span class="ruby-constant">String</span>
<span class="line-num"> 76</span>     <span class="ruby-keyword">case</span> <span class="ruby-identifier">v</span>
<span class="line-num"> 77</span>     <span class="ruby-keyword">when</span> <span class="ruby-constant">LiteralString</span>
<span class="line-num"> 78</span>       <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">v</span>
<span class="line-num"> 79</span>     <span class="ruby-keyword">when</span> <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">Blob</span>
<span class="line-num"> 80</span>       <span class="ruby-identifier">literal_blob_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">v</span>)
<span class="line-num"> 81</span>     <span class="ruby-keyword">else</span>
<span class="line-num"> 82</span>       <span class="ruby-identifier">literal_string_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">v</span>)
<span class="line-num"> 83</span>     <span class="ruby-keyword">end</span>
<span class="line-num"> 84</span>   <span class="ruby-keyword">when</span> <span class="ruby-constant">Integer</span>
<span class="line-num"> 85</span>     <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">literal_integer</span>(<span class="ruby-identifier">v</span>)
<span class="line-num"> 86</span>   <span class="ruby-keyword">when</span> <span class="ruby-constant">Hash</span>
<span class="line-num"> 87</span>     <span class="ruby-identifier">literal_hash_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">v</span>)
<span class="line-num"> 88</span>   <span class="ruby-keyword">when</span> <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">Expression</span>
<span class="line-num"> 89</span>     <span class="ruby-identifier">literal_expression_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">v</span>)
<span class="line-num"> 90</span>   <span class="ruby-keyword">when</span> <span class="ruby-constant">Float</span>
<span class="line-num"> 91</span>     <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">literal_float</span>(<span class="ruby-identifier">v</span>)
<span class="line-num"> 92</span>   <span class="ruby-keyword">when</span> <span class="ruby-constant">BigDecimal</span>
<span class="line-num"> 93</span>     <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">literal_big_decimal</span>(<span class="ruby-identifier">v</span>)
<span class="line-num"> 94</span>   <span class="ruby-keyword">when</span> <span class="ruby-constant">NilClass</span>
<span class="line-num"> 95</span>     <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">literal_nil</span>
<span class="line-num"> 96</span>   <span class="ruby-keyword">when</span> <span class="ruby-constant">TrueClass</span>
<span class="line-num"> 97</span>     <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">literal_true</span>
<span class="line-num"> 98</span>   <span class="ruby-keyword">when</span> <span class="ruby-constant">FalseClass</span>
<span class="line-num"> 99</span>     <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">literal_false</span>
<span class="line-num">100</span>   <span class="ruby-keyword">when</span> <span class="ruby-constant">Array</span>
<span class="line-num">101</span>     <span class="ruby-identifier">literal_array_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">v</span>)
<span class="line-num">102</span>   <span class="ruby-keyword">when</span> <span class="ruby-constant">Time</span>
<span class="line-num">103</span>     <span class="ruby-identifier">v</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">SQLTime</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">literal_sqltime_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">v</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">literal_time_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">v</span>)
<span class="line-num">104</span>   <span class="ruby-keyword">when</span> <span class="ruby-constant">DateTime</span>
<span class="line-num">105</span>     <span class="ruby-identifier">literal_datetime_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">v</span>)
<span class="line-num">106</span>   <span class="ruby-keyword">when</span> <span class="ruby-constant">Date</span>
<span class="line-num">107</span>     <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">literal_date</span>(<span class="ruby-identifier">v</span>)
<span class="line-num">108</span>   <span class="ruby-keyword">when</span> <span class="ruby-constant">Dataset</span>
<span class="line-num">109</span>     <span class="ruby-identifier">literal_dataset_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">v</span>)
<span class="line-num">110</span>   <span class="ruby-keyword">else</span>
<span class="line-num">111</span>     <span class="ruby-identifier">literal_other_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">v</span>)
<span class="line-num">112</span>   <span class="ruby-keyword">end</span>
<span class="line-num">113</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-multi_insert_sql" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">multi_insert_sql</span><span
            class="method-args">(columns, values)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns an array of insert statements for inserting multiple records. This method is used by <code>multi_insert</code> to format insert statements and expects a keys array and and an array of value arrays.</p>
          
          

          
          <div class="method-source-code" id="multi_insert_sql-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/sql.rb</span>
<span class="line-num">118</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">multi_insert_sql</span>(<span class="ruby-identifier">columns</span>, <span class="ruby-identifier">values</span>)
<span class="line-num">119</span>   <span class="ruby-keyword">case</span> <span class="ruby-identifier">multi_insert_sql_strategy</span>
<span class="line-num">120</span>   <span class="ruby-keyword">when</span> <span class="ruby-value">:values</span>
<span class="line-num">121</span>     <span class="ruby-identifier">sql</span> = <span class="ruby-constant">LiteralString</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&#39;VALUES &#39;</span>)
<span class="line-num">122</span>     <span class="ruby-identifier">expression_list_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">values</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-constant">Array</span>(<span class="ruby-identifier">r</span>)})
<span class="line-num">123</span>     [<span class="ruby-identifier">insert_sql</span>(<span class="ruby-identifier">columns</span>, <span class="ruby-identifier">sql</span>)]
<span class="line-num">124</span>   <span class="ruby-keyword">when</span> <span class="ruby-value">:union</span>
<span class="line-num">125</span>     <span class="ruby-identifier">c</span> = <span class="ruby-keyword">false</span>
<span class="line-num">126</span>     <span class="ruby-identifier">sql</span> = <span class="ruby-constant">LiteralString</span>.<span class="ruby-identifier">new</span>
<span class="line-num">127</span>     <span class="ruby-identifier">u</span> = <span class="ruby-string">&#39; UNION ALL SELECT &#39;</span>
<span class="line-num">128</span>     <span class="ruby-identifier">f</span> = <span class="ruby-identifier">empty_from_sql</span>
<span class="line-num">129</span>     <span class="ruby-identifier">values</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
<span class="line-num">130</span>       <span class="ruby-keyword">if</span> <span class="ruby-identifier">c</span>
<span class="line-num">131</span>         <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">u</span>
<span class="line-num">132</span>       <span class="ruby-keyword">else</span>
<span class="line-num">133</span>         <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;SELECT &#39;</span>
<span class="line-num">134</span>         <span class="ruby-identifier">c</span> = <span class="ruby-keyword">true</span>
<span class="line-num">135</span>       <span class="ruby-keyword">end</span>
<span class="line-num">136</span>       <span class="ruby-identifier">expression_list_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">v</span>)
<span class="line-num">137</span>       <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">f</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">f</span>
<span class="line-num">138</span>     <span class="ruby-keyword">end</span>
<span class="line-num">139</span>     [<span class="ruby-identifier">insert_sql</span>(<span class="ruby-identifier">columns</span>, <span class="ruby-identifier">sql</span>)]
<span class="line-num">140</span>   <span class="ruby-keyword">else</span>
<span class="line-num">141</span>     <span class="ruby-identifier">values</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-identifier">insert_sql</span>(<span class="ruby-identifier">columns</span>, <span class="ruby-identifier">r</span>)}
<span class="line-num">142</span>   <span class="ruby-keyword">end</span>
<span class="line-num">143</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-sql" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">sql</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Same as <code>select_sql</code>, not aliased directly to make subclassing simpler.</p>
          
          

          
          <div class="method-source-code" id="sql-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/sql.rb</span>
<span class="line-num">146</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">sql</span>
<span class="line-num">147</span>   <span class="ruby-identifier">select_sql</span>
<span class="line-num">148</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-truncate_sql" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">truncate_sql</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns a TRUNCATE <a href="SQL.html"><code>SQL</code></a> query string.  See <code>truncate</code></p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">truncate_sql</span> <span class="ruby-comment"># =&gt; &#39;TRUNCATE items&#39;</span>
</pre>
          
          

          
          <div class="method-source-code" id="truncate_sql-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/sql.rb</span>
<span class="line-num">153</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">truncate_sql</span>
<span class="line-num">154</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:sql</span>]
<span class="line-num">155</span>     <span class="ruby-identifier">static_sql</span>(<span class="ruby-identifier">opts</span>[<span class="ruby-value">:sql</span>])
<span class="line-num">156</span>   <span class="ruby-keyword">else</span>
<span class="line-num">157</span>     <span class="ruby-identifier">check_truncation_allowed!</span>
<span class="line-num">158</span>     <span class="ruby-identifier">check_not_limited!</span>(<span class="ruby-value">:truncate</span>)
<span class="line-num">159</span>     <span class="ruby-identifier">raise</span>(<span class="ruby-constant">InvalidOperation</span>, <span class="ruby-string">&quot;Can&#39;t truncate filtered datasets&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:where</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:having</span>]
<span class="line-num">160</span>     <span class="ruby-identifier">t</span> = <span class="ruby-constant">String</span>.<span class="ruby-identifier">new</span>
<span class="line-num">161</span>     <span class="ruby-identifier">source_list_append</span>(<span class="ruby-identifier">t</span>, <span class="ruby-identifier">opts</span>[<span class="ruby-value">:from</span>])
<span class="line-num">162</span>     <span class="ruby-identifier">_truncate_sql</span>(<span class="ruby-identifier">t</span>)
<span class="line-num">163</span>   <span class="ruby-keyword">end</span>
<span class="line-num">164</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-update_sql" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_sql</span><span
            class="method-args">(values = OPTS)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Formats an UPDATE statement using the given values.  See <code>update</code>.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:items</span>].<span class="ruby-identifier">update_sql</span>(<span class="ruby-value">price:</span> <span class="ruby-value">100</span>, <span class="ruby-value">category:</span> <span class="ruby-string">&#39;software&#39;</span>)
<span class="ruby-comment"># =&gt; &quot;UPDATE items SET price = 100, category = &#39;software&#39;</span>
</pre>

<p>Raises an <code>Error</code> if the dataset is grouped or includes more than one table.</p>
          
          

          
          <div class="method-source-code" id="update_sql-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/sql.rb</span>
<span class="line-num">173</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">update_sql</span>(<span class="ruby-identifier">values</span> = <span class="ruby-constant">OPTS</span>)
<span class="line-num">174</span>   <span class="ruby-keyword">return</span> <span class="ruby-identifier">static_sql</span>(<span class="ruby-identifier">opts</span>[<span class="ruby-value">:sql</span>]) <span class="ruby-keyword">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:sql</span>]
<span class="line-num">175</span>   <span class="ruby-identifier">check_update_allowed!</span>
<span class="line-num">176</span>   <span class="ruby-identifier">check_not_limited!</span>(<span class="ruby-value">:update</span>)
<span class="line-num">177</span> 
<span class="line-num">178</span>   <span class="ruby-keyword">case</span> <span class="ruby-identifier">values</span>
<span class="line-num">179</span>   <span class="ruby-keyword">when</span> <span class="ruby-constant">LiteralString</span>
<span class="line-num">180</span>     <span class="ruby-comment"># nothing</span>
<span class="line-num">181</span>   <span class="ruby-keyword">when</span> <span class="ruby-constant">String</span>
<span class="line-num">182</span>     <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-string">&quot;plain string passed to Dataset#update is not supported, use Sequel.lit to use a literal string&quot;</span>
<span class="line-num">183</span>   <span class="ruby-keyword">end</span>
<span class="line-num">184</span> 
<span class="line-num">185</span>   <span class="ruby-identifier">clone</span>(<span class="ruby-value">:values</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">values</span>).<span class="ruby-identifier">send</span>(<span class="ruby-value">:_update_sql</span>)
<span class="line-num">186</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>

  <section id="4+-+Methods+that+describe+what+the+dataset+supports" class="documentation-section">
    
    <header class="documentation-section-title">
      <h2>
        4 - Methods that describe what the dataset supports
      </h2>
      <span class="section-click-top">
        <a href="#top">&uarr; top</a>
      </span>
    </header>
    

    

    

    

    
     <section id="public-instance-4+-+Methods+that+describe+what+the+dataset+supports-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-provides_accurate_rows_matched-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">provides_accurate_rows_matched?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Whether this dataset will provide accurate number of rows matched for delete and update statements, true by default.  Accurate in this case is the number of rows matched by the dataset&#39;s filter.</p>
          
          

          
          <div class="method-source-code" id="provides_accurate_rows_matched-3F-source">
            <pre>   <span class="ruby-comment"># File lib/sequel/dataset/features.rb</span>
<span class="line-num">19</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">provides_accurate_rows_matched?</span>
<span class="line-num">20</span>   <span class="ruby-keyword">true</span>
<span class="line-num">21</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-quote_identifiers-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">quote_identifiers?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Whether this dataset quotes identifiers.</p>
          
          

          
          <div class="method-source-code" id="quote_identifiers-3F-source">
            <pre>   <span class="ruby-comment"># File lib/sequel/dataset/features.rb</span>
<span class="line-num">12</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">quote_identifiers?</span>
<span class="line-num">13</span>   <span class="ruby-ivar">@opts</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-value">:quote_identifiers</span>, <span class="ruby-keyword">true</span>)
<span class="line-num">14</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-recursive_cte_requires_column_aliases-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">recursive_cte_requires_column_aliases?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Whether you must use a column alias list for recursive CTEs, false by default.</p>
          
          

          
          <div class="method-source-code" id="recursive_cte_requires_column_aliases-3F-source">
            <pre>   <span class="ruby-comment"># File lib/sequel/dataset/features.rb</span>
<span class="line-num">24</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">recursive_cte_requires_column_aliases?</span>
<span class="line-num">25</span>   <span class="ruby-keyword">false</span>
<span class="line-num">26</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-requires_placeholder_type_specifiers-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">requires_placeholder_type_specifiers?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Whether type specifiers are required for prepared statement/bound variable argument placeholders (i.e. :bv__integer), false by default.</p>
          
          

          
          <div class="method-source-code" id="requires_placeholder_type_specifiers-3F-source">
            <pre>   <span class="ruby-comment"># File lib/sequel/dataset/features.rb</span>
<span class="line-num">36</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">requires_placeholder_type_specifiers?</span>
<span class="line-num">37</span>   <span class="ruby-keyword">false</span>
<span class="line-num">38</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-requires_sql_standard_datetimes-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">requires_sql_standard_datetimes?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Whether the dataset requires <a href="SQL.html"><code>SQL</code></a> standard datetimes. False by default, as most allow strings with ISO 8601 format.</p>
          
          

          
          <div class="method-source-code" id="requires_sql_standard_datetimes-3F-source">
            <pre>   <span class="ruby-comment"># File lib/sequel/dataset/features.rb</span>
<span class="line-num">30</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">requires_sql_standard_datetimes?</span>
<span class="line-num">31</span>   <span class="ruby-keyword">false</span>
<span class="line-num">32</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-supports_cte-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">supports_cte?</span><span
            class="method-args">(type=:select)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Whether the dataset supports common table expressions, false by default. If given, <code>type</code> can be :select, :insert, :update, or :delete, in which case it determines whether WITH is supported for the respective statement type.</p>
          
          

          
          <div class="method-source-code" id="supports_cte-3F-source">
            <pre>   <span class="ruby-comment"># File lib/sequel/dataset/features.rb</span>
<span class="line-num">43</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_cte?</span>(<span class="ruby-identifier">type</span>=<span class="ruby-value">:select</span>)
<span class="line-num">44</span>   <span class="ruby-keyword">false</span>
<span class="line-num">45</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-supports_cte_in_subqueries-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">supports_cte_in_subqueries?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Whether the dataset supports common table expressions in subqueries, false by default. If false, applies the WITH clause to the main query, which can cause issues if multiple WITH clauses use the same name.</p>
          
          

          
          <div class="method-source-code" id="supports_cte_in_subqueries-3F-source">
            <pre>   <span class="ruby-comment"># File lib/sequel/dataset/features.rb</span>
<span class="line-num">50</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_cte_in_subqueries?</span>
<span class="line-num">51</span>   <span class="ruby-keyword">false</span>
<span class="line-num">52</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-supports_deleting_joins-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">supports_deleting_joins?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Whether deleting from joined datasets is supported, false by default.</p>
          
          

          
          <div class="method-source-code" id="supports_deleting_joins-3F-source">
            <pre>   <span class="ruby-comment"># File lib/sequel/dataset/features.rb</span>
<span class="line-num">55</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_deleting_joins?</span>
<span class="line-num">56</span>   <span class="ruby-identifier">supports_modifying_joins?</span>
<span class="line-num">57</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-supports_derived_column_lists-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">supports_derived_column_lists?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Whether the database supports derived column lists (e.g. “table_expr AS table_alias(column_alias1, column_alias2, …)”), true by default.</p>
          
          

          
          <div class="method-source-code" id="supports_derived_column_lists-3F-source">
            <pre>   <span class="ruby-comment"># File lib/sequel/dataset/features.rb</span>
<span class="line-num">62</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_derived_column_lists?</span>
<span class="line-num">63</span>   <span class="ruby-keyword">true</span>
<span class="line-num">64</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-supports_distinct_on-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">supports_distinct_on?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Whether the dataset supports or can emulate the DISTINCT ON clause, false by default.</p>
          
          

          
          <div class="method-source-code" id="supports_distinct_on-3F-source">
            <pre>   <span class="ruby-comment"># File lib/sequel/dataset/features.rb</span>
<span class="line-num">67</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_distinct_on?</span>
<span class="line-num">68</span>   <span class="ruby-keyword">false</span>
<span class="line-num">69</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-supports_group_cube-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">supports_group_cube?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Whether the dataset supports CUBE with GROUP BY, false by default.</p>
          
          

          
          <div class="method-source-code" id="supports_group_cube-3F-source">
            <pre>   <span class="ruby-comment"># File lib/sequel/dataset/features.rb</span>
<span class="line-num">72</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_group_cube?</span>
<span class="line-num">73</span>   <span class="ruby-keyword">false</span>
<span class="line-num">74</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-supports_group_rollup-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">supports_group_rollup?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Whether the dataset supports ROLLUP with GROUP BY, false by default.</p>
          
          

          
          <div class="method-source-code" id="supports_group_rollup-3F-source">
            <pre>   <span class="ruby-comment"># File lib/sequel/dataset/features.rb</span>
<span class="line-num">77</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_group_rollup?</span>
<span class="line-num">78</span>   <span class="ruby-keyword">false</span>
<span class="line-num">79</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-supports_grouping_sets-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">supports_grouping_sets?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Whether the dataset supports GROUPING SETS with GROUP BY, false by default.</p>
          
          

          
          <div class="method-source-code" id="supports_grouping_sets-3F-source">
            <pre>   <span class="ruby-comment"># File lib/sequel/dataset/features.rb</span>
<span class="line-num">82</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_grouping_sets?</span>
<span class="line-num">83</span>   <span class="ruby-keyword">false</span>
<span class="line-num">84</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-supports_insert_select-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">supports_insert_select?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Whether this dataset supports the <code>insert_select</code> method for returning all columns values directly from an insert query, false by default.</p>
          
          

          
          <div class="method-source-code" id="supports_insert_select-3F-source">
            <pre>   <span class="ruby-comment"># File lib/sequel/dataset/features.rb</span>
<span class="line-num">88</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_insert_select?</span>
<span class="line-num">89</span>   <span class="ruby-identifier">supports_returning?</span>(<span class="ruby-value">:insert</span>)
<span class="line-num">90</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-supports_intersect_except-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">supports_intersect_except?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Whether the dataset supports the INTERSECT and EXCEPT compound operations, true by default.</p>
          
          

          
          <div class="method-source-code" id="supports_intersect_except-3F-source">
            <pre>   <span class="ruby-comment"># File lib/sequel/dataset/features.rb</span>
<span class="line-num">93</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_intersect_except?</span>
<span class="line-num">94</span>   <span class="ruby-keyword">true</span>
<span class="line-num">95</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-supports_intersect_except_all-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">supports_intersect_except_all?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Whether the dataset supports the INTERSECT ALL and EXCEPT ALL compound operations, true by default.</p>
          
          

          
          <div class="method-source-code" id="supports_intersect_except_all-3F-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/features.rb</span>
<span class="line-num"> 98</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_intersect_except_all?</span>
<span class="line-num"> 99</span>   <span class="ruby-keyword">true</span>
<span class="line-num">100</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-supports_is_true-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">supports_is_true?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Whether the dataset supports the IS TRUE syntax, true by default.</p>
          
          

          
          <div class="method-source-code" id="supports_is_true-3F-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/features.rb</span>
<span class="line-num">103</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_is_true?</span>
<span class="line-num">104</span>   <span class="ruby-keyword">true</span>
<span class="line-num">105</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-supports_join_using-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">supports_join_using?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Whether the dataset supports the JOIN table USING (column1, …) syntax, true by default. If false, support is emulated using JOIN table ON (table.column1 = other_table.column1).</p>
          
          

          
          <div class="method-source-code" id="supports_join_using-3F-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/features.rb</span>
<span class="line-num">109</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_join_using?</span>
<span class="line-num">110</span>   <span class="ruby-keyword">true</span>
<span class="line-num">111</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-supports_lateral_subqueries-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">supports_lateral_subqueries?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Whether the dataset supports LATERAL for subqueries in the FROM or JOIN clauses, false by default.</p>
          
          

          
          <div class="method-source-code" id="supports_lateral_subqueries-3F-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/features.rb</span>
<span class="line-num">114</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_lateral_subqueries?</span>
<span class="line-num">115</span>   <span class="ruby-keyword">false</span>
<span class="line-num">116</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-supports_limits_in_correlated_subqueries-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">supports_limits_in_correlated_subqueries?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Whether limits are supported in correlated subqueries, true by default.</p>
          
          

          
          <div class="method-source-code" id="supports_limits_in_correlated_subqueries-3F-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/features.rb</span>
<span class="line-num">119</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_limits_in_correlated_subqueries?</span>
<span class="line-num">120</span>   <span class="ruby-keyword">true</span>
<span class="line-num">121</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-supports_modifying_joins-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">supports_modifying_joins?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Whether modifying joined datasets is supported, false by default.</p>
          
          

          
          <div class="method-source-code" id="supports_modifying_joins-3F-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/features.rb</span>
<span class="line-num">129</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_modifying_joins?</span>
<span class="line-num">130</span>   <span class="ruby-keyword">false</span>
<span class="line-num">131</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-supports_multiple_column_in-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">supports_multiple_column_in?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Whether the IN/NOT IN operators support multiple columns when an array of values is given, true by default.</p>
          
          

          
          <div class="method-source-code" id="supports_multiple_column_in-3F-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/features.rb</span>
<span class="line-num">135</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_multiple_column_in?</span>
<span class="line-num">136</span>   <span class="ruby-keyword">true</span>
<span class="line-num">137</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-supports_nowait-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">supports_nowait?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Whether the dataset supports skipping raising an error instead of waiting for locked rows when returning data, false by default.</p>
          
          

          
          <div class="method-source-code" id="supports_nowait-3F-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/features.rb</span>
<span class="line-num">124</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_nowait?</span>
<span class="line-num">125</span>   <span class="ruby-keyword">false</span>
<span class="line-num">126</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-supports_offsets_in_correlated_subqueries-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">supports_offsets_in_correlated_subqueries?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Whether offsets are supported in correlated subqueries, true by default.</p>
          
          

          
          <div class="method-source-code" id="supports_offsets_in_correlated_subqueries-3F-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/features.rb</span>
<span class="line-num">140</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_offsets_in_correlated_subqueries?</span>
<span class="line-num">141</span>   <span class="ruby-keyword">true</span>
<span class="line-num">142</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-supports_ordered_distinct_on-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">supports_ordered_distinct_on?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Whether the dataset supports or can fully emulate the DISTINCT ON clause, including respecting the ORDER BY clause, false by default.</p>
          
          

          
          <div class="method-source-code" id="supports_ordered_distinct_on-3F-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/features.rb</span>
<span class="line-num">146</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_ordered_distinct_on?</span>
<span class="line-num">147</span>   <span class="ruby-identifier">supports_distinct_on?</span>
<span class="line-num">148</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-supports_regexp-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">supports_regexp?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Whether the dataset supports pattern matching by regular expressions, false by default.</p>
          
          

          
          <div class="method-source-code" id="supports_regexp-3F-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/features.rb</span>
<span class="line-num">151</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_regexp?</span>
<span class="line-num">152</span>   <span class="ruby-keyword">false</span>
<span class="line-num">153</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-supports_replace-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">supports_replace?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Whether the dataset supports REPLACE syntax, false by default.</p>
          
          

          
          <div class="method-source-code" id="supports_replace-3F-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/features.rb</span>
<span class="line-num">156</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_replace?</span>
<span class="line-num">157</span>   <span class="ruby-keyword">false</span>
<span class="line-num">158</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-supports_returning-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">supports_returning?</span><span
            class="method-args">(type)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Whether the RETURNING clause is supported for the given type of query, false by default. <code>type</code> can be :insert, :update, or :delete.</p>
          
          

          
          <div class="method-source-code" id="supports_returning-3F-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/features.rb</span>
<span class="line-num">162</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_returning?</span>(<span class="ruby-identifier">type</span>)
<span class="line-num">163</span>   <span class="ruby-keyword">false</span>
<span class="line-num">164</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-supports_select_all_and_column-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">supports_select_all_and_column?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Whether the database supports <code>SELECT *, column FROM table</code>, true by default.</p>
          
          

          
          <div class="method-source-code" id="supports_select_all_and_column-3F-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/features.rb</span>
<span class="line-num">172</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_select_all_and_column?</span>
<span class="line-num">173</span>   <span class="ruby-keyword">true</span>
<span class="line-num">174</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-supports_skip_locked-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">supports_skip_locked?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Whether the dataset supports skipping locked rows when returning data, false by default.</p>
          
          

          
          <div class="method-source-code" id="supports_skip_locked-3F-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/features.rb</span>
<span class="line-num">167</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_skip_locked?</span>
<span class="line-num">168</span>   <span class="ruby-keyword">false</span>
<span class="line-num">169</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-supports_timestamp_timezones-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">supports_timestamp_timezones?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Whether the dataset supports timezones in literal timestamps, false by default.</p>
          
          

          
          <div class="method-source-code" id="supports_timestamp_timezones-3F-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/features.rb</span>
<span class="line-num">177</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_timestamp_timezones?</span>
<span class="line-num">178</span>   <span class="ruby-keyword">false</span>
<span class="line-num">179</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-supports_timestamp_usecs-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">supports_timestamp_usecs?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Whether the dataset supports fractional seconds in literal timestamps, true by default.</p>
          
          

          
          <div class="method-source-code" id="supports_timestamp_usecs-3F-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/features.rb</span>
<span class="line-num">182</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_timestamp_usecs?</span>
<span class="line-num">183</span>   <span class="ruby-keyword">true</span>
<span class="line-num">184</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-supports_updating_joins-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">supports_updating_joins?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Whether updating joined datasets is supported, false by default.</p>
          
          

          
          <div class="method-source-code" id="supports_updating_joins-3F-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/features.rb</span>
<span class="line-num">187</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_updating_joins?</span>
<span class="line-num">188</span>   <span class="ruby-identifier">supports_modifying_joins?</span>
<span class="line-num">189</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-supports_where_true-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">supports_where_true?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Whether the dataset supports WHERE TRUE (or WHERE 1 for databases that that use 1 for true), true by default.</p>
          
          

          
          <div class="method-source-code" id="supports_where_true-3F-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/features.rb</span>
<span class="line-num">216</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_where_true?</span>
<span class="line-num">217</span>   <span class="ruby-keyword">true</span>
<span class="line-num">218</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-supports_window_clause-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">supports_window_clause?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Whether the dataset supports the WINDOW clause to define windows used by multiple window functions, false by default.</p>
          
          

          
          <div class="method-source-code" id="supports_window_clause-3F-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/features.rb</span>
<span class="line-num">193</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_window_clause?</span>
<span class="line-num">194</span>   <span class="ruby-keyword">false</span>
<span class="line-num">195</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-supports_window_function_frame_option-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">supports_window_function_frame_option?</span><span
            class="method-args">(option)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Whether the dataset supports the given window function option.  True by default. This should only be called if supports_window_functions? is true. Possible options are :rows, :range, :groups, :offset, :exclude.</p>
          
          

          
          <div class="method-source-code" id="supports_window_function_frame_option-3F-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/features.rb</span>
<span class="line-num">205</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_window_function_frame_option?</span>(<span class="ruby-identifier">option</span>)
<span class="line-num">206</span>   <span class="ruby-keyword">case</span> <span class="ruby-identifier">option</span>
<span class="line-num">207</span>   <span class="ruby-keyword">when</span> <span class="ruby-value">:rows</span>, <span class="ruby-value">:range</span>, <span class="ruby-value">:offset</span>
<span class="line-num">208</span>     <span class="ruby-keyword">true</span>
<span class="line-num">209</span>   <span class="ruby-keyword">else</span>
<span class="line-num">210</span>     <span class="ruby-keyword">false</span>
<span class="line-num">211</span>   <span class="ruby-keyword">end</span>
<span class="line-num">212</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-supports_window_functions-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">supports_window_functions?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Whether the dataset supports window functions, false by default.</p>
          
          

          
          <div class="method-source-code" id="supports_window_functions-3F-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/features.rb</span>
<span class="line-num">198</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">supports_window_functions?</span>
<span class="line-num">199</span>   <span class="ruby-keyword">false</span>
<span class="line-num">200</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>

  <section id="5+-+Methods+related+to+dataset+graphing" class="documentation-section">
    
    <header class="documentation-section-title">
      <h2>
        5 - Methods related to dataset graphing
      </h2>
      <span class="section-click-top">
        <a href="#top">&uarr; top</a>
      </span>
    </header>
    

    

    

    

    
     <section id="public-instance-5+-+Methods+related+to+dataset+graphing-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-add_graph_aliases" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">add_graph_aliases</span><span
            class="method-args">(graph_aliases)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Adds the given graph aliases to the list of graph aliases to use, unlike <code>set_graph_aliases</code>, which replaces the list (the equivalent of <code>select_append</code> when graphing).  See <code>set_graph_aliases</code>.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">add_graph_aliases</span>(<span class="ruby-value">some_alias:</span> [<span class="ruby-value">:table</span>, <span class="ruby-value">:column</span>])
<span class="ruby-comment"># SELECT ..., table.column AS some_alias</span>
</pre>
          
          

          
          <div class="method-source-code" id="add_graph_aliases-source">
            <pre>   <span class="ruby-comment"># File lib/sequel/dataset/graph.rb</span>
<span class="line-num">18</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">add_graph_aliases</span>(<span class="ruby-identifier">graph_aliases</span>)
<span class="line-num">19</span>   <span class="ruby-identifier">graph</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:graph</span>]
<span class="line-num">20</span>   <span class="ruby-keyword">unless</span> (<span class="ruby-identifier">graph</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">ga</span> = <span class="ruby-identifier">graph</span>[<span class="ruby-value">:column_aliases</span>]))
<span class="line-num">21</span>     <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-string">&quot;cannot call add_graph_aliases on a dataset that has not been called with graph or set_graph_aliases&quot;</span>
<span class="line-num">22</span>   <span class="ruby-keyword">end</span>
<span class="line-num">23</span>   <span class="ruby-identifier">columns</span>, <span class="ruby-identifier">graph_aliases</span> = <span class="ruby-identifier">graph_alias_columns</span>(<span class="ruby-identifier">graph_aliases</span>)
<span class="line-num">24</span>   <span class="ruby-identifier">select_append</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">columns</span>).<span class="ruby-identifier">clone</span>(<span class="ruby-value">:graph</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">graph</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-value">:column_aliases</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">ga</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">graph_aliases</span>).<span class="ruby-identifier">freeze</span>).<span class="ruby-identifier">freeze</span>)
<span class="line-num">25</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-graph" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">graph</span><span
            class="method-args">(dataset, join_conditions = nil, options = OPTS, &amp;block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Similar to <a href="Dataset.html#method-i-join_table"><code>Dataset#join_table</code></a>, but uses unambiguous aliases for selected columns and keeps metadata about the aliases for use in other methods.</p>

<p>Arguments:</p>
<dl class="rdoc-list note-list"><dt>dataset 
<dd>
<p>Can be a symbol (specifying a table), another dataset, or an <a href="SQL/Identifier.html"><code>SQL::Identifier</code></a>, <a href="SQL/QualifiedIdentifier.html"><code>SQL::QualifiedIdentifier</code></a>, or <a href="SQL/AliasedExpression.html"><code>SQL::AliasedExpression</code></a>.</p>
</dd><dt>join_conditions 
<dd>
<p>Any condition(s) allowed by <code>join_table</code>.</p>
</dd><dt>block 
<dd>
<p>A block that is passed to <code>join_table</code>.</p>
</dd></dl>

<p>Options:</p>
<dl class="rdoc-list note-list"><dt>:from_self_alias 
<dd>
<p>The alias to use when the receiver is not a graphed dataset but it contains multiple FROM tables or a JOIN.  In this case, the receiver is wrapped in a <a href="Dataset.html#method-i-from_self"><code>from_self</code></a> before graphing, and this option determines the alias to use.</p>
</dd><dt>:implicit_qualifier 
<dd>
<p>The qualifier of implicit conditions, see <a href="Dataset.html#method-i-join_table"><code>join_table</code></a>.</p>
</dd><dt>:join_only 
<dd>
<p>Only join the tables, do not change the selected columns.</p>
</dd><dt>:join_type 
<dd>
<p>The type of join to use (passed to <code>join_table</code>).  Defaults to :left_outer.</p>
</dd><dt>:qualify
<dd>
<p>The type of qualification to do, see <a href="Dataset.html#method-i-join_table"><code>join_table</code></a>.</p>
</dd><dt>:select 
<dd>
<p>An array of columns to select.  When not used, selects all columns in the given dataset.  When set to false, selects no columns and is like simply joining the tables, though graph keeps some metadata about the join that makes it important to use <code>graph</code> instead of <code>join_table</code>.</p>
</dd><dt>:table_alias 
<dd>
<p>The alias to use for the table.  If not specified, doesn&#39;t alias the table.  You will get an error if the alias (or table) name is used more than once.</p>
</dd></dl>
          
          

          
          <div class="method-source-code" id="graph-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/graph.rb</span>
<span class="line-num"> 53</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">graph</span>(<span class="ruby-identifier">dataset</span>, <span class="ruby-identifier">join_conditions</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">options</span> = <span class="ruby-constant">OPTS</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num"> 54</span>   <span class="ruby-comment"># Allow the use of a dataset or symbol as the first argument</span>
<span class="line-num"> 55</span>   <span class="ruby-comment"># Find the table name/dataset based on the argument</span>
<span class="line-num"> 56</span>   <span class="ruby-identifier">table_alias</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:table_alias</span>]
<span class="line-num"> 57</span>   <span class="ruby-identifier">table</span> = <span class="ruby-identifier">dataset</span>
<span class="line-num"> 58</span>   <span class="ruby-identifier">create_dataset</span> = <span class="ruby-keyword">true</span>
<span class="line-num"> 59</span> 
<span class="line-num"> 60</span>   <span class="ruby-keyword">case</span> <span class="ruby-identifier">dataset</span>
<span class="line-num"> 61</span>   <span class="ruby-keyword">when</span> <span class="ruby-constant">Symbol</span>
<span class="line-num"> 62</span>     <span class="ruby-comment"># let alias be the same as the table name (sans any optional schema)</span>
<span class="line-num"> 63</span>     <span class="ruby-comment"># unless alias explicitly given in the symbol using ___ notation and symbol splitting is enabled</span>
<span class="line-num"> 64</span>     <span class="ruby-identifier">table_alias</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">split_symbol</span>(<span class="ruby-identifier">table</span>).<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">last</span>
<span class="line-num"> 65</span>   <span class="ruby-keyword">when</span> <span class="ruby-constant">Dataset</span>
<span class="line-num"> 66</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">simple_select_all?</span>
<span class="line-num"> 67</span>       <span class="ruby-identifier">table</span> = <span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">opts</span>[<span class="ruby-value">:from</span>].<span class="ruby-identifier">first</span>
<span class="line-num"> 68</span>       <span class="ruby-identifier">table_alias</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">table</span>
<span class="line-num"> 69</span>     <span class="ruby-keyword">else</span>
<span class="line-num"> 70</span>       <span class="ruby-identifier">table_alias</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">dataset_alias</span>((<span class="ruby-ivar">@opts</span>[<span class="ruby-value">:num_dataset_sources</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>)<span class="ruby-value">+1</span>)
<span class="line-num"> 71</span>     <span class="ruby-keyword">end</span>
<span class="line-num"> 72</span>     <span class="ruby-identifier">create_dataset</span> = <span class="ruby-keyword">false</span>
<span class="line-num"> 73</span>   <span class="ruby-keyword">when</span> <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">Identifier</span>
<span class="line-num"> 74</span>     <span class="ruby-identifier">table_alias</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">table</span>.<span class="ruby-identifier">value</span>
<span class="line-num"> 75</span>   <span class="ruby-keyword">when</span> <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">QualifiedIdentifier</span>
<span class="line-num"> 76</span>     <span class="ruby-identifier">table_alias</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">split_qualifiers</span>(<span class="ruby-identifier">table</span>).<span class="ruby-identifier">last</span>
<span class="line-num"> 77</span>   <span class="ruby-keyword">when</span> <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">AliasedExpression</span>
<span class="line-num"> 78</span>     <span class="ruby-keyword">return</span> <span class="ruby-identifier">graph</span>(<span class="ruby-identifier">table</span>.<span class="ruby-identifier">expression</span>, <span class="ruby-identifier">join_conditions</span>, {<span class="ruby-value">:table_alias</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">table</span>.<span class="ruby-identifier">alias</span>}.<span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">options</span>), <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num"> 79</span>   <span class="ruby-keyword">else</span>
<span class="line-num"> 80</span>     <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-string">&quot;The dataset argument should be a symbol or dataset&quot;</span>
<span class="line-num"> 81</span>   <span class="ruby-keyword">end</span>
<span class="line-num"> 82</span>   <span class="ruby-identifier">table_alias</span> = <span class="ruby-identifier">table_alias</span>.<span class="ruby-identifier">to_sym</span>
<span class="line-num"> 83</span> 
<span class="line-num"> 84</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">create_dataset</span>
<span class="line-num"> 85</span>     <span class="ruby-identifier">dataset</span> = <span class="ruby-identifier">db</span>.<span class="ruby-identifier">from</span>(<span class="ruby-identifier">table</span>)
<span class="line-num"> 86</span>   <span class="ruby-keyword">end</span>
<span class="line-num"> 87</span> 
<span class="line-num"> 88</span>   <span class="ruby-comment"># Raise Sequel::Error with explanation that the table alias has been used</span>
<span class="line-num"> 89</span>   <span class="ruby-identifier">raise_alias_error</span> = <span class="ruby-identifier">lambda</span> <span class="ruby-keyword">do</span>
<span class="line-num"> 90</span>     <span class="ruby-identifier">raise</span>(<span class="ruby-constant">Error</span>, <span class="ruby-node">&quot;this #{options[:table_alias] ? &#39;alias&#39; : &#39;table&#39;} has already been been used, please specify &quot;</span> \
<span class="line-num"> 91</span>       <span class="ruby-node">&quot;#{options[:table_alias] ? &#39;a different alias&#39; : &#39;an alias via the :table_alias option&#39;}&quot;</span>) 
<span class="line-num"> 92</span>   <span class="ruby-keyword">end</span>
<span class="line-num"> 93</span> 
<span class="line-num"> 94</span>   <span class="ruby-comment"># Only allow table aliases that haven&#39;t been used</span>
<span class="line-num"> 95</span>   <span class="ruby-identifier">raise_alias_error</span>.<span class="ruby-identifier">call</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@opts</span>[<span class="ruby-value">:graph</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@opts</span>[<span class="ruby-value">:graph</span>][<span class="ruby-value">:table_aliases</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@opts</span>[<span class="ruby-value">:graph</span>][<span class="ruby-value">:table_aliases</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">table_alias</span>)
<span class="line-num"> 96</span>   
<span class="line-num"> 97</span>   <span class="ruby-identifier">table_alias_qualifier</span> = <span class="ruby-identifier">qualifier_from_alias_symbol</span>(<span class="ruby-identifier">table_alias</span>, <span class="ruby-identifier">table</span>)
<span class="line-num"> 98</span>   <span class="ruby-identifier">implicit_qualifier</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:implicit_qualifier</span>]
<span class="line-num"> 99</span>   <span class="ruby-identifier">joined_dataset</span> = <span class="ruby-identifier">joined_dataset?</span>
<span class="line-num">100</span>   <span class="ruby-identifier">ds</span> = <span class="ruby-keyword">self</span>
<span class="line-num">101</span>   <span class="ruby-identifier">graph</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:graph</span>]
<span class="line-num">102</span> 
<span class="line-num">103</span>   <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">graph</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">select</span> = <span class="ruby-ivar">@opts</span>[<span class="ruby-value">:select</span>]) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">select</span>.<span class="ruby-identifier">empty?</span>
<span class="line-num">104</span>     <span class="ruby-identifier">select_columns</span> = <span class="ruby-keyword">nil</span>
<span class="line-num">105</span> 
<span class="line-num">106</span>     <span class="ruby-keyword">unless</span> <span class="ruby-operator">!</span><span class="ruby-identifier">joined_dataset</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">select</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">select</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">ColumnAll</span>))
<span class="line-num">107</span>       <span class="ruby-identifier">force_from_self</span> = <span class="ruby-keyword">false</span>
<span class="line-num">108</span>       <span class="ruby-identifier">select_columns</span> = <span class="ruby-identifier">select</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">sel</span><span class="ruby-operator">|</span>
<span class="line-num">109</span>         <span class="ruby-keyword">unless</span> <span class="ruby-identifier">col</span> = <span class="ruby-identifier">_hash_key_symbol</span>(<span class="ruby-identifier">sel</span>)
<span class="line-num">110</span>           <span class="ruby-identifier">force_from_self</span> = <span class="ruby-keyword">true</span>
<span class="line-num">111</span>           <span class="ruby-keyword">break</span>
<span class="line-num">112</span>         <span class="ruby-keyword">end</span>
<span class="line-num">113</span> 
<span class="line-num">114</span>         [<span class="ruby-identifier">sel</span>, <span class="ruby-identifier">col</span>]
<span class="line-num">115</span>       <span class="ruby-keyword">end</span>
<span class="line-num">116</span> 
<span class="line-num">117</span>       <span class="ruby-identifier">select_columns</span> = <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">force_from_self</span>
<span class="line-num">118</span>     <span class="ruby-keyword">end</span>
<span class="line-num">119</span>   <span class="ruby-keyword">end</span>
<span class="line-num">120</span> 
<span class="line-num">121</span>   <span class="ruby-comment"># Use a from_self if this is already a joined table (or from_self specifically disabled for graphs)</span>
<span class="line-num">122</span>   <span class="ruby-keyword">if</span> (<span class="ruby-ivar">@opts</span>[<span class="ruby-value">:graph_from_self</span>] <span class="ruby-operator">!=</span> <span class="ruby-keyword">false</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">graph</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">joined_dataset</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">force_from_self</span>))
<span class="line-num">123</span>     <span class="ruby-identifier">from_selfed</span> = <span class="ruby-keyword">true</span>
<span class="line-num">124</span>     <span class="ruby-identifier">implicit_qualifier</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:from_self_alias</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">first_source</span>
<span class="line-num">125</span>     <span class="ruby-identifier">ds</span> = <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">from_self</span>(<span class="ruby-value">:alias</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">implicit_qualifier</span>)
<span class="line-num">126</span>   <span class="ruby-keyword">end</span>
<span class="line-num">127</span>   
<span class="line-num">128</span>   <span class="ruby-comment"># Join the table early in order to avoid cloning the dataset twice</span>
<span class="line-num">129</span>   <span class="ruby-identifier">ds</span> = <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">join_table</span>(<span class="ruby-identifier">options</span>[<span class="ruby-value">:join_type</span>] <span class="ruby-operator">||</span> <span class="ruby-value">:left_outer</span>, <span class="ruby-identifier">table</span>, <span class="ruby-identifier">join_conditions</span>, <span class="ruby-value">:table_alias</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">table_alias_qualifier</span>, <span class="ruby-value">:implicit_qualifier</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">implicit_qualifier</span>, <span class="ruby-value">:qualify</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">options</span>[<span class="ruby-value">:qualify</span>], <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">130</span> 
<span class="line-num">131</span>   <span class="ruby-keyword">return</span> <span class="ruby-identifier">ds</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:join_only</span>]
<span class="line-num">132</span> 
<span class="line-num">133</span>   <span class="ruby-identifier">opts</span> = <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">opts</span>
<span class="line-num">134</span> 
<span class="line-num">135</span>   <span class="ruby-comment"># Whether to include the table in the result set</span>
<span class="line-num">136</span>   <span class="ruby-identifier">add_table</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:select</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword">false</span> <span class="ruby-operator">?</span> <span class="ruby-keyword">false</span> <span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>
<span class="line-num">137</span> 
<span class="line-num">138</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">graph</span>
<span class="line-num">139</span>     <span class="ruby-identifier">graph</span> = <span class="ruby-identifier">graph</span>.<span class="ruby-identifier">dup</span>
<span class="line-num">140</span>     <span class="ruby-identifier">select</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:select</span>].<span class="ruby-identifier">dup</span>
<span class="line-num">141</span>     [<span class="ruby-value">:column_aliases</span>, <span class="ruby-value">:table_aliases</span>, <span class="ruby-value">:column_alias_num</span>].<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">k</span><span class="ruby-operator">|</span> <span class="ruby-identifier">graph</span>[<span class="ruby-identifier">k</span>] = <span class="ruby-identifier">graph</span>[<span class="ruby-identifier">k</span>].<span class="ruby-identifier">dup</span>}
<span class="line-num">142</span>   <span class="ruby-keyword">else</span>
<span class="line-num">143</span>     <span class="ruby-comment"># Setup the initial graph data structure if it doesn&#39;t exist</span>
<span class="line-num">144</span>     <span class="ruby-identifier">qualifier</span> = <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">first_source_alias</span>
<span class="line-num">145</span>     <span class="ruby-identifier">master</span> = <span class="ruby-identifier">alias_symbol</span>(<span class="ruby-identifier">qualifier</span>)
<span class="line-num">146</span>     <span class="ruby-identifier">raise_alias_error</span>.<span class="ruby-identifier">call</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">master</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">table_alias</span>
<span class="line-num">147</span> 
<span class="line-num">148</span>     <span class="ruby-comment"># Master hash storing all .graph related information</span>
<span class="line-num">149</span>     <span class="ruby-identifier">graph</span> = {}
<span class="line-num">150</span> 
<span class="line-num">151</span>     <span class="ruby-comment"># Associates column aliases back to tables and columns</span>
<span class="line-num">152</span>     <span class="ruby-identifier">column_aliases</span> = <span class="ruby-identifier">graph</span>[<span class="ruby-value">:column_aliases</span>] = {}
<span class="line-num">153</span> 
<span class="line-num">154</span>     <span class="ruby-comment"># Associates table alias (the master is never aliased)</span>
<span class="line-num">155</span>     <span class="ruby-identifier">table_aliases</span> = <span class="ruby-identifier">graph</span>[<span class="ruby-value">:table_aliases</span>] = {<span class="ruby-identifier">master</span><span class="ruby-operator">=&gt;</span><span class="ruby-keyword">self</span>}
<span class="line-num">156</span> 
<span class="line-num">157</span>     <span class="ruby-comment"># Keep track of the alias numbers used</span>
<span class="line-num">158</span>     <span class="ruby-identifier">ca_num</span> = <span class="ruby-identifier">graph</span>[<span class="ruby-value">:column_alias_num</span>] = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">0</span>)
<span class="line-num">159</span> 
<span class="line-num">160</span>     <span class="ruby-identifier">select</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">select_columns</span>
<span class="line-num">161</span>       <span class="ruby-identifier">select_columns</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">sel</span>, <span class="ruby-identifier">column</span><span class="ruby-operator">|</span>
<span class="line-num">162</span>         <span class="ruby-identifier">column_aliases</span>[<span class="ruby-identifier">column</span>] = [<span class="ruby-identifier">master</span>, <span class="ruby-identifier">column</span>]
<span class="line-num">163</span>         <span class="ruby-keyword">if</span> <span class="ruby-identifier">from_selfed</span>
<span class="line-num">164</span>           <span class="ruby-comment"># Initial dataset was wrapped in subselect, selected all</span>
<span class="line-num">165</span>           <span class="ruby-comment"># columns in the subselect, qualified by the subselect alias.</span>
<span class="line-num">166</span>           <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">qualify</span>(<span class="ruby-identifier">qualifier</span>, <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">identifier</span>(<span class="ruby-identifier">column</span>))
<span class="line-num">167</span>         <span class="ruby-keyword">else</span>
<span class="line-num">168</span>           <span class="ruby-comment"># Initial dataset not wrapped in subslect, just make</span>
<span class="line-num">169</span>           <span class="ruby-comment"># sure columns are qualified in some way.</span>
<span class="line-num">170</span>           <span class="ruby-identifier">qualified_expression</span>(<span class="ruby-identifier">sel</span>, <span class="ruby-identifier">qualifier</span>)
<span class="line-num">171</span>         <span class="ruby-keyword">end</span>
<span class="line-num">172</span>       <span class="ruby-keyword">end</span>
<span class="line-num">173</span>     <span class="ruby-keyword">else</span>
<span class="line-num">174</span>       <span class="ruby-identifier">columns</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">column</span><span class="ruby-operator">|</span>
<span class="line-num">175</span>         <span class="ruby-identifier">column_aliases</span>[<span class="ruby-identifier">column</span>] = [<span class="ruby-identifier">master</span>, <span class="ruby-identifier">column</span>]
<span class="line-num">176</span>         <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">QualifiedIdentifier</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">qualifier</span>, <span class="ruby-identifier">column</span>)
<span class="line-num">177</span>       <span class="ruby-keyword">end</span>
<span class="line-num">178</span>     <span class="ruby-keyword">end</span>
<span class="line-num">179</span>   <span class="ruby-keyword">end</span>
<span class="line-num">180</span> 
<span class="line-num">181</span>   <span class="ruby-comment"># Add the table alias to the list of aliases</span>
<span class="line-num">182</span>   <span class="ruby-comment"># Even if it isn&#39;t been used in the result set,</span>
<span class="line-num">183</span>   <span class="ruby-comment"># we add a key for it with a nil value so we can check if it</span>
<span class="line-num">184</span>   <span class="ruby-comment"># is used more than once</span>
<span class="line-num">185</span>   <span class="ruby-identifier">table_aliases</span> = <span class="ruby-identifier">graph</span>[<span class="ruby-value">:table_aliases</span>]
<span class="line-num">186</span>   <span class="ruby-identifier">table_aliases</span>[<span class="ruby-identifier">table_alias</span>] = <span class="ruby-identifier">add_table</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">dataset</span> <span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>
<span class="line-num">187</span> 
<span class="line-num">188</span>   <span class="ruby-comment"># Add the columns to the selection unless we are ignoring them</span>
<span class="line-num">189</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">add_table</span>
<span class="line-num">190</span>     <span class="ruby-identifier">column_aliases</span> = <span class="ruby-identifier">graph</span>[<span class="ruby-value">:column_aliases</span>]
<span class="line-num">191</span>     <span class="ruby-identifier">ca_num</span> = <span class="ruby-identifier">graph</span>[<span class="ruby-value">:column_alias_num</span>]
<span class="line-num">192</span>     <span class="ruby-comment"># Which columns to add to the result set</span>
<span class="line-num">193</span>     <span class="ruby-identifier">cols</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:select</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">dataset</span>.<span class="ruby-identifier">columns</span>
<span class="line-num">194</span>     <span class="ruby-comment"># If the column hasn&#39;t been used yet, don&#39;t alias it.</span>
<span class="line-num">195</span>     <span class="ruby-comment"># If it has been used, try table_column.</span>
<span class="line-num">196</span>     <span class="ruby-comment"># If that has been used, try table_column_N</span>
<span class="line-num">197</span>     <span class="ruby-comment"># using the next value of N that we know hasn&#39;t been</span>
<span class="line-num">198</span>     <span class="ruby-comment"># used</span>
<span class="line-num">199</span>     <span class="ruby-identifier">cols</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">column</span><span class="ruby-operator">|</span>
<span class="line-num">200</span>       <span class="ruby-identifier">col_alias</span>, <span class="ruby-identifier">identifier</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">column_aliases</span>[<span class="ruby-identifier">column</span>]
<span class="line-num">201</span>         <span class="ruby-identifier">column_alias</span> = <span class="ruby-value">:&quot;#{table_alias}_#{column}&quot;</span>
<span class="line-num">202</span>         <span class="ruby-keyword">if</span> <span class="ruby-identifier">column_aliases</span>[<span class="ruby-identifier">column_alias</span>]
<span class="line-num">203</span>           <span class="ruby-identifier">column_alias_num</span> = <span class="ruby-identifier">ca_num</span>[<span class="ruby-identifier">column_alias</span>]
<span class="line-num">204</span>           <span class="ruby-identifier">column_alias</span> = <span class="ruby-value">:&quot;#{column_alias}_#{column_alias_num}&quot;</span> 
<span class="line-num">205</span>           <span class="ruby-identifier">ca_num</span>[<span class="ruby-identifier">column_alias</span>] <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
<span class="line-num">206</span>         <span class="ruby-keyword">end</span>
<span class="line-num">207</span>         [<span class="ruby-identifier">column_alias</span>, <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">AliasedExpression</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">QualifiedIdentifier</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">table_alias_qualifier</span>, <span class="ruby-identifier">column</span>), <span class="ruby-identifier">column_alias</span>)]
<span class="line-num">208</span>       <span class="ruby-keyword">else</span>
<span class="line-num">209</span>         <span class="ruby-identifier">ident</span> = <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">QualifiedIdentifier</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">table_alias_qualifier</span>, <span class="ruby-identifier">column</span>)
<span class="line-num">210</span>         [<span class="ruby-identifier">column</span>, <span class="ruby-identifier">ident</span>]
<span class="line-num">211</span>       <span class="ruby-keyword">end</span>
<span class="line-num">212</span>       <span class="ruby-identifier">column_aliases</span>[<span class="ruby-identifier">col_alias</span>] = [<span class="ruby-identifier">table_alias</span>, <span class="ruby-identifier">column</span>].<span class="ruby-identifier">freeze</span>
<span class="line-num">213</span>       <span class="ruby-identifier">select</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">identifier</span>)
<span class="line-num">214</span>     <span class="ruby-keyword">end</span>
<span class="line-num">215</span>   <span class="ruby-keyword">end</span>
<span class="line-num">216</span>   [<span class="ruby-value">:column_aliases</span>, <span class="ruby-value">:table_aliases</span>, <span class="ruby-value">:column_alias_num</span>].<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">k</span><span class="ruby-operator">|</span> <span class="ruby-identifier">graph</span>[<span class="ruby-identifier">k</span>].<span class="ruby-identifier">freeze</span>}
<span class="line-num">217</span>   <span class="ruby-identifier">ds</span> = <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">clone</span>(<span class="ruby-value">:graph</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">graph</span>.<span class="ruby-identifier">freeze</span>)
<span class="line-num">218</span>   <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">select</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">select</span>)
<span class="line-num">219</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-set_graph_aliases" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">set_graph_aliases</span><span
            class="method-args">(graph_aliases)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>This allows you to manually specify the graph aliases to use when using graph.  You can use it to only select certain columns, and have those columns mapped to specific aliases in the result set.  This is the equivalent of <code>select</code> for a graphed dataset, and must be used instead of <code>select</code> whenever graphing is used.</p>

<p>graph_aliases should be a hash with keys being symbols of column aliases, and values being either symbols or arrays with one to three elements. If the value is a symbol, it is assumed to be the same as a one element array containing that symbol. The first element of the array should be the table alias symbol. The second should be the actual column name symbol.  If the array only has a single element the column name symbol will be assumed to be the same as the corresponding hash key. If the array has a third element, it is used as the value returned, instead of table_alias.column_name.</p>

<pre>DB[:artists].graph(:albums, :artist_id: :id).
  set_graph_aliases(name: :artists,
                    album_name: [:albums, :name],
                    forty_two: [:albums, :fourtwo, 42]).first
# SELECT artists.name, albums.name AS album_name, 42 AS forty_two ...</pre>
          
          

          
          <div class="method-source-code" id="set_graph_aliases-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/graph.rb</span>
<span class="line-num">244</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">set_graph_aliases</span>(<span class="ruby-identifier">graph_aliases</span>)
<span class="line-num">245</span>   <span class="ruby-identifier">columns</span>, <span class="ruby-identifier">graph_aliases</span> = <span class="ruby-identifier">graph_alias_columns</span>(<span class="ruby-identifier">graph_aliases</span>)
<span class="line-num">246</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">graph</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:graph</span>]
<span class="line-num">247</span>     <span class="ruby-identifier">select</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">columns</span>).<span class="ruby-identifier">clone</span>(<span class="ruby-value">:graph</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">graph</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-value">:column_aliases</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">graph_aliases</span>.<span class="ruby-identifier">freeze</span>).<span class="ruby-identifier">freeze</span>)
<span class="line-num">248</span>   <span class="ruby-keyword">else</span>
<span class="line-num">249</span>     <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-string">&quot;cannot call #set_graph_aliases on an ungraphed dataset&quot;</span>
<span class="line-num">250</span>   <span class="ruby-keyword">end</span>
<span class="line-num">251</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-ungraphed" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">ungraphed</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Remove the splitting of results into subhashes, and all metadata related to the current graph (if any).</p>
          
          

          
          <div class="method-source-code" id="ungraphed-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/graph.rb</span>
<span class="line-num">255</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">ungraphed</span>
<span class="line-num">256</span>   <span class="ruby-identifier">clone</span>(<span class="ruby-value">:graph</span><span class="ruby-operator">=&gt;</span><span class="ruby-keyword">nil</span>)
<span class="line-num">257</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>

  <section id="6+-+Miscellaneous+methods" class="documentation-section">
    
    <header class="documentation-section-title">
      <h2>
        6 - Miscellaneous methods
      </h2>
      <span class="section-click-top">
        <a href="#top">&uarr; top</a>
      </span>
    </header>
    

    

    

    
    <section class="attribute-method-details" class="method-section">
      <header>
        <h3>Attributes</h3>
      </header>

      
      <div id="attribute-i-cache" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">cache</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        <p>Access the cache for the current dataset.  Should be used with caution, as access to the cache is not thread safe without a mutex if other threads can reference the dataset.  Symbol keys prefixed with an underscore are reserved for internal use.</p>
        
        </div>
      </div>
      
      <div id="attribute-i-db" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">db</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        <p>The database related to this dataset.  This is the <a href="Database.html"><code>Database</code></a> instance that will execute all of this dataset&#39;s queries.</p>
        
        </div>
      </div>
      
      <div id="attribute-i-opts" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">opts</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        <p>The hash of options for this dataset, keys are symbols.</p>
        
        </div>
      </div>
      
    </section>
    

    
     <section id="public-class-6+-+Miscellaneous+methods-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(db)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Constructs a new <a href="Dataset.html"><code>Dataset</code></a> instance with an associated database and  options. Datasets are usually constructed by invoking the <a href="Database.html#method-i-5B-5D"><code>Database#[]</code></a> method:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:posts</span>]
</pre>

<p><a href="Dataset.html"><code>Sequel::Dataset</code></a> is an abstract class that is not useful by itself. Each database adapter provides a subclass of <a href="Dataset.html"><code>Sequel::Dataset</code></a>, and has the <a href="Database.html#method-i-dataset"><code>Database#dataset</code></a> method return an instance of that subclass.</p>
          
          

          
          <div class="method-source-code" id="new-source">
            <pre>   <span class="ruby-comment"># File lib/sequel/dataset/misc.rb</span>
<span class="line-num">25</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">initialize</span>(<span class="ruby-identifier">db</span>)
<span class="line-num">26</span>   <span class="ruby-ivar">@db</span> = <span class="ruby-identifier">db</span>
<span class="line-num">27</span>   <span class="ruby-ivar">@opts</span> = <span class="ruby-constant">OPTS</span>
<span class="line-num">28</span>   <span class="ruby-ivar">@cache</span> = {}
<span class="line-num">29</span>   <span class="ruby-identifier">freeze</span>
<span class="line-num">30</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="public-instance-6+-+Miscellaneous+methods-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-3D-3D" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">==</span><span
            class="method-args">(o)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Define a hash value such that datasets with the same class, DB, and opts will be considered equal.</p>
          
          

          
          <div class="method-source-code" id="3D-3D-source">
            <pre>   <span class="ruby-comment"># File lib/sequel/dataset/misc.rb</span>
<span class="line-num">34</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">==</span>(<span class="ruby-identifier">o</span>)
<span class="line-num">35</span>   <span class="ruby-identifier">o</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">db</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">o</span>.<span class="ruby-identifier">db</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">opts</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">o</span>.<span class="ruby-identifier">opts</span>
<span class="line-num">36</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-current_datetime" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">current_datetime</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>An object representing the current date or time, should be an instance of Sequel.datetime_class.</p>
          
          

          
          <div class="method-source-code" id="current_datetime-source">
            <pre>   <span class="ruby-comment"># File lib/sequel/dataset/misc.rb</span>
<span class="line-num">40</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">current_datetime</span>
<span class="line-num">41</span>   <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">datetime_class</span>.<span class="ruby-identifier">now</span>
<span class="line-num">42</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-dup" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">dup</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Return self, as datasets are always frozen.</p>
          
          

          
          <div class="method-source-code" id="dup-source">
            <pre>   <span class="ruby-comment"># File lib/sequel/dataset/misc.rb</span>
<span class="line-num">50</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">dup</span>
<span class="line-num">51</span>   <span class="ruby-keyword">self</span>
<span class="line-num">52</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-each_server" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">each_server</span><span
            class="method-args">() { |server(s)| ... }</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Yield a dataset for each server in the connection pool that is tied to that server. Intended for use in sharded environments where all servers need to be modified with the same data:</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:configs</span>].<span class="ruby-identifier">where</span>(<span class="ruby-value">key:</span> <span class="ruby-string">&#39;setting&#39;</span>).<span class="ruby-identifier">each_server</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">ds</span><span class="ruby-operator">|</span> <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">update</span>(<span class="ruby-value">value:</span> <span class="ruby-string">&#39;new_value&#39;</span>)}
</pre>
          
          

          
          <div class="method-source-code" id="each_server-source">
            <pre>   <span class="ruby-comment"># File lib/sequel/dataset/misc.rb</span>
<span class="line-num">59</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">each_server</span>
<span class="line-num">60</span>   <span class="ruby-identifier">db</span>.<span class="ruby-identifier">servers</span>.<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> <span class="ruby-keyword">yield</span> <span class="ruby-identifier">server</span>(<span class="ruby-identifier">s</span>)}
<span class="line-num">61</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-eql-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">eql?</span><span
            class="method-args">(o)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Alias for ==</p>
          
          

          
          <div class="method-source-code" id="eql-3F-source">
            <pre>   <span class="ruby-comment"># File lib/sequel/dataset/misc.rb</span>
<span class="line-num">45</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">eql?</span>(<span class="ruby-identifier">o</span>)
<span class="line-num">46</span>   <span class="ruby-keyword">self</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">o</span>
<span class="line-num">47</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-escape_like" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">escape_like</span><span
            class="method-args">(string)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns the string with the LIKE metacharacters (% and _) escaped. Useful for when the LIKE term is a user-provided string where metacharacters should not be recognized. Example:</p>

<pre class="ruby"><span class="ruby-identifier">ds</span>.<span class="ruby-identifier">escape_like</span>(<span class="ruby-string">&quot;foo\\%_&quot;</span>) <span class="ruby-comment"># &#39;foo\\\%\_&#39;</span>
</pre>
          
          

          
          <div class="method-source-code" id="escape_like-source">
            <pre>   <span class="ruby-comment"># File lib/sequel/dataset/misc.rb</span>
<span class="line-num">68</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">escape_like</span>(<span class="ruby-identifier">string</span>)
<span class="line-num">69</span>   <span class="ruby-identifier">string</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/[\\%_]/</span>){<span class="ruby-operator">|</span><span class="ruby-identifier">m</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;\\#{m}&quot;</span>}
<span class="line-num">70</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-first_source" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">first_source</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Alias of <code>first_source_alias</code></p>
          
          

          
          <div class="method-source-code" id="first_source-source">
            <pre>   <span class="ruby-comment"># File lib/sequel/dataset/misc.rb</span>
<span class="line-num">91</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">first_source</span>
<span class="line-num">92</span>   <span class="ruby-identifier">first_source_alias</span>
<span class="line-num">93</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-first_source_alias" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">first_source_alias</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>The first source (primary table) for this dataset.  If the dataset doesn&#39;t have a table, raises an <code>Error</code>.  If the table is aliased, returns the aliased name.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">first_source_alias</span>
<span class="ruby-comment"># =&gt; :table</span>

<span class="ruby-constant">DB</span>[<span class="ruby-constant">Sequel</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">as</span>(<span class="ruby-value">:t</span>)].<span class="ruby-identifier">first_source_alias</span>
<span class="ruby-comment"># =&gt; :t</span>
</pre>
          
          

          
          <div class="method-source-code" id="first_source_alias-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/misc.rb</span>
<span class="line-num">103</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">first_source_alias</span>
<span class="line-num">104</span>   <span class="ruby-identifier">source</span> = <span class="ruby-ivar">@opts</span>[<span class="ruby-value">:from</span>]
<span class="line-num">105</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">source</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">source</span>.<span class="ruby-identifier">empty?</span>
<span class="line-num">106</span>     <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-string">&#39;No source specified for query&#39;</span>
<span class="line-num">107</span>   <span class="ruby-keyword">end</span>
<span class="line-num">108</span>   <span class="ruby-keyword">case</span> <span class="ruby-identifier">s</span> = <span class="ruby-identifier">source</span>.<span class="ruby-identifier">first</span>
<span class="line-num">109</span>   <span class="ruby-keyword">when</span> <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">AliasedExpression</span>
<span class="line-num">110</span>     <span class="ruby-identifier">s</span>.<span class="ruby-identifier">alias</span>
<span class="line-num">111</span>   <span class="ruby-keyword">when</span> <span class="ruby-constant">Symbol</span>
<span class="line-num">112</span>     <span class="ruby-identifier">_</span>, <span class="ruby-identifier">_</span>, <span class="ruby-identifier">aliaz</span> = <span class="ruby-identifier">split_symbol</span>(<span class="ruby-identifier">s</span>)
<span class="line-num">113</span>     <span class="ruby-identifier">aliaz</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">aliaz</span>.<span class="ruby-identifier">to_sym</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">s</span>
<span class="line-num">114</span>   <span class="ruby-keyword">else</span>
<span class="line-num">115</span>     <span class="ruby-identifier">s</span>
<span class="line-num">116</span>   <span class="ruby-keyword">end</span>
<span class="line-num">117</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-first_source_table" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">first_source_table</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>The first source (primary table) for this dataset.  If the dataset doesn&#39;t have a table, raises an error.  If the table is aliased, returns the original table, not the alias</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">first_source_table</span>
<span class="ruby-comment"># =&gt; :table</span>

<span class="ruby-constant">DB</span>[<span class="ruby-constant">Sequel</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">as</span>(<span class="ruby-value">:t</span>)].<span class="ruby-identifier">first_source_table</span>
<span class="ruby-comment"># =&gt; :table</span>
</pre>
          
          

          
          <div class="method-source-code" id="first_source_table-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/misc.rb</span>
<span class="line-num">128</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">first_source_table</span>
<span class="line-num">129</span>   <span class="ruby-identifier">source</span> = <span class="ruby-ivar">@opts</span>[<span class="ruby-value">:from</span>]
<span class="line-num">130</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">source</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">source</span>.<span class="ruby-identifier">empty?</span>
<span class="line-num">131</span>     <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-string">&#39;No source specified for query&#39;</span>
<span class="line-num">132</span>   <span class="ruby-keyword">end</span>
<span class="line-num">133</span>   <span class="ruby-keyword">case</span> <span class="ruby-identifier">s</span> = <span class="ruby-identifier">source</span>.<span class="ruby-identifier">first</span>
<span class="line-num">134</span>   <span class="ruby-keyword">when</span> <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">AliasedExpression</span>
<span class="line-num">135</span>     <span class="ruby-identifier">s</span>.<span class="ruby-identifier">expression</span>
<span class="line-num">136</span>   <span class="ruby-keyword">when</span> <span class="ruby-constant">Symbol</span>
<span class="line-num">137</span>     <span class="ruby-identifier">sch</span>, <span class="ruby-identifier">table</span>, <span class="ruby-identifier">aliaz</span> = <span class="ruby-identifier">split_symbol</span>(<span class="ruby-identifier">s</span>)
<span class="line-num">138</span>     <span class="ruby-identifier">aliaz</span> <span class="ruby-operator">?</span> (<span class="ruby-identifier">sch</span> <span class="ruby-operator">?</span> <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">QualifiedIdentifier</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">sch</span>, <span class="ruby-identifier">table</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">table</span>.<span class="ruby-identifier">to_sym</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">s</span>
<span class="line-num">139</span>   <span class="ruby-keyword">else</span>
<span class="line-num">140</span>     <span class="ruby-identifier">s</span>
<span class="line-num">141</span>   <span class="ruby-keyword">end</span>
<span class="line-num">142</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-freeze" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">freeze</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Freeze the opts when freezing the dataset.</p>
          
          
            <div class="method-calls-super">
              Calls superclass method
              
            </div>
          

          
          <div class="method-source-code" id="freeze-source">
            <pre>   <span class="ruby-comment"># File lib/sequel/dataset/misc.rb</span>
<span class="line-num">74</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">freeze</span>
<span class="line-num">75</span>   <span class="ruby-ivar">@opts</span>.<span class="ruby-identifier">freeze</span>
<span class="line-num">76</span>   <span class="ruby-keyword">super</span>
<span class="line-num">77</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-hash" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">hash</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Define a hash value such that datasets with the same class, DB, and opts, will have the same hash value.</p>
          
          

          
          <div class="method-source-code" id="hash-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/misc.rb</span>
<span class="line-num">146</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">hash</span>
<span class="line-num">147</span>   [<span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>, <span class="ruby-identifier">db</span>, <span class="ruby-identifier">opts</span>].<span class="ruby-identifier">hash</span>
<span class="line-num">148</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-inspect" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">inspect</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns a string representation of the dataset including the class name  and the corresponding <a href="SQL.html"><code>SQL</code></a> select statement.</p>
          
          

          
          <div class="method-source-code" id="inspect-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/misc.rb</span>
<span class="line-num">152</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">inspect</span>
<span class="line-num">153</span>   <span class="ruby-node">&quot;#&lt;#{visible_class_name}: #{sql.inspect}&gt;&quot;</span>
<span class="line-num">154</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-joined_dataset-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">joined_dataset?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Whether this dataset is a joined dataset (multiple FROM tables or any JOINs).</p>
          
          

          
          <div class="method-source-code" id="joined_dataset-3F-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/misc.rb</span>
<span class="line-num">157</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">joined_dataset?</span>
<span class="line-num">158</span>  <span class="ruby-operator">!</span><span class="ruby-operator">!</span>((<span class="ruby-identifier">opts</span>[<span class="ruby-value">:from</span>].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:from</span>].<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:join</span>])
<span class="line-num">159</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-row_number_column" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">row_number_column</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>The alias to use for the row_number column, used when emulating OFFSET support and for eager limit strategies</p>
          
          

          
          <div class="method-source-code" id="row_number_column-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/misc.rb</span>
<span class="line-num">163</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">row_number_column</span>
<span class="line-num">164</span>   <span class="ruby-value">:x_sequel_row_number_x</span>
<span class="line-num">165</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-row_proc" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">row_proc</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>The <a href="Dataset.html#method-i-row_proc"><code>row_proc</code></a> for this database, should be any object that responds to <code>call</code> with a single hash argument and returns the object you want <a href="Dataset.html#method-i-each"><code>each</code></a> to return.</p>
          
          

          
          <div class="method-source-code" id="row_proc-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/misc.rb</span>
<span class="line-num">169</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">row_proc</span>
<span class="line-num">170</span>   <span class="ruby-ivar">@opts</span>[<span class="ruby-value">:row_proc</span>]
<span class="line-num">171</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-split_alias" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">split_alias</span><span
            class="method-args">(c)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Splits a possible implicit alias in <code>c</code>, handling both SQL::AliasedExpressions and Symbols.  Returns an array of two elements, with the first being the main expression, and the second being the alias.</p>
          
          

          
          <div class="method-source-code" id="split_alias-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/misc.rb</span>
<span class="line-num">176</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">split_alias</span>(<span class="ruby-identifier">c</span>)
<span class="line-num">177</span>   <span class="ruby-keyword">case</span> <span class="ruby-identifier">c</span>
<span class="line-num">178</span>   <span class="ruby-keyword">when</span> <span class="ruby-constant">Symbol</span>
<span class="line-num">179</span>     <span class="ruby-identifier">c_table</span>, <span class="ruby-identifier">column</span>, <span class="ruby-identifier">aliaz</span> = <span class="ruby-identifier">split_symbol</span>(<span class="ruby-identifier">c</span>)
<span class="line-num">180</span>     [<span class="ruby-identifier">c_table</span> <span class="ruby-operator">?</span> <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">QualifiedIdentifier</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">c_table</span>, <span class="ruby-identifier">column</span>.<span class="ruby-identifier">to_sym</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">column</span>.<span class="ruby-identifier">to_sym</span>, <span class="ruby-identifier">aliaz</span>]
<span class="line-num">181</span>   <span class="ruby-keyword">when</span> <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">AliasedExpression</span>
<span class="line-num">182</span>     [<span class="ruby-identifier">c</span>.<span class="ruby-identifier">expression</span>, <span class="ruby-identifier">c</span>.<span class="ruby-identifier">alias</span>]
<span class="line-num">183</span>   <span class="ruby-keyword">when</span> <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">JoinClause</span>
<span class="line-num">184</span>     [<span class="ruby-identifier">c</span>.<span class="ruby-identifier">table</span>, <span class="ruby-identifier">c</span>.<span class="ruby-identifier">table_alias</span>]
<span class="line-num">185</span>   <span class="ruby-keyword">else</span>
<span class="line-num">186</span>     [<span class="ruby-identifier">c</span>, <span class="ruby-keyword">nil</span>]
<span class="line-num">187</span>   <span class="ruby-keyword">end</span>
<span class="line-num">188</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-unqualified_column_for" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">unqualified_column_for</span><span
            class="method-args">(v)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>This returns an <a href="SQL/Identifier.html"><code>SQL::Identifier</code></a> or <a href="SQL/AliasedExpression.html"><code>SQL::AliasedExpression</code></a> containing an <a href="SQL.html"><code>SQL</code></a> identifier that represents the unqualified column for the given value. The given value should be a Symbol, <a href="SQL/Identifier.html"><code>SQL::Identifier</code></a>, <a href="SQL/QualifiedIdentifier.html"><code>SQL::QualifiedIdentifier</code></a>, or <a href="SQL/AliasedExpression.html"><code>SQL::AliasedExpression</code></a> containing one of those.  In other cases, this returns nil.</p>
          
          

          
          <div class="method-source-code" id="unqualified_column_for-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/misc.rb</span>
<span class="line-num">195</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">unqualified_column_for</span>(<span class="ruby-identifier">v</span>)
<span class="line-num">196</span>   <span class="ruby-keyword">unless</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>)
<span class="line-num">197</span>     <span class="ruby-identifier">_unqualified_column_for</span>(<span class="ruby-identifier">v</span>)
<span class="line-num">198</span>   <span class="ruby-keyword">end</span>
<span class="line-num">199</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-unused_table_alias" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">unused_table_alias</span><span
            class="method-args">(table_alias, used_aliases = [])</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Creates a unique table alias that hasn&#39;t already been used in the dataset. table_alias can be any type of object accepted by alias_symbol. The symbol returned will be the implicit alias in the argument, possibly appended with “_N” if the implicit alias has already been used, where N is an integer starting at 0 and increasing until an unused one is found.</p>

<p>You can provide a second addition array argument containing symbols that should not be considered valid table aliases.  The current aliases for the FROM and JOIN tables are automatically included in this array.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">unused_table_alias</span>(<span class="ruby-value">:t</span>)
<span class="ruby-comment"># =&gt; :t</span>

<span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">unused_table_alias</span>(<span class="ruby-value">:table</span>)
<span class="ruby-comment"># =&gt; :table_0</span>

<span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>, <span class="ruby-value">:table_0</span>].<span class="ruby-identifier">unused_table_alias</span>(<span class="ruby-value">:table</span>)
<span class="ruby-comment"># =&gt; :table_1</span>

<span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>, <span class="ruby-value">:table_0</span>].<span class="ruby-identifier">unused_table_alias</span>(<span class="ruby-value">:table</span>, [<span class="ruby-value">:table_1</span>, <span class="ruby-value">:table_2</span>])
<span class="ruby-comment"># =&gt; :table_3</span>
</pre>
          
          

          
          <div class="method-source-code" id="unused_table_alias-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/misc.rb</span>
<span class="line-num">223</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">unused_table_alias</span>(<span class="ruby-identifier">table_alias</span>, <span class="ruby-identifier">used_aliases</span> = [])
<span class="line-num">224</span>   <span class="ruby-identifier">table_alias</span> = <span class="ruby-identifier">alias_symbol</span>(<span class="ruby-identifier">table_alias</span>)
<span class="line-num">225</span>   <span class="ruby-identifier">used_aliases</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:from</span>].<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span> <span class="ruby-identifier">alias_symbol</span>(<span class="ruby-identifier">t</span>)} <span class="ruby-keyword">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:from</span>]
<span class="line-num">226</span>   <span class="ruby-identifier">used_aliases</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:join</span>].<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">j</span><span class="ruby-operator">|</span> <span class="ruby-identifier">j</span>.<span class="ruby-identifier">table_alias</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">alias_alias_symbol</span>(<span class="ruby-identifier">j</span>.<span class="ruby-identifier">table_alias</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">alias_symbol</span>(<span class="ruby-identifier">j</span>.<span class="ruby-identifier">table</span>)} <span class="ruby-keyword">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:join</span>]
<span class="line-num">227</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">used_aliases</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">table_alias</span>)
<span class="line-num">228</span>     <span class="ruby-identifier">i</span> = <span class="ruby-value">0</span>
<span class="line-num">229</span>     <span class="ruby-keyword">while</span> <span class="ruby-keyword">true</span>
<span class="line-num">230</span>       <span class="ruby-identifier">ta</span> = <span class="ruby-value">:&quot;#{table_alias}_#{i}&quot;</span>
<span class="line-num">231</span>       <span class="ruby-keyword">return</span> <span class="ruby-identifier">ta</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">used_aliases</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">ta</span>)
<span class="line-num">232</span>       <span class="ruby-identifier">i</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span> 
<span class="line-num">233</span>     <span class="ruby-keyword">end</span>
<span class="line-num">234</span>   <span class="ruby-keyword">else</span>
<span class="line-num">235</span>     <span class="ruby-identifier">table_alias</span>
<span class="line-num">236</span>   <span class="ruby-keyword">end</span>
<span class="line-num">237</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-with_quote_identifiers" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">with_quote_identifiers</span><span
            class="method-args">(v)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Return a modified dataset with quote_identifiers set.</p>
          
          

          
          <div class="method-source-code" id="with_quote_identifiers-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/misc.rb</span>
<span class="line-num">240</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">with_quote_identifiers</span>(<span class="ruby-identifier">v</span>)
<span class="line-num">241</span>   <span class="ruby-identifier">clone</span>(<span class="ruby-value">:quote_identifiers</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">v</span>, <span class="ruby-value">:skip_symbol_cache</span><span class="ruby-operator">=&gt;</span><span class="ruby-keyword">true</span>)
<span class="line-num">242</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="protected-instance-6+-+Miscellaneous+methods-method-details" class="method-section">
       <header>
         <h3>Protected Instance Methods</h3>
       </header>

    
      <div id="method-i-_columns" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">_columns</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>The cached columns for the current dataset.</p>
          
          

          
          <div class="method-source-code" id="_columns-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/misc.rb</span>
<span class="line-num">271</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">_columns</span>
<span class="line-num">272</span>   <span class="ruby-identifier">cache_get</span>(<span class="ruby-value">:_columns</span>)
<span class="line-num">273</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-cache_get" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">cache_get</span><span
            class="method-args">(k)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Retreive a value from the dataset&#39;s cache in a thread safe manner.</p>
          
          

          
          <div class="method-source-code" id="cache_get-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/misc.rb</span>
<span class="line-num">253</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">cache_get</span>(<span class="ruby-identifier">k</span>)
<span class="line-num">254</span>   <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">synchronize</span>{<span class="ruby-ivar">@cache</span>[<span class="ruby-identifier">k</span>]}
<span class="line-num">255</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-cache_set" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">cache_set</span><span
            class="method-args">(k, v)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Set a value in the dataset&#39;s cache in a thread safe manner.</p>
          
          

          
          <div class="method-source-code" id="cache_set-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/misc.rb</span>
<span class="line-num">258</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">cache_set</span>(<span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span>)
<span class="line-num">259</span>   <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">synchronize</span>{<span class="ruby-ivar">@cache</span>[<span class="ruby-identifier">k</span>] = <span class="ruby-identifier">v</span>}
<span class="line-num">260</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-clear_columns_cache" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">clear_columns_cache</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Clear the columns hash for the current dataset.  This is not a thread safe operation, so it should only be used if the dataset could not be used by another thread (such as one that was just created via clone).</p>
          
          

          
          <div class="method-source-code" id="clear_columns_cache-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/misc.rb</span>
<span class="line-num">266</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">clear_columns_cache</span>
<span class="line-num">267</span>   <span class="ruby-ivar">@cache</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:_columns</span>)
<span class="line-num">268</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>

  <section id="8+-+Methods+related+to+prepared+statements+or+bound+variables" class="documentation-section">
    
    <header class="documentation-section-title">
      <h2>
        8 - Methods related to prepared statements or bound variables
      </h2>
      <span class="section-click-top">
        <a href="#top">&uarr; top</a>
      </span>
    </header>
    

    

    
    <section class="constants-list">
      <header>
        <h3>Constants</h3>
      </header>
      <dl>
      
        <dt id="DEFAULT_PREPARED_STATEMENT_MODULE_METHODS">DEFAULT_PREPARED_STATEMENT_MODULE_METHODS
        
        <dd>
        
      
        <dt id="PREPARED_ARG_PLACEHOLDER">PREPARED_ARG_PLACEHOLDER
        
        <dd>
        
      
        <dt id="PREPARED_STATEMENT_MODULE_CODE">PREPARED_STATEMENT_MODULE_CODE
        
        <dd>
        
      
      </dl>
    </section>
    

    

    
     <section id="public-instance-8+-+Methods+related+to+prepared+statements+or+bound+variables-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-bind" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">bind</span><span
            class="method-args">(bind_vars=OPTS)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Set the bind variables to use for the call.  If bind variables have already been set for this dataset, they are updated with the contents of bind_vars.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">where</span>(<span class="ruby-value">id:</span> <span class="ruby-value">:$id</span>).<span class="ruby-identifier">bind</span>(<span class="ruby-value">id:</span> <span class="ruby-value">1</span>).<span class="ruby-identifier">call</span>(<span class="ruby-value">:first</span>)
<span class="ruby-comment"># SELECT * FROM table WHERE id = ? LIMIT 1 -- (1)</span>
<span class="ruby-comment"># =&gt; {:id=&gt;1}</span>
</pre>
          
          

          
          <div class="method-source-code" id="bind-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/prepared_statements.rb</span>
<span class="line-num">332</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">bind</span>(<span class="ruby-identifier">bind_vars</span>=<span class="ruby-constant">OPTS</span>)
<span class="line-num">333</span>   <span class="ruby-identifier">bind_vars</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">bv</span> = <span class="ruby-ivar">@opts</span>[<span class="ruby-value">:bind_vars</span>]
<span class="line-num">334</span>     <span class="ruby-identifier">bv</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">bind_vars</span>).<span class="ruby-identifier">freeze</span>
<span class="line-num">335</span>   <span class="ruby-keyword">else</span>
<span class="line-num">336</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">bind_vars</span>.<span class="ruby-identifier">frozen?</span>
<span class="line-num">337</span>       <span class="ruby-identifier">bind_vars</span>
<span class="line-num">338</span>     <span class="ruby-keyword">else</span>
<span class="line-num">339</span>       <span class="ruby-constant">Hash</span>[<span class="ruby-identifier">bind_vars</span>]
<span class="line-num">340</span>     <span class="ruby-keyword">end</span>
<span class="line-num">341</span>   <span class="ruby-keyword">end</span>
<span class="line-num">342</span> 
<span class="line-num">343</span>   <span class="ruby-identifier">clone</span>(<span class="ruby-value">:bind_vars</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">bind_vars</span>)
<span class="line-num">344</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-call" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">call</span><span
            class="method-args">(type, bind_variables=OPTS, *values, &amp;block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>For the given type (:select, :first, :insert, :insert_select, :update, :delete, or :single_value), run the sql with the bind variables specified in the hash.  <code>values</code> is a hash passed to insert or update (if one of those types is used), which may contain placeholders.</p>

<pre class="ruby"><span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">where</span>(<span class="ruby-value">id:</span> <span class="ruby-value">:$id</span>).<span class="ruby-identifier">call</span>(<span class="ruby-value">:first</span>, <span class="ruby-value">id:</span> <span class="ruby-value">1</span>)
<span class="ruby-comment"># SELECT * FROM table WHERE id = ? LIMIT 1 -- (1)</span>
<span class="ruby-comment"># =&gt; {:id=&gt;1}</span>
</pre>
          
          

          
          <div class="method-source-code" id="call-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/prepared_statements.rb</span>
<span class="line-num">353</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">call</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">bind_variables</span>=<span class="ruby-constant">OPTS</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">values</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">354</span>   <span class="ruby-identifier">to_prepared_statement</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">values</span>, <span class="ruby-value">:extend</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">bound_variable_modules</span>).<span class="ruby-identifier">call</span>(<span class="ruby-identifier">bind_variables</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">355</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-prepare" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">prepare</span><span
            class="method-args">(type, name, *values)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Prepare an <a href="SQL.html"><code>SQL</code></a> statement for later execution.  Takes a type similar to <a href="Dataset.html#method-i-call"><code>call</code></a>, and the <code>name</code> symbol of the prepared statement.</p>

<p>This returns a clone of the dataset extended with <a href="Dataset/PreparedStatementMethods.html"><code>PreparedStatementMethods</code></a>, which you can <code>call</code> with the hash of bind variables to use. The prepared statement is also stored in the associated <a href="Database.html"><code>Database</code></a>, where it can be called by name. The following usage is identical:</p>

<pre class="ruby"><span class="ruby-identifier">ps</span> = <span class="ruby-constant">DB</span>[<span class="ruby-value">:table</span>].<span class="ruby-identifier">where</span>(<span class="ruby-value">name:</span> <span class="ruby-value">:$name</span>).<span class="ruby-identifier">prepare</span>(<span class="ruby-value">:first</span>, <span class="ruby-value">:select_by_name</span>)

<span class="ruby-identifier">ps</span>.<span class="ruby-identifier">call</span>(<span class="ruby-value">name:</span> <span class="ruby-string">&#39;Blah&#39;</span>)
<span class="ruby-comment"># SELECT * FROM table WHERE name = ? -- (&#39;Blah&#39;)</span>
<span class="ruby-comment"># =&gt; {:id=&gt;1, :name=&gt;&#39;Blah&#39;}</span>

<span class="ruby-constant">DB</span>.<span class="ruby-identifier">call</span>(<span class="ruby-value">:select_by_name</span>, <span class="ruby-value">name:</span> <span class="ruby-string">&#39;Blah&#39;</span>) <span class="ruby-comment"># Same thing</span>
</pre>
          
          

          
          <div class="method-source-code" id="prepare-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/prepared_statements.rb</span>
<span class="line-num">373</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">prepare</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">name</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">values</span>)
<span class="line-num">374</span>   <span class="ruby-identifier">ps</span> = <span class="ruby-identifier">to_prepared_statement</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">values</span>, <span class="ruby-value">:name</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">name</span>, <span class="ruby-value">:extend</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">prepared_statement_modules</span>, <span class="ruby-value">:no_delayed_evaluations</span><span class="ruby-operator">=&gt;</span><span class="ruby-keyword">true</span>)
<span class="line-num">375</span> 
<span class="line-num">376</span>   <span class="ruby-identifier">ps</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">ps</span>.<span class="ruby-identifier">send</span>(<span class="ruby-value">:emulate_prepared_statements?</span>)
<span class="line-num">377</span>     <span class="ruby-identifier">ps</span> = <span class="ruby-identifier">ps</span>.<span class="ruby-identifier">with_extend</span>(<span class="ruby-constant">EmulatePreparedStatementMethods</span>)
<span class="line-num">378</span>     <span class="ruby-identifier">ps</span>.<span class="ruby-identifier">send</span>(<span class="ruby-value">:emulated_prepared_statement</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">values</span>)
<span class="line-num">379</span>   <span class="ruby-keyword">else</span>
<span class="line-num">380</span>     <span class="ruby-identifier">sql</span> = <span class="ruby-identifier">ps</span>.<span class="ruby-identifier">prepared_sql</span>
<span class="line-num">381</span>     <span class="ruby-identifier">ps</span>.<span class="ruby-identifier">prepared_args</span>.<span class="ruby-identifier">freeze</span>
<span class="line-num">382</span>     <span class="ruby-identifier">ps</span>.<span class="ruby-identifier">clone</span>(<span class="ruby-value">:prepared_sql</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">sql</span>, <span class="ruby-value">:sql</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">sql</span>)
<span class="line-num">383</span>   <span class="ruby-keyword">end</span>
<span class="line-num">384</span> 
<span class="line-num">385</span>   <span class="ruby-identifier">db</span>.<span class="ruby-identifier">set_prepared_statement</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">ps</span>)
<span class="line-num">386</span>   <span class="ruby-identifier">ps</span>
<span class="line-num">387</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="protected-instance-8+-+Methods+related+to+prepared+statements+or+bound+variables-method-details" class="method-section">
       <header>
         <h3>Protected Instance Methods</h3>
       </header>

    
      <div id="method-i-to_prepared_statement" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">to_prepared_statement</span><span
            class="method-args">(type, values=nil, opts=OPTS)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Return a cloned copy of the current dataset extended with <a href="Dataset/PreparedStatementMethods.html"><code>PreparedStatementMethods</code></a>, setting the type and modify values.</p>
          
          

          
          <div class="method-source-code" id="to_prepared_statement-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/prepared_statements.rb</span>
<span class="line-num">393</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">to_prepared_statement</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">values</span>=<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)
<span class="line-num">394</span>   <span class="ruby-identifier">mods</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:extend</span>] <span class="ruby-operator">||</span> []
<span class="line-num">395</span>   <span class="ruby-identifier">mods</span> <span class="ruby-operator">+=</span> [<span class="ruby-constant">PreparedStatementMethods</span>]
<span class="line-num">396</span> 
<span class="line-num">397</span>   <span class="ruby-identifier">bind</span>.
<span class="line-num">398</span>     <span class="ruby-identifier">clone</span>(<span class="ruby-value">:prepared_statement_name</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">opts</span>[<span class="ruby-value">:name</span>], <span class="ruby-value">:prepared_type</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">type</span>, <span class="ruby-value">:prepared_modify_values</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">values</span>, <span class="ruby-value">:orig_dataset</span><span class="ruby-operator">=&gt;</span><span class="ruby-keyword">self</span>, <span class="ruby-value">:no_cache_sql</span><span class="ruby-operator">=&gt;</span><span class="ruby-keyword">true</span>, <span class="ruby-value">:prepared_args</span><span class="ruby-operator">=&gt;</span><span class="ruby-ivar">@opts</span>[<span class="ruby-value">:prepared_args</span>]<span class="ruby-operator">||</span>[], <span class="ruby-value">:no_delayed_evaluations</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">opts</span>[<span class="ruby-value">:no_delayed_evaluations</span>]).
<span class="line-num">399</span>     <span class="ruby-identifier">with_extend</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">mods</span>)
<span class="line-num">400</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>

  <section id="9+-+Internal+Methods+relating+to+SQL+Creation" class="documentation-section">
    
    <header class="documentation-section-title">
      <h2>
        9 - Internal Methods relating to SQL Creation
      </h2>
      <span class="section-click-top">
        <a href="#top">&uarr; top</a>
      </span>
    </header>
    

    

    
    <section class="constants-list">
      <header>
        <h3>Constants</h3>
      </header>
      <dl>
      
        <dt id="BITWISE_METHOD_MAP">BITWISE_METHOD_MAP
        
        <dd>
        
      
        <dt id="COUNT_FROM_SELF_OPTS">COUNT_FROM_SELF_OPTS
        
        <dd>
        
      
        <dt id="COUNT_OF_ALL_AS_COUNT">COUNT_OF_ALL_AS_COUNT
        
        <dd>
        
      
        <dt id="DEFAULT">DEFAULT
        
        <dd>
        
      
        <dt id="EXISTS">EXISTS
        
        <dd>
        
      
        <dt id="IS_LITERALS">IS_LITERALS
        
        <dd>
        
      
        <dt id="IS_OPERATORS">IS_OPERATORS
        
        <dd>
        
      
        <dt id="LIKE_OPERATORS">LIKE_OPERATORS
        
        <dd>
        
      
        <dt id="N_ARITY_OPERATORS">N_ARITY_OPERATORS
        
        <dd>
        
      
        <dt id="QUALIFY_KEYS">QUALIFY_KEYS
        
        <dd>
        
      
        <dt id="REGEXP_OPERATORS">REGEXP_OPERATORS
        
        <dd>
        
      
        <dt id="TWO_ARITY_OPERATORS">TWO_ARITY_OPERATORS
        
        <dd>
        
      
        <dt id="WILDCARD">WILDCARD
        
        <dd>
        
      
      </dl>
    </section>
    

    

    
     <section id="public-class-9+-+Internal+Methods+relating+to+SQL+Creation-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-clause_methods" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">clause_methods</span><span
            class="method-args">(type, clauses)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Given a type (e.g. select) and an array of clauses, return an array of methods to call to build the <a href="SQL.html"><code>SQL</code></a> string.</p>
          
          

          
          <div class="method-source-code" id="clause_methods-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/sql.rb</span>
<span class="line-num">195</span> <span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">clause_methods</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">clauses</span>)
<span class="line-num">196</span>   <span class="ruby-identifier">clauses</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">clause</span><span class="ruby-operator">|</span> <span class="ruby-value">:&quot;#{type}_#{clause}_sql&quot;</span>}.<span class="ruby-identifier">freeze</span>
<span class="line-num">197</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-def_sql_method" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">def_sql_method</span><span
            class="method-args">(mod, type, clauses)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Define a dataset literalization method for the given type in the given module, using the given clauses.</p>

<p>Arguments:</p>
<dl class="rdoc-list note-list"><dt>mod 
<dd>
<p>Module in which to define method</p>
</dd><dt>type 
<dd>
<p>Type of <a href="SQL.html"><code>SQL</code></a> literalization method to create, either :select, :insert, :update, or :delete</p>
</dd><dt>clauses 
<dd>
<p>array of clauses that make up the <a href="SQL.html"><code>SQL</code></a> query for the type.  This can either be a single array of symbols/strings, or it can be an array of pairs, with the first element in each pair being an if/elsif/else code fragment, and the second element in each pair being an array of symbol/strings for the appropriate branch.</p>
</dd></dl>
          
          

          
          <div class="method-source-code" id="def_sql_method-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/sql.rb</span>
<span class="line-num">209</span> <span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">def_sql_method</span>(<span class="ruby-identifier">mod</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">clauses</span>)
<span class="line-num">210</span>   <span class="ruby-identifier">priv</span> = <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:update</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:insert</span>
<span class="line-num">211</span>   <span class="ruby-identifier">cacheable</span> = <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:select</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:delete</span>
<span class="line-num">212</span> 
<span class="line-num">213</span>   <span class="ruby-identifier">lines</span> = []
<span class="line-num">214</span>   <span class="ruby-identifier">lines</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;private&#39;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">priv</span>
<span class="line-num">215</span>   <span class="ruby-identifier">lines</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;def #{&#39;_&#39; if priv}#{type}_sql&quot;</span>
<span class="line-num">216</span>   <span class="ruby-identifier">lines</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;if sql = opts[:sql]; return static_sql(sql) end&#39;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">priv</span>
<span class="line-num">217</span>   <span class="ruby-identifier">lines</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;if sql = cache_get(:_#{type}_sql); return sql end&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">cacheable</span>
<span class="line-num">218</span>   <span class="ruby-identifier">lines</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;check_delete_allowed!&#39;</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;check_not_limited!(:delete)&#39;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:delete</span>
<span class="line-num">219</span>   <span class="ruby-identifier">lines</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;sql = @opts[:append_sql] || sql_string_origin&#39;</span>
<span class="line-num">220</span> 
<span class="line-num">221</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">clauses</span>.<span class="ruby-identifier">all?</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)}
<span class="line-num">222</span>     <span class="ruby-identifier">clauses</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">i</span>, <span class="ruby-identifier">cs</span><span class="ruby-operator">|</span>
<span class="line-num">223</span>       <span class="ruby-identifier">lines</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">i</span>
<span class="line-num">224</span>       <span class="ruby-identifier">lines</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-identifier">clause_methods</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">cs</span>).<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;#{x}(sql)&quot;</span>}) 
<span class="line-num">225</span>     <span class="ruby-keyword">end</span> 
<span class="line-num">226</span>     <span class="ruby-identifier">lines</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;end&#39;</span>
<span class="line-num">227</span>   <span class="ruby-keyword">else</span>
<span class="line-num">228</span>     <span class="ruby-identifier">lines</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-identifier">clause_methods</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">clauses</span>).<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;#{x}(sql)&quot;</span>})
<span class="line-num">229</span>   <span class="ruby-keyword">end</span>
<span class="line-num">230</span> 
<span class="line-num">231</span>   <span class="ruby-identifier">lines</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;cache_set(:_#{type}_sql, sql) if cache_sql?&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">cacheable</span>
<span class="line-num">232</span>   <span class="ruby-identifier">lines</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;sql&#39;</span>
<span class="line-num">233</span>   <span class="ruby-identifier">lines</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;end&#39;</span>
<span class="line-num">234</span> 
<span class="line-num">235</span>   <span class="ruby-identifier">mod</span>.<span class="ruby-identifier">class_eval</span> <span class="ruby-identifier">lines</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;\n&quot;</span>), <span class="ruby-keyword">__FILE__</span>, <span class="ruby-keyword">__LINE__</span>
<span class="line-num">236</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="public-instance-9+-+Internal+Methods+relating+to+SQL+Creation-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-aliased_expression_sql_append" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">aliased_expression_sql_append</span><span
            class="method-args">(sql, ae)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Append literalization of aliased expression to <a href="SQL.html"><code>SQL</code></a> string.</p>
          
          

          
          <div class="method-source-code" id="aliased_expression_sql_append-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/sql.rb</span>
<span class="line-num">270</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">aliased_expression_sql_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">ae</span>)
<span class="line-num">271</span>   <span class="ruby-identifier">literal_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">ae</span>.<span class="ruby-identifier">expression</span>)
<span class="line-num">272</span>   <span class="ruby-identifier">as_sql_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">ae</span>.<span class="ruby-identifier">alias</span>, <span class="ruby-identifier">ae</span>.<span class="ruby-identifier">columns</span>)
<span class="line-num">273</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-array_sql_append" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">array_sql_append</span><span
            class="method-args">(sql, a)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Append literalization of array to <a href="SQL.html"><code>SQL</code></a> string.</p>
          
          

          
          <div class="method-source-code" id="array_sql_append-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/sql.rb</span>
<span class="line-num">276</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">array_sql_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">a</span>)
<span class="line-num">277</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">empty?</span>
<span class="line-num">278</span>     <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;(NULL)&#39;</span>
<span class="line-num">279</span>   <span class="ruby-keyword">else</span>
<span class="line-num">280</span>     <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;(&#39;</span>
<span class="line-num">281</span>     <span class="ruby-identifier">expression_list_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">a</span>)
<span class="line-num">282</span>     <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;)&#39;</span>
<span class="line-num">283</span>   <span class="ruby-keyword">end</span>
<span class="line-num">284</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-boolean_constant_sql_append" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">boolean_constant_sql_append</span><span
            class="method-args">(sql, constant)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Append literalization of boolean constant to <a href="SQL.html"><code>SQL</code></a> string.</p>
          
          

          
          <div class="method-source-code" id="boolean_constant_sql_append-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/sql.rb</span>
<span class="line-num">287</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">boolean_constant_sql_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">constant</span>)
<span class="line-num">288</span>   <span class="ruby-keyword">if</span> (<span class="ruby-identifier">constant</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">constant</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">false</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">supports_where_true?</span>
<span class="line-num">289</span>     <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> (<span class="ruby-identifier">constant</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39;(1 = 1)&#39;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&#39;(1 = 0)&#39;</span>)
<span class="line-num">290</span>   <span class="ruby-keyword">else</span>
<span class="line-num">291</span>     <span class="ruby-identifier">literal_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">constant</span>)
<span class="line-num">292</span>   <span class="ruby-keyword">end</span>
<span class="line-num">293</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-case_expression_sql_append" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">case_expression_sql_append</span><span
            class="method-args">(sql, ce)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Append literalization of case expression to <a href="SQL.html"><code>SQL</code></a> string.</p>
          
          

          
          <div class="method-source-code" id="case_expression_sql_append-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/sql.rb</span>
<span class="line-num">296</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">case_expression_sql_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">ce</span>)
<span class="line-num">297</span>   <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;(CASE&#39;</span>
<span class="line-num">298</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">ce</span>.<span class="ruby-identifier">expression?</span>
<span class="line-num">299</span>     <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39; &#39;</span>
<span class="line-num">300</span>     <span class="ruby-identifier">literal_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">ce</span>.<span class="ruby-identifier">expression</span>)
<span class="line-num">301</span>   <span class="ruby-keyword">end</span>
<span class="line-num">302</span>   <span class="ruby-identifier">w</span> = <span class="ruby-string">&quot; WHEN &quot;</span>
<span class="line-num">303</span>   <span class="ruby-identifier">t</span> = <span class="ruby-string">&quot; THEN &quot;</span>
<span class="line-num">304</span>   <span class="ruby-identifier">ce</span>.<span class="ruby-identifier">conditions</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span>,<span class="ruby-identifier">r</span><span class="ruby-operator">|</span>
<span class="line-num">305</span>     <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">w</span>
<span class="line-num">306</span>     <span class="ruby-identifier">literal_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">c</span>)
<span class="line-num">307</span>     <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">t</span>
<span class="line-num">308</span>     <span class="ruby-identifier">literal_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">r</span>)
<span class="line-num">309</span>   <span class="ruby-keyword">end</span>
<span class="line-num">310</span>   <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot; ELSE &quot;</span>
<span class="line-num">311</span>   <span class="ruby-identifier">literal_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">ce</span>.<span class="ruby-identifier">default</span>)
<span class="line-num">312</span>   <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot; END)&quot;</span>
<span class="line-num">313</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-cast_sql_append" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">cast_sql_append</span><span
            class="method-args">(sql, expr, type)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Append literalization of cast expression to <a href="SQL.html"><code>SQL</code></a> string.</p>
          
          

          
          <div class="method-source-code" id="cast_sql_append-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/sql.rb</span>
<span class="line-num">316</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">cast_sql_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">expr</span>, <span class="ruby-identifier">type</span>)
<span class="line-num">317</span>   <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;CAST(&#39;</span>
<span class="line-num">318</span>   <span class="ruby-identifier">literal_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">expr</span>)
<span class="line-num">319</span>   <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39; AS &#39;</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">db</span>.<span class="ruby-identifier">cast_type_literal</span>(<span class="ruby-identifier">type</span>).<span class="ruby-identifier">to_s</span>
<span class="line-num">320</span>   <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;)&#39;</span>
<span class="line-num">321</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-column_all_sql_append" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">column_all_sql_append</span><span
            class="method-args">(sql, ca)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Append literalization of column all selection to <a href="SQL.html"><code>SQL</code></a> string.</p>
          
          

          
          <div class="method-source-code" id="column_all_sql_append-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/sql.rb</span>
<span class="line-num">324</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">column_all_sql_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">ca</span>)
<span class="line-num">325</span>   <span class="ruby-identifier">qualified_identifier_sql_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">ca</span>.<span class="ruby-identifier">table</span>, <span class="ruby-constant">WILDCARD</span>)
<span class="line-num">326</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-complex_expression_sql_append" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">complex_expression_sql_append</span><span
            class="method-args">(sql, op, args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Append literalization of complex expression to <a href="SQL.html"><code>SQL</code></a> string.</p>
          
          

          
          <div class="method-source-code" id="complex_expression_sql_append-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/sql.rb</span>
<span class="line-num">329</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">complex_expression_sql_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">op</span>, <span class="ruby-identifier">args</span>)
<span class="line-num">330</span>   <span class="ruby-keyword">case</span> <span class="ruby-identifier">op</span>
<span class="line-num">331</span>   <span class="ruby-keyword">when</span> <span class="ruby-operator">*</span><span class="ruby-constant">IS_OPERATORS</span>
<span class="line-num">332</span>     <span class="ruby-identifier">r</span> = <span class="ruby-identifier">args</span>[<span class="ruby-value">1</span>]
<span class="line-num">333</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">supports_is_true?</span>
<span class="line-num">334</span>       <span class="ruby-identifier">raise</span>(<span class="ruby-constant">InvalidOperation</span>, <span class="ruby-string">&#39;Invalid argument used for IS operator&#39;</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">val</span> = <span class="ruby-constant">IS_LITERALS</span>[<span class="ruby-identifier">r</span>]
<span class="line-num">335</span>       <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;(&#39;</span>
<span class="line-num">336</span>       <span class="ruby-identifier">literal_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">args</span>[<span class="ruby-value">0</span>])
<span class="line-num">337</span>       <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39; &#39;</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">op</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39; &#39;</span>
<span class="line-num">338</span>       <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;)&#39;</span>
<span class="line-num">339</span>     <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">op</span> <span class="ruby-operator">==</span> <span class="ruby-value">:IS</span>
<span class="line-num">340</span>       <span class="ruby-identifier">complex_expression_sql_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-value">:&quot;=&quot;</span>, <span class="ruby-identifier">args</span>)
<span class="line-num">341</span>     <span class="ruby-keyword">else</span>
<span class="line-num">342</span>       <span class="ruby-identifier">complex_expression_sql_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-value">:OR</span>, [<span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">BooleanExpression</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:&quot;!=&quot;</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>), <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">BooleanExpression</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:IS</span>, <span class="ruby-identifier">args</span>[<span class="ruby-value">0</span>], <span class="ruby-keyword">nil</span>)])
<span class="line-num">343</span>     <span class="ruby-keyword">end</span>
<span class="line-num">344</span>   <span class="ruby-keyword">when</span> <span class="ruby-value">:IN</span>, <span class="ruby-value">:&quot;NOT IN&quot;</span>
<span class="line-num">345</span>     <span class="ruby-identifier">cols</span> = <span class="ruby-identifier">args</span>[<span class="ruby-value">0</span>]
<span class="line-num">346</span>     <span class="ruby-identifier">vals</span> = <span class="ruby-identifier">args</span>[<span class="ruby-value">1</span>]
<span class="line-num">347</span>     <span class="ruby-identifier">col_array</span> = <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">cols</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)
<span class="line-num">348</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">vals</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)
<span class="line-num">349</span>       <span class="ruby-identifier">val_array</span> = <span class="ruby-keyword">true</span>
<span class="line-num">350</span>       <span class="ruby-identifier">empty_val_array</span> = <span class="ruby-identifier">vals</span> <span class="ruby-operator">==</span> []
<span class="line-num">351</span>     <span class="ruby-keyword">end</span>
<span class="line-num">352</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">empty_val_array</span>
<span class="line-num">353</span>       <span class="ruby-identifier">literal_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">empty_array_value</span>(<span class="ruby-identifier">op</span>, <span class="ruby-identifier">cols</span>))
<span class="line-num">354</span>     <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">col_array</span>
<span class="line-num">355</span>       <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">supports_multiple_column_in?</span>
<span class="line-num">356</span>         <span class="ruby-keyword">if</span> <span class="ruby-identifier">val_array</span>
<span class="line-num">357</span>           <span class="ruby-identifier">expr</span> = <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">BooleanExpression</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:OR</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">vals</span>.<span class="ruby-identifier">to_a</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">vs</span><span class="ruby-operator">|</span> <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">BooleanExpression</span>.<span class="ruby-identifier">from_value_pairs</span>(<span class="ruby-identifier">cols</span>.<span class="ruby-identifier">to_a</span>.<span class="ruby-identifier">zip</span>(<span class="ruby-identifier">vs</span>).<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">c</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> [<span class="ruby-identifier">c</span>, <span class="ruby-identifier">v</span>]})})
<span class="line-num">358</span>           <span class="ruby-identifier">literal_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">op</span> <span class="ruby-operator">==</span> <span class="ruby-value">:IN</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">expr</span> <span class="ruby-operator">:</span> <span class="ruby-operator">~</span><span class="ruby-identifier">expr</span>)
<span class="line-num">359</span>         <span class="ruby-keyword">else</span>
<span class="line-num">360</span>           <span class="ruby-identifier">old_vals</span> = <span class="ruby-identifier">vals</span>
<span class="line-num">361</span>           <span class="ruby-identifier">vals</span> = <span class="ruby-identifier">vals</span>.<span class="ruby-identifier">naked</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">vals</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Sequel</span><span class="ruby-operator">::</span><span class="ruby-constant">Dataset</span>)
<span class="line-num">362</span>           <span class="ruby-identifier">vals</span> = <span class="ruby-identifier">vals</span>.<span class="ruby-identifier">to_a</span>
<span class="line-num">363</span>           <span class="ruby-identifier">val_cols</span> = <span class="ruby-identifier">old_vals</span>.<span class="ruby-identifier">columns</span>
<span class="line-num">364</span>           <span class="ruby-identifier">complex_expression_sql_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">op</span>, [<span class="ruby-identifier">cols</span>, <span class="ruby-identifier">vals</span>.<span class="ruby-identifier">map!</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">values_at</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">val_cols</span>)}])
<span class="line-num">365</span>         <span class="ruby-keyword">end</span>
<span class="line-num">366</span>       <span class="ruby-keyword">else</span>
<span class="line-num">367</span>         <span class="ruby-comment"># If the columns and values are both arrays, use array_sql instead of</span>
<span class="line-num">368</span>         <span class="ruby-comment"># literal so that if values is an array of two element arrays, it</span>
<span class="line-num">369</span>         <span class="ruby-comment"># will be treated as a value list instead of a condition specifier.</span>
<span class="line-num">370</span>         <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;(&#39;</span>
<span class="line-num">371</span>         <span class="ruby-identifier">literal_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">cols</span>)
<span class="line-num">372</span>         <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39; &#39;</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">op</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39; &#39;</span>
<span class="line-num">373</span>         <span class="ruby-keyword">if</span> <span class="ruby-identifier">val_array</span>
<span class="line-num">374</span>           <span class="ruby-identifier">array_sql_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">vals</span>)
<span class="line-num">375</span>         <span class="ruby-keyword">else</span>
<span class="line-num">376</span>           <span class="ruby-identifier">literal_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">vals</span>)
<span class="line-num">377</span>         <span class="ruby-keyword">end</span>
<span class="line-num">378</span>         <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;)&#39;</span>
<span class="line-num">379</span>       <span class="ruby-keyword">end</span>
<span class="line-num">380</span>     <span class="ruby-keyword">else</span>
<span class="line-num">381</span>       <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;(&#39;</span>
<span class="line-num">382</span>       <span class="ruby-identifier">literal_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">cols</span>)
<span class="line-num">383</span>       <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39; &#39;</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">op</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39; &#39;</span>
<span class="line-num">384</span>       <span class="ruby-identifier">literal_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">vals</span>)
<span class="line-num">385</span>       <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;)&#39;</span>
<span class="line-num">386</span>     <span class="ruby-keyword">end</span>
<span class="line-num">387</span>   <span class="ruby-keyword">when</span> <span class="ruby-value">:LIKE</span>, <span class="ruby-value">:&#39;NOT LIKE&#39;</span>
<span class="line-num">388</span>     <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;(&#39;</span>
<span class="line-num">389</span>     <span class="ruby-identifier">literal_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">args</span>[<span class="ruby-value">0</span>])
<span class="line-num">390</span>     <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39; &#39;</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">op</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39; &#39;</span>
<span class="line-num">391</span>     <span class="ruby-identifier">literal_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">args</span>[<span class="ruby-value">1</span>])
<span class="line-num">392</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">requires_like_escape?</span>
<span class="line-num">393</span>       <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot; ESCAPE &quot;</span>
<span class="line-num">394</span>       <span class="ruby-identifier">literal_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-string">&quot;\\&quot;</span>)
<span class="line-num">395</span>     <span class="ruby-keyword">end</span>
<span class="line-num">396</span>     <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;)&#39;</span>
<span class="line-num">397</span>   <span class="ruby-keyword">when</span> <span class="ruby-value">:ILIKE</span>, <span class="ruby-value">:&#39;NOT ILIKE&#39;</span>
<span class="line-num">398</span>     <span class="ruby-identifier">complex_expression_sql_append</span>(<span class="ruby-identifier">sql</span>, (<span class="ruby-identifier">op</span> <span class="ruby-operator">==</span> <span class="ruby-value">:ILIKE</span> <span class="ruby-operator">?</span> <span class="ruby-value">:LIKE</span> <span class="ruby-operator">:</span> <span class="ruby-value">:&quot;NOT LIKE&quot;</span>), <span class="ruby-identifier">args</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">function</span>(<span class="ruby-value">:UPPER</span>, <span class="ruby-identifier">v</span>)})
<span class="line-num">399</span>   <span class="ruby-keyword">when</span> <span class="ruby-value">:**</span>
<span class="line-num">400</span>     <span class="ruby-identifier">function_sql_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">function</span>(<span class="ruby-value">:power</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>))
<span class="line-num">401</span>   <span class="ruby-keyword">when</span> <span class="ruby-operator">*</span><span class="ruby-constant">TWO_ARITY_OPERATORS</span>
<span class="line-num">402</span>     <span class="ruby-keyword">if</span> <span class="ruby-constant">REGEXP_OPERATORS</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">op</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">supports_regexp?</span>
<span class="line-num">403</span>       <span class="ruby-identifier">raise</span> <span class="ruby-constant">InvalidOperation</span>, <span class="ruby-node">&quot;Pattern matching via regular expressions is not supported on #{db.database_type}&quot;</span>
<span class="line-num">404</span>     <span class="ruby-keyword">end</span>
<span class="line-num">405</span>     <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;(&#39;</span>
<span class="line-num">406</span>     <span class="ruby-identifier">literal_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">args</span>[<span class="ruby-value">0</span>])
<span class="line-num">407</span>     <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39; &#39;</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">op</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39; &#39;</span>
<span class="line-num">408</span>     <span class="ruby-identifier">literal_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">args</span>[<span class="ruby-value">1</span>])
<span class="line-num">409</span>     <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;)&#39;</span>
<span class="line-num">410</span>   <span class="ruby-keyword">when</span> <span class="ruby-operator">*</span><span class="ruby-constant">N_ARITY_OPERATORS</span>
<span class="line-num">411</span>     <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;(&#39;</span>
<span class="line-num">412</span>     <span class="ruby-identifier">c</span> = <span class="ruby-keyword">false</span>
<span class="line-num">413</span>     <span class="ruby-identifier">op_str</span> = <span class="ruby-node">&quot; #{op} &quot;</span>
<span class="line-num">414</span>     <span class="ruby-identifier">args</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span>
<span class="line-num">415</span>       <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">op_str</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">c</span>
<span class="line-num">416</span>       <span class="ruby-identifier">literal_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">a</span>)
<span class="line-num">417</span>       <span class="ruby-identifier">c</span> <span class="ruby-operator">||=</span> <span class="ruby-keyword">true</span>
<span class="line-num">418</span>     <span class="ruby-keyword">end</span>
<span class="line-num">419</span>     <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;)&#39;</span>
<span class="line-num">420</span>   <span class="ruby-keyword">when</span> <span class="ruby-value">:NOT</span>
<span class="line-num">421</span>     <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;NOT &#39;</span>
<span class="line-num">422</span>     <span class="ruby-identifier">literal_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">args</span>[<span class="ruby-value">0</span>])
<span class="line-num">423</span>   <span class="ruby-keyword">when</span> <span class="ruby-value">:NOOP</span>
<span class="line-num">424</span>     <span class="ruby-identifier">literal_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">args</span>[<span class="ruby-value">0</span>])
<span class="line-num">425</span>   <span class="ruby-keyword">when</span> <span class="ruby-value">:&#39;B~&#39;</span>
<span class="line-num">426</span>     <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;~&#39;</span>
<span class="line-num">427</span>     <span class="ruby-identifier">literal_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">args</span>[<span class="ruby-value">0</span>])
<span class="line-num">428</span>   <span class="ruby-keyword">when</span> <span class="ruby-value">:extract</span>
<span class="line-num">429</span>     <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;extract(&#39;</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">args</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">to_s</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39; FROM &#39;</span>
<span class="line-num">430</span>     <span class="ruby-identifier">literal_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">args</span>[<span class="ruby-value">1</span>])
<span class="line-num">431</span>     <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;)&#39;</span>
<span class="line-num">432</span>   <span class="ruby-keyword">else</span>
<span class="line-num">433</span>     <span class="ruby-identifier">raise</span>(<span class="ruby-constant">InvalidOperation</span>, <span class="ruby-node">&quot;invalid operator #{op}&quot;</span>)
<span class="line-num">434</span>   <span class="ruby-keyword">end</span>
<span class="line-num">435</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-constant_sql_append" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">constant_sql_append</span><span
            class="method-args">(sql, constant)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Append literalization of constant to <a href="SQL.html"><code>SQL</code></a> string.</p>
          
          

          
          <div class="method-source-code" id="constant_sql_append-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/sql.rb</span>
<span class="line-num">438</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">constant_sql_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">constant</span>)
<span class="line-num">439</span>   <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">constant</span>.<span class="ruby-identifier">to_s</span>
<span class="line-num">440</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-delayed_evaluation_sql_append" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">delayed_evaluation_sql_append</span><span
            class="method-args">(sql, delay)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Append literalization of delayed evaluation to <a href="SQL.html"><code>SQL</code></a> string, causing the delayed evaluation proc to be evaluated.</p>
          
          

          
          <div class="method-source-code" id="delayed_evaluation_sql_append-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/sql.rb</span>
<span class="line-num">444</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">delayed_evaluation_sql_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">delay</span>)
<span class="line-num">445</span>   <span class="ruby-comment"># Delayed evaluations are used specifically so the SQL</span>
<span class="line-num">446</span>   <span class="ruby-comment"># can differ in subsequent calls, so we definitely don&#39;t</span>
<span class="line-num">447</span>   <span class="ruby-comment"># want to cache the sql in this case.</span>
<span class="line-num">448</span>   <span class="ruby-identifier">disable_sql_caching!</span>
<span class="line-num">449</span> 
<span class="line-num">450</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">recorder</span> = <span class="ruby-ivar">@opts</span>[<span class="ruby-value">:placeholder_literalizer</span>]
<span class="line-num">451</span>     <span class="ruby-identifier">recorder</span>.<span class="ruby-identifier">use</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">lambda</span>{<span class="ruby-identifier">delay</span>.<span class="ruby-identifier">call</span>(<span class="ruby-keyword">self</span>)}, <span class="ruby-keyword">nil</span>)
<span class="line-num">452</span>   <span class="ruby-keyword">else</span>
<span class="line-num">453</span>     <span class="ruby-identifier">literal_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">delay</span>.<span class="ruby-identifier">call</span>(<span class="ruby-keyword">self</span>))
<span class="line-num">454</span>   <span class="ruby-keyword">end</span>
<span class="line-num">455</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-function_sql_append" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">function_sql_append</span><span
            class="method-args">(sql, f)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Append literalization of function call to <a href="SQL.html"><code>SQL</code></a> string.</p>
          
          

          
          <div class="method-source-code" id="function_sql_append-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/sql.rb</span>
<span class="line-num">458</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">function_sql_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">f</span>)
<span class="line-num">459</span>   <span class="ruby-identifier">name</span> = <span class="ruby-identifier">f</span>.<span class="ruby-identifier">name</span>
<span class="line-num">460</span>   <span class="ruby-identifier">opts</span> = <span class="ruby-identifier">f</span>.<span class="ruby-identifier">opts</span>
<span class="line-num">461</span> 
<span class="line-num">462</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:emulate</span>]
<span class="line-num">463</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">emulate_function?</span>(<span class="ruby-identifier">name</span>)
<span class="line-num">464</span>       <span class="ruby-identifier">emulate_function_sql_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">f</span>)
<span class="line-num">465</span>       <span class="ruby-keyword">return</span>
<span class="line-num">466</span>     <span class="ruby-keyword">end</span>
<span class="line-num">467</span> 
<span class="line-num">468</span>     <span class="ruby-identifier">name</span> = <span class="ruby-identifier">native_function_name</span>(<span class="ruby-identifier">name</span>) 
<span class="line-num">469</span>   <span class="ruby-keyword">end</span>
<span class="line-num">470</span> 
<span class="line-num">471</span>   <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;LATERAL &#39;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:lateral</span>]
<span class="line-num">472</span> 
<span class="line-num">473</span>   <span class="ruby-keyword">case</span> <span class="ruby-identifier">name</span>
<span class="line-num">474</span>   <span class="ruby-keyword">when</span> <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">Identifier</span>
<span class="line-num">475</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">supports_quoted_function_names?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:quoted</span>]
<span class="line-num">476</span>       <span class="ruby-identifier">literal_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">name</span>)
<span class="line-num">477</span>     <span class="ruby-keyword">else</span>
<span class="line-num">478</span>       <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">name</span>.<span class="ruby-identifier">value</span>.<span class="ruby-identifier">to_s</span>
<span class="line-num">479</span>     <span class="ruby-keyword">end</span>
<span class="line-num">480</span>   <span class="ruby-keyword">when</span> <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">QualifiedIdentifier</span>
<span class="line-num">481</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">supports_quoted_function_names?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:quoted</span>] <span class="ruby-operator">!=</span> <span class="ruby-keyword">false</span>
<span class="line-num">482</span>       <span class="ruby-identifier">literal_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">name</span>)
<span class="line-num">483</span>     <span class="ruby-keyword">else</span>
<span class="line-num">484</span>       <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">split_qualifiers</span>(<span class="ruby-identifier">name</span>).<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39;.&#39;</span>)
<span class="line-num">485</span>     <span class="ruby-keyword">end</span>
<span class="line-num">486</span>   <span class="ruby-keyword">else</span>
<span class="line-num">487</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">supports_quoted_function_names?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:quoted</span>]
<span class="line-num">488</span>       <span class="ruby-identifier">quote_identifier_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">name</span>)
<span class="line-num">489</span>     <span class="ruby-keyword">else</span>
<span class="line-num">490</span>       <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_s</span>
<span class="line-num">491</span>     <span class="ruby-keyword">end</span>
<span class="line-num">492</span>   <span class="ruby-keyword">end</span>
<span class="line-num">493</span> 
<span class="line-num">494</span>   <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;(&#39;</span>
<span class="line-num">495</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">filter</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:filter</span>]
<span class="line-num">496</span>     <span class="ruby-identifier">filter</span> = <span class="ruby-identifier">filter_expr</span>(<span class="ruby-identifier">filter</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">opts</span>[<span class="ruby-value">:filter_block</span>])
<span class="line-num">497</span>   <span class="ruby-keyword">end</span>
<span class="line-num">498</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:*</span>]
<span class="line-num">499</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">filter</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">supports_filtered_aggregates?</span>
<span class="line-num">500</span>       <span class="ruby-identifier">literal_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">case</span>({<span class="ruby-identifier">filter</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">1</span>}, <span class="ruby-keyword">nil</span>))
<span class="line-num">501</span>       <span class="ruby-identifier">filter</span> = <span class="ruby-keyword">nil</span>
<span class="line-num">502</span>     <span class="ruby-keyword">else</span>
<span class="line-num">503</span>       <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span>  <span class="ruby-string">&#39;*&#39;</span>
<span class="line-num">504</span>     <span class="ruby-keyword">end</span>
<span class="line-num">505</span>   <span class="ruby-keyword">else</span>
<span class="line-num">506</span>     <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;DISTINCT &quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:distinct</span>]
<span class="line-num">507</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">filter</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">supports_filtered_aggregates?</span>
<span class="line-num">508</span>       <span class="ruby-identifier">expression_list_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">f</span>.<span class="ruby-identifier">args</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">arg</span><span class="ruby-operator">|</span> <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">case</span>({<span class="ruby-identifier">filter</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">arg</span>}, <span class="ruby-keyword">nil</span>)})
<span class="line-num">509</span>       <span class="ruby-identifier">filter</span> = <span class="ruby-keyword">nil</span>
<span class="line-num">510</span>     <span class="ruby-keyword">else</span>
<span class="line-num">511</span>       <span class="ruby-identifier">expression_list_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">f</span>.<span class="ruby-identifier">args</span>)
<span class="line-num">512</span>     <span class="ruby-keyword">end</span>
<span class="line-num">513</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">order</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:order</span>]
<span class="line-num">514</span>       <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot; ORDER BY &quot;</span>
<span class="line-num">515</span>       <span class="ruby-identifier">expression_list_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">order</span>)
<span class="line-num">516</span>     <span class="ruby-keyword">end</span>
<span class="line-num">517</span>   <span class="ruby-keyword">end</span>
<span class="line-num">518</span>   <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;)&#39;</span>
<span class="line-num">519</span> 
<span class="line-num">520</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">group</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:within_group</span>]
<span class="line-num">521</span>     <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot; WITHIN GROUP (ORDER BY &quot;</span>
<span class="line-num">522</span>     <span class="ruby-identifier">expression_list_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">group</span>)
<span class="line-num">523</span>     <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;)&#39;</span>
<span class="line-num">524</span>   <span class="ruby-keyword">end</span>
<span class="line-num">525</span> 
<span class="line-num">526</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">filter</span>
<span class="line-num">527</span>     <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot; FILTER (WHERE &quot;</span>
<span class="line-num">528</span>     <span class="ruby-identifier">literal_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">filter</span>)
<span class="line-num">529</span>     <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;)&#39;</span>
<span class="line-num">530</span>   <span class="ruby-keyword">end</span>
<span class="line-num">531</span> 
<span class="line-num">532</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">window</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:over</span>]
<span class="line-num">533</span>     <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39; OVER &#39;</span>
<span class="line-num">534</span>     <span class="ruby-identifier">window_sql_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">window</span>.<span class="ruby-identifier">opts</span>)
<span class="line-num">535</span>   <span class="ruby-keyword">end</span>
<span class="line-num">536</span> 
<span class="line-num">537</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:with_ordinality</span>]
<span class="line-num">538</span>     <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot; WITH ORDINALITY&quot;</span>
<span class="line-num">539</span>   <span class="ruby-keyword">end</span>
<span class="line-num">540</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-join_clause_sql_append" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">join_clause_sql_append</span><span
            class="method-args">(sql, jc)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Append literalization of JOIN clause without ON or USING to <a href="SQL.html"><code>SQL</code></a> string.</p>
          
          

          
          <div class="method-source-code" id="join_clause_sql_append-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/sql.rb</span>
<span class="line-num">543</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">join_clause_sql_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">jc</span>)
<span class="line-num">544</span>   <span class="ruby-identifier">table</span> = <span class="ruby-identifier">jc</span>.<span class="ruby-identifier">table</span>
<span class="line-num">545</span>   <span class="ruby-identifier">table_alias</span> = <span class="ruby-identifier">jc</span>.<span class="ruby-identifier">table_alias</span>
<span class="line-num">546</span>   <span class="ruby-identifier">table_alias</span> = <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">table</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">table_alias</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">jc</span>.<span class="ruby-identifier">column_aliases</span>
<span class="line-num">547</span>   <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39; &#39;</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">join_type_sql</span>(<span class="ruby-identifier">jc</span>.<span class="ruby-identifier">join_type</span>) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39; &#39;</span>
<span class="line-num">548</span>   <span class="ruby-identifier">identifier_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">table</span>)
<span class="line-num">549</span>   <span class="ruby-identifier">as_sql_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">table_alias</span>, <span class="ruby-identifier">jc</span>.<span class="ruby-identifier">column_aliases</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">table_alias</span>
<span class="line-num">550</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-join_on_clause_sql_append" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">join_on_clause_sql_append</span><span
            class="method-args">(sql, jc)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Append literalization of JOIN ON clause to <a href="SQL.html"><code>SQL</code></a> string.</p>
          
          

          
          <div class="method-source-code" id="join_on_clause_sql_append-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/sql.rb</span>
<span class="line-num">553</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">join_on_clause_sql_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">jc</span>)
<span class="line-num">554</span>   <span class="ruby-identifier">join_clause_sql_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">jc</span>)
<span class="line-num">555</span>   <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39; ON &#39;</span>
<span class="line-num">556</span>   <span class="ruby-identifier">literal_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">filter_expr</span>(<span class="ruby-identifier">jc</span>.<span class="ruby-identifier">on</span>))
<span class="line-num">557</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-join_using_clause_sql_append" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">join_using_clause_sql_append</span><span
            class="method-args">(sql, jc)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Append literalization of JOIN USING clause to <a href="SQL.html"><code>SQL</code></a> string.</p>
          
          

          
          <div class="method-source-code" id="join_using_clause_sql_append-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/sql.rb</span>
<span class="line-num">560</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">join_using_clause_sql_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">jc</span>)
<span class="line-num">561</span>   <span class="ruby-identifier">join_clause_sql_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">jc</span>)
<span class="line-num">562</span>   <span class="ruby-identifier">join_using_clause_using_sql_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">jc</span>.<span class="ruby-identifier">using</span>) 
<span class="line-num">563</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-negative_boolean_constant_sql_append" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">negative_boolean_constant_sql_append</span><span
            class="method-args">(sql, constant)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Append literalization of negative boolean constant to <a href="SQL.html"><code>SQL</code></a> string.</p>
          
          

          
          <div class="method-source-code" id="negative_boolean_constant_sql_append-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/sql.rb</span>
<span class="line-num">566</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">negative_boolean_constant_sql_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">constant</span>)
<span class="line-num">567</span>   <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;NOT &#39;</span>
<span class="line-num">568</span>   <span class="ruby-identifier">boolean_constant_sql_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">constant</span>)
<span class="line-num">569</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-ordered_expression_sql_append" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">ordered_expression_sql_append</span><span
            class="method-args">(sql, oe)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Append literalization of ordered expression to <a href="SQL.html"><code>SQL</code></a> string.</p>
          
          

          
          <div class="method-source-code" id="ordered_expression_sql_append-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/sql.rb</span>
<span class="line-num">572</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">ordered_expression_sql_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">oe</span>)
<span class="line-num">573</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">emulate</span> = <span class="ruby-identifier">requires_emulating_nulls_first?</span>
<span class="line-num">574</span>     <span class="ruby-keyword">case</span> <span class="ruby-identifier">oe</span>.<span class="ruby-identifier">nulls</span>
<span class="line-num">575</span>     <span class="ruby-keyword">when</span> <span class="ruby-value">:first</span>
<span class="line-num">576</span>       <span class="ruby-identifier">null_order</span> = <span class="ruby-value">0</span>
<span class="line-num">577</span>     <span class="ruby-keyword">when</span> <span class="ruby-value">:last</span>
<span class="line-num">578</span>       <span class="ruby-identifier">null_order</span> = <span class="ruby-value">2</span>
<span class="line-num">579</span>     <span class="ruby-keyword">end</span>
<span class="line-num">580</span> 
<span class="line-num">581</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">null_order</span>
<span class="line-num">582</span>       <span class="ruby-identifier">literal_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">case</span>({{<span class="ruby-identifier">oe</span>.<span class="ruby-identifier">expression</span><span class="ruby-operator">=&gt;</span><span class="ruby-keyword">nil</span>}<span class="ruby-operator">=&gt;</span><span class="ruby-identifier">null_order</span>}, <span class="ruby-value">1</span>))
<span class="line-num">583</span>       <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;, &quot;</span>
<span class="line-num">584</span>     <span class="ruby-keyword">end</span>
<span class="line-num">585</span>   <span class="ruby-keyword">end</span>
<span class="line-num">586</span> 
<span class="line-num">587</span>   <span class="ruby-identifier">literal_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">oe</span>.<span class="ruby-identifier">expression</span>)
<span class="line-num">588</span>   <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> (<span class="ruby-identifier">oe</span>.<span class="ruby-identifier">descending</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39; DESC&#39;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&#39; ASC&#39;</span>)
<span class="line-num">589</span> 
<span class="line-num">590</span>   <span class="ruby-keyword">unless</span> <span class="ruby-identifier">emulate</span>
<span class="line-num">591</span>     <span class="ruby-keyword">case</span> <span class="ruby-identifier">oe</span>.<span class="ruby-identifier">nulls</span>
<span class="line-num">592</span>     <span class="ruby-keyword">when</span> <span class="ruby-value">:first</span>
<span class="line-num">593</span>       <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot; NULLS FIRST&quot;</span>
<span class="line-num">594</span>     <span class="ruby-keyword">when</span> <span class="ruby-value">:last</span>
<span class="line-num">595</span>       <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot; NULLS LAST&quot;</span>
<span class="line-num">596</span>     <span class="ruby-keyword">end</span>
<span class="line-num">597</span>   <span class="ruby-keyword">end</span>
<span class="line-num">598</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-placeholder_literal_string_sql_append" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">placeholder_literal_string_sql_append</span><span
            class="method-args">(sql, pls)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Append literalization of placeholder literal string to <a href="SQL.html"><code>SQL</code></a> string.</p>
          
          

          
          <div class="method-source-code" id="placeholder_literal_string_sql_append-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/sql.rb</span>
<span class="line-num">601</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">placeholder_literal_string_sql_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">pls</span>)
<span class="line-num">602</span>   <span class="ruby-identifier">args</span> = <span class="ruby-identifier">pls</span>.<span class="ruby-identifier">args</span>
<span class="line-num">603</span>   <span class="ruby-identifier">str</span> = <span class="ruby-identifier">pls</span>.<span class="ruby-identifier">str</span>
<span class="line-num">604</span>   <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;(&#39;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">pls</span>.<span class="ruby-identifier">parens</span>
<span class="line-num">605</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>)
<span class="line-num">606</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">empty?</span>
<span class="line-num">607</span>       <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">str</span>
<span class="line-num">608</span>     <span class="ruby-keyword">else</span>
<span class="line-num">609</span>       <span class="ruby-identifier">re</span> = <span class="ruby-regexp">/:(#{args.keys.map{|k| Regexp.escape(k.to_s)}.join(&#39;|&#39;)})\b/</span>
<span class="line-num">610</span>       <span class="ruby-keyword">while</span> <span class="ruby-keyword">true</span>
<span class="line-num">611</span>         <span class="ruby-identifier">previous</span>, <span class="ruby-identifier">q</span>, <span class="ruby-identifier">str</span> = <span class="ruby-identifier">str</span>.<span class="ruby-identifier">partition</span>(<span class="ruby-identifier">re</span>)
<span class="line-num">612</span>         <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">previous</span>
<span class="line-num">613</span>         <span class="ruby-identifier">literal_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">args</span>[(<span class="ruby-node">$1</span><span class="ruby-operator">||</span><span class="ruby-identifier">q</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>].<span class="ruby-identifier">to_s</span>).<span class="ruby-identifier">to_sym</span>]) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">q</span>.<span class="ruby-identifier">empty?</span>
<span class="line-num">614</span>         <span class="ruby-keyword">break</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">str</span>.<span class="ruby-identifier">empty?</span>
<span class="line-num">615</span>       <span class="ruby-keyword">end</span>
<span class="line-num">616</span>     <span class="ruby-keyword">end</span>
<span class="line-num">617</span>   <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">str</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)
<span class="line-num">618</span>     <span class="ruby-identifier">len</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">length</span>
<span class="line-num">619</span>     <span class="ruby-identifier">str</span>.<span class="ruby-identifier">each_with_index</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span>, <span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
<span class="line-num">620</span>       <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">s</span>
<span class="line-num">621</span>       <span class="ruby-identifier">literal_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">args</span>[<span class="ruby-identifier">i</span>]) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">i</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">len</span>
<span class="line-num">622</span>     <span class="ruby-keyword">end</span>
<span class="line-num">623</span>     <span class="ruby-keyword">unless</span> <span class="ruby-identifier">str</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">str</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
<span class="line-num">624</span>       <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-node">&quot;Mismatched number of placeholders (#{str.length}) and placeholder arguments (#{args.length}) when using placeholder array&quot;</span>
<span class="line-num">625</span>     <span class="ruby-keyword">end</span>
<span class="line-num">626</span>   <span class="ruby-keyword">else</span>
<span class="line-num">627</span>     <span class="ruby-identifier">i</span> = <span class="ruby-value">-1</span>
<span class="line-num">628</span>     <span class="ruby-identifier">match_len</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>
<span class="line-num">629</span>     <span class="ruby-keyword">while</span> <span class="ruby-keyword">true</span>
<span class="line-num">630</span>       <span class="ruby-identifier">previous</span>, <span class="ruby-identifier">q</span>, <span class="ruby-identifier">str</span> = <span class="ruby-identifier">str</span>.<span class="ruby-identifier">partition</span>(<span class="ruby-string">&#39;?&#39;</span>)
<span class="line-num">631</span>       <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">previous</span>
<span class="line-num">632</span>       <span class="ruby-identifier">literal_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">args</span>.<span class="ruby-identifier">at</span>(<span class="ruby-identifier">i</span><span class="ruby-operator">+=</span><span class="ruby-value">1</span>)) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">q</span>.<span class="ruby-identifier">empty?</span>
<span class="line-num">633</span>       <span class="ruby-keyword">if</span> <span class="ruby-identifier">str</span>.<span class="ruby-identifier">empty?</span>
<span class="line-num">634</span>         <span class="ruby-keyword">unless</span> <span class="ruby-identifier">i</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">match_len</span>
<span class="line-num">635</span>           <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-node">&quot;Mismatched number of placeholders (#{i+1}) and placeholder arguments (#{args.length}) when using placeholder string&quot;</span>
<span class="line-num">636</span>         <span class="ruby-keyword">end</span>
<span class="line-num">637</span>         <span class="ruby-keyword">break</span>
<span class="line-num">638</span>       <span class="ruby-keyword">end</span>
<span class="line-num">639</span>     <span class="ruby-keyword">end</span>
<span class="line-num">640</span>   <span class="ruby-keyword">end</span>
<span class="line-num">641</span>   <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;)&#39;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">pls</span>.<span class="ruby-identifier">parens</span>
<span class="line-num">642</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-qualified_identifier_sql_append" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">qualified_identifier_sql_append</span><span
            class="method-args">(sql, table, column=(c = table.column; table = table.table; c))</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Append literalization of qualified identifier to <a href="SQL.html"><code>SQL</code></a> string. If 3 arguments are given, the 2nd should be the table/qualifier and the third should be column/qualified.  If 2 arguments are given, the 2nd should be an <a href="SQL/QualifiedIdentifier.html"><code>SQL::QualifiedIdentifier</code></a>.</p>
          
          

          
          <div class="method-source-code" id="qualified_identifier_sql_append-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/sql.rb</span>
<span class="line-num">647</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">qualified_identifier_sql_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">table</span>, <span class="ruby-identifier">column</span>=(<span class="ruby-identifier">c</span> = <span class="ruby-identifier">table</span>.<span class="ruby-identifier">column</span>; <span class="ruby-identifier">table</span> = <span class="ruby-identifier">table</span>.<span class="ruby-identifier">table</span>; <span class="ruby-identifier">c</span>))
<span class="line-num">648</span>   <span class="ruby-identifier">identifier_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">table</span>)
<span class="line-num">649</span>   <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;.&#39;</span>
<span class="line-num">650</span>   <span class="ruby-identifier">identifier_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">column</span>)
<span class="line-num">651</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-quote_identifier_append" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">quote_identifier_append</span><span
            class="method-args">(sql, name)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Append literalization of unqualified identifier to <a href="SQL.html"><code>SQL</code></a> string. Adds quoting to identifiers (columns and tables). If identifiers are not being quoted, returns name as a string.  If identifiers are being quoted quote the name with quoted_identifier.</p>
          
          

          
          <div class="method-source-code" id="quote_identifier_append-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/sql.rb</span>
<span class="line-num">657</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">quote_identifier_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">name</span>)
<span class="line-num">658</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">name</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">LiteralString</span>)
<span class="line-num">659</span>     <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">name</span>
<span class="line-num">660</span>   <span class="ruby-keyword">else</span>
<span class="line-num">661</span>     <span class="ruby-identifier">name</span> = <span class="ruby-identifier">name</span>.<span class="ruby-identifier">value</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">name</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">Identifier</span>)
<span class="line-num">662</span>     <span class="ruby-identifier">name</span> = <span class="ruby-identifier">input_identifier</span>(<span class="ruby-identifier">name</span>)
<span class="line-num">663</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">quote_identifiers?</span>
<span class="line-num">664</span>       <span class="ruby-identifier">quoted_identifier_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">name</span>)
<span class="line-num">665</span>     <span class="ruby-keyword">else</span>
<span class="line-num">666</span>       <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">name</span>
<span class="line-num">667</span>     <span class="ruby-keyword">end</span>
<span class="line-num">668</span>   <span class="ruby-keyword">end</span>
<span class="line-num">669</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-quote_schema_table_append" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">quote_schema_table_append</span><span
            class="method-args">(sql, table)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Append literalization of identifier or unqualified identifier to <a href="SQL.html"><code>SQL</code></a> string.</p>
          
          

          
          <div class="method-source-code" id="quote_schema_table_append-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/sql.rb</span>
<span class="line-num">672</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">quote_schema_table_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">table</span>)
<span class="line-num">673</span>   <span class="ruby-identifier">schema</span>, <span class="ruby-identifier">table</span> = <span class="ruby-identifier">schema_and_table</span>(<span class="ruby-identifier">table</span>)
<span class="line-num">674</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">schema</span>
<span class="line-num">675</span>     <span class="ruby-identifier">quote_identifier_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">schema</span>)
<span class="line-num">676</span>     <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;.&#39;</span>
<span class="line-num">677</span>   <span class="ruby-keyword">end</span>
<span class="line-num">678</span>   <span class="ruby-identifier">quote_identifier_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">table</span>)
<span class="line-num">679</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-quoted_identifier_append" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">quoted_identifier_append</span><span
            class="method-args">(sql, name)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Append literalization of quoted identifier to <a href="SQL.html"><code>SQL</code></a> string. This method quotes the given name with the <a href="SQL.html"><code>SQL</code></a> standard double quote.  should be overridden by subclasses to provide quoting not matching the <a href="SQL.html"><code>SQL</code></a> standard, such as backtick (used by MySQL and SQLite).</p>
          
          

          
          <div class="method-source-code" id="quoted_identifier_append-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/sql.rb</span>
<span class="line-num">685</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">quoted_identifier_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">name</span>)
<span class="line-num">686</span>   <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;&quot;&#39;</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&#39;&quot;&#39;</span>, <span class="ruby-string">&#39;&quot;&quot;&#39;</span>) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;&quot;&#39;</span>
<span class="line-num">687</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-schema_and_table" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">schema_and_table</span><span
            class="method-args">(table_name, sch=nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Split the schema information from the table, returning two strings, one for the schema and one for the table.  The returned schema may be nil, but the table will always have a string value.</p>

<p>Note that this function does not handle tables with more than one level of qualification (e.g. database.schema.table on Microsoft <a href="SQL.html"><code>SQL</code></a> Server).</p>
          
          

          
          <div class="method-source-code" id="schema_and_table-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/sql.rb</span>
<span class="line-num">696</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">schema_and_table</span>(<span class="ruby-identifier">table_name</span>, <span class="ruby-identifier">sch</span>=<span class="ruby-keyword">nil</span>)
<span class="line-num">697</span>   <span class="ruby-identifier">sch</span> = <span class="ruby-identifier">sch</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">sch</span>
<span class="line-num">698</span>   <span class="ruby-keyword">case</span> <span class="ruby-identifier">table_name</span>
<span class="line-num">699</span>   <span class="ruby-keyword">when</span> <span class="ruby-constant">Symbol</span>
<span class="line-num">700</span>     <span class="ruby-identifier">s</span>, <span class="ruby-identifier">t</span>, <span class="ruby-identifier">_</span> = <span class="ruby-identifier">split_symbol</span>(<span class="ruby-identifier">table_name</span>)
<span class="line-num">701</span>     [<span class="ruby-identifier">s</span><span class="ruby-operator">||</span><span class="ruby-identifier">sch</span>, <span class="ruby-identifier">t</span>]
<span class="line-num">702</span>   <span class="ruby-keyword">when</span> <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">QualifiedIdentifier</span>
<span class="line-num">703</span>     [<span class="ruby-identifier">table_name</span>.<span class="ruby-identifier">table</span>.<span class="ruby-identifier">to_s</span>, <span class="ruby-identifier">table_name</span>.<span class="ruby-identifier">column</span>.<span class="ruby-identifier">to_s</span>]
<span class="line-num">704</span>   <span class="ruby-keyword">when</span> <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">Identifier</span>
<span class="line-num">705</span>     [<span class="ruby-identifier">sch</span>, <span class="ruby-identifier">table_name</span>.<span class="ruby-identifier">value</span>.<span class="ruby-identifier">to_s</span>]
<span class="line-num">706</span>   <span class="ruby-keyword">when</span> <span class="ruby-constant">String</span>
<span class="line-num">707</span>     [<span class="ruby-identifier">sch</span>, <span class="ruby-identifier">table_name</span>]
<span class="line-num">708</span>   <span class="ruby-keyword">else</span>
<span class="line-num">709</span>     <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-string">&#39;table_name should be a Symbol, SQL::QualifiedIdentifier, SQL::Identifier, or String&#39;</span>
<span class="line-num">710</span>   <span class="ruby-keyword">end</span>
<span class="line-num">711</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-split_qualifiers" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">split_qualifiers</span><span
            class="method-args">(table_name, *args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Splits table_name into an array of strings.</p>

<pre class="ruby"><span class="ruby-identifier">ds</span>.<span class="ruby-identifier">split_qualifiers</span>(<span class="ruby-value">:s</span>) <span class="ruby-comment"># [&#39;s&#39;]</span>
<span class="ruby-identifier">ds</span>.<span class="ruby-identifier">split_qualifiers</span>(<span class="ruby-constant">Sequel</span>[<span class="ruby-value">:t</span>][<span class="ruby-value">:s</span>]) <span class="ruby-comment"># [&#39;t&#39;, &#39;s&#39;]</span>
<span class="ruby-identifier">ds</span>.<span class="ruby-identifier">split_qualifiers</span>(<span class="ruby-constant">Sequel</span>[<span class="ruby-value">:d</span>][<span class="ruby-value">:t</span>][<span class="ruby-value">:s</span>]) <span class="ruby-comment"># [&#39;d&#39;, &#39;t&#39;, &#39;s&#39;]</span>
<span class="ruby-identifier">ds</span>.<span class="ruby-identifier">split_qualifiers</span>(<span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">qualify</span>(<span class="ruby-constant">Sequel</span>[<span class="ruby-value">:h</span>][<span class="ruby-value">:d</span>], <span class="ruby-constant">Sequel</span>[<span class="ruby-value">:t</span>][<span class="ruby-value">:s</span>])) <span class="ruby-comment"># [&#39;h&#39;, &#39;d&#39;, &#39;t&#39;, &#39;s&#39;]</span>
</pre>
          
          

          
          <div class="method-source-code" id="split_qualifiers-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/sql.rb</span>
<span class="line-num">719</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">split_qualifiers</span>(<span class="ruby-identifier">table_name</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
<span class="line-num">720</span>   <span class="ruby-keyword">case</span> <span class="ruby-identifier">table_name</span>
<span class="line-num">721</span>   <span class="ruby-keyword">when</span> <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">QualifiedIdentifier</span>
<span class="line-num">722</span>     <span class="ruby-identifier">split_qualifiers</span>(<span class="ruby-identifier">table_name</span>.<span class="ruby-identifier">table</span>, <span class="ruby-keyword">nil</span>) <span class="ruby-operator">+</span> <span class="ruby-identifier">split_qualifiers</span>(<span class="ruby-identifier">table_name</span>.<span class="ruby-identifier">column</span>, <span class="ruby-keyword">nil</span>)
<span class="line-num">723</span>   <span class="ruby-keyword">else</span>
<span class="line-num">724</span>     <span class="ruby-identifier">sch</span>, <span class="ruby-identifier">table</span> = <span class="ruby-identifier">schema_and_table</span>(<span class="ruby-identifier">table_name</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
<span class="line-num">725</span>     <span class="ruby-identifier">sch</span> <span class="ruby-operator">?</span> [<span class="ruby-identifier">sch</span>, <span class="ruby-identifier">table</span>] <span class="ruby-operator">:</span> [<span class="ruby-identifier">table</span>]
<span class="line-num">726</span>   <span class="ruby-keyword">end</span>
<span class="line-num">727</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-subscript_sql_append" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">subscript_sql_append</span><span
            class="method-args">(sql, s)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Append literalization of subscripts (SQL array accesses) to <a href="SQL.html"><code>SQL</code></a> string.</p>
          
          

          
          <div class="method-source-code" id="subscript_sql_append-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/sql.rb</span>
<span class="line-num">730</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">subscript_sql_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">s</span>)
<span class="line-num">731</span>   <span class="ruby-keyword">case</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">expression</span>
<span class="line-num">732</span>   <span class="ruby-keyword">when</span> <span class="ruby-constant">Symbol</span>, <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">Subscript</span>, <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">Identifier</span>, <span class="ruby-constant">SQL</span><span class="ruby-operator">::</span><span class="ruby-constant">QualifiedIdentifier</span>
<span class="line-num">733</span>     <span class="ruby-comment"># nothing</span>
<span class="line-num">734</span>   <span class="ruby-keyword">else</span>
<span class="line-num">735</span>     <span class="ruby-identifier">wrap_expression</span> = <span class="ruby-keyword">true</span>
<span class="line-num">736</span>     <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;(&#39;</span>
<span class="line-num">737</span>   <span class="ruby-keyword">end</span>
<span class="line-num">738</span>   <span class="ruby-identifier">literal_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">s</span>.<span class="ruby-identifier">expression</span>)
<span class="line-num">739</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">wrap_expression</span>
<span class="line-num">740</span>     <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;)[&#39;</span>
<span class="line-num">741</span>   <span class="ruby-keyword">else</span>
<span class="line-num">742</span>     <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;[&#39;</span>
<span class="line-num">743</span>   <span class="ruby-keyword">end</span>
<span class="line-num">744</span>   <span class="ruby-identifier">sub</span> = <span class="ruby-identifier">s</span>.<span class="ruby-identifier">sub</span>
<span class="line-num">745</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">sub</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">range</span> = <span class="ruby-identifier">sub</span>.<span class="ruby-identifier">first</span>).<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Range</span>)
<span class="line-num">746</span>     <span class="ruby-identifier">literal_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">range</span>.<span class="ruby-identifier">begin</span>)
<span class="line-num">747</span>     <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;:&#39;</span>
<span class="line-num">748</span>     <span class="ruby-identifier">e</span> = <span class="ruby-identifier">range</span>.<span class="ruby-identifier">end</span>
<span class="line-num">749</span>     <span class="ruby-identifier">e</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">range</span>.<span class="ruby-identifier">exclude_end?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">e</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Integer</span>)
<span class="line-num">750</span>     <span class="ruby-identifier">literal_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">e</span>)
<span class="line-num">751</span>   <span class="ruby-keyword">else</span>
<span class="line-num">752</span>     <span class="ruby-identifier">expression_list_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">s</span>.<span class="ruby-identifier">sub</span>)
<span class="line-num">753</span>   <span class="ruby-keyword">end</span>
<span class="line-num">754</span>   <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;]&#39;</span>
<span class="line-num">755</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-window_sql_append" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">window_sql_append</span><span
            class="method-args">(sql, opts)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Append literalization of windows (for window functions) to <a href="SQL.html"><code>SQL</code></a> string.</p>
          
          

          
          <div class="method-source-code" id="window_sql_append-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/sql.rb</span>
<span class="line-num">758</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">window_sql_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">opts</span>)
<span class="line-num">759</span>   <span class="ruby-identifier">raise</span>(<span class="ruby-constant">Error</span>, <span class="ruby-string">&#39;This dataset does not support window functions&#39;</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">supports_window_functions?</span>
<span class="line-num">760</span>   <span class="ruby-identifier">space</span> = <span class="ruby-keyword">false</span>
<span class="line-num">761</span>   <span class="ruby-identifier">space_s</span> = <span class="ruby-string">&#39; &#39;</span>
<span class="line-num">762</span> 
<span class="line-num">763</span>   <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;(&#39;</span>
<span class="line-num">764</span> 
<span class="line-num">765</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">window</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:window</span>]
<span class="line-num">766</span>     <span class="ruby-identifier">literal_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">window</span>)
<span class="line-num">767</span>     <span class="ruby-identifier">space</span> = <span class="ruby-keyword">true</span>
<span class="line-num">768</span>   <span class="ruby-keyword">end</span>
<span class="line-num">769</span> 
<span class="line-num">770</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">part</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:partition</span>]
<span class="line-num">771</span>     <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">space_s</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">space</span>
<span class="line-num">772</span>     <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;PARTITION BY &quot;</span>
<span class="line-num">773</span>     <span class="ruby-identifier">expression_list_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-constant">Array</span>(<span class="ruby-identifier">part</span>))
<span class="line-num">774</span>     <span class="ruby-identifier">space</span> = <span class="ruby-keyword">true</span>
<span class="line-num">775</span>   <span class="ruby-keyword">end</span>
<span class="line-num">776</span> 
<span class="line-num">777</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">order</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:order</span>]
<span class="line-num">778</span>     <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">space_s</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">space</span>
<span class="line-num">779</span>     <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;ORDER BY &quot;</span>
<span class="line-num">780</span>     <span class="ruby-identifier">expression_list_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-constant">Array</span>(<span class="ruby-identifier">order</span>))
<span class="line-num">781</span>     <span class="ruby-identifier">space</span> = <span class="ruby-keyword">true</span>
<span class="line-num">782</span>   <span class="ruby-keyword">end</span>
<span class="line-num">783</span> 
<span class="line-num">784</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">frame</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:frame</span>]
<span class="line-num">785</span>     <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">space_s</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">space</span>
<span class="line-num">786</span> 
<span class="line-num">787</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">frame</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>)
<span class="line-num">788</span>       <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">frame</span>
<span class="line-num">789</span>     <span class="ruby-keyword">else</span>
<span class="line-num">790</span>       <span class="ruby-keyword">case</span> <span class="ruby-identifier">frame</span>
<span class="line-num">791</span>       <span class="ruby-keyword">when</span> <span class="ruby-value">:all</span>
<span class="line-num">792</span>         <span class="ruby-identifier">frame_type</span> = <span class="ruby-value">:rows</span>
<span class="line-num">793</span>         <span class="ruby-identifier">frame_start</span> = <span class="ruby-value">:preceding</span>
<span class="line-num">794</span>         <span class="ruby-identifier">frame_end</span> = <span class="ruby-value">:following</span>
<span class="line-num">795</span>       <span class="ruby-keyword">when</span> <span class="ruby-value">:rows</span>, <span class="ruby-value">:range</span>, <span class="ruby-value">:groups</span>
<span class="line-num">796</span>         <span class="ruby-identifier">frame_type</span> = <span class="ruby-identifier">frame</span>
<span class="line-num">797</span>         <span class="ruby-identifier">frame_start</span> = <span class="ruby-value">:preceding</span>
<span class="line-num">798</span>         <span class="ruby-identifier">frame_end</span> = <span class="ruby-value">:current</span>
<span class="line-num">799</span>       <span class="ruby-keyword">when</span> <span class="ruby-constant">Hash</span>
<span class="line-num">800</span>         <span class="ruby-identifier">frame_type</span> = <span class="ruby-identifier">frame</span>[<span class="ruby-value">:type</span>]
<span class="line-num">801</span>         <span class="ruby-keyword">unless</span> <span class="ruby-identifier">frame_type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:rows</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">frame_type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:range</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">frame_type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:groups</span>
<span class="line-num">802</span>           <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-node">&quot;invalid window :frame :type option: #{frame_type.inspect}&quot;</span>
<span class="line-num">803</span>         <span class="ruby-keyword">end</span>
<span class="line-num">804</span>         <span class="ruby-keyword">unless</span> <span class="ruby-identifier">frame_start</span> = <span class="ruby-identifier">frame</span>[<span class="ruby-value">:start</span>]
<span class="line-num">805</span>           <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-node">&quot;invalid window :frame :start option: #{frame_start.inspect}&quot;</span>
<span class="line-num">806</span>         <span class="ruby-keyword">end</span>
<span class="line-num">807</span>         <span class="ruby-identifier">frame_end</span> = <span class="ruby-identifier">frame</span>[<span class="ruby-value">:end</span>]
<span class="line-num">808</span>         <span class="ruby-identifier">frame_exclude</span> = <span class="ruby-identifier">frame</span>[<span class="ruby-value">:exclude</span>]
<span class="line-num">809</span>       <span class="ruby-keyword">else</span>
<span class="line-num">810</span>         <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-node">&quot;invalid window :frame option: #{frame.inspect}&quot;</span>
<span class="line-num">811</span>       <span class="ruby-keyword">end</span>
<span class="line-num">812</span> 
<span class="line-num">813</span>       <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">frame_type</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">upcase</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot; &quot;</span>
<span class="line-num">814</span>       <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;BETWEEN &#39;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">frame_end</span>
<span class="line-num">815</span>       <span class="ruby-identifier">window_frame_boundary_sql_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">frame_start</span>, <span class="ruby-value">:preceding</span>)
<span class="line-num">816</span>       <span class="ruby-keyword">if</span> <span class="ruby-identifier">frame_end</span>
<span class="line-num">817</span>         <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot; AND &quot;</span>
<span class="line-num">818</span>         <span class="ruby-identifier">window_frame_boundary_sql_append</span>(<span class="ruby-identifier">sql</span>, <span class="ruby-identifier">frame_end</span>, <span class="ruby-value">:following</span>)
<span class="line-num">819</span>       <span class="ruby-keyword">end</span>
<span class="line-num">820</span> 
<span class="line-num">821</span>       <span class="ruby-keyword">if</span> <span class="ruby-identifier">frame_exclude</span>
<span class="line-num">822</span>         <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot; EXCLUDE &quot;</span>
<span class="line-num">823</span> 
<span class="line-num">824</span>         <span class="ruby-keyword">case</span> <span class="ruby-identifier">frame_exclude</span>
<span class="line-num">825</span>         <span class="ruby-keyword">when</span> <span class="ruby-value">:current</span>
<span class="line-num">826</span>           <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;CURRENT ROW&quot;</span>
<span class="line-num">827</span>         <span class="ruby-keyword">when</span> <span class="ruby-value">:group</span>
<span class="line-num">828</span>           <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;GROUP&quot;</span>
<span class="line-num">829</span>         <span class="ruby-keyword">when</span> <span class="ruby-value">:ties</span>
<span class="line-num">830</span>           <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;TIES&quot;</span>
<span class="line-num">831</span>         <span class="ruby-keyword">when</span> <span class="ruby-value">:no_others</span>
<span class="line-num">832</span>           <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;NO OTHERS&quot;</span>
<span class="line-num">833</span>         <span class="ruby-keyword">else</span>
<span class="line-num">834</span>           <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-node">&quot;invalid window :frame :exclude option: #{frame_exclude.inspect}&quot;</span>
<span class="line-num">835</span>         <span class="ruby-keyword">end</span>
<span class="line-num">836</span>       <span class="ruby-keyword">end</span>
<span class="line-num">837</span>     <span class="ruby-keyword">end</span>
<span class="line-num">838</span>   <span class="ruby-keyword">end</span>
<span class="line-num">839</span> 
<span class="line-num">840</span>   <span class="ruby-identifier">sql</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;)&#39;</span>
<span class="line-num">841</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="protected-instance-9+-+Internal+Methods+relating+to+SQL+Creation-method-details" class="method-section">
       <header>
         <h3>Protected Instance Methods</h3>
       </header>

    
      <div id="method-i-compound_from_self" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">compound_from_self</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Return a <a href="Dataset.html#method-i-from_self"><code>from_self</code></a> dataset if an order or limit is specified, so it works as expected with UNION, EXCEPT, and INTERSECT clauses.</p>
          
          

          
          <div class="method-source-code" id="compound_from_self-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/dataset/sql.rb</span>
<span class="line-num">847</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">compound_from_self</span>
<span class="line-num">848</span>   (<span class="ruby-ivar">@opts</span>[<span class="ruby-value">:sql</span>] <span class="ruby-operator">||</span> <span class="ruby-ivar">@opts</span>[<span class="ruby-value">:limit</span>] <span class="ruby-operator">||</span> <span class="ruby-ivar">@opts</span>[<span class="ruby-value">:order</span>] <span class="ruby-operator">||</span> <span class="ruby-ivar">@opts</span>[<span class="ruby-value">:offset</span>]) <span class="ruby-operator">?</span> <span class="ruby-identifier">from_self</span> <span class="ruby-operator">:</span> <span class="ruby-keyword">self</span>
<span class="line-num">849</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>

</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="https://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://ruby.github.io/rdoc/">RDoc</a> 6.1.2.1.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

