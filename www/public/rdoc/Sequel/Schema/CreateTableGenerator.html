<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class Sequel::Schema::CreateTableGenerator - Sequel: The Database Toolkit for Ruby</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
  var index_rel_prefix = "../../";
</script>

<script src="../../js/navigation.js" defer></script>
<script src="../../js/search.js" defer></script>
<script src="../../js/search_index.js" defer></script>
<script src="../../js/searcher.js" defer></script>
<script src="../../js/darkfish.js" defer></script>

<link href="../../css/fonts.css" rel="stylesheet">
<link href="../../css/rdoc.css" rel="stylesheet">




<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../table_of_contents.html#pages">Pages</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link">Object
  
</div>

    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-c-add_type_method">::add_type_method</a>
    
    <li ><a href="#method-c-new">::new</a>
    
    <li ><a href="#method-i-Bignum">#Bignum</a>
    
    <li ><a href="#method-i-Fixnum">#Fixnum</a>
    
    <li ><a href="#method-i-check">#check</a>
    
    <li ><a href="#method-i-column">#column</a>
    
    <li ><a href="#method-i-constraint">#constraint</a>
    
    <li ><a href="#method-i-foreign_key">#foreign_key</a>
    
    <li ><a href="#method-i-full_text_index">#full_text_index</a>
    
    <li ><a href="#method-i-has_column-3F">#has_column?</a>
    
    <li ><a href="#method-i-index">#index</a>
    
    <li class="calls-super" ><a href="#method-i-method_missing">#method_missing</a>
    
    <li ><a href="#method-i-primary_key">#primary_key</a>
    
    <li ><a href="#method-i-primary_key_name">#primary_key_name</a>
    
    <li ><a href="#method-i-respond_to_missing-3F">#respond_to_missing?</a>
    
    <li ><a href="#method-i-spatial_index">#spatial_index</a>
    
    <li ><a href="#method-i-unique">#unique</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-Sequel::Schema::CreateTableGenerator">
  <h1 id="class-Sequel::Schema::CreateTableGenerator" class="class">
    class Sequel::Schema::CreateTableGenerator
  </h1>

  <section class="description">
    
<p><a href="CreateTableGenerator.html"><code>Schema::CreateTableGenerator</code></a> is an internal class that the user is not expected to instantiate directly.  Instances are created by <a href="../Database.html#method-i-create_table"><code>Database#create_table</code></a>. It is used to specify table creation parameters.  It takes a <a href="../Database.html"><code>Database</code></a> object and a block of column/index/constraint specifications, and gives the <a href="../Database.html"><code>Database</code></a> a table description, which the database uses to create a table.</p>

<p><a href="CreateTableGenerator.html"><code>Schema::CreateTableGenerator</code></a> has some methods but also includes <a href="CreateTableGenerator.html#method-i-method_missing"><code>method_missing</code></a>, allowing users to specify column type as a method instead of using the column method, which makes for a nicer DSL.</p>

<p>For more information on Sequel&#39;s support for schema modification, see the <a href="../../doc/schema_modification_rdoc.html">“Schema Modification” guide</a>.</p>

  </section>

  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    
    <section class="constants-list">
      <header>
        <h3>Constants</h3>
      </header>
      <dl>
      
        <dt id="GENERIC_TYPES">GENERIC_TYPES
        
        <dd><p>Classes specifying generic types that <a href="../../Sequel.html"><code>Sequel</code></a> will convert to database-specific types.</p>
        
      
      </dl>
    </section>
    

    
    <section class="attribute-method-details" class="method-section">
      <header>
        <h3>Attributes</h3>
      </header>

      
      <div id="attribute-i-columns" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">columns</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        <p>Column hashes created by this generator</p>
        
        </div>
      </div>
      
      <div id="attribute-i-constraints" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">constraints</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        <p>Constraint hashes created by this generator</p>
        
        </div>
      </div>
      
      <div id="attribute-i-indexes" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">indexes</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        <p>Index hashes created by this generator</p>
        
        </div>
      </div>
      
    </section>
    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-add_type_method" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">add_type_method</span><span
            class="method-args">(*types)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Add a method for each of the given types that creates a column with that type as a constant.  Types given should either already be constants/classes or a capitalized string/symbol with the same name as a constant/class.</p>
          
          

          
          <div class="method-source-code" id="add_type_method-source">
            <pre>   <span class="ruby-comment"># File lib/sequel/database/schema_generator.rb</span>
<span class="line-num">59</span> <span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">add_type_method</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">types</span>)
<span class="line-num">60</span>   <span class="ruby-identifier">types</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">type</span><span class="ruby-operator">|</span>
<span class="line-num">61</span>     <span class="ruby-keyword">case</span> <span class="ruby-identifier">type</span>
<span class="line-num">62</span>     <span class="ruby-keyword">when</span> <span class="ruby-constant">Symbol</span>, <span class="ruby-constant">String</span>
<span class="line-num">63</span>       <span class="ruby-identifier">method</span> = <span class="ruby-identifier">type</span>
<span class="line-num">64</span>       <span class="ruby-identifier">type</span> = <span class="ruby-constant">Object</span>.<span class="ruby-identifier">const_get</span>(<span class="ruby-identifier">type</span>)
<span class="line-num">65</span>     <span class="ruby-keyword">else</span>
<span class="line-num">66</span>       <span class="ruby-identifier">method</span> = <span class="ruby-identifier">type</span>.<span class="ruby-identifier">to_s</span>
<span class="line-num">67</span>     <span class="ruby-keyword">end</span>
<span class="line-num">68</span> 
<span class="line-num">69</span>     <span class="ruby-identifier">define_method</span>(<span class="ruby-identifier">method</span>){<span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span><span class="ruby-operator">|</span> <span class="ruby-identifier">column</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">opts</span>)}
<span class="line-num">70</span>   <span class="ruby-keyword">end</span>
<span class="line-num">71</span>   <span class="ruby-keyword">nil</span>
<span class="line-num">72</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(db, &amp;block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Set the database in which to create the table, and evaluate the block in the context of this object.</p>
          
          

          
          <div class="method-source-code" id="new-source">
            <pre>   <span class="ruby-comment"># File lib/sequel/database/schema_generator.rb</span>
<span class="line-num">34</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">initialize</span>(<span class="ruby-identifier">db</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">35</span>   <span class="ruby-ivar">@db</span> = <span class="ruby-identifier">db</span>
<span class="line-num">36</span>   <span class="ruby-ivar">@columns</span> = []
<span class="line-num">37</span>   <span class="ruby-ivar">@indexes</span> = []
<span class="line-num">38</span>   <span class="ruby-ivar">@constraints</span> = []
<span class="line-num">39</span>   <span class="ruby-ivar">@primary_key</span> = <span class="ruby-keyword">nil</span>
<span class="line-num">40</span>   <span class="ruby-identifier">instance_exec</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">block</span>
<span class="line-num">41</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-Bignum" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">Bignum</span><span
            class="method-args">(name, opts=OPTS)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Use custom <a href="CreateTableGenerator.html#method-i-Bignum"><code>Bignum</code></a> method to use :Bignum instead of <a href="CreateTableGenerator.html#method-i-Bignum"><code>Bignum</code></a> class, to work correctly in cases where <a href="CreateTableGenerator.html#method-i-Bignum"><code>Bignum</code></a> is the same as Integer.</p>
          
          

          
          <div class="method-source-code" id="Bignum-source">
            <pre>   <span class="ruby-comment"># File lib/sequel/database/schema_generator.rb</span>
<span class="line-num">45</span> <span class="ruby-keyword">def</span> <span class="ruby-constant">Bignum</span>(<span class="ruby-identifier ruby-title">name</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)
<span class="line-num">46</span>   <span class="ruby-identifier">column</span>(<span class="ruby-identifier">name</span>, <span class="ruby-value">:Bignum</span>, <span class="ruby-identifier">opts</span>)
<span class="line-num">47</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-Fixnum" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">Fixnum</span><span
            class="method-args">(name, opts=OPTS)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Use custom <a href="CreateTableGenerator.html#method-i-Fixnum"><code>Fixnum</code></a> method to use Integer instead of <a href="CreateTableGenerator.html#method-i-Fixnum"><code>Fixnum</code></a> class, to avoid  warnings on ruby 2.4+.</p>
          
          

          
          <div class="method-source-code" id="Fixnum-source">
            <pre>   <span class="ruby-comment"># File lib/sequel/database/schema_generator.rb</span>
<span class="line-num">51</span> <span class="ruby-keyword">def</span> <span class="ruby-constant">Fixnum</span>(<span class="ruby-identifier ruby-title">name</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)
<span class="line-num">52</span>   <span class="ruby-identifier">column</span>(<span class="ruby-identifier">name</span>, <span class="ruby-constant">Integer</span>, <span class="ruby-identifier">opts</span>)
<span class="line-num">53</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-check" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">check</span><span
            class="method-args">(*args, &amp;block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Add an unnamed constraint, specified by the given block or args:</p>

<pre class="ruby"><span class="ruby-identifier">check</span>(<span class="ruby-value">num:</span> <span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">5</span>) <span class="ruby-comment"># CHECK num &gt;= 1 AND num &lt;= 5</span>
<span class="ruby-identifier">check</span>{<span class="ruby-identifier">num</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">5</span>}   <span class="ruby-comment"># CHECK num &gt; 5</span>
</pre>
          
          

          
          <div class="method-source-code" id="check-source">
            <pre>   <span class="ruby-comment"># File lib/sequel/database/schema_generator.rb</span>
<span class="line-num">79</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">check</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">80</span>   <span class="ruby-identifier">constraint</span>(<span class="ruby-keyword">nil</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">81</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-column" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">column</span><span
            class="method-args">(name, type, opts = OPTS)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Add a column with the given name, type, and opts:</p>

<pre class="ruby"><span class="ruby-identifier">column</span> <span class="ruby-value">:num</span>, <span class="ruby-value">:integer</span>
<span class="ruby-comment"># num INTEGER</span>

<span class="ruby-identifier">column</span> <span class="ruby-value">:name</span>, <span class="ruby-constant">String</span>, <span class="ruby-value">null:</span> <span class="ruby-keyword">false</span>, <span class="ruby-value">default:</span> <span class="ruby-string">&#39;a&#39;</span>
<span class="ruby-comment"># name varchar(255) NOT NULL DEFAULT &#39;a&#39;</span>

<span class="ruby-identifier">inet</span> <span class="ruby-value">:ip</span>
<span class="ruby-comment"># ip inet</span>
</pre>

<p>You can also create columns via method missing, so the following are equivalent:</p>

<pre class="ruby"><span class="ruby-identifier">column</span> <span class="ruby-value">:number</span>, <span class="ruby-value">:integer</span>
<span class="ruby-identifier">integer</span> <span class="ruby-value">:number</span>
</pre>

<p>The following options are supported:</p>
<dl class="rdoc-list note-list"><dt>:collate 
<dd>
<p>The collation to use for the column.  For backwards compatibility, only symbols and string values are supported, and they are used verbatim. However, on PostgreSQL, symbols are literalized as regular identifiers, since unquoted collations are unlikely to be valid.</p>
</dd><dt>:default 
<dd>
<p>The default value for the column.</p>
</dd><dt>:deferrable 
<dd>
<p>For foreign key columns, this ensures referential integrity will work even if referencing table uses a foreign key value that does not yet exist on referenced table (but will exist before the transaction commits). Basically it adds DEFERRABLE INITIALLY DEFERRED on key creation. If you use :immediate as the value, uses DEFERRABLE INITIALLY IMMEDIATE.</p>
</dd><dt>:generated_always_as 
<dd>
<p>Specify a GENERATED ALWAYS AS column expression, if generated columns are supported (PostgreSQL 12+, MariaDB 5.2.0+, and MySQL 5.7.6+).</p>
</dd><dt>:index 
<dd>
<p>Create an index on this column.  If given a hash, use the hash as the options for the index.</p>
</dd><dt>:key 
<dd>
<p>For foreign key columns, the column in the associated table that this column references.  Unnecessary if this column references the primary key of the associated table, except if you are using MySQL.</p>
</dd><dt>:null 
<dd>
<p>Mark the column as allowing NULL values (if true), or not allowing NULL values (if false).  The default is to allow NULL values.</p>
</dd><dt>:on_delete 
<dd>
<p>Specify the behavior of this column when being deleted (:restrict, :cascade, :set_null, :set_default, :no_action).</p>
</dd><dt>:on_update 
<dd>
<p>Specify the behavior of this column when being updated (:restrict, :cascade, :set_null, :set_default, :no_action).</p>
</dd><dt>:primary_key 
<dd>
<p>Make the column as a single primary key column.  This should not be used if you want a single autoincrementing primary key column (use the <a href="CreateTableGenerator.html#method-i-primary_key"><code>primary_key</code></a> method in that case).</p>
</dd><dt>:primary_key_constraint_name 
<dd>
<p>The name to give the primary key constraint</p>
</dd><dt>:primary_key_deferrable 
<dd>
<p>Similar to :deferrable, but for the primary key constraint if :primary_key is used.</p>
</dd><dt>:type 
<dd>
<p>Overrides the type given as the argument.  Generally not used by column itself, but can be passed as an option to other methods that call column.</p>
</dd><dt>:unique 
<dd>
<p>Mark the column as unique, generally has the same effect as creating a unique index on the column.</p>
</dd><dt>:unique_constraint_name 
<dd>
<p>The name to give the unique key constraint</p>
</dd><dt>:unique_deferrable 
<dd>
<p>Similar to :deferrable, but for the unique constraint if :unique is used.</p>
</dd></dl>

<p>PostgreSQL specific options:</p>
<dl class="rdoc-list note-list"><dt>:identity 
<dd>
<p>Create an identity column.</p>
</dd></dl>

<p>MySQL specific options:</p>
<dl class="rdoc-list note-list"><dt>:generated_type 
<dd>
<p>Set the type of column when using :generated_always_as, should be :virtual or :stored to force a type.</p>
</dd></dl>

<p>Microsoft <a href="../SQL.html"><code>SQL</code></a> Server specific options:</p>
<dl class="rdoc-list note-list"><dt>:clustered 
<dd>
<p>When using :primary_key or :unique, marks the primary key or unique constraint as CLUSTERED (if true), or NONCLUSTERED (if false).</p>
</dd></dl>
          
          

          
          <div class="method-source-code" id="column-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/database/schema_generator.rb</span>
<span class="line-num">154</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">column</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">opts</span> = <span class="ruby-constant">OPTS</span>)
<span class="line-num">155</span>   <span class="ruby-identifier">columns</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:name</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">name</span>, <span class="ruby-value">:type</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">type</span>}.<span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">opts</span>)
<span class="line-num">156</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">index_opts</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:index</span>]
<span class="line-num">157</span>     <span class="ruby-identifier">index</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">index_opts</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">index_opts</span> <span class="ruby-operator">:</span> <span class="ruby-constant">OPTS</span>)
<span class="line-num">158</span>   <span class="ruby-keyword">end</span>
<span class="line-num">159</span>   <span class="ruby-keyword">nil</span>
<span class="line-num">160</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-constraint" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">constraint</span><span
            class="method-args">(name, *args, &amp;block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Adds a named CHECK constraint (or unnamed if name is nil), with the given block or args. To provide options for the constraint, pass a hash as the first argument.</p>

<pre class="ruby"><span class="ruby-identifier">constraint</span>(<span class="ruby-value">:blah</span>, <span class="ruby-value">num:</span> <span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">5</span>)
<span class="ruby-comment"># CONSTRAINT blah CHECK num &gt;= 1 AND num &lt;= 5</span>
<span class="ruby-identifier">constraint</span>({<span class="ruby-value">name:</span> <span class="ruby-value">:blah</span>, <span class="ruby-value">deferrable:</span> <span class="ruby-keyword">true</span>}, <span class="ruby-value">num:</span> <span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">5</span>)
<span class="ruby-comment"># CONSTRAINT blah CHECK num &gt;= 1 AND num &lt;= 5 DEFERRABLE INITIALLY DEFERRED</span>
</pre>

<p>If the first argument is a hash, the following options are supported:</p>

<p>Options:</p>
<dl class="rdoc-list note-list"><dt>:name 
<dd>
<p>The name of the CHECK constraint</p>
</dd><dt>:deferrable 
<dd>
<p>Whether the CHECK constraint should be marked DEFERRABLE.</p>
</dd></dl>

<p>PostgreSQL specific options:</p>
<dl class="rdoc-list note-list"><dt>:not_valid 
<dd>
<p>Whether the CHECK constraint should be marked NOT VALID.</p>
</dd></dl>
          
          

          
          <div class="method-source-code" id="constraint-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/database/schema_generator.rb</span>
<span class="line-num">179</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">constraint</span>(<span class="ruby-identifier">name</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">180</span>   <span class="ruby-identifier">opts</span> = <span class="ruby-identifier">name</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">name</span> <span class="ruby-operator">:</span> {<span class="ruby-value">:name</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">name</span>}
<span class="line-num">181</span>   <span class="ruby-identifier">constraints</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-value">:type</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">:check</span>, <span class="ruby-value">:check</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">block</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">args</span>)
<span class="line-num">182</span>   <span class="ruby-keyword">nil</span>
<span class="line-num">183</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-foreign_key" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">foreign_key</span><span
            class="method-args">(name, table=nil, opts = OPTS)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Add a foreign key in the table that references another table. See <a href="CreateTableGenerator.html#method-i-column"><code>column</code></a> for available options.</p>

<pre class="ruby"><span class="ruby-identifier">foreign_key</span>(<span class="ruby-value">:artist_id</span>) <span class="ruby-comment"># artist_id INTEGER</span>
<span class="ruby-identifier">foreign_key</span>(<span class="ruby-value">:artist_id</span>, <span class="ruby-value">:artists</span>) <span class="ruby-comment"># artist_id INTEGER REFERENCES artists</span>
<span class="ruby-identifier">foreign_key</span>(<span class="ruby-value">:artist_id</span>, <span class="ruby-value">:artists</span>, <span class="ruby-value">key:</span> <span class="ruby-value">:id</span>) <span class="ruby-comment"># artist_id INTEGER REFERENCES artists(id)</span>
<span class="ruby-identifier">foreign_key</span>(<span class="ruby-value">:artist_id</span>, <span class="ruby-value">:artists</span>, <span class="ruby-value">type:</span> <span class="ruby-constant">String</span>) <span class="ruby-comment"># artist_id varchar(255) REFERENCES artists(id)</span>
</pre>

<p>Additional Options:</p>
<dl class="rdoc-list note-list"><dt>:foreign_key_constraint_name 
<dd>
<p>The name to give the foreign key constraint</p>
</dd></dl>

<p>If you want a foreign key constraint without adding a column (usually because it is a composite foreign key), you can provide an array of columns as the first argument, and you can provide the :name option to name the constraint:</p>

<pre class="ruby"><span class="ruby-identifier">foreign_key</span>([<span class="ruby-value">:artist_name</span>, <span class="ruby-value">:artist_location</span>], <span class="ruby-value">:artists</span>, <span class="ruby-value">name:</span> <span class="ruby-value">:artist_fk</span>)
<span class="ruby-comment"># ADD CONSTRAINT artist_fk FOREIGN KEY (artist_name, artist_location) REFERENCES artists</span>
</pre>
          
          

          
          <div class="method-source-code" id="foreign_key-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/database/schema_generator.rb</span>
<span class="line-num">203</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">foreign_key</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">table</span>=<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">opts</span> = <span class="ruby-constant">OPTS</span>)
<span class="line-num">204</span>   <span class="ruby-identifier">opts</span> = <span class="ruby-keyword">case</span> <span class="ruby-identifier">table</span>
<span class="line-num">205</span>   <span class="ruby-keyword">when</span> <span class="ruby-constant">Hash</span>
<span class="line-num">206</span>     <span class="ruby-identifier">table</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">opts</span>)
<span class="line-num">207</span>   <span class="ruby-keyword">when</span> <span class="ruby-constant">NilClass</span>
<span class="line-num">208</span>     <span class="ruby-identifier">opts</span>
<span class="line-num">209</span>   <span class="ruby-keyword">else</span>
<span class="line-num">210</span>     <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-value">:table</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">table</span>)
<span class="line-num">211</span>   <span class="ruby-keyword">end</span>
<span class="line-num">212</span>   <span class="ruby-keyword">return</span> <span class="ruby-identifier">composite_foreign_key</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">opts</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">name</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)
<span class="line-num">213</span>   <span class="ruby-identifier">column</span>(<span class="ruby-identifier">name</span>, <span class="ruby-constant">Integer</span>, <span class="ruby-identifier">opts</span>)
<span class="line-num">214</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-full_text_index" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">full_text_index</span><span
            class="method-args">(columns, opts = OPTS)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Add a full text index on the given columns. See <a href="CreateTableGenerator.html#method-i-index"><code>index</code></a> for additional options.</p>

<p>PostgreSQL specific options:</p>
<dl class="rdoc-list note-list"><dt>:index_type 
<dd>
<p>Can be set to :gist to use a GIST index instead of the default GIN index.</p>
</dd><dt>:language 
<dd>
<p>Set a language to use for the index (default: simple).</p>
</dd></dl>
          
          

          
          <div class="method-source-code" id="full_text_index-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/database/schema_generator.rb</span>
<span class="line-num">223</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">full_text_index</span>(<span class="ruby-identifier">columns</span>, <span class="ruby-identifier">opts</span> = <span class="ruby-constant">OPTS</span>)
<span class="line-num">224</span>   <span class="ruby-identifier">index</span>(<span class="ruby-identifier">columns</span>, <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-value">:type</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-value">:full_text</span>))
<span class="line-num">225</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-has_column-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">has_column?</span><span
            class="method-args">(name)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>True if the generator includes the creation of a column with the given name.</p>
          
          

          
          <div class="method-source-code" id="has_column-3F-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/database/schema_generator.rb</span>
<span class="line-num">228</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">has_column?</span>(<span class="ruby-identifier">name</span>)
<span class="line-num">229</span>   <span class="ruby-identifier">columns</span>.<span class="ruby-identifier">any?</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">c</span>[<span class="ruby-value">:name</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">name</span>}
<span class="line-num">230</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-index" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">index</span><span
            class="method-args">(columns, opts = OPTS)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Add an index on the given column(s) with the given options. Examples:</p>

<pre class="ruby"><span class="ruby-identifier">index</span> <span class="ruby-value">:name</span>
<span class="ruby-comment"># CREATE INDEX table_name_index ON table (name)</span>

<span class="ruby-identifier">index</span> [<span class="ruby-value">:artist_id</span>, <span class="ruby-value">:name</span>]
<span class="ruby-comment"># CREATE INDEX table_artist_id_name_index ON table (artist_id, name)</span>

<span class="ruby-identifier">index</span> [<span class="ruby-value">:artist_id</span>, <span class="ruby-value">:name</span>], <span class="ruby-value">name:</span> <span class="ruby-value">:foo</span>
<span class="ruby-comment"># CREATE INDEX foo ON table (artist_id, name)</span>
</pre>

<p>General options:</p>
<dl class="rdoc-list note-list"><dt>:include 
<dd>
<p>Include additional column values in the index, without actually indexing on those values (only supported by some databases).</p>
</dd><dt>:name 
<dd>
<p>The name to use for the index. If not given, a default name based on the table and columns is used.</p>
</dd><dt>:type 
<dd>
<p>The type of index to use (only supported by some databases, :full_text and :spatial values are handled specially).</p>
</dd><dt>:unique 
<dd>
<p>Make the index unique, so duplicate values are not allowed.</p>
</dd><dt>:where 
<dd>
<p>A filter expression, used to create a partial index (only supported by some databases).</p>
</dd></dl>

<p>PostgreSQL specific options:</p>
<dl class="rdoc-list note-list"><dt>:concurrently 
<dd>
<p>Create the index concurrently, so it doesn&#39;t block operations on the table while the index is being built.</p>
</dd><dt>:if_not_exists 
<dd>
<p>Only create the index if an index of the same name doesn&#39;t already exist.</p>
</dd><dt>:opclass 
<dd>
<p>Set an opclass to use for all columns (per-column opclasses require custom <a href="../SQL.html"><code>SQL</code></a>).</p>
</dd><dt>:tablespace 
<dd>
<p>Specify tablespace for index.</p>
</dd></dl>

<p>Microsoft <a href="../SQL.html"><code>SQL</code></a> Server specific options:</p>
<dl class="rdoc-list note-list"><dt>:key_index 
<dd>
<p>Sets the KEY INDEX to the given value.</p>
</dd></dl>
          
          

          
          <div class="method-source-code" id="index-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/database/schema_generator.rb</span>
<span class="line-num">269</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">index</span>(<span class="ruby-identifier">columns</span>, <span class="ruby-identifier">opts</span> = <span class="ruby-constant">OPTS</span>)
<span class="line-num">270</span>   <span class="ruby-identifier">indexes</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:columns</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-constant">Array</span>(<span class="ruby-identifier">columns</span>)}.<span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">opts</span>)
<span class="line-num">271</span>   <span class="ruby-keyword">nil</span>
<span class="line-num">272</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-method_missing" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">method_missing</span><span
            class="method-args">(type, name = nil, opts = OPTS)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Add a column with the given type, name, and opts.  See <a href="CreateTableGenerator.html#method-i-column"><code>column</code></a> for available options.</p>
          
          
            <div class="method-calls-super">
              Calls superclass method
              
            </div>
          

          
          <div class="method-source-code" id="method_missing-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/database/schema_generator.rb</span>
<span class="line-num">276</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">method_missing</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">name</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">opts</span> = <span class="ruby-constant">OPTS</span>)
<span class="line-num">277</span>   <span class="ruby-identifier">name</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">column</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">opts</span>) <span class="ruby-operator">:</span> <span class="ruby-keyword">super</span>
<span class="line-num">278</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-primary_key" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">primary_key</span><span
            class="method-args">(name, *args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Adds an autoincrementing primary key column or a primary key constraint. To just create a constraint, the first argument should be an array of column symbols specifying the primary key columns. To create an autoincrementing primary key column, a single symbol can be used. In both cases, an options hash can be used as the second argument.</p>

<p>If you want to create a primary key column that is not autoincrementing, you should not use this method.  Instead, you should use the regular <code>column</code> method with a <code>primary_key: true</code> option.</p>

<p>If an array of column symbols is used, you can specify the :name option to name the constraint.</p>

<p>Options:</p>
<dl class="rdoc-list note-list"><dt>:keep_order 
<dd>
<p>For non-composite primary keys, respects the existing order of columns, overriding the default behavior of making the primary key the first column.</p>
</dd></dl>

<p>Examples:</p>

<pre>primary_key(:id)
primary_key(:id, type: :Bignum, keep_order: true)
primary_key([:street_number, :house_number], name: :some constraint_name)</pre>
          
          

          
          <div class="method-source-code" id="primary_key-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/database/schema_generator.rb</span>
<span class="line-num">307</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">primary_key</span>(<span class="ruby-identifier">name</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
<span class="line-num">308</span>   <span class="ruby-keyword">return</span> <span class="ruby-identifier">composite_primary_key</span>(<span class="ruby-identifier">name</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">name</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)
<span class="line-num">309</span>   <span class="ruby-identifier">column</span> = <span class="ruby-ivar">@db</span>.<span class="ruby-identifier">serial_primary_key_options</span>.<span class="ruby-identifier">merge</span>({<span class="ruby-value">:name</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">name</span>})
<span class="line-num">310</span>   
<span class="line-num">311</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">opts</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">pop</span>
<span class="line-num">312</span>     <span class="ruby-identifier">opts</span> = {<span class="ruby-value">:type</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">opts</span>} <span class="ruby-keyword">unless</span> <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>)
<span class="line-num">313</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">type</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">pop</span>
<span class="line-num">314</span>       <span class="ruby-identifier">opts</span> = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-value">:type</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">type</span>)
<span class="line-num">315</span>     <span class="ruby-keyword">end</span>
<span class="line-num">316</span>     <span class="ruby-identifier">column</span>.<span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">opts</span>)
<span class="line-num">317</span>   <span class="ruby-keyword">end</span>
<span class="line-num">318</span> 
<span class="line-num">319</span>   <span class="ruby-ivar">@primary_key</span> = <span class="ruby-identifier">column</span>
<span class="line-num">320</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">column</span>[<span class="ruby-value">:keep_order</span>]
<span class="line-num">321</span>     <span class="ruby-identifier">columns</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">column</span>
<span class="line-num">322</span>   <span class="ruby-keyword">else</span>
<span class="line-num">323</span>     <span class="ruby-identifier">columns</span>.<span class="ruby-identifier">unshift</span>(<span class="ruby-identifier">column</span>)
<span class="line-num">324</span>   <span class="ruby-keyword">end</span>
<span class="line-num">325</span>   <span class="ruby-keyword">nil</span>
<span class="line-num">326</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-primary_key_name" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">primary_key_name</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>The name of the primary key for this generator, if it has a primary key.</p>
          
          

          
          <div class="method-source-code" id="primary_key_name-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/database/schema_generator.rb</span>
<span class="line-num">329</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">primary_key_name</span>
<span class="line-num">330</span>   <span class="ruby-ivar">@primary_key</span>[<span class="ruby-value">:name</span>] <span class="ruby-keyword">if</span> <span class="ruby-ivar">@primary_key</span>
<span class="line-num">331</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-respond_to_missing-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">respond_to_missing?</span><span
            class="method-args">(meth, include_private)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>This object responds to all methods.</p>
          
          

          
          <div class="method-source-code" id="respond_to_missing-3F-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/database/schema_generator.rb</span>
<span class="line-num">281</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">respond_to_missing?</span>(<span class="ruby-identifier">meth</span>, <span class="ruby-identifier">include_private</span>)
<span class="line-num">282</span>   <span class="ruby-keyword">true</span>
<span class="line-num">283</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-spatial_index" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">spatial_index</span><span
            class="method-args">(columns, opts = OPTS)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Add a spatial index on the given columns. See <a href="CreateTableGenerator.html#method-i-index"><code>index</code></a> for additional options.</p>
          
          

          
          <div class="method-source-code" id="spatial_index-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/database/schema_generator.rb</span>
<span class="line-num">335</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">spatial_index</span>(<span class="ruby-identifier">columns</span>, <span class="ruby-identifier">opts</span> = <span class="ruby-constant">OPTS</span>)
<span class="line-num">336</span>   <span class="ruby-identifier">index</span>(<span class="ruby-identifier">columns</span>, <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-value">:type</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-value">:spatial</span>))
<span class="line-num">337</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-unique" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">unique</span><span
            class="method-args">(columns, opts = OPTS)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Add a unique constraint on the given columns.</p>

<pre class="ruby"><span class="ruby-identifier">unique</span>(<span class="ruby-value">:name</span>) <span class="ruby-comment"># UNIQUE (name)</span>
</pre>

<p>Supports the same :deferrable option as <a href="CreateTableGenerator.html#method-i-column"><code>column</code></a>. The :name option can be used to name the constraint.</p>
          
          

          
          <div class="method-source-code" id="unique-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/database/schema_generator.rb</span>
<span class="line-num">345</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">unique</span>(<span class="ruby-identifier">columns</span>, <span class="ruby-identifier">opts</span> = <span class="ruby-constant">OPTS</span>)
<span class="line-num">346</span>   <span class="ruby-identifier">constraints</span> <span class="ruby-operator">&lt;&lt;</span> {<span class="ruby-value">:type</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-value">:unique</span>, <span class="ruby-value">:columns</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-constant">Array</span>(<span class="ruby-identifier">columns</span>)}.<span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">opts</span>)
<span class="line-num">347</span>   <span class="ruby-keyword">nil</span>
<span class="line-num">348</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>

</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="https://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://ruby.github.io/rdoc/">RDoc</a> 6.1.2.1.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

