<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>module Sequel::Plugins::Touch - Sequel: The Database Toolkit for Ruby</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
  var index_rel_prefix = "../../";
</script>

<script src="../../js/navigation.js" defer></script>
<script src="../../js/search.js" defer></script>
<script src="../../js/search_index.js" defer></script>
<script src="../../js/searcher.js" defer></script>
<script src="../../js/darkfish.js" defer></script>

<link href="../../css/fonts.css" rel="stylesheet">
<link href="../../css/rdoc.css" rel="stylesheet">




<body id="top" role="document" class="module">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../table_of_contents.html#pages">Pages</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    
    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-c-apply">::apply</a>
    
    <li ><a href="#method-c-configure">::configure</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="module-Sequel::Plugins::Touch">
  <h1 id="module-Sequel::Plugins::Touch" class="module">
    module Sequel::Plugins::Touch
  </h1>

  <section class="description">
    
<p>The touch plugin adds a touch method to model instances, which saves the object with a modified timestamp.  By default, it uses the :updated_at column, but you can set which column to use. It also supports touching of associations, so that when the current model object is updated or destroyed, the associated rows in the database can have their modified timestamp updated to the current timestamp.</p>

<p>Since the instance touch method works on model instances, it uses Time.now for the timestamp.  The association touching works on datasets, so it updates all related rows in a single query, using the <a href="../SQL.html"><code>SQL</code></a> standard CURRENT_TIMESTAMP.  Both of these can be overridden easily if necessary.</p>

<p>Usage:</p>

<pre class="ruby"><span class="ruby-comment"># Allow touching of all model instances (called before loading subclasses)</span>
<span class="ruby-constant">Sequel</span><span class="ruby-operator">::</span><span class="ruby-constant">Model</span>.<span class="ruby-identifier">plugin</span> <span class="ruby-value">:touch</span>

<span class="ruby-comment"># Allow touching of Album instances, with a custom column</span>
<span class="ruby-constant">Album</span>.<span class="ruby-identifier">plugin</span> <span class="ruby-value">:touch</span>, <span class="ruby-value">column:</span> <span class="ruby-value">:updated_on</span>

<span class="ruby-comment"># Allow touching of Artist instances, updating the albums and tags</span>
<span class="ruby-comment"># associations when touching, touching the +updated_on+ column for</span>
<span class="ruby-comment"># albums and the +updated_at+ column for tags</span>
<span class="ruby-constant">Artist</span>.<span class="ruby-identifier">plugin</span> <span class="ruby-value">:touch</span>, <span class="ruby-value">associations:</span> [{<span class="ruby-value">albums:</span> <span class="ruby-value">:updated_on</span>}, <span class="ruby-value">:tags</span>]
</pre>

  </section>

  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-apply" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">apply</span><span
            class="method-args">(model, opts=OPTS)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="apply-source">
            <pre>   <span class="ruby-comment"># File lib/sequel/plugins/touch.rb</span>
<span class="line-num">32</span> <span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">apply</span>(<span class="ruby-identifier">model</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)
<span class="line-num">33</span>   <span class="ruby-identifier">model</span>.<span class="ruby-identifier">instance_variable_set</span>(<span class="ruby-value">:@touched_associations</span>, {})
<span class="line-num">34</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-configure" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">configure</span><span
            class="method-args">(model, opts=OPTS)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Set the touch_column and touched_associations variables for the model. Options:</p>
<dl class="rdoc-list note-list"><dt>:associations 
<dd>
<p>The associations to touch when a model instance is updated or destroyed.  Can be a symbol for a single association, a hash with association keys and column values, or an array of symbols and/or hashes.  If a symbol is used, the column used when updating the associated objects is the model&#39;s touch_column. If a hash is used, the value is used as the column to update.</p>
</dd><dt>:column 
<dd>
<p>The column to modify when touching a model instance.</p>
</dd></dl>
          
          

          
          <div class="method-source-code" id="configure-source">
            <pre>   <span class="ruby-comment"># File lib/sequel/plugins/touch.rb</span>
<span class="line-num">45</span> <span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">configure</span>(<span class="ruby-identifier">model</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)
<span class="line-num">46</span>   <span class="ruby-identifier">model</span>.<span class="ruby-identifier">touch_column</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:column</span>] <span class="ruby-operator">||</span> <span class="ruby-value">:updated_at</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:column</span>] <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-identifier">model</span>.<span class="ruby-identifier">touch_column</span>
<span class="line-num">47</span>   <span class="ruby-identifier">model</span>.<span class="ruby-identifier">touch_associations</span>(<span class="ruby-identifier">opts</span>[<span class="ruby-value">:associations</span>]) <span class="ruby-keyword">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:associations</span>]
<span class="line-num">48</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>

</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="https://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://ruby.github.io/rdoc/">RDoc</a> 6.1.2.1.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

