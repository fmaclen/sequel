<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>module Sequel::Plugins::ValidationHelpers - Sequel: The Database Toolkit for Ruby</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
  var index_rel_prefix = "../../";
</script>

<script src="../../js/navigation.js" defer></script>
<script src="../../js/search.js" defer></script>
<script src="../../js/search_index.js" defer></script>
<script src="../../js/searcher.js" defer></script>
<script src="../../js/darkfish.js" defer></script>

<link href="../../css/fonts.css" rel="stylesheet">
<link href="../../css/rdoc.css" rel="stylesheet">




<body id="top" role="document" class="module">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../table_of_contents.html#pages">Pages</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    
    
    
    
  </div>
</nav>

<main role="main" aria-labelledby="module-Sequel::Plugins::ValidationHelpers">
  <h1 id="module-Sequel::Plugins::ValidationHelpers" class="module">
    module Sequel::Plugins::ValidationHelpers
  </h1>

  <section class="description">
    
<p>The validation_helpers plugin contains validate_* methods designed to be called inside Model#validate to perform validations:</p>

<pre class="ruby"><span class="ruby-constant">Sequel</span><span class="ruby-operator">::</span><span class="ruby-constant">Model</span>.<span class="ruby-identifier">plugin</span> <span class="ruby-value">:validation_helpers</span>
<span class="ruby-keyword">class</span> <span class="ruby-constant">Album</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Sequel</span><span class="ruby-operator">::</span><span class="ruby-constant">Model</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">validate</span>
    <span class="ruby-keyword">super</span>
    <span class="ruby-identifier">validates_min_length</span> <span class="ruby-value">1</span>, <span class="ruby-value">:num_tracks</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>The validates_unique method has a unique API, but the other validations have the API explained here:</p>

<p>Arguments:</p>
<dl class="rdoc-list note-list"><dt>atts 
<dd>
<p>Single attribute symbol or an array of attribute symbols specifying the attribute(s) to validate.</p>
</dd></dl>

<p>Options:</p>
<dl class="rdoc-list note-list"><dt>:allow_blank 
<dd>
<p>Whether to skip the validation if the value is blank.</p>
</dd><dt>:allow_missing 
<dd>
<p>Whether to skip the validation if the attribute isn&#39;t a key in the values hash.  This is different from allow_nil, because <a href="../../Sequel.html"><code>Sequel</code></a> only sends the attributes in the values when doing an insert or update.  If the attribute is not present, <a href="../../Sequel.html"><code>Sequel</code></a> doesn&#39;t specify it, so the database will use the table&#39;s default value.  This is different from having an attribute in values with a value of nil, which <a href="../../Sequel.html"><code>Sequel</code></a> will send as NULL. If your database table has a non NULL default, this may be a good option to use.  You don&#39;t want to use allow_nil, because if the attribute is in values but has a value nil, <a href="../../Sequel.html"><code>Sequel</code></a> will attempt to insert a NULL value into the database, instead of using the database&#39;s default.</p>
</dd><dt>:allow_nil 
<dd>
<p>Whether to skip the validation if the value is nil.</p>
</dd><dt>:from 
<dd>
<p>Set to :values to pull column values from the values hash instead of calling the related method. Allows for setting up methods on the underlying column values, in the cases where the model transforms the underlying value before returning it, such as when using serialization.</p>
</dd><dt>:message 
<dd>
<p>The message to use.  Can be a string which is used directly, or a proc which is called.  If the validation method takes a argument before the array of attributes, that argument is passed as an argument to the proc.</p>
</dd><dt>:skip_invalid 
<dd>
<p>Do not try to validate columns that are already invalid.</p>
</dd></dl>

<p>The default validation options for all models can be modified by overridding the Model#default_validation_helpers_options private method. By changing the default options, you can setup internationalization of the error messages.  For example, you would modify the default options:</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">Sequel</span><span class="ruby-operator">::</span><span class="ruby-constant">Model</span>
  <span class="ruby-identifier">private</span>

  <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">default_validation_helpers_options</span>(<span class="ruby-identifier">type</span>)
    <span class="ruby-keyword">case</span> <span class="ruby-identifier">type</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">:exact_length</span>
      {<span class="ruby-value">message:</span> <span class="ruby-identifier">lambda</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">exact</span><span class="ruby-operator">|</span> <span class="ruby-constant">I18n</span>.<span class="ruby-identifier">t</span>(<span class="ruby-string">&quot;errors.exact_length&quot;</span>, <span class="ruby-value">exact:</span> <span class="ruby-identifier">exact</span>)}}
    <span class="ruby-keyword">when</span> <span class="ruby-value">:integer</span>
      {<span class="ruby-value">message:</span> <span class="ruby-identifier">lambda</span>{<span class="ruby-constant">I18n</span>.<span class="ruby-identifier">t</span>(<span class="ruby-string">&quot;errors.integer&quot;</span>)}}
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">super</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>and then use something like this in your yaml translation file:</p>

<pre>en:
  errors:
    exact_length: &quot;is not %{exact} characters&quot;
    integer: &quot;is not a number&quot;</pre>

<p>Note that if you want to support internationalization of Errors#full_messages, it is easiest to override Errors#full_message (note singular form and not plural form). Here&#39;s an example:</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">Sequel</span><span class="ruby-operator">::</span><span class="ruby-constant">Model</span><span class="ruby-operator">::</span><span class="ruby-constant">Errors</span>
  <span class="ruby-identifier">private</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">full_message</span>(<span class="ruby-identifier">attribute</span>, <span class="ruby-identifier">error_msg</span>)
    <span class="ruby-node">&quot;#{Array(attribute).join(I18n.t(&#39;errors.joiner&#39;))} #{error_msg}&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

  </section>

  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    
    <section class="constants-list">
      <header>
        <h3>Constants</h3>
      </header>
      <dl>
      
        <dt id="DEFAULT_OPTIONS">DEFAULT_OPTIONS
        
        <dd>
        
      
      </dl>
    </section>
    

    

    
  </section>

</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="https://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://ruby.github.io/rdoc/">RDoc</a> 6.1.2.1.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

