<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>module Sequel::Plugins::ValidationClassMethods::ClassMethods - Sequel: The Database Toolkit for Ruby</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../../../";
  var index_rel_prefix = "../../../";
</script>

<script src="../../../js/navigation.js" defer></script>
<script src="../../../js/search.js" defer></script>
<script src="../../../js/search_index.js" defer></script>
<script src="../../../js/searcher.js" defer></script>
<script src="../../../js/darkfish.js" defer></script>

<link href="../../../css/fonts.css" rel="stylesheet">
<link href="../../../css/rdoc.css" rel="stylesheet">




<body id="top" role="document" class="module">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../../table_of_contents.html#pages">Pages</a>
    <a href="../../../table_of_contents.html#classes">Classes</a>
    <a href="../../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    
    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li class="calls-super" ><a href="#method-i-freeze">#freeze</a>
    
    <li ><a href="#method-i-has_validations-3F">#has_validations?</a>
    
    <li ><a href="#method-i-skip_superclass_validations">#skip_superclass_validations</a>
    
    <li ><a href="#method-i-skip_superclass_validations-3F">#skip_superclass_validations?</a>
    
    <li ><a href="#method-i-validate">#validate</a>
    
    <li ><a href="#method-i-validates">#validates</a>
    
    <li ><a href="#method-i-validates_acceptance_of">#validates_acceptance_of</a>
    
    <li ><a href="#method-i-validates_confirmation_of">#validates_confirmation_of</a>
    
    <li ><a href="#method-i-validates_each">#validates_each</a>
    
    <li ><a href="#method-i-validates_format_of">#validates_format_of</a>
    
    <li ><a href="#method-i-validates_inclusion_of">#validates_inclusion_of</a>
    
    <li ><a href="#method-i-validates_length_of">#validates_length_of</a>
    
    <li ><a href="#method-i-validates_numericality_of">#validates_numericality_of</a>
    
    <li ><a href="#method-i-validates_presence_of">#validates_presence_of</a>
    
    <li ><a href="#method-i-validates_schema_type">#validates_schema_type</a>
    
    <li ><a href="#method-i-validates_uniqueness_of">#validates_uniqueness_of</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="module-Sequel::Plugins::ValidationClassMethods::ClassMethods">
  <h1 id="module-Sequel::Plugins::ValidationClassMethods::ClassMethods" class="module">
    module Sequel::Plugins::ValidationClassMethods::ClassMethods
  </h1>

  <section class="description">
    
  </section>

  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    
    <section class="attribute-method-details" class="method-section">
      <header>
        <h3>Attributes</h3>
      </header>

      
      <div id="attribute-i-validation_reflections" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">validation_reflections</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        <p>A hash of validation reflections for this model class.  Keys are column symbols, values are an array of two element arrays, with the first element being the validation type symbol and the second being a hash of validation options.</p>
        
        </div>
      </div>
      
      <div id="attribute-i-validations" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">validations</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        <p>A hash of validations for this model class.  Keys are column symbols, values are arrays of validation procs.</p>
        
        </div>
      </div>
      
    </section>
    

    
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-freeze" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">freeze</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Freeze validation metadata when freezing model class.</p>
          
          
            <div class="method-calls-super">
              Calls superclass method
              
            </div>
          

          
          <div class="method-source-code" id="freeze-source">
            <pre>   <span class="ruby-comment"># File lib/sequel/plugins/validation_class_methods.rb</span>
<span class="line-num">41</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">freeze</span>
<span class="line-num">42</span>   <span class="ruby-ivar">@validations</span>.<span class="ruby-identifier">freeze</span>.<span class="ruby-identifier">each_value</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:freeze</span>)
<span class="line-num">43</span>   <span class="ruby-ivar">@validation_reflections</span>.<span class="ruby-identifier">freeze</span>.<span class="ruby-identifier">each_value</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">vs</span><span class="ruby-operator">|</span>
<span class="line-num">44</span>     <span class="ruby-identifier">vs</span>.<span class="ruby-identifier">freeze</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
<span class="line-num">45</span>       <span class="ruby-identifier">v</span>.<span class="ruby-identifier">freeze</span>
<span class="line-num">46</span>       <span class="ruby-identifier">v</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">freeze</span>
<span class="line-num">47</span>     <span class="ruby-keyword">end</span>
<span class="line-num">48</span>   <span class="ruby-keyword">end</span>
<span class="line-num">49</span> 
<span class="line-num">50</span>   <span class="ruby-keyword">super</span>
<span class="line-num">51</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-has_validations-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">has_validations?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns true if validations are defined.</p>
          
          

          
          <div class="method-source-code" id="has_validations-3F-source">
            <pre>   <span class="ruby-comment"># File lib/sequel/plugins/validation_class_methods.rb</span>
<span class="line-num">74</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">has_validations?</span>
<span class="line-num">75</span>   <span class="ruby-operator">!</span><span class="ruby-identifier">validations</span>.<span class="ruby-identifier">empty?</span>
<span class="line-num">76</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-skip_superclass_validations" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">skip_superclass_validations</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Instructs the model to skip validations defined in superclasses</p>
          
          

          
          <div class="method-source-code" id="skip_superclass_validations-source">
            <pre>   <span class="ruby-comment"># File lib/sequel/plugins/validation_class_methods.rb</span>
<span class="line-num">81</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">skip_superclass_validations</span>
<span class="line-num">82</span>   <span class="ruby-identifier">superclass</span>.<span class="ruby-identifier">validations</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">att</span>, <span class="ruby-identifier">procs</span><span class="ruby-operator">|</span>
<span class="line-num">83</span>     <span class="ruby-keyword">if</span> <span class="ruby-ivar">@validations</span>[<span class="ruby-identifier">att</span>]
<span class="line-num">84</span>       <span class="ruby-ivar">@validations</span>[<span class="ruby-identifier">att</span>] <span class="ruby-operator">-=</span> <span class="ruby-identifier">procs</span>
<span class="line-num">85</span>     <span class="ruby-keyword">end</span>
<span class="line-num">86</span>   <span class="ruby-keyword">end</span>
<span class="line-num">87</span>   <span class="ruby-ivar">@skip_superclass_validations</span> = <span class="ruby-keyword">true</span>
<span class="line-num">88</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-skip_superclass_validations-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">skip_superclass_validations?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Instructs the model to skip validations defined in superclasses</p>
          
          

          
          <div class="method-source-code" id="skip_superclass_validations-3F-source">
            <pre>   <span class="ruby-comment"># File lib/sequel/plugins/validation_class_methods.rb</span>
<span class="line-num">91</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">skip_superclass_validations?</span>
<span class="line-num">92</span>   <span class="ruby-ivar">@skip_superclass_validations</span>
<span class="line-num">93</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-validate" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">validate</span><span
            class="method-args">(o)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Validates the given instance.</p>
          
          

          
          <div class="method-source-code" id="validate-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/plugins/validation_class_methods.rb</span>
<span class="line-num">116</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">validate</span>(<span class="ruby-identifier">o</span>)
<span class="line-num">117</span>   <span class="ruby-identifier">validations</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">att</span>, <span class="ruby-identifier">procs</span><span class="ruby-operator">|</span>
<span class="line-num">118</span>     <span class="ruby-identifier">v</span> = <span class="ruby-keyword">case</span> <span class="ruby-identifier">att</span>
<span class="line-num">119</span>     <span class="ruby-keyword">when</span> <span class="ruby-constant">Array</span>
<span class="line-num">120</span>       <span class="ruby-identifier">att</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span> <span class="ruby-identifier">o</span>.<span class="ruby-identifier">get_column_value</span>(<span class="ruby-identifier">a</span>)}
<span class="line-num">121</span>     <span class="ruby-keyword">else</span>
<span class="line-num">122</span>       <span class="ruby-identifier">o</span>.<span class="ruby-identifier">get_column_value</span>(<span class="ruby-identifier">att</span>)
<span class="line-num">123</span>     <span class="ruby-keyword">end</span>
<span class="line-num">124</span>     <span class="ruby-identifier">procs</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">tag</span>, <span class="ruby-identifier">p</span><span class="ruby-operator">|</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">o</span>, <span class="ruby-identifier">att</span>, <span class="ruby-identifier">v</span>)}
<span class="line-num">125</span>   <span class="ruby-keyword">end</span>
<span class="line-num">126</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-validates" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">validates</span><span
            class="method-args">(&amp;block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Defines validations by converting a longhand block into a series of  shorthand definitions. For example:</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">MyClass</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Sequel</span><span class="ruby-operator">::</span><span class="ruby-constant">Model</span>
  <span class="ruby-identifier">validates</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">length_of</span> <span class="ruby-value">:name</span>, <span class="ruby-value">minimum:</span> <span class="ruby-value">6</span>
    <span class="ruby-identifier">length_of</span> <span class="ruby-value">:password</span>, <span class="ruby-value">minimum:</span> <span class="ruby-value">8</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>is equivalent to:</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">MyClass</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Sequel</span><span class="ruby-operator">::</span><span class="ruby-constant">Model</span>
  <span class="ruby-identifier">validates_length_of</span> <span class="ruby-value">:name</span>, <span class="ruby-value">minimum:</span> <span class="ruby-value">6</span>
  <span class="ruby-identifier">validates_length_of</span> <span class="ruby-value">:password</span>, <span class="ruby-value">minimum:</span> <span class="ruby-value">8</span>
<span class="ruby-keyword">end</span>
</pre>
          
          

          
          <div class="method-source-code" id="validates-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/plugins/validation_class_methods.rb</span>
<span class="line-num">111</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">validates</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">112</span>   <span class="ruby-constant">Generator</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword">self</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">113</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-validates_acceptance_of" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">validates_acceptance_of</span><span
            class="method-args">(*atts)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Validates acceptance of an attribute.  Just checks that the value is equal to the :accept option. This method is unique in that :allow_nil is assumed to be true instead of false.</p>

<p>Possible Options:</p>
<dl class="rdoc-list note-list"><dt>:accept 
<dd>
<p>The value required for the object to be valid (default: &#39;1&#39;)</p>
</dd><dt>:message 
<dd>
<p>The message to use (default: &#39;is not accepted&#39;)</p>
</dd></dl>
          
          

          
          <div class="method-source-code" id="validates_acceptance_of-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/plugins/validation_class_methods.rb</span>
<span class="line-num">135</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">validates_acceptance_of</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">atts</span>)
<span class="line-num">136</span>   <span class="ruby-identifier">opts</span> = {
<span class="line-num">137</span>     <span class="ruby-value">:message</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;is not accepted&#39;</span>,
<span class="line-num">138</span>     <span class="ruby-value">:allow_nil</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">true</span>,
<span class="line-num">139</span>     <span class="ruby-value">:accept</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;1&#39;</span>,
<span class="line-num">140</span>     <span class="ruby-value">:tag</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-value">:acceptance</span>,
<span class="line-num">141</span>   }.<span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">extract_options!</span>(<span class="ruby-identifier">atts</span>))
<span class="line-num">142</span>   <span class="ruby-identifier">reflect_validation</span>(<span class="ruby-value">:acceptance</span>, <span class="ruby-identifier">opts</span>, <span class="ruby-identifier">atts</span>)
<span class="line-num">143</span>   <span class="ruby-identifier">atts</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">opts</span>
<span class="line-num">144</span>   <span class="ruby-identifier">validates_each</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">atts</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">o</span>, <span class="ruby-identifier">a</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
<span class="line-num">145</span>     <span class="ruby-identifier">o</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">a</span>, <span class="ruby-identifier">opts</span>[<span class="ruby-value">:message</span>]) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">v</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:accept</span>]
<span class="line-num">146</span>   <span class="ruby-keyword">end</span>
<span class="line-num">147</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-validates_confirmation_of" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">validates_confirmation_of</span><span
            class="method-args">(*atts)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Validates confirmation of an attribute. Checks that the object has a _confirmation value matching the current value.  For example:</p>

<pre class="ruby"><span class="ruby-identifier">validates_confirmation_of</span> <span class="ruby-value">:blah</span>
</pre>

<p>Just makes sure that object.blah = object.blah_confirmation.  Often used for passwords or email addresses on web forms.</p>

<p>Possible Options:</p>
<dl class="rdoc-list note-list"><dt>:message 
<dd>
<p>The message to use (default: &#39;is not confirmed&#39;)</p>
</dd></dl>
          
          

          
          <div class="method-source-code" id="validates_confirmation_of-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/plugins/validation_class_methods.rb</span>
<span class="line-num">159</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">validates_confirmation_of</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">atts</span>)
<span class="line-num">160</span>   <span class="ruby-identifier">opts</span> = {
<span class="line-num">161</span>     <span class="ruby-value">:message</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;is not confirmed&#39;</span>,
<span class="line-num">162</span>     <span class="ruby-value">:tag</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-value">:confirmation</span>,
<span class="line-num">163</span>   }.<span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">extract_options!</span>(<span class="ruby-identifier">atts</span>))
<span class="line-num">164</span>   <span class="ruby-identifier">reflect_validation</span>(<span class="ruby-value">:confirmation</span>, <span class="ruby-identifier">opts</span>, <span class="ruby-identifier">atts</span>)
<span class="line-num">165</span>   <span class="ruby-identifier">atts</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">opts</span>
<span class="line-num">166</span>   <span class="ruby-identifier">validates_each</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">atts</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">o</span>, <span class="ruby-identifier">a</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
<span class="line-num">167</span>     <span class="ruby-identifier">o</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">a</span>, <span class="ruby-identifier">opts</span>[<span class="ruby-value">:message</span>]) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">v</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">o</span>.<span class="ruby-identifier">get_column_value</span>(<span class="ruby-value">:&quot;#{a}_confirmation&quot;</span>)
<span class="line-num">168</span>   <span class="ruby-keyword">end</span>
<span class="line-num">169</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-validates_each" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">validates_each</span><span
            class="method-args">(*atts, &amp;block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Adds a validation for each of the given attributes using the supplied block. The block must accept three arguments: instance, attribute and  value, e.g.:</p>

<pre class="ruby"><span class="ruby-identifier">validates_each</span> <span class="ruby-value">:name</span>, <span class="ruby-value">:password</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">object</span>, <span class="ruby-identifier">attribute</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">object</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">attribute</span>, <span class="ruby-string">&#39;is not nice&#39;</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">nice?</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Possible Options:</p>
<dl class="rdoc-list note-list"><dt>:allow_blank 
<dd>
<p>Whether to skip the validation if the value is blank. </p>
</dd><dt>:allow_missing 
<dd>
<p>Whether to skip the validation if the attribute isn&#39;t a key in the values hash.  This is different from allow_nil, because <a href="../../../Sequel.html"><code>Sequel</code></a> only sends the attributes in the values when doing an insert or update.  If the attribute is not present, <a href="../../../Sequel.html"><code>Sequel</code></a> doesn&#39;t specify it, so the database will use the table&#39;s default value.  This is different from having an attribute in values with a value of nil, which <a href="../../../Sequel.html"><code>Sequel</code></a> will send as NULL. If your database table has a non NULL default, this may be a good option to use.  You don&#39;t want to use allow_nil, because if the attribute is in values but has a value nil, <a href="../../../Sequel.html"><code>Sequel</code></a> will attempt to insert a NULL value into the database, instead of using the database&#39;s default.</p>
</dd><dt>:allow_nil 
<dd>
<p>Whether to skip the validation if the value is nil.</p>
</dd><dt>:if 
<dd>
<p>A symbol (indicating an instance_method) or proc (which is used to define an instance method) skipping this validation if it returns nil or false.</p>
</dd><dt>:tag 
<dd>
<p>The tag to use for this validation.</p>
</dd></dl>
          
          

          
          <div class="method-source-code" id="validates_each-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/plugins/validation_class_methods.rb</span>
<span class="line-num">194</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">validates_each</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">atts</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="line-num">195</span>   <span class="ruby-identifier">opts</span> = <span class="ruby-identifier">extract_options!</span>(<span class="ruby-identifier">atts</span>)
<span class="line-num">196</span>   <span class="ruby-identifier">blank_meth</span> = <span class="ruby-identifier">db</span>.<span class="ruby-identifier">method</span>(<span class="ruby-value">:blank_object?</span>).<span class="ruby-identifier">to_proc</span>
<span class="line-num">197</span>   <span class="ruby-identifier">i</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:if</span>]
<span class="line-num">198</span>   <span class="ruby-identifier">am</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:allow_missing</span>]
<span class="line-num">199</span>   <span class="ruby-identifier">an</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:allow_nil</span>]
<span class="line-num">200</span>   <span class="ruby-identifier">ab</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:allow_blank</span>]
<span class="line-num">201</span>   <span class="ruby-identifier">blk</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">i</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">am</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">an</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">ab</span>
<span class="line-num">202</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">i</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Proc</span>)
<span class="line-num">203</span>       <span class="ruby-identifier">i</span> = <span class="ruby-constant">Plugins</span>.<span class="ruby-identifier">def_sequel_method</span>(<span class="ruby-keyword">self</span>, <span class="ruby-string">&quot;validation_class_methods_if&quot;</span>, <span class="ruby-value">0</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">i</span>)
<span class="line-num">204</span>     <span class="ruby-keyword">end</span>
<span class="line-num">205</span> 
<span class="line-num">206</span>     <span class="ruby-identifier">proc</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">o</span>,<span class="ruby-identifier">a</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
<span class="line-num">207</span>       <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">i</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">validation_if_proc</span>(<span class="ruby-identifier">o</span>, <span class="ruby-identifier">i</span>)
<span class="line-num">208</span>       <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">an</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">Array</span>(<span class="ruby-identifier">v</span>).<span class="ruby-identifier">all?</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:nil?</span>)
<span class="line-num">209</span>       <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">ab</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">Array</span>(<span class="ruby-identifier">v</span>).<span class="ruby-identifier">all?</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">blank_meth</span>)
<span class="line-num">210</span>       <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">am</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">Array</span>(<span class="ruby-identifier">a</span>).<span class="ruby-identifier">all?</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-operator">!</span><span class="ruby-identifier">o</span>.<span class="ruby-identifier">values</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">x</span>)}
<span class="line-num">211</span>       <span class="ruby-identifier">block</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">o</span>,<span class="ruby-identifier">a</span>,<span class="ruby-identifier">v</span>)
<span class="line-num">212</span>     <span class="ruby-keyword">end</span>
<span class="line-num">213</span>   <span class="ruby-keyword">else</span>
<span class="line-num">214</span>     <span class="ruby-identifier">block</span>
<span class="line-num">215</span>   <span class="ruby-keyword">end</span>
<span class="line-num">216</span>   <span class="ruby-identifier">tag</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:tag</span>]
<span class="line-num">217</span>   <span class="ruby-identifier">atts</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span> 
<span class="line-num">218</span>     <span class="ruby-identifier">a_vals</span> = <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">synchronize</span>{<span class="ruby-identifier">validations</span>[<span class="ruby-identifier">a</span>] <span class="ruby-operator">||=</span> []}
<span class="line-num">219</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">tag</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">old</span> = <span class="ruby-identifier">a_vals</span>.<span class="ruby-identifier">find</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">tag</span>})
<span class="line-num">220</span>       <span class="ruby-identifier">old</span>[<span class="ruby-value">1</span>] = <span class="ruby-identifier">blk</span>
<span class="line-num">221</span>     <span class="ruby-keyword">else</span>
<span class="line-num">222</span>       <span class="ruby-identifier">a_vals</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-identifier">tag</span>, <span class="ruby-identifier">blk</span>]
<span class="line-num">223</span>     <span class="ruby-keyword">end</span>
<span class="line-num">224</span>   <span class="ruby-keyword">end</span>
<span class="line-num">225</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-validates_format_of" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">validates_format_of</span><span
            class="method-args">(*atts)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Validates the format of an attribute, checking the string representation of the value against the regular expression provided by the :with option.</p>

<p>Possible Options:</p>
<dl class="rdoc-list note-list"><dt>:message 
<dd>
<p>The message to use (default: &#39;is invalid&#39;)</p>
</dd><dt>:with 
<dd>
<p>The regular expression to validate the value with (required).</p>
</dd></dl>
          
          

          
          <div class="method-source-code" id="validates_format_of-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/plugins/validation_class_methods.rb</span>
<span class="line-num">233</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">validates_format_of</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">atts</span>)
<span class="line-num">234</span>   <span class="ruby-identifier">opts</span> = {
<span class="line-num">235</span>     <span class="ruby-value">:message</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;is invalid&#39;</span>,
<span class="line-num">236</span>     <span class="ruby-value">:tag</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-value">:format</span>,
<span class="line-num">237</span>   }.<span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">extract_options!</span>(<span class="ruby-identifier">atts</span>))
<span class="line-num">238</span>   
<span class="line-num">239</span>   <span class="ruby-keyword">unless</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:with</span>].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Regexp</span>)
<span class="line-num">240</span>     <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-string">&quot;A regular expression must be supplied as the :with option of the options hash&quot;</span>
<span class="line-num">241</span>   <span class="ruby-keyword">end</span>
<span class="line-num">242</span>   
<span class="line-num">243</span>   <span class="ruby-identifier">reflect_validation</span>(<span class="ruby-value">:format</span>, <span class="ruby-identifier">opts</span>, <span class="ruby-identifier">atts</span>)
<span class="line-num">244</span>   <span class="ruby-identifier">atts</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">opts</span>
<span class="line-num">245</span>   <span class="ruby-identifier">validates_each</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">atts</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">o</span>, <span class="ruby-identifier">a</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
<span class="line-num">246</span>     <span class="ruby-identifier">o</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">a</span>, <span class="ruby-identifier">opts</span>[<span class="ruby-value">:message</span>]) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:with</span>]
<span class="line-num">247</span>   <span class="ruby-keyword">end</span>
<span class="line-num">248</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-validates_inclusion_of" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">validates_inclusion_of</span><span
            class="method-args">(*atts)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Validates that an attribute is within a specified range or set of values.</p>

<p>Possible Options:</p>
<dl class="rdoc-list note-list"><dt>:in 
<dd>
<p>An array or range of values to check for validity (required)</p>
</dd><dt>:message 
<dd>
<p>The message to use (default: &#39;is not in range or set: &lt;specified range&gt;&#39;)</p>
</dd></dl>
          
          

          
          <div class="method-source-code" id="validates_inclusion_of-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/plugins/validation_class_methods.rb</span>
<span class="line-num">337</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">validates_inclusion_of</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">atts</span>)
<span class="line-num">338</span>   <span class="ruby-identifier">opts</span> = <span class="ruby-identifier">extract_options!</span>(<span class="ruby-identifier">atts</span>)
<span class="line-num">339</span>   <span class="ruby-identifier">n</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:in</span>]
<span class="line-num">340</span>   <span class="ruby-keyword">unless</span> <span class="ruby-identifier">n</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">n</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:cover?</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">n</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:include?</span>))
<span class="line-num">341</span>     <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-string">&quot;The :in parameter is required, and must respond to cover? or include?&quot;</span>
<span class="line-num">342</span>   <span class="ruby-keyword">end</span>
<span class="line-num">343</span>   <span class="ruby-identifier">opts</span>[<span class="ruby-value">:message</span>] <span class="ruby-operator">||=</span> <span class="ruby-node">&quot;is not in range or set: #{n.inspect}&quot;</span>
<span class="line-num">344</span>   <span class="ruby-identifier">reflect_validation</span>(<span class="ruby-value">:inclusion</span>, <span class="ruby-identifier">opts</span>, <span class="ruby-identifier">atts</span>)
<span class="line-num">345</span>   <span class="ruby-identifier">atts</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">opts</span>
<span class="line-num">346</span>   <span class="ruby-identifier">validates_each</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">atts</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">o</span>, <span class="ruby-identifier">a</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
<span class="line-num">347</span>     <span class="ruby-identifier">o</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">a</span>, <span class="ruby-identifier">opts</span>[<span class="ruby-value">:message</span>]) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">n</span>.<span class="ruby-identifier">public_send</span>(<span class="ruby-identifier">n</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:cover?</span>) <span class="ruby-operator">?</span> <span class="ruby-value">:cover?</span> <span class="ruby-operator">:</span> <span class="ruby-value">:include?</span>, <span class="ruby-identifier">v</span>)
<span class="line-num">348</span>   <span class="ruby-keyword">end</span>
<span class="line-num">349</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-validates_length_of" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">validates_length_of</span><span
            class="method-args">(*atts)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Validates the length of an attribute.</p>

<p>Possible Options:</p>
<dl class="rdoc-list note-list"><dt>:is 
<dd>
<p>The exact size required for the value to be valid (no default)</p>
</dd><dt>:maximum 
<dd>
<p>The maximum size allowed for the value (no default)</p>
</dd><dt>:message 
<dd>
<p>The message to use (no default, overrides :nil_message, :too_long, :too_short, and :wrong_length options if present)</p>
</dd><dt>:minimum 
<dd>
<p>The minimum size allowed for the value (no default)</p>
</dd><dt>:nil_message 
<dd>
<p>The message to use use if :maximum option is used and the value is nil (default: &#39;is not present&#39;)</p>
</dd><dt>:too_long 
<dd>
<p>The message to use use if it the value is too long (default: &#39;is too long&#39;)</p>
</dd><dt>:too_short 
<dd>
<p>The message to use use if it the value is too short (default: &#39;is too short&#39;)</p>
</dd><dt>:within 
<dd>
<p>The array/range that must include the size of the value for it to be valid (no default)</p>
</dd><dt>:wrong_length 
<dd>
<p>The message to use use if it the value is not valid (default: &#39;is the wrong length&#39;)</p>
</dd></dl>
          
          

          
          <div class="method-source-code" id="validates_length_of-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/plugins/validation_class_methods.rb</span>
<span class="line-num">263</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">validates_length_of</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">atts</span>)
<span class="line-num">264</span>   <span class="ruby-identifier">opts</span> = {
<span class="line-num">265</span>     <span class="ruby-value">:nil_message</span>  <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;is not present&#39;</span>,
<span class="line-num">266</span>     <span class="ruby-value">:too_long</span>     <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;is too long&#39;</span>,
<span class="line-num">267</span>     <span class="ruby-value">:too_short</span>    <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;is too short&#39;</span>,
<span class="line-num">268</span>     <span class="ruby-value">:wrong_length</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;is the wrong length&#39;</span>
<span class="line-num">269</span>   }.<span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">extract_options!</span>(<span class="ruby-identifier">atts</span>))
<span class="line-num">270</span>   
<span class="line-num">271</span>   <span class="ruby-identifier">opts</span>[<span class="ruby-value">:tag</span>] <span class="ruby-operator">||=</span> ([<span class="ruby-value">:length</span>] <span class="ruby-operator">+</span> [<span class="ruby-value">:maximum</span>, <span class="ruby-value">:minimum</span>, <span class="ruby-value">:is</span>, <span class="ruby-value">:within</span>].<span class="ruby-identifier">reject</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-operator">!</span><span class="ruby-identifier">opts</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">x</span>)}).<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39;-&#39;</span>).<span class="ruby-identifier">to_sym</span>
<span class="line-num">272</span>   <span class="ruby-identifier">reflect_validation</span>(<span class="ruby-value">:length</span>, <span class="ruby-identifier">opts</span>, <span class="ruby-identifier">atts</span>)
<span class="line-num">273</span>   <span class="ruby-identifier">atts</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">opts</span>
<span class="line-num">274</span>   <span class="ruby-identifier">validates_each</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">atts</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">o</span>, <span class="ruby-identifier">a</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
<span class="line-num">275</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">m</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:maximum</span>]
<span class="line-num">276</span>       <span class="ruby-identifier">o</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">a</span>, <span class="ruby-identifier">opts</span>[<span class="ruby-value">:message</span>] <span class="ruby-operator">||</span> (<span class="ruby-identifier">v</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:too_long</span>] <span class="ruby-operator">:</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:nil_message</span>])) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">v</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">m</span>
<span class="line-num">277</span>     <span class="ruby-keyword">end</span>
<span class="line-num">278</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">m</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:minimum</span>]
<span class="line-num">279</span>       <span class="ruby-identifier">o</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">a</span>, <span class="ruby-identifier">opts</span>[<span class="ruby-value">:message</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:too_short</span>]) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">v</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">m</span>
<span class="line-num">280</span>     <span class="ruby-keyword">end</span>
<span class="line-num">281</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">i</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:is</span>]
<span class="line-num">282</span>       <span class="ruby-identifier">o</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">a</span>, <span class="ruby-identifier">opts</span>[<span class="ruby-value">:message</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:wrong_length</span>]) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">v</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">i</span>
<span class="line-num">283</span>     <span class="ruby-keyword">end</span>
<span class="line-num">284</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">w</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:within</span>]
<span class="line-num">285</span>       <span class="ruby-identifier">o</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">a</span>, <span class="ruby-identifier">opts</span>[<span class="ruby-value">:message</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:wrong_length</span>]) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">v</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">w</span>.<span class="ruby-identifier">public_send</span>(<span class="ruby-identifier">w</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:cover?</span>) <span class="ruby-operator">?</span> <span class="ruby-value">:cover?</span> <span class="ruby-operator">:</span> <span class="ruby-value">:include?</span>, <span class="ruby-identifier">v</span>.<span class="ruby-identifier">size</span>)
<span class="line-num">286</span>     <span class="ruby-keyword">end</span>
<span class="line-num">287</span>   <span class="ruby-keyword">end</span>
<span class="line-num">288</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-validates_numericality_of" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">validates_numericality_of</span><span
            class="method-args">(*atts)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Validates whether an attribute is a number.</p>

<p>Possible Options:</p>
<dl class="rdoc-list note-list"><dt>:message 
<dd>
<p>The message to use (default: &#39;is not a number&#39;)</p>
</dd><dt>:only_integer 
<dd>
<p>Whether only integers are valid values (default: false)</p>
</dd></dl>
          
          

          
          <div class="method-source-code" id="validates_numericality_of-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/plugins/validation_class_methods.rb</span>
<span class="line-num">295</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">validates_numericality_of</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">atts</span>)
<span class="line-num">296</span>   <span class="ruby-identifier">opts</span> = {
<span class="line-num">297</span>     <span class="ruby-value">:message</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;is not a number&#39;</span>,
<span class="line-num">298</span>     <span class="ruby-value">:tag</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-value">:numericality</span>,
<span class="line-num">299</span>   }.<span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">extract_options!</span>(<span class="ruby-identifier">atts</span>))
<span class="line-num">300</span>   <span class="ruby-identifier">reflect_validation</span>(<span class="ruby-value">:numericality</span>, <span class="ruby-identifier">opts</span>, <span class="ruby-identifier">atts</span>)
<span class="line-num">301</span>   <span class="ruby-identifier">atts</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">opts</span>
<span class="line-num">302</span>   <span class="ruby-identifier">validates_each</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">atts</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">o</span>, <span class="ruby-identifier">a</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
<span class="line-num">303</span>     <span class="ruby-keyword">begin</span>
<span class="line-num">304</span>       <span class="ruby-keyword">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:only_integer</span>]
<span class="line-num">305</span>         <span class="ruby-constant">Kernel</span>.<span class="ruby-constant">Integer</span>(<span class="ruby-identifier">v</span>.<span class="ruby-identifier">to_s</span>)
<span class="line-num">306</span>       <span class="ruby-keyword">else</span>
<span class="line-num">307</span>         <span class="ruby-constant">Kernel</span>.<span class="ruby-constant">Float</span>(<span class="ruby-identifier">v</span>.<span class="ruby-identifier">to_s</span>)
<span class="line-num">308</span>       <span class="ruby-keyword">end</span>
<span class="line-num">309</span>     <span class="ruby-keyword">rescue</span>
<span class="line-num">310</span>       <span class="ruby-identifier">o</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">a</span>, <span class="ruby-identifier">opts</span>[<span class="ruby-value">:message</span>])
<span class="line-num">311</span>     <span class="ruby-keyword">end</span>
<span class="line-num">312</span>   <span class="ruby-keyword">end</span>
<span class="line-num">313</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-validates_presence_of" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">validates_presence_of</span><span
            class="method-args">(*atts)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Validates the presence of an attribute.  Requires the value not be blank, with false considered present instead of absent.</p>

<p>Possible Options:</p>
<dl class="rdoc-list note-list"><dt>:message 
<dd>
<p>The message to use (default: &#39;is not present&#39;)</p>
</dd></dl>
          
          

          
          <div class="method-source-code" id="validates_presence_of-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/plugins/validation_class_methods.rb</span>
<span class="line-num">320</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">validates_presence_of</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">atts</span>)
<span class="line-num">321</span>   <span class="ruby-identifier">opts</span> = {
<span class="line-num">322</span>     <span class="ruby-value">:message</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;is not present&#39;</span>,
<span class="line-num">323</span>     <span class="ruby-value">:tag</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-value">:presence</span>,
<span class="line-num">324</span>   }.<span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">extract_options!</span>(<span class="ruby-identifier">atts</span>))
<span class="line-num">325</span>   <span class="ruby-identifier">reflect_validation</span>(<span class="ruby-value">:presence</span>, <span class="ruby-identifier">opts</span>, <span class="ruby-identifier">atts</span>)
<span class="line-num">326</span>   <span class="ruby-identifier">atts</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">opts</span>
<span class="line-num">327</span>   <span class="ruby-identifier">validates_each</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">atts</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">o</span>, <span class="ruby-identifier">a</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
<span class="line-num">328</span>     <span class="ruby-identifier">o</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">a</span>, <span class="ruby-identifier">opts</span>[<span class="ruby-value">:message</span>]) <span class="ruby-keyword">if</span> <span class="ruby-identifier">db</span>.<span class="ruby-identifier">send</span>(<span class="ruby-value">:blank_object?</span>, <span class="ruby-identifier">v</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">v</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">false</span>
<span class="line-num">329</span>   <span class="ruby-keyword">end</span>
<span class="line-num">330</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-validates_schema_type" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">validates_schema_type</span><span
            class="method-args">(*atts)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Validates whether an attribute has the correct ruby type for the associated database type.  This is generally useful in conjunction with raise_on_typecast_failure = false, to handle typecasting errors at validation time instead of at setter time. </p>

<p>Possible Options:</p>
<dl class="rdoc-list note-list"><dt>:message 
<dd>
<p>The message to use (default: &#39;is not a valid (integer|datetime|etc.)&#39;)</p>
</dd></dl>
          
          

          
          <div class="method-source-code" id="validates_schema_type-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/plugins/validation_class_methods.rb</span>
<span class="line-num">358</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">validates_schema_type</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">atts</span>)
<span class="line-num">359</span>   <span class="ruby-identifier">opts</span> = {
<span class="line-num">360</span>     <span class="ruby-value">:tag</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-value">:schema_type</span>,
<span class="line-num">361</span>   }.<span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">extract_options!</span>(<span class="ruby-identifier">atts</span>))
<span class="line-num">362</span>   <span class="ruby-identifier">reflect_validation</span>(<span class="ruby-value">:schema_type</span>, <span class="ruby-identifier">opts</span>, <span class="ruby-identifier">atts</span>)
<span class="line-num">363</span>   <span class="ruby-identifier">atts</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">opts</span>
<span class="line-num">364</span>   <span class="ruby-identifier">validates_each</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">atts</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">o</span>, <span class="ruby-identifier">a</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
<span class="line-num">365</span>     <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> (<span class="ruby-identifier">klass</span> = <span class="ruby-identifier">o</span>.<span class="ruby-identifier">send</span>(<span class="ruby-value">:schema_type_class</span>, <span class="ruby-identifier">a</span>)).<span class="ruby-identifier">nil?</span>
<span class="line-num">366</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>) <span class="ruby-operator">?</span> <span class="ruby-operator">!</span><span class="ruby-identifier">klass</span>.<span class="ruby-identifier">any?</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">kls</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-identifier">kls</span>)} <span class="ruby-operator">:</span> <span class="ruby-operator">!</span><span class="ruby-identifier">v</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-identifier">klass</span>)
<span class="line-num">367</span>       <span class="ruby-identifier">message</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:message</span>] <span class="ruby-operator">||</span> <span class="ruby-node">&quot;is not a valid #{Array(klass).join(&quot; or &quot;).downcase}&quot;</span>
<span class="line-num">368</span>       <span class="ruby-identifier">o</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">a</span>, <span class="ruby-identifier">message</span>)
<span class="line-num">369</span>     <span class="ruby-keyword">end</span>
<span class="line-num">370</span>   <span class="ruby-keyword">end</span>
<span class="line-num">371</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-validates_uniqueness_of" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">validates_uniqueness_of</span><span
            class="method-args">(*atts)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Validates only if the fields in the model (specified by atts) are unique in the database.  Pass an array of fields instead of multiple fields to specify that the combination of fields must be unique, instead of that each field should have a unique value.</p>

<p>This means that the code:</p>

<pre class="ruby"><span class="ruby-identifier">validates_uniqueness_of</span>([<span class="ruby-value">:column1</span>, <span class="ruby-value">:column2</span>])
</pre>

<p>validates the grouping of column1 and column2 while</p>

<pre class="ruby"><span class="ruby-identifier">validates_uniqueness_of</span>(<span class="ruby-value">:column1</span>, <span class="ruby-value">:column2</span>)
</pre>

<p>validates them separately.</p>

<p>You should also add a unique index in the database, as this suffers from a fairly obvious race condition.</p>

<p>Possible Options:</p>
<dl class="rdoc-list note-list"><dt>:message 
<dd>
<p>The message to use (default: &#39;is already taken&#39;)</p>
</dd></dl>
          
          

          
          <div class="method-source-code" id="validates_uniqueness_of-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/plugins/validation_class_methods.rb</span>
<span class="line-num">389</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">validates_uniqueness_of</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">atts</span>)
<span class="line-num">390</span>   <span class="ruby-identifier">opts</span> = {
<span class="line-num">391</span>     <span class="ruby-value">:message</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;is already taken&#39;</span>,
<span class="line-num">392</span>     <span class="ruby-value">:tag</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-value">:uniqueness</span>,
<span class="line-num">393</span>   }.<span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">extract_options!</span>(<span class="ruby-identifier">atts</span>))
<span class="line-num">394</span>     
<span class="line-num">395</span>   <span class="ruby-identifier">reflect_validation</span>(<span class="ruby-value">:uniqueness</span>, <span class="ruby-identifier">opts</span>, <span class="ruby-identifier">atts</span>)
<span class="line-num">396</span>   <span class="ruby-identifier">atts</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">opts</span>
<span class="line-num">397</span>   <span class="ruby-identifier">validates_each</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">atts</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">o</span>, <span class="ruby-identifier">a</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
<span class="line-num">398</span>     <span class="ruby-identifier">error_field</span> = <span class="ruby-identifier">a</span>
<span class="line-num">399</span>     <span class="ruby-identifier">a</span> = <span class="ruby-constant">Array</span>(<span class="ruby-identifier">a</span>)
<span class="line-num">400</span>     <span class="ruby-identifier">v</span> = <span class="ruby-constant">Array</span>(<span class="ruby-identifier">v</span>)
<span class="line-num">401</span>     <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-identifier">v</span>.<span class="ruby-identifier">all?</span>
<span class="line-num">402</span>     <span class="ruby-identifier">ds</span> = <span class="ruby-identifier">o</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">a</span>.<span class="ruby-identifier">zip</span>(<span class="ruby-identifier">v</span>))
<span class="line-num">403</span>     <span class="ruby-identifier">num_dups</span> = <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">count</span>
<span class="line-num">404</span>     <span class="ruby-identifier">allow</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">num_dups</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
<span class="line-num">405</span>       <span class="ruby-comment"># No unique value in the database</span>
<span class="line-num">406</span>       <span class="ruby-keyword">true</span>
<span class="line-num">407</span>     <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">num_dups</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
<span class="line-num">408</span>       <span class="ruby-comment"># Multiple &quot;unique&quot; values in the database!!</span>
<span class="line-num">409</span>       <span class="ruby-comment"># Someone didn&#39;t add a unique index</span>
<span class="line-num">410</span>       <span class="ruby-keyword">false</span>
<span class="line-num">411</span>     <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">o</span>.<span class="ruby-identifier">new?</span>
<span class="line-num">412</span>       <span class="ruby-comment"># New record, but unique value already exists in the database</span>
<span class="line-num">413</span>       <span class="ruby-keyword">false</span>
<span class="line-num">414</span>     <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">first</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">o</span>
<span class="line-num">415</span>       <span class="ruby-comment"># Unique value exists in database, but for the same record, so the update won&#39;t cause a duplicate record</span>
<span class="line-num">416</span>       <span class="ruby-keyword">true</span>
<span class="line-num">417</span>     <span class="ruby-keyword">else</span>
<span class="line-num">418</span>       <span class="ruby-keyword">false</span>
<span class="line-num">419</span>     <span class="ruby-keyword">end</span>
<span class="line-num">420</span>     <span class="ruby-identifier">o</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">error_field</span>, <span class="ruby-identifier">opts</span>[<span class="ruby-value">:message</span>]) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">allow</span>
<span class="line-num">421</span>   <span class="ruby-keyword">end</span>
<span class="line-num">422</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>

</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="https://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://ruby.github.io/rdoc/">RDoc</a> 6.1.2.1.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

