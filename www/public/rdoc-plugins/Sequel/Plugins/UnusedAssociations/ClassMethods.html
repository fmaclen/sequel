<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>module Sequel::Plugins::UnusedAssociations::ClassMethods - Sequel: The Database Toolkit for Ruby</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../../../";
  var index_rel_prefix = "../../../";
</script>

<script src="../../../js/navigation.js" defer></script>
<script src="../../../js/search.js" defer></script>
<script src="../../../js/search_index.js" defer></script>
<script src="../../../js/searcher.js" defer></script>
<script src="../../../js/darkfish.js" defer></script>

<link href="../../../css/fonts.css" rel="stylesheet">
<link href="../../../css/rdoc.css" rel="stylesheet">




<body id="top" role="document" class="module">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../../table_of_contents.html#pages">Pages</a>
    <a href="../../../table_of_contents.html#classes">Classes</a>
    <a href="../../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    
    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li class="calls-super" ><a href="#method-i-associate">#associate</a>
    
    <li class="calls-super" ><a href="#method-i-association_reflection">#association_reflection</a>
    
    <li ><a href="#method-i-delete_unused_associations_files">#delete_unused_associations_files</a>
    
    <li class="calls-super" ><a href="#method-i-freeze">#freeze</a>
    
    <li ><a href="#method-i-unused_association_options">#unused_association_options</a>
    
    <li ><a href="#method-i-unused_associations">#unused_associations</a>
    
    <li ><a href="#method-i-update_associations_coverage">#update_associations_coverage</a>
    
    <li ><a href="#method-i-update_unused_associations_data">#update_unused_associations_data</a>
    
    <li ><a href="#method-i-used_association_reflections">#used_association_reflections</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="module-Sequel::Plugins::UnusedAssociations::ClassMethods">
  <h1 id="module-Sequel::Plugins::UnusedAssociations::ClassMethods" class="module">
    module Sequel::Plugins::UnusedAssociations::ClassMethods
  </h1>

  <section class="description">
    
  </section>

  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-associate" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">associate</span><span
            class="method-args">(type, assoc_name, opts=OPTS)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>If modifying associations, and this association is marked as not used, and the association does not include the specific :is_used option, skip defining the association.</p>
          
          
            <div class="method-calls-super">
              Calls superclass method
              
            </div>
          

          
          <div class="method-source-code" id="associate-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/plugins/unused_associations.rb</span>
<span class="line-num">284</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">associate</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">assoc_name</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)
<span class="line-num">285</span>   <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">opts</span>[<span class="ruby-value">:is_used</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@unused_associations_data</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">data</span> = <span class="ruby-ivar">@unused_associations_data</span>[<span class="ruby-identifier">name</span>]) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">data</span>[<span class="ruby-identifier">assoc_name</span>.<span class="ruby-identifier">to_s</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;unused&#39;</span>
<span class="line-num">286</span>     <span class="ruby-keyword">return</span>
<span class="line-num">287</span>   <span class="ruby-keyword">end</span>
<span class="line-num">288</span>   
<span class="line-num">289</span>   <span class="ruby-keyword">super</span>
<span class="line-num">290</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-association_reflection" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">association_reflection</span><span
            class="method-args">(association)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Record access to association reflections to determine which associations are not used.</p>
          
          
            <div class="method-calls-super">
              Calls superclass method
              
            </div>
          

          
          <div class="method-source-code" id="association_reflection-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/plugins/unused_associations.rb</span>
<span class="line-num">275</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">association_reflection</span>(<span class="ruby-identifier">association</span>)
<span class="line-num">276</span>   <span class="ruby-identifier">uar</span> = <span class="ruby-identifier">used_association_reflections</span>
<span class="line-num">277</span>   <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">synchronize</span>{<span class="ruby-identifier">uar</span>[<span class="ruby-identifier">association</span>] <span class="ruby-operator">||=</span> <span class="ruby-keyword">true</span>}
<span class="line-num">278</span>   <span class="ruby-keyword">super</span>
<span class="line-num">279</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-delete_unused_associations_files" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">delete_unused_associations_files</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Delete the unused associations coverage file and unused associations data file, if either exist.</p>
          
          

          
          <div class="method-source-code" id="delete_unused_associations_files-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/plugins/unused_associations.rb</span>
<span class="line-num">461</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">delete_unused_associations_files</span>
<span class="line-num">462</span>   <span class="ruby-identifier">_delete_unused_associations_file</span>(<span class="ruby-ivar">@unused_associations_coverage_file</span>)
<span class="line-num">463</span>   <span class="ruby-identifier">_delete_unused_associations_file</span>(<span class="ruby-ivar">@unused_associations_file</span>)
<span class="line-num">464</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-freeze" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">freeze</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Setup the <a href="ClassMethods.html#method-i-used_association_reflections"><code>used_association_reflections</code></a> storage before freezing</p>
          
          
            <div class="method-calls-super">
              Calls superclass method
              
            </div>
          

          
          <div class="method-source-code" id="freeze-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/plugins/unused_associations.rb</span>
<span class="line-num">293</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">freeze</span>
<span class="line-num">294</span>   <span class="ruby-identifier">used_association_reflections</span>
<span class="line-num">295</span>   <span class="ruby-keyword">super</span>
<span class="line-num">296</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-unused_association_options" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">unused_association_options</span><span
            class="method-args">(opts=OPTS)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Return an array of unused association options.  These are associations some but not all of the association methods are used, according to the coverage information. Each entry in the array is an array of three elements.  The first element is the class name string, the second element is the association name string, and the third element is a hash of association options that can be used in the association so it does not define methods that are not used.</p>

<p>Options:</p>
<dl class="rdoc-list note-list"><dt>:unused_associations_data 
<dd>
<p>The data to use for determining which associations are unused, which is returned from <code>update_unused_associations_data</code>. If not given, loads the data from the file specified by the :file plugin option.</p>
</dd></dl>
          
          

          
          <div class="method-source-code" id="unused_association_options-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/plugins/unused_associations.rb</span>
<span class="line-num">445</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">unused_association_options</span>(<span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)
<span class="line-num">446</span>   <span class="ruby-identifier">unused_associations_data</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:unused_associations_data</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">parse_json</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">binread</span>(<span class="ruby-ivar">@unused_associations_file</span>))
<span class="line-num">447</span> 
<span class="line-num">448</span>   <span class="ruby-identifier">unused_association_methods</span> = []
<span class="line-num">449</span>   <span class="ruby-identifier">unused_associations_data</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">sc</span>, <span class="ruby-identifier">associations</span><span class="ruby-operator">|</span>
<span class="line-num">450</span>     <span class="ruby-identifier">associations</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">assoc</span>, <span class="ruby-identifier">unused</span><span class="ruby-operator">|</span>
<span class="line-num">451</span>       <span class="ruby-keyword">unless</span> <span class="ruby-identifier">unused</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;unused&#39;</span>
<span class="line-num">452</span>         <span class="ruby-identifier">unused_association_methods</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-identifier">sc</span>, <span class="ruby-identifier">assoc</span>, <span class="ruby-identifier">set_unused_options_for_association</span>({}, <span class="ruby-identifier">unused</span>)]
<span class="line-num">453</span>       <span class="ruby-keyword">end</span>
<span class="line-num">454</span>     <span class="ruby-keyword">end</span>
<span class="line-num">455</span>   <span class="ruby-keyword">end</span>
<span class="line-num">456</span>   <span class="ruby-identifier">unused_association_methods</span>
<span class="line-num">457</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-unused_associations" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">unused_associations</span><span
            class="method-args">(opts=OPTS)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Return an array of unused associations.  These are associations where none of the association methods are used, according to the coverage information.  Each entry in the array is an array of two strings, with the first string being the class name and the second string being the association name.</p>

<p>Options:</p>
<dl class="rdoc-list note-list"><dt>:unused_associations_data 
<dd>
<p>The data to use for determining which associations are unused, which is returned from <code>update_unused_associations_data</code>. If not given, loads the data from the file specified by the :file plugin option.</p>
</dd></dl>
          
          

          
          <div class="method-source-code" id="unused_associations-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/plugins/unused_associations.rb</span>
<span class="line-num">418</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">unused_associations</span>(<span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)
<span class="line-num">419</span>   <span class="ruby-identifier">unused_associations_data</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:unused_associations_data</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">parse_json</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">binread</span>(<span class="ruby-ivar">@unused_associations_file</span>))
<span class="line-num">420</span> 
<span class="line-num">421</span>   <span class="ruby-identifier">unused_associations</span> = []
<span class="line-num">422</span>   <span class="ruby-identifier">unused_associations_data</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">sc</span>, <span class="ruby-identifier">associations</span><span class="ruby-operator">|</span>
<span class="line-num">423</span>     <span class="ruby-identifier">associations</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">assoc</span>, <span class="ruby-identifier">unused</span><span class="ruby-operator">|</span>
<span class="line-num">424</span>       <span class="ruby-keyword">if</span> <span class="ruby-identifier">unused</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;unused&#39;</span>
<span class="line-num">425</span>         <span class="ruby-identifier">unused_associations</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-identifier">sc</span>, <span class="ruby-identifier">assoc</span>]
<span class="line-num">426</span>       <span class="ruby-keyword">end</span>
<span class="line-num">427</span>     <span class="ruby-keyword">end</span>
<span class="line-num">428</span>   <span class="ruby-keyword">end</span>
<span class="line-num">429</span>   <span class="ruby-identifier">unused_associations</span>
<span class="line-num">430</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-update_associations_coverage" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_associations_coverage</span><span
            class="method-args">(opts=OPTS)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Parse the coverage result, and return the coverage data for the associations for descendants of this class. If the plugin uses the :coverage_file option, the existing coverage file will be loaded if present, and before the method returns, the coverage file will be updated.</p>

<p>Options:</p>
<dl class="rdoc-list note-list"><dt>:coverage_result 
<dd>
<p>The coverage result to use. This defaults to <code>Coverage.result</code>.</p>
</dd></dl>
          
          

          
          <div class="method-source-code" id="update_associations_coverage-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/plugins/unused_associations.rb</span>
<span class="line-num">305</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">update_associations_coverage</span>(<span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)
<span class="line-num">306</span>   <span class="ruby-identifier">coverage_result</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:coverage_result</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">Coverage</span>.<span class="ruby-identifier">result</span>
<span class="line-num">307</span>   <span class="ruby-identifier">module_mapping</span> = {}
<span class="line-num">308</span>   <span class="ruby-identifier">file</span> = <span class="ruby-ivar">@unused_associations_coverage_file</span>
<span class="line-num">309</span> 
<span class="line-num">310</span>   <span class="ruby-identifier">coverage_data</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">file</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">file?</span>(<span class="ruby-identifier">file</span>)
<span class="line-num">311</span>     <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">parse_json</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">binread</span>(<span class="ruby-identifier">file</span>))
<span class="line-num">312</span>   <span class="ruby-keyword">else</span>
<span class="line-num">313</span>     {}
<span class="line-num">314</span>   <span class="ruby-keyword">end</span>
<span class="line-num">315</span> 
<span class="line-num">316</span>   ([<span class="ruby-keyword">self</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">descendants</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">sc</span><span class="ruby-operator">|</span>
<span class="line-num">317</span>     <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">sc</span>.<span class="ruby-identifier">associations</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-identifier">sc</span>.<span class="ruby-identifier">name</span>
<span class="line-num">318</span>     <span class="ruby-identifier">module_mapping</span>[<span class="ruby-identifier">sc</span>.<span class="ruby-identifier">send</span>(<span class="ruby-value">:overridable_methods_module</span>)] = <span class="ruby-identifier">sc</span>
<span class="line-num">319</span>     <span class="ruby-identifier">cov_data</span> = <span class="ruby-identifier">coverage_data</span>[<span class="ruby-identifier">sc</span>.<span class="ruby-identifier">name</span>] <span class="ruby-operator">||=</span> {<span class="ruby-string">&#39;&#39;</span><span class="ruby-operator">=&gt;</span>[]}
<span class="line-num">320</span>     <span class="ruby-identifier">cov_data</span>[<span class="ruby-string">&#39;&#39;</span>].<span class="ruby-identifier">concat</span>(<span class="ruby-identifier">sc</span>.<span class="ruby-identifier">used_association_reflections</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:to_s</span>).<span class="ruby-identifier">sort</span>).<span class="ruby-identifier">uniq!</span>
<span class="line-num">321</span>   <span class="ruby-keyword">end</span>
<span class="line-num">322</span> 
<span class="line-num">323</span>   <span class="ruby-identifier">coverage_result</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span>, <span class="ruby-identifier">coverage</span><span class="ruby-operator">|</span>
<span class="line-num">324</span>     <span class="ruby-identifier">coverage</span>[<span class="ruby-value">:methods</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span>(<span class="ruby-identifier">mod</span>, <span class="ruby-identifier">meth</span>), <span class="ruby-identifier">times</span><span class="ruby-operator">|</span>
<span class="line-num">325</span>       <span class="ruby-keyword">next</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">sc</span> = <span class="ruby-identifier">module_mapping</span>[<span class="ruby-identifier">mod</span>]
<span class="line-num">326</span>       <span class="ruby-identifier">coverage_data</span>[<span class="ruby-identifier">sc</span>.<span class="ruby-identifier">name</span>][<span class="ruby-identifier">meth</span>.<span class="ruby-identifier">to_s</span>] <span class="ruby-operator">||=</span> <span class="ruby-value">0</span>
<span class="line-num">327</span>       <span class="ruby-identifier">coverage_data</span>[<span class="ruby-identifier">sc</span>.<span class="ruby-identifier">name</span>][<span class="ruby-identifier">meth</span>.<span class="ruby-identifier">to_s</span>] <span class="ruby-operator">+=</span> <span class="ruby-identifier">times</span>
<span class="line-num">328</span>     <span class="ruby-keyword">end</span>
<span class="line-num">329</span>   <span class="ruby-keyword">end</span>
<span class="line-num">330</span> 
<span class="line-num">331</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">file</span>
<span class="line-num">332</span>     <span class="ruby-constant">File</span>.<span class="ruby-identifier">binwrite</span>(<span class="ruby-identifier">file</span>, <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">object_to_json</span>(<span class="ruby-identifier">coverage_data</span>))
<span class="line-num">333</span>   <span class="ruby-keyword">end</span>
<span class="line-num">334</span> 
<span class="line-num">335</span>   <span class="ruby-identifier">coverage_data</span>
<span class="line-num">336</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-update_unused_associations_data" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">update_unused_associations_data</span><span
            class="method-args">(options=OPTS)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Parse the coverage data returned by <a href="ClassMethods.html#method-i-update_associations_coverage"><code>update_associations_coverage</code></a>, and return data on unused associations and unused association methods.</p>

<p>Options:</p>
<dl class="rdoc-list note-list"><dt>:coverage_data 
<dd>
<p>The coverage data to use. If not given, it is taken from the file specified by the :coverage_file plugin option.</p>
</dd><dt>:keep_coverage 
<dd>
<p>Do not delete the file specified by the :coverage_file plugin option, even if it exists.</p>
</dd></dl>
          
          

          
          <div class="method-source-code" id="update_unused_associations_data-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/plugins/unused_associations.rb</span>
<span class="line-num">346</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">update_unused_associations_data</span>(<span class="ruby-identifier">options</span>=<span class="ruby-constant">OPTS</span>)
<span class="line-num">347</span>   <span class="ruby-identifier">coverage_data</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:coverage_data</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">parse_json</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">binread</span>(<span class="ruby-ivar">@unused_associations_coverage_file</span>))
<span class="line-num">348</span> 
<span class="line-num">349</span>   <span class="ruby-identifier">unused_associations_data</span> = {}
<span class="line-num">350</span> 
<span class="line-num">351</span>   ([<span class="ruby-keyword">self</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">descendants</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">sc</span><span class="ruby-operator">|</span>
<span class="line-num">352</span>     <span class="ruby-keyword">next</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">cov_data</span> = <span class="ruby-identifier">coverage_data</span>[<span class="ruby-identifier">sc</span>.<span class="ruby-identifier">name</span>]
<span class="line-num">353</span>     <span class="ruby-identifier">reflection_data</span> = <span class="ruby-identifier">cov_data</span>[<span class="ruby-string">&#39;&#39;</span>] <span class="ruby-operator">||</span> []
<span class="line-num">354</span> 
<span class="line-num">355</span>     <span class="ruby-identifier">sc</span>.<span class="ruby-identifier">association_reflections</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">assoc</span>, <span class="ruby-identifier">ref</span><span class="ruby-operator">|</span>
<span class="line-num">356</span>       <span class="ruby-comment"># Only report associations for the class they are defined in</span>
<span class="line-num">357</span>       <span class="ruby-keyword">next</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">ref</span>[<span class="ruby-value">:model</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">sc</span>
<span class="line-num">358</span> 
<span class="line-num">359</span>       <span class="ruby-comment"># Do not report associations using methods_module option, because this plugin only</span>
<span class="line-num">360</span>       <span class="ruby-comment"># looks in the class&#39;s overridable_methods_module</span>
<span class="line-num">361</span>       <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">ref</span>[<span class="ruby-value">:methods_module</span>]
<span class="line-num">362</span> 
<span class="line-num">363</span>       <span class="ruby-identifier">info</span> = {}
<span class="line-num">364</span>       <span class="ruby-keyword">if</span> <span class="ruby-identifier">reflection_data</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">assoc</span>.<span class="ruby-identifier">to_s</span>)
<span class="line-num">365</span>         <span class="ruby-identifier">info</span>[<span class="ruby-value">:used</span>] = [<span class="ruby-value">:reflection</span>]
<span class="line-num">366</span>       <span class="ruby-keyword">end</span>
<span class="line-num">367</span> 
<span class="line-num">368</span>       <span class="ruby-identifier">_update_association_coverage_info</span>(<span class="ruby-identifier">info</span>, <span class="ruby-identifier">cov_data</span>, <span class="ruby-identifier">ref</span>.<span class="ruby-identifier">dataset_method</span>, <span class="ruby-value">:dataset_method</span>)
<span class="line-num">369</span>       <span class="ruby-identifier">_update_association_coverage_info</span>(<span class="ruby-identifier">info</span>, <span class="ruby-identifier">cov_data</span>, <span class="ruby-identifier">ref</span>.<span class="ruby-identifier">association_method</span>, <span class="ruby-value">:association_method</span>)
<span class="line-num">370</span> 
<span class="line-num">371</span>       <span class="ruby-keyword">unless</span> <span class="ruby-identifier">ref</span>[<span class="ruby-value">:orig_opts</span>][<span class="ruby-value">:read_only</span>]
<span class="line-num">372</span>         <span class="ruby-keyword">if</span> <span class="ruby-identifier">ref</span>.<span class="ruby-identifier">returns_array?</span>
<span class="line-num">373</span>           <span class="ruby-identifier">_update_association_coverage_info</span>(<span class="ruby-identifier">info</span>, <span class="ruby-identifier">cov_data</span>, <span class="ruby-identifier">ref</span>[<span class="ruby-value">:add_method</span>], <span class="ruby-value">:adder</span>)
<span class="line-num">374</span>           <span class="ruby-identifier">_update_association_coverage_info</span>(<span class="ruby-identifier">info</span>, <span class="ruby-identifier">cov_data</span>, <span class="ruby-identifier">ref</span>[<span class="ruby-value">:remove_method</span>], <span class="ruby-value">:remover</span>)
<span class="line-num">375</span>           <span class="ruby-identifier">_update_association_coverage_info</span>(<span class="ruby-identifier">info</span>, <span class="ruby-identifier">cov_data</span>, <span class="ruby-identifier">ref</span>[<span class="ruby-value">:remove_all_method</span>], <span class="ruby-value">:clearer</span>)
<span class="line-num">376</span>         <span class="ruby-keyword">else</span>
<span class="line-num">377</span>           <span class="ruby-identifier">_update_association_coverage_info</span>(<span class="ruby-identifier">info</span>, <span class="ruby-identifier">cov_data</span>, <span class="ruby-identifier">ref</span>[<span class="ruby-value">:setter_method</span>], <span class="ruby-value">:setter</span>)
<span class="line-num">378</span>         <span class="ruby-keyword">end</span>
<span class="line-num">379</span>       <span class="ruby-keyword">end</span>
<span class="line-num">380</span> 
<span class="line-num">381</span>       <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">info</span>.<span class="ruby-identifier">keys</span> <span class="ruby-operator">==</span> [<span class="ruby-value">:missing</span>]
<span class="line-num">382</span> 
<span class="line-num">383</span>       <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">info</span>[<span class="ruby-value">:used</span>]
<span class="line-num">384</span>         (<span class="ruby-identifier">unused_associations_data</span>[<span class="ruby-identifier">sc</span>.<span class="ruby-identifier">name</span>] <span class="ruby-operator">||=</span> {})[<span class="ruby-identifier">assoc</span>.<span class="ruby-identifier">to_s</span>] = <span class="ruby-string">&#39;unused&#39;</span>
<span class="line-num">385</span>       <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">unused</span> = <span class="ruby-identifier">info</span>[<span class="ruby-value">:unused</span>]
<span class="line-num">386</span>         <span class="ruby-keyword">if</span> <span class="ruby-identifier">unused</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-value">:setter</span>) <span class="ruby-operator">||</span> [<span class="ruby-value">:adder</span>, <span class="ruby-value">:remover</span>, <span class="ruby-value">:clearer</span>].<span class="ruby-identifier">all?</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">k</span><span class="ruby-operator">|</span> <span class="ruby-identifier">unused</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">k</span>)}
<span class="line-num">387</span>           [<span class="ruby-value">:setter</span>, <span class="ruby-value">:adder</span>, <span class="ruby-value">:remover</span>, <span class="ruby-value">:clearer</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span><span class="ruby-operator">|</span>
<span class="line-num">388</span>             <span class="ruby-identifier">unused</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">k</span>)
<span class="line-num">389</span>           <span class="ruby-keyword">end</span>
<span class="line-num">390</span>           <span class="ruby-identifier">unused</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value">:read_only</span>
<span class="line-num">391</span>         <span class="ruby-keyword">end</span>
<span class="line-num">392</span>         (<span class="ruby-identifier">unused_associations_data</span>[<span class="ruby-identifier">sc</span>.<span class="ruby-identifier">name</span>] <span class="ruby-operator">||=</span> {})[<span class="ruby-identifier">assoc</span>.<span class="ruby-identifier">to_s</span>] = <span class="ruby-identifier">unused</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:to_s</span>)
<span class="line-num">393</span>       <span class="ruby-keyword">end</span>
<span class="line-num">394</span>     <span class="ruby-keyword">end</span>
<span class="line-num">395</span>   <span class="ruby-keyword">end</span>
<span class="line-num">396</span> 
<span class="line-num">397</span>   <span class="ruby-keyword">if</span> <span class="ruby-ivar">@unused_associations_file</span>
<span class="line-num">398</span>     <span class="ruby-constant">File</span>.<span class="ruby-identifier">binwrite</span>(<span class="ruby-ivar">@unused_associations_file</span>, <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">object_to_json</span>(<span class="ruby-identifier">unused_associations_data</span>))
<span class="line-num">399</span>   <span class="ruby-keyword">end</span>
<span class="line-num">400</span>   <span class="ruby-keyword">unless</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:keep_coverage</span>]
<span class="line-num">401</span>     <span class="ruby-identifier">_delete_unused_associations_file</span>(<span class="ruby-ivar">@unused_associations_coverage_file</span>)
<span class="line-num">402</span>   <span class="ruby-keyword">end</span>
<span class="line-num">403</span> 
<span class="line-num">404</span>   <span class="ruby-identifier">unused_associations_data</span>
<span class="line-num">405</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-used_association_reflections" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">used_association_reflections</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Synchronize access to the used association reflections.</p>
          
          

          
          <div class="method-source-code" id="used_association_reflections-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/plugins/unused_associations.rb</span>
<span class="line-num">270</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">used_association_reflections</span>
<span class="line-num">271</span>   <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">synchronize</span>{<span class="ruby-ivar">@used_association_reflections</span> <span class="ruby-operator">||=</span> {}}
<span class="line-num">272</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>

</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="https://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://ruby.github.io/rdoc/">RDoc</a> 6.1.2.1.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

