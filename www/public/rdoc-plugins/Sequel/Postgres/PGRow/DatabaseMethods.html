<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>module Sequel::Postgres::PGRow::DatabaseMethods - Sequel: The Database Toolkit for Ruby</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../../../";
  var index_rel_prefix = "../../../";
</script>

<script src="../../../js/navigation.js" defer></script>
<script src="../../../js/search.js" defer></script>
<script src="../../../js/search_index.js" defer></script>
<script src="../../../js/searcher.js" defer></script>
<script src="../../../js/darkfish.js" defer></script>

<link href="../../../css/fonts.css" rel="stylesheet">
<link href="../../../css/rdoc.css" rel="stylesheet">




<body id="top" role="document" class="module">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../../table_of_contents.html#pages">Pages</a>
    <a href="../../../table_of_contents.html#classes">Classes</a>
    <a href="../../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    
    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-c-extended">::extended</a>
    
    <li class="calls-super" ><a href="#method-i-bound_variable_arg">#bound_variable_arg</a>
    
    <li class="calls-super" ><a href="#method-i-freeze">#freeze</a>
    
    <li ><a href="#method-i-register_row_type">#register_row_type</a>
    
    <li ><a href="#method-i-row_type">#row_type</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="module-Sequel::Postgres::PGRow::DatabaseMethods">
  <h1 id="module-Sequel::Postgres::PGRow::DatabaseMethods" class="module">
    module Sequel::Postgres::PGRow::DatabaseMethods
  </h1>

  <section class="description">
    
  </section>

  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    
    <section class="attribute-method-details" class="method-section">
      <header>
        <h3>Attributes</h3>
      </header>

      
      <div id="attribute-i-row_types" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">row_types</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        <p>A hash mapping row type keys (usually symbols), to option hashes.  At the least, the values will contain the :parser option for the <a href="Parser.html"><code>Parser</code></a> instance that the type will use.</p>
        
        </div>
      </div>
      
    </section>
    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-extended" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">extended</span><span
            class="method-args">(db)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Do some setup for the data structures the module uses.</p>
          
          

          
          <div class="method-source-code" id="extended-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/extensions/pg_row.rb</span>
<span class="line-num">372</span> <span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">extended</span>(<span class="ruby-identifier">db</span>)
<span class="line-num">373</span>   <span class="ruby-identifier">db</span>.<span class="ruby-identifier">instance_exec</span> <span class="ruby-keyword">do</span>
<span class="line-num">374</span>     <span class="ruby-ivar">@row_types</span> = {}
<span class="line-num">375</span>     <span class="ruby-ivar">@row_schema_types</span> = {}
<span class="line-num">376</span>     <span class="ruby-identifier">extend</span>(<span class="ruby-ivar">@row_type_method_module</span> = <span class="ruby-constant">Module</span>.<span class="ruby-identifier">new</span>)
<span class="line-num">377</span>     <span class="ruby-identifier">add_conversion_proc</span>(<span class="ruby-value">2249</span>, <span class="ruby-constant">PGRow</span><span class="ruby-operator">::</span><span class="ruby-constant">Parser</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:converter</span><span class="ruby-operator">=&gt;</span><span class="ruby-constant">PGRow</span><span class="ruby-operator">::</span><span class="ruby-constant">ArrayRow</span>))
<span class="line-num">378</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:register_array_type</span>)
<span class="line-num">379</span>       <span class="ruby-identifier">register_array_type</span>(<span class="ruby-string">&#39;record&#39;</span>, <span class="ruby-value">:oid</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">2287</span>, <span class="ruby-value">:scalar_oid</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">2249</span>)
<span class="line-num">380</span>     <span class="ruby-keyword">end</span>
<span class="line-num">381</span>   <span class="ruby-keyword">end</span>
<span class="line-num">382</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-bound_variable_arg" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">bound_variable_arg</span><span
            class="method-args">(arg, conn)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Handle <a href="ArrayRow.html"><code>ArrayRow</code></a> and <a href="HashRow.html"><code>HashRow</code></a> values in bound variables.</p>
          
          
            <div class="method-calls-super">
              Calls superclass method
              
            </div>
          

          
          <div class="method-source-code" id="bound_variable_arg-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/extensions/pg_row.rb</span>
<span class="line-num">385</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">bound_variable_arg</span>(<span class="ruby-identifier">arg</span>, <span class="ruby-identifier">conn</span>)
<span class="line-num">386</span>   <span class="ruby-keyword">case</span> <span class="ruby-identifier">arg</span>
<span class="line-num">387</span>   <span class="ruby-keyword">when</span> <span class="ruby-constant">ArrayRow</span>
<span class="line-num">388</span>     <span class="ruby-node">&quot;(#{arg.map{|v| bound_variable_array(v) if v}.join(&#39;,&#39;)})&quot;</span>
<span class="line-num">389</span>   <span class="ruby-keyword">when</span> <span class="ruby-constant">HashRow</span>
<span class="line-num">390</span>     <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">check_columns!</span>
<span class="line-num">391</span>     <span class="ruby-node">&quot;(#{arg.values_at(*arg.columns).map{|v| bound_variable_array(v) if v}.join(&#39;,&#39;)})&quot;</span>
<span class="line-num">392</span>   <span class="ruby-keyword">else</span>
<span class="line-num">393</span>     <span class="ruby-keyword">super</span>
<span class="line-num">394</span>   <span class="ruby-keyword">end</span>
<span class="line-num">395</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-freeze" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">freeze</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Freeze the row types and row schema types to prevent adding new ones.</p>
          
          
            <div class="method-calls-super">
              Calls superclass method
              
            </div>
          

          
          <div class="method-source-code" id="freeze-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/extensions/pg_row.rb</span>
<span class="line-num">398</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">freeze</span>
<span class="line-num">399</span>   <span class="ruby-ivar">@row_types</span>.<span class="ruby-identifier">freeze</span>
<span class="line-num">400</span>   <span class="ruby-ivar">@row_schema_types</span>.<span class="ruby-identifier">freeze</span>
<span class="line-num">401</span>   <span class="ruby-ivar">@row_type_method_module</span>.<span class="ruby-identifier">freeze</span>
<span class="line-num">402</span>   <span class="ruby-keyword">super</span>
<span class="line-num">403</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-register_row_type" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">register_row_type</span><span
            class="method-args">(db_type, opts=OPTS)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Register a new row type for the <a href="../../../Database.html"><code>Database</code></a> instance. db_type should be the type symbol.  This parses the PostgreSQL system tables to get information the composite type, and by default has the type return instances of a subclass of <a href="HashRow.html"><code>HashRow</code></a>.</p>

<p>The following options are supported:</p>
<dl class="rdoc-list note-list"><dt>:converter 
<dd>
<p>Use a custom converter for the parser.</p>
</dd><dt>:typecaster 
<dd>
<p>Use a custom typecaster for the parser.</p>
</dd></dl>
          
          

          
          <div class="method-source-code" id="register_row_type-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/extensions/pg_row.rb</span>
<span class="line-num">414</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">register_row_type</span>(<span class="ruby-identifier">db_type</span>, <span class="ruby-identifier">opts</span>=<span class="ruby-constant">OPTS</span>)
<span class="line-num">415</span>   <span class="ruby-identifier">procs</span> = <span class="ruby-ivar">@conversion_procs</span>
<span class="line-num">416</span>   <span class="ruby-identifier">rel_oid</span> = <span class="ruby-keyword">nil</span>
<span class="line-num">417</span>   <span class="ruby-identifier">array_oid</span> = <span class="ruby-keyword">nil</span>
<span class="line-num">418</span>   <span class="ruby-identifier">parser_opts</span> = {}
<span class="line-num">419</span> 
<span class="line-num">420</span>   <span class="ruby-comment"># Try to handle schema-qualified types.</span>
<span class="line-num">421</span>   <span class="ruby-identifier">type_schema</span>, <span class="ruby-identifier">type_name</span> = <span class="ruby-identifier">schema_and_table</span>(<span class="ruby-identifier">db_type</span>)
<span class="line-num">422</span>   <span class="ruby-identifier">schema_type_string</span> = <span class="ruby-identifier">type_name</span>.<span class="ruby-identifier">to_s</span>
<span class="line-num">423</span> 
<span class="line-num">424</span>   <span class="ruby-comment"># Get basic oid information for the composite type.</span>
<span class="line-num">425</span>   <span class="ruby-identifier">ds</span> = <span class="ruby-identifier">from</span>(<span class="ruby-value">:pg_type</span>).
<span class="line-num">426</span>     <span class="ruby-identifier">select</span>{[<span class="ruby-identifier">pg_type</span>[<span class="ruby-value">:oid</span>], <span class="ruby-value">:typrelid</span>, <span class="ruby-value">:typarray</span>]}.
<span class="line-num">427</span>     <span class="ruby-identifier">where</span>([[<span class="ruby-value">:typtype</span>, <span class="ruby-string">&#39;c&#39;</span>], [<span class="ruby-value">:typname</span>, <span class="ruby-identifier">type_name</span>.<span class="ruby-identifier">to_s</span>]])
<span class="line-num">428</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">type_schema</span>
<span class="line-num">429</span>     <span class="ruby-identifier">ds</span> = <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value">:pg_namespace</span>, [[<span class="ruby-value">:oid</span>, <span class="ruby-value">:typnamespace</span>], [<span class="ruby-value">:nspname</span>, <span class="ruby-identifier">type_schema</span>.<span class="ruby-identifier">to_s</span>]])
<span class="line-num">430</span>     <span class="ruby-identifier">schema_type_symbol</span> = <span class="ruby-value">:&quot;pg_row_#{type_schema}__#{type_name}&quot;</span> 
<span class="line-num">431</span>   <span class="ruby-keyword">else</span>
<span class="line-num">432</span>     <span class="ruby-identifier">schema_type_symbol</span> = <span class="ruby-value">:&quot;pg_row_#{type_name}&quot;</span>
<span class="line-num">433</span>   <span class="ruby-keyword">end</span>
<span class="line-num">434</span>   <span class="ruby-keyword">unless</span> <span class="ruby-identifier">row</span> = <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">first</span>
<span class="line-num">435</span>     <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-node">&quot;row type #{db_type.inspect} not found in database&quot;</span>
<span class="line-num">436</span>   <span class="ruby-keyword">end</span>
<span class="line-num">437</span>   <span class="ruby-comment"># Manually cast to integer using to_i, because adapter may not cast oid type</span>
<span class="line-num">438</span>   <span class="ruby-comment"># correctly (e.g. swift)</span>
<span class="line-num">439</span>   <span class="ruby-identifier">parser_opts</span>[<span class="ruby-value">:oid</span>], <span class="ruby-identifier">rel_oid</span>, <span class="ruby-identifier">array_oid</span> = <span class="ruby-identifier">row</span>.<span class="ruby-identifier">values_at</span>(<span class="ruby-value">:oid</span>, <span class="ruby-value">:typrelid</span>, <span class="ruby-value">:typarray</span>).<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:to_i</span>)
<span class="line-num">440</span> 
<span class="line-num">441</span>   <span class="ruby-comment"># Get column names and oids for each of the members of the composite type.</span>
<span class="line-num">442</span>   <span class="ruby-identifier">res</span> = <span class="ruby-identifier">from</span>(<span class="ruby-value">:pg_attribute</span>).
<span class="line-num">443</span>     <span class="ruby-identifier">join</span>(<span class="ruby-value">:pg_type</span>, <span class="ruby-value">:oid</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">:atttypid</span>).
<span class="line-num">444</span>     <span class="ruby-identifier">where</span>(<span class="ruby-value">:attrelid</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">rel_oid</span>).
<span class="line-num">445</span>     <span class="ruby-identifier">where</span>{<span class="ruby-identifier">attnum</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>}.
<span class="line-num">446</span>     <span class="ruby-identifier">exclude</span>(<span class="ruby-value">:attisdropped</span>).
<span class="line-num">447</span>     <span class="ruby-identifier">order</span>(<span class="ruby-value">:attnum</span>).
<span class="line-num">448</span>     <span class="ruby-identifier">select_map</span>{[<span class="ruby-value">:attname</span>, <span class="ruby-constant">Sequel</span>.<span class="ruby-identifier">case</span>({<span class="ruby-value">0</span><span class="ruby-operator">=&gt;</span><span class="ruby-value">:atttypid</span>}, <span class="ruby-identifier">pg_type</span>[<span class="ruby-value">:typbasetype</span>], <span class="ruby-identifier">pg_type</span>[<span class="ruby-value">:typbasetype</span>]).<span class="ruby-identifier">as</span>(<span class="ruby-value">:atttypid</span>)]}
<span class="line-num">449</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">res</span>.<span class="ruby-identifier">empty?</span>
<span class="line-num">450</span>     <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-node">&quot;no columns for row type #{db_type.inspect} in database&quot;</span>
<span class="line-num">451</span>   <span class="ruby-keyword">end</span>
<span class="line-num">452</span>   <span class="ruby-identifier">parser_opts</span>[<span class="ruby-value">:columns</span>] = <span class="ruby-identifier">res</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-identifier">r</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">to_sym</span>}
<span class="line-num">453</span>   <span class="ruby-identifier">parser_opts</span>[<span class="ruby-value">:column_oids</span>] = <span class="ruby-identifier">res</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-identifier">r</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">to_i</span>}
<span class="line-num">454</span> 
<span class="line-num">455</span>   <span class="ruby-comment"># Using the conversion_procs, lookup converters for each member of the composite type</span>
<span class="line-num">456</span>   <span class="ruby-identifier">parser_opts</span>[<span class="ruby-value">:column_converters</span>] = <span class="ruby-identifier">parser_opts</span>[<span class="ruby-value">:column_oids</span>].<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">oid</span><span class="ruby-operator">|</span>
<span class="line-num">457</span>     <span class="ruby-identifier">procs</span>[<span class="ruby-identifier">oid</span>]
<span class="line-num">458</span>   <span class="ruby-keyword">end</span>
<span class="line-num">459</span> 
<span class="line-num">460</span>   <span class="ruby-comment"># Setup the converter and typecaster</span>
<span class="line-num">461</span>   <span class="ruby-identifier">parser_opts</span>[<span class="ruby-value">:converter</span>] = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-value">:converter</span>){<span class="ruby-constant">HashRow</span>.<span class="ruby-identifier">subclass</span>(<span class="ruby-identifier">db_type</span>, <span class="ruby-identifier">parser_opts</span>[<span class="ruby-value">:columns</span>])}
<span class="line-num">462</span>   <span class="ruby-identifier">parser_opts</span>[<span class="ruby-value">:typecaster</span>] = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-value">:typecaster</span>, <span class="ruby-identifier">parser_opts</span>[<span class="ruby-value">:converter</span>])
<span class="line-num">463</span> 
<span class="line-num">464</span>   <span class="ruby-identifier">parser</span> = <span class="ruby-constant">Parser</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">parser_opts</span>)
<span class="line-num">465</span>   <span class="ruby-identifier">add_conversion_proc</span>(<span class="ruby-identifier">parser</span>.<span class="ruby-identifier">oid</span>, <span class="ruby-identifier">parser</span>)
<span class="line-num">466</span> 
<span class="line-num">467</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:register_array_type</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">array_oid</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">array_oid</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
<span class="line-num">468</span>     <span class="ruby-identifier">array_type_name</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">type_schema</span>
<span class="line-num">469</span>       <span class="ruby-node">&quot;#{type_schema}.#{type_name}&quot;</span>
<span class="line-num">470</span>     <span class="ruby-keyword">else</span>
<span class="line-num">471</span>       <span class="ruby-identifier">type_name</span>
<span class="line-num">472</span>     <span class="ruby-keyword">end</span>
<span class="line-num">473</span>     <span class="ruby-identifier">register_array_type</span>(<span class="ruby-identifier">array_type_name</span>, <span class="ruby-value">:oid</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">array_oid</span>, <span class="ruby-value">:converter</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">parser</span>, <span class="ruby-value">:scalar_typecast</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">schema_type_symbol</span>)
<span class="line-num">474</span>   <span class="ruby-keyword">end</span>
<span class="line-num">475</span> 
<span class="line-num">476</span>   <span class="ruby-ivar">@row_types</span>[<span class="ruby-identifier">literal</span>(<span class="ruby-identifier">db_type</span>)] = <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-value">:parser</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">parser</span>, <span class="ruby-value">:type</span><span class="ruby-operator">=&gt;</span><span class="ruby-identifier">db_type</span>)
<span class="line-num">477</span>   <span class="ruby-ivar">@row_schema_types</span>[<span class="ruby-identifier">schema_type_string</span>] = <span class="ruby-identifier">schema_type_symbol</span> 
<span class="line-num">478</span>   <span class="ruby-ivar">@schema_type_classes</span>[<span class="ruby-identifier">schema_type_symbol</span>] = <span class="ruby-constant">ROW_TYPE_CLASSES</span>
<span class="line-num">479</span>   <span class="ruby-ivar">@row_type_method_module</span>.<span class="ruby-identifier">class_eval</span> <span class="ruby-keyword">do</span>
<span class="line-num">480</span>     <span class="ruby-identifier">meth</span> = <span class="ruby-value">:&quot;typecast_value_#{schema_type_symbol}&quot;</span>
<span class="line-num">481</span>     <span class="ruby-identifier">define_method</span>(<span class="ruby-identifier">meth</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
<span class="line-num">482</span>       <span class="ruby-identifier">row_type</span>(<span class="ruby-identifier">db_type</span>, <span class="ruby-identifier">v</span>)
<span class="line-num">483</span>     <span class="ruby-keyword">end</span>
<span class="line-num">484</span>     <span class="ruby-identifier">private</span> <span class="ruby-identifier">meth</span>
<span class="line-num">485</span>     <span class="ruby-identifier">alias_method</span>(<span class="ruby-identifier">meth</span>, <span class="ruby-identifier">meth</span>)
<span class="line-num">486</span>   <span class="ruby-keyword">end</span>
<span class="line-num">487</span> 
<span class="line-num">488</span>   <span class="ruby-keyword">nil</span>
<span class="line-num">489</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-row_type" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">row_type</span><span
            class="method-args">(db_type, obj)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Handle typecasting of the given object to the given database type. In general, the given database type should already be registered, but if obj is an array, this will handled unregistered types.</p>
          
          

          
          <div class="method-source-code" id="row_type-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/extensions/pg_row.rb</span>
<span class="line-num">494</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">row_type</span>(<span class="ruby-identifier">db_type</span>, <span class="ruby-identifier">obj</span>)
<span class="line-num">495</span>   (<span class="ruby-identifier">type_hash</span> = <span class="ruby-ivar">@row_types</span>[<span class="ruby-identifier">literal</span>(<span class="ruby-identifier">db_type</span>)]) <span class="ruby-operator">&amp;&amp;</span>
<span class="line-num">496</span>     (<span class="ruby-identifier">parser</span> = <span class="ruby-identifier">type_hash</span>[<span class="ruby-value">:parser</span>])
<span class="line-num">497</span> 
<span class="line-num">498</span>   <span class="ruby-keyword">case</span> <span class="ruby-identifier">obj</span>
<span class="line-num">499</span>   <span class="ruby-keyword">when</span> <span class="ruby-constant">ArrayRow</span>, <span class="ruby-constant">HashRow</span>
<span class="line-num">500</span>     <span class="ruby-identifier">obj</span>
<span class="line-num">501</span>   <span class="ruby-keyword">when</span> <span class="ruby-constant">Array</span>
<span class="line-num">502</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">parser</span>
<span class="line-num">503</span>       <span class="ruby-identifier">parser</span>.<span class="ruby-identifier">typecast</span>(<span class="ruby-identifier">obj</span>)
<span class="line-num">504</span>     <span class="ruby-keyword">else</span>
<span class="line-num">505</span>       <span class="ruby-identifier">obj</span> = <span class="ruby-constant">ArrayRow</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">obj</span>)
<span class="line-num">506</span>       <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">db_type</span> = <span class="ruby-identifier">db_type</span>
<span class="line-num">507</span>       <span class="ruby-identifier">obj</span>
<span class="line-num">508</span>     <span class="ruby-keyword">end</span>
<span class="line-num">509</span>   <span class="ruby-keyword">when</span> <span class="ruby-constant">Hash</span>
<span class="line-num">510</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">parser</span> 
<span class="line-num">511</span>       <span class="ruby-identifier">parser</span>.<span class="ruby-identifier">typecast</span>(<span class="ruby-identifier">obj</span>)
<span class="line-num">512</span>     <span class="ruby-keyword">else</span>
<span class="line-num">513</span>       <span class="ruby-identifier">raise</span> <span class="ruby-constant">InvalidValue</span>, <span class="ruby-node">&quot;Database#row_type requires the #{db_type.inspect} type have a registered parser and typecaster when called with a hash&quot;</span>
<span class="line-num">514</span>     <span class="ruby-keyword">end</span>
<span class="line-num">515</span>   <span class="ruby-keyword">else</span>
<span class="line-num">516</span>     <span class="ruby-identifier">raise</span> <span class="ruby-constant">InvalidValue</span>, <span class="ruby-node">&quot;cannot convert #{obj.inspect} to row type #{db_type.inspect}&quot;</span>
<span class="line-num">517</span>   <span class="ruby-keyword">end</span>
<span class="line-num">518</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>

</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="https://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://ruby.github.io/rdoc/">RDoc</a> 6.1.2.1.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

