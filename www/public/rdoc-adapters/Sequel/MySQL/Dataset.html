<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class Sequel::MySQL::Dataset - Sequel: The Database Toolkit for Ruby</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
  var index_rel_prefix = "../../";
</script>

<script src="../../js/navigation.js" defer></script>
<script src="../../js/search.js" defer></script>
<script src="../../js/search_index.js" defer></script>
<script src="../../js/searcher.js" defer></script>
<script src="../../js/darkfish.js" defer></script>

<link href="../../css/fonts.css" rel="stylesheet">
<link href="../../css/rdoc.css" rel="stylesheet">




<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../table_of_contents.html#pages">Pages</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link"><a href="../Dataset.html">Sequel::Dataset</a>
  
</div>

    <div id="includes-section" class="nav-section">
  <h3>Included Modules</h3>

  <ul class="link-list">
  
  
    <li><a class="include" href="DatasetMethods.html">Sequel::MySQL::DatasetMethods</a>
  
  
  
    <li><a class="include" href="MysqlMysql2/DatasetMethods.html">Sequel::MySQL::MysqlMysql2::DatasetMethods</a>
  
  
  
    <li><a class="include" href="PreparedStatements/DatasetMethods.html">Sequel::MySQL::PreparedStatements::DatasetMethods</a>
  
  
  </ul>
</div>

    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-i-fetch_rows">#fetch_rows</a>
    
    <li class="calls-super" ><a href="#method-i-graph">#graph</a>
    
    <li ><a href="#method-i-split_multiple_result_sets">#split_multiple_result_sets</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-Sequel::MySQL::Dataset">
  <h1 id="class-Sequel::MySQL::Dataset" class="class">
    class Sequel::MySQL::Dataset
  </h1>

  <section class="description">
    
  </section>

  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-fetch_rows" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">fetch_rows</span><span
            class="method-args">(sql) { |s| ... }</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Yield all rows matching this dataset.  If the dataset is set to split multiple statements, yield arrays of hashes one per statement instead of yielding results for all statements as hashes.</p>
          
          

          
          <div class="method-source-code" id="fetch_rows-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/adapters/mysql.rb</span>
<span class="line-num">293</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">fetch_rows</span>(<span class="ruby-identifier">sql</span>)
<span class="line-num">294</span>   <span class="ruby-identifier">execute</span>(<span class="ruby-identifier">sql</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span>
<span class="line-num">295</span>     <span class="ruby-identifier">i</span> = <span class="ruby-value">-1</span>
<span class="line-num">296</span>     <span class="ruby-identifier">cps</span> = <span class="ruby-identifier">db</span>.<span class="ruby-identifier">conversion_procs</span>
<span class="line-num">297</span>     <span class="ruby-identifier">cols</span> = <span class="ruby-identifier">r</span>.<span class="ruby-identifier">fetch_fields</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> 
<span class="line-num">298</span>       <span class="ruby-comment"># Pretend tinyint is another integer type if its length is not 1, to</span>
<span class="line-num">299</span>       <span class="ruby-comment"># avoid casting to boolean if convert_tinyint_to_bool is set.</span>
<span class="line-num">300</span>       <span class="ruby-identifier">type_proc</span> = <span class="ruby-identifier">f</span>.<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">cast_tinyint_integer?</span>(<span class="ruby-identifier">f</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">cps</span>[<span class="ruby-value">2</span>] <span class="ruby-operator">:</span> <span class="ruby-identifier">cps</span>[<span class="ruby-identifier">f</span>.<span class="ruby-identifier">type</span>]
<span class="line-num">301</span>       [<span class="ruby-identifier">output_identifier</span>(<span class="ruby-identifier">f</span>.<span class="ruby-identifier">name</span>), <span class="ruby-identifier">type_proc</span>, <span class="ruby-identifier">i</span><span class="ruby-operator">+=</span><span class="ruby-value">1</span>]
<span class="line-num">302</span>     <span class="ruby-keyword">end</span>
<span class="line-num">303</span>     <span class="ruby-keyword">self</span>.<span class="ruby-identifier">columns</span> = <span class="ruby-identifier">cols</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:first</span>)
<span class="line-num">304</span>     <span class="ruby-keyword">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:split_multiple_result_sets</span>]
<span class="line-num">305</span>       <span class="ruby-identifier">s</span> = []
<span class="line-num">306</span>       <span class="ruby-identifier">yield_rows</span>(<span class="ruby-identifier">r</span>, <span class="ruby-identifier">cols</span>){<span class="ruby-operator">|</span><span class="ruby-identifier">h</span><span class="ruby-operator">|</span> <span class="ruby-identifier">s</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">h</span>}
<span class="line-num">307</span>       <span class="ruby-keyword">yield</span> <span class="ruby-identifier">s</span>
<span class="line-num">308</span>     <span class="ruby-keyword">else</span>
<span class="line-num">309</span>       <span class="ruby-identifier">yield_rows</span>(<span class="ruby-identifier">r</span>, <span class="ruby-identifier">cols</span>){<span class="ruby-operator">|</span><span class="ruby-identifier">h</span><span class="ruby-operator">|</span> <span class="ruby-keyword">yield</span> <span class="ruby-identifier">h</span>}
<span class="line-num">310</span>     <span class="ruby-keyword">end</span>
<span class="line-num">311</span>   <span class="ruby-keyword">end</span>
<span class="line-num">312</span>   <span class="ruby-keyword">self</span>
<span class="line-num">313</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-graph" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">graph</span><span
            class="method-args">(*)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Don&#39;t allow graphing a dataset that splits multiple statements</p>
          
          
            <div class="method-calls-super">
              Calls superclass method
              
            </div>
          

          
          <div class="method-source-code" id="graph-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/adapters/mysql.rb</span>
<span class="line-num">316</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">graph</span>(<span class="ruby-operator">*</span>)
<span class="line-num">317</span>   <span class="ruby-identifier">raise</span>(<span class="ruby-constant">Error</span>, <span class="ruby-string">&quot;Can&#39;t graph a dataset that splits multiple result sets&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:split_multiple_result_sets</span>]
<span class="line-num">318</span>   <span class="ruby-keyword">super</span>
<span class="line-num">319</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-split_multiple_result_sets" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">split_multiple_result_sets</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Makes each yield arrays of rows, with each array containing the rows for a given result set.  Does not work with graphing.  So you can submit SQL with multiple statements and easily determine which statement returned which results.</p>

<p>Modifies the row_proc of the returned dataset so that it still works as expected (running on the hashes instead of on the arrays of hashes). If you modify the row_proc afterward, note that it will receive an array of hashes instead of a hash.</p>
          
          

          
          <div class="method-source-code" id="split_multiple_result_sets-source">
            <pre>    <span class="ruby-comment"># File lib/sequel/adapters/mysql.rb</span>
<span class="line-num">330</span> <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">split_multiple_result_sets</span>
<span class="line-num">331</span>   <span class="ruby-identifier">raise</span>(<span class="ruby-constant">Error</span>, <span class="ruby-string">&quot;Can&#39;t split multiple statements on a graphed dataset&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:graph</span>]
<span class="line-num">332</span>   <span class="ruby-identifier">ds</span> = <span class="ruby-identifier">clone</span>(<span class="ruby-value">:split_multiple_result_sets</span><span class="ruby-operator">=&gt;</span><span class="ruby-keyword">true</span>)
<span class="line-num">333</span>   <span class="ruby-identifier">ds</span> = <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">with_row_proc</span>(<span class="ruby-identifier">proc</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">h</span><span class="ruby-operator">|</span> <span class="ruby-identifier">row_proc</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">h</span>)}}) <span class="ruby-keyword">if</span> <span class="ruby-identifier">row_proc</span>
<span class="line-num">334</span>   <span class="ruby-identifier">ds</span>
<span class="line-num">335</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>

</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="https://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://ruby.github.io/rdoc/">RDoc</a> 6.1.2.1.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

